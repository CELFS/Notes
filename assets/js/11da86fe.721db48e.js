"use strict";(self.webpackChunknotes_new=self.webpackChunknotes_new||[]).push([[7073],{3774:(n,r,e)=>{e.d(r,{R:()=>t,x:()=>c});var i=e(36672);const l={},s=i.createContext(l);function t(n){const r=i.useContext(s);return i.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function c(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),i.createElement(s.Provider,{value:r},n.children)}},5201:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240601235616489-79961b62ed040a15d2bc6bec740927b6.png"},5563:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606192403133-b6c69fd5d62c3243b88b115d1ba7c061.png"},7530:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240602040014676-74b420f99d8328b10ecc317d03f01503.png"},8126:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240611161144629-062fe535cb85bfc90394861d1a147cea.png"},12607:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240609172142090-db0d52cc4800dcf236e15ac81cb8f36d.png"},13379:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240605194810999-7ede850ccdd37407cb0dac11258c92ac.png"},13929:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606192038149-314b4356f6aed2cc6d5002d4dc7d253f.png"},14668:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240602041641378-12defa1d16da78548a123378d080fc68.png"},16163:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240618121321093-83c74fdf40653d271727cb6d9757d194.png"},18455:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604230431718-57c7e9a9937b2604a9f123a097eb52d7.png"},18915:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240614211235941-63eeda3ddced4192153caae438d6e272.png"},19124:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240603165739507-19297526da934a6422932976e30d9046.png"},20131:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240605194103282-70370ef8860462c3ea2449a7dba29e12.png"},20954:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606181933931-773fc5ec17518001b71b47a489510e92.png"},21891:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604224636804-ed8c07c4a93390b8ce76875f7865c18d.png"},22346:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240616172857955-3ef0bd518f2448beebf7ceae88ecf093.png"},23378:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606200519630-8b582b87edb871e43749add36a4f8964.png"},25130:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604231848174-4203aac575d1f7ed6ed0fb899ec845f9.png"},25137:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240618121218816-91400f9e8466cb2e25b20e2029e7982d.png"},25744:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240607190707524-4c5951db017cb7d37a6ef0554677557b.png"},29021:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606185310951-915af79373bec6d3a0d63a6d0b749c4b.png"},32556:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240602041330863-8411082a34ca1f1684df42bc549c401c.png"},32927:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604183756142-4d3984c11d711ab88e008f7a18d5c498.png"},35304:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604225535558-0e545a3b74838e704d9a671876ecfb3f.png"},44281:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240611232444662-851bf933183286b78851ce34a0ce722f.png"},44820:(n,r,e)=>{e.d(r,{A:()=>i});const i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAuQAAAB6CAYAAAD3V0Z/AAAgAElEQVR4nO3db4jk5p0n8O84TnY2U9lxJetKx24yibBn6o70XezKBZZD4N7qzUGQEbt4oA7uxTmgmFBHvTjCCS5HyoLbhTr2lUixZAs29yKQgg4bRMRxJN0Zg1gCXssOdEiqbaPchLHj7SRbmbWymbUnmXuhPyVVSY9U/7p6Zr4fGJjup/T8kxp+/fRPz3Nua2vrDgBcuvQ4AOD69ddARERERESn44FNd4CIiIiI6H52ZgLy3UeexLXd3eDf5YeyP/TQ5clndp9E73yJimUDQ9uGbduwbRNa4QVP4eHnvouPfWK+/p+6xLiGhhx9E8bQhlk8yFy3v/Is3lFW0sMzaPn5ISIiIlq1B0WFj/3+7+O/b2/j3/3BHwAA/v6f/gl/ceMGXv/Nb1bekWtvvoxrbwaB+Zcr2Z8ZPPEoXn/lGrRflaxUM2GrgKUoGERfDw2MWl04K+r3pmhXG4Dbg3Kwh6F+FRocjIw2GicWlMGmezdLM200xz20unf7zBMRERGtVu4K+c6FC/iby5fxvZs38alXXsGnXnkF37t5E39z+TJ2Llw4zT4Gzj+CLbyBH5QNxiHDaNbg9jqI49PBPlxcwZ4suu7ucXIjEdzKBtqNE1idMxiNExEREVGuzBXy9547h89vbeFrb72FT1Uq+O2dOwCAT1Uq+Npbb+HzW1v4r56Hd8Pvz3joMq498Wj8pX/8fTz95i0AQO/JXXz6YljwxivYfbVkhH2+gpyF83SdeAPfvPYq+tpVNE4OoaQWZB0cHLfhOE/h4ee+hAt/9yf4fz8MSt73mW/hkx/8Dl4c/jj87Bfwsf/2Z6gBAF7Hi//rC+X6+fxtuE/fjr98+6Xfw1PPncNXX3gH+OqD+NAX38HHAQAP4tuNB/E8ICzLM9h3MdRt2Crguxa22ypOLAVlw/HbX3kW/xJnBl3Hhf/0vUTpR/HO15t4N7MsjwxjqKMR3yQPltLByBhCj7+pw7b1sNiC0hkA0GDaKqToMt9Fr9WFAxnGsA30D1HVo/KgzuIxZvdlcl2yzbJ1EhEREa1HZkBeffBBPPze9+KFmzfxz7/7Hf7HRz8KAPifP/0pXnz7bfyHahXVBx/Eybvvzl780GVce6KCF79/DfqtdFH78i4+7b+C3ZeDILz35C6+/cgkWM+y+8iT+PKVONrGM7uP4hkgDuZ3H3kyVWdE25HgHXWQCr58F73Dk6I5AQDUPvsZ/OR//wlePAE+0PouPt36Al4c/pX4oudvw336d3jpL8/juW9MF/4On/ribbz0l+fxzDeA5795C09/8wE8/8wDBWU5nC5a0S8bmgm7Wj5V5XftP8W//OIQF/7LTzPL32018Ht//jVc+HEQuN9qX8T5/k1hnXKULtOa6kS3BQd5KSsyjKGKmtuD0nUQBdK6qcHpjABU0NCbcHsKFCeoQzU1DAr+CpDbl5CkRnUG7TUNGQOm0hAREdGGrPylzp70KPzjH80E4wDwyUffwDcTK+K69wYqWx/ErqC+a2++jN1r17D7yhsIVr+vBV8nV9YfraGdukrGds3HeARoZhjwWR5wcqN07vjJ//lT/DyM3d/+4evAR/9N4TVffeo23n7pvRnBeOAn335fXPb8Dx8E/vAO/mOJMjENplqDuz/nGu9jj+UWvXf4LTwY/qHggR//Cr99+GLuZ1OknRIvzSZoV9GoeDiMg2EH3b4LX9qJP+JZLUTFgyMPqG2jVMaRoC+TOh0cHPuoVOvz9JqIiIhopTJXyMe3b+Pn776Lpy5exL+9cAF/8dNgJfWPPvABvP+BB/Dzd9/F+PbtrEvxwYvAW15GNH7+EWzh0ckKd+Tm8VIDuPbmy/jXld243iA9BgBOcMPRsKN7OFQcyEYb/ngEYEdcYZaTMXxUCz/2oQ8Av/jZufL1fuAOrixSlhD9wnF01UaQDeLD7U2C2CwP9L+F8w8/i19//VkAwHu+/7eFK+BFnG4LddOGattQAfhuyRc4/TFG8zRUqaIOCH+xWrgvRERERBuQGZC/e+cO/vqtt9B/7DH89c9+hr/95S8BAO85dw6f/8hH0H799dz88X+8CXwwt7kwv3sFHU/qv3oN/VeD/w92d4E3H0O1AtyQt8MccKBereDkyIG83Z5/h5VaFZWb48KP/fJt4EPz1Pv2ORwD+IigTEgzodZc9Pb30NYnOdvtPRlwxKN8z/NfQ/Bq7kfxztf/DLewfFA+6EQ57BpMW8fQQHEgPB1g16u57woAKB3AZ/elxIVEREREpyw3ZeXo17/G5159FX988SJeeuIJvPTEE/jjixfxuVdfxdGvf51b4f996yYee+LyVAoJgFtv4kc3H8UzeXuMr8g/3gSAEcZ+8rsadiQAkLGXWHZ+/yNPBf/5xF/hk5/MCwOfwsP//jH4P/lOYdsvHD+Ajz99W/gyZuSbT9/G28cPICu7RVQ2Eaaq9NNbONarwnA2w0/xQOmda8qann9gNPZRubKXTjcZHMGDhGZyH/WmBN/dz6hTg6lK8I8PJuON9mIfGoI0ltm+EBEREZ0lwn3IX//Nb/C5116bq8Jrb74M4El8eXc3Tk2JdlnRX76G3pO7uJZIGo/K0julPIFrj6LULizp64JrgrSUGraxj2Nfh2rX4LoeGqoOeBaAF/Dzb30GD//nL+HTn/wScPPv8eMf+PhXiaX92me/i9pnwz7+4M/xo++8UDj2bzz3PuCr7+CL7i08HX4v2mUFAD7+9C24T89+v6gsS5Sq0nEAoIvDq0GKRrBriHhVOr3DCoDXD3FhqdXx6V1NEOyiklgdd7p97A116LYNPSrvDNBRANOe2n0lfMETACQ12EkGKJt6IurLPbLfJREREd1Tzm1tbd0BgEuXHgcAXL8+XwB+Vp21g2i++sItfOiF83gmY/lcVHb/CgLr6qECbq1ORERE97KV77JyVgz2XaDRRpwNAQ0mz0wnIiIiojNGmLJyV3O6aNVN2Hq0+wjgWcpm+0RERERENCVOWfnwh4OTNf/hH97YaIfo7mPb9srrVJTJL08Xml+C2f4jfPh9K28msz0iIiKi03TP5pATEREREd0N7tkcciIiIiKiuwEDciIiIiKiDbpvA3LZGMK27eCfaPcVzSw4eGYVNJi2ift3DxgNZuEBP1Te5uZTM20MDd5FIiKiedzzAXlegOB0W1AUBT1XcIyjbGA4cxpmGOyE/2brzguGZBhDO+eXgAH23RrUlQZQU+1tONi9FwK1e30M98L4iIiI7kb3fEC+OBlGuwG4fUzOFpJhDIMTMhVFgaJYOGnoiGNrzYRt72CcEeRrpo7GiRVf50lqKvhxui1YJw20VxIQBYfqXDmO+tmDiwb0M7sP+wAdRYHSSv7iQ4vjfBIREd1NVrwPuQxj2Ab6h6jqKiQAwVHuHQwwOT2zjzb08Gxzz4pOYtRg2tE1AHwXvWRAoZmw1bg0fYx6RlmyDWDqaPYyRz9qV9GAi17ypE/tKhoVD1b8vQH23Sb0nSDQNZtj9JQuYAzRSE2Lgabkw+0N0tdd2YMMJx7jYN9FU78KDQ7SPQznZuG+O+j29zDUd1B0j2aOnk+0Kb5/U9eF9w/GUHgf5GT5zPjynomiMeQpui67vaIxLN7eAnMNE/bOGG6tgUbFh2sd44raQCWrr4n6ZMEYeuNmwfjy+zlTFkwbERERzWENK+QVNPQmxj0FiqLA8iSoiZXZSkOHXj2M00WkpoHZleepFV3NhK3W4IZ1KooyFYzPlkUpKZYXBOhRWamAFoC2I8E/PphdYfTHGCW+dG6cALVtyBigk7ciWa+i4h/jICrUzCAAqlRRT37OOcCxL2FnyYVsebsGnNxI98W5gZM41My/R+mV/B7cWnolP+v+yQBk4yrQV1L3r23IhfchP3Wo4JlIjaEH15fQLPXXhbzr8ttb7lla7VwDAKQGqocKLK+ChlrFoWLBq1zBnpw/n6IxFI1P1M90WVAHERERzWctKSue1YrTPAZHXhiwhnwXvSgYOziGX6nGK8+HqRVdF74Urug2Jfip1JGIqGwZMoKYdqrSwRG8SgNX44BZg5lYmS+u1sDQtmGrgKVY8FDDdiqGdBDE99OBZZiCUPKXiXq1An88mvruCONEjJZ1jwANO5IHK27HQffQQ+XKnvD+1QE43U7iHjg4OPZRqaZ+3ZiP8JmYHsN87WVeJ2hv2USfVc519P39QfTf/YK/Ciwrv5/BX36SZURERLSIFaes5EisBKdWnZ0uWg4AzZxZeZ6oo1rJCI4Ly5YR1DtrgI61A1sNgmrAg2V5kHZuFOfqVhrQdQ+WogQBlGxgiBMcTV04GvtQq3Vgiezf7DrqqFYEL7BWqoAM1CBBtW2oybJEDkLm/QOC8egNpKZt2dXS3GdiTU6rvWXmWjNPo4cT8nZhP4mIiGg5pxOQh4GOcP0yWmmNvq5Xw+BuhLGvopp5kahsGYJ6Bx0oiQVB2RiiObMaPV3dGL7q47iXyHGuV1HJCACzV7fn49w4gX4l+KvE5H3UbdRwkn+RPw7/k5+LnX//NJh6A3B7UMKlYNkYQl/2xuQ+E2tyWu0tNdebkNNP2dhEZ4iIiO45a95lJUjpyMzFThocwUMyBzhKRdlHlFYgqVn7dIvKAqOxn04DKCUvdSRNNobQrxyjX5Qv4xzg2K+g0Y62HgzHNzMvOaky0VaKZXdJCVNr2sn5bDcAdz/jw5N7FOWwqwvuxhL3WzbQbqRD2bnvg/CZWANBe1EgutizlLS6uV6UaAyZZaJ+hu8lRO88yMYQ82RwERERUWAtK+RSnNIxtRtKrgE6CmDaUzs8hNc53Vawe0Tiz+ZRvaKy4No+9oY6dNuGHtXbGU3tDKHCttXU7hGDIw+qOr3jScZuE6283SYaQZvh7hdBNyf9yJwXeQ9XKh4Ol07JnZ3PSXtBuJV3j6J+2vYkQaH4Hoa7xiRSeVzXRyOxQr7Ifch/JtaxV7b4GcwfQ/HNWu1c5+s608/g7HMtGkNeWX4/p1K4PAs9t4n2Qr0nIiK6f53b2tq6AwCXLj0OALh+/bUlqgsCguphtBXe3Wyyl/eiAdK8oq3u1tvevXSPzjrONRERERXjwUC5gl020GjjNA4vlI0h1JpbnP5CRERERPcUBuQiThct6ySR+70uGq42TmDxZEUiIiKi+86KU1aIiIiIiGgeXCEnIiIiItogBuRERERERBvEgJyIiIiIaINO56TOM0g2htCjDZtL7idNa6SZsONTZXy4vRZOY8OZ09lqkoiIiCjfPR+Q5wVcTrcFBys64p2WFJxg6Vncr5uIiIjuP0xZoc2Tt1GDhyMG40RERHQfWvEKuQxj2Ab6h6jqKoIEBA+W0sEAk9XqPtpxushkVVSDaUfXAAiPnI/XtVMpDVNHjGeUJdsApo5DL7UMG/an9OfFYy8c3wJ1rmc+p45fT41/+mj25PhEZQXqVVQyC/LGMHsCZvCXjkMonVHBfZjuJ+C7ZTpJREREtB5rWCGvoKE3Me4pUBQFlidBNbVJaUMPAidFQc/1ITUNBEGSiprbg6IoUJQeXDSgR9dpJmy1BjesU1GUqWB8tszptsL2g2AzKltvrnhy7D24voSmIRePr3Sd659PzdTROLEm19VUDMOjSmWjnShToCQCblFZHtkYwrbt8BcDCaptB1+b2grnLHkfpscXPB9EREREm7SWlBXPmryQNzjygNr25KRL30UvDIqdg2P4lSqgXUWj4uEwzvMOjq33pR0AMoymBN/tZ7zkJypb1gCdBQL4ydgdHBz7qFTrwvGVCS9Pbz417EgerHjMDrqHHipX9ibtifpccjyR6JcmxfIQrGInfmkSjqFY5n2QDTRT4yMiIiLavNN5qbNSRT38r398MEmbcLpoOQA0E/DHGGVeXEe1ApzcyIq4RWVnTO74FrCu+ZS3UQtXqtVU392w+hbqph2XJ9OGRGULW+WcEREREZ1RpxOQh4FVXfSZMMiMQ7g4r3iEsa8ieyMUUdkZkzu+BaxtPoGi3O9BR0nkxOsYGogDb1HZQlY5Z0RERERn1Jp3WQm2s0ut4mYZHMHDJM93klaxjyjlQFLNjHQIUVlgNPbTKRfz9D3OZ16SYHzzJU+seT6dAxz76Rz1fCOM/UXKShKOIVDbDss0M/ECr4BzAyeQsBMOTzaGSLzXSkRERLQRa1khl1QbdpjzUC51YYCOApj21G4oiXQIGEPoiVSKqF5RWXBtH3tDHbptQ4/q7YymdtpQYdvqGg8IEo+vyGnOZ1CkB/ORKsPM7iSTOmd3LplnfIuModvfw1APy3wXlutDLfxTyQAdawd2NJ+ehZ7bRHuJXhIREREt69zW1tYdALh06XEAwPXrry1R3ex2dLQMzicRERHRvY4HAxERERERbRADciIiIiKiDVpxygoREREREc2DK+RERERERBvEgJyIiIiIaIMYkBMRERERbdDpnNR5lmkm7Ph0GB9ur4Xp7bM100ZzvIKj4OnsKHHf19MsnyUiIiJKO1MB+ekHK8HJl561un2+GXDdDVZ/34mIiIgWdX+nrMjbqMHDEYOy+wvvOxEREZ0h61khT6UDTI5lj1aP+2hDD89Z9ywF+9vD+Gtg6qj0zgCzR7N7sJQOBhknWcrGEHr1EEpnkNtevCparyJ52vvE7FHwvptT5rvoBefKzzeG8LrJOroG01YhxZ8vIsMYtoH+Iaq6Cik1L4n6EgNItzd/neL5LGgv55mYmZfU+PPue1FZgdz7njcG0XM2KrgPomeJiIiIaB0BuWbCVmtwe0pmTm6loUP3LCjKIAhqmgbQakFBfrqHbLTROLGgtOZf0sxqT96+kgieAdW2oQJxMKiZeqo9zbTRjPtyFegrUBwgCrbahoxWtwVHOIbs65ylUlsqaOhNuD0FihPU2TRkDLqAMVRRc3tQEkGvbmpwCoP9ZJ3BeFRTwyC8LvP+DQ7E7QmeifRcB9cNjRFaXUd43xd5JuTUL03T930kGMNojjlL3gdH+CwRERERAStPWZFhNCX4bj//BTnfRS8M7pyDY/iVKuplqpZ2oC3Spaz2ui0oigLF8hCsZirB150BIBtoSh6snMDV6XYSY3NwcOyjUi0eQfF1A3SiPszBs6KXERN1alfRqHg4jBt00O278EvO4aROYHDkAbVtyFFhxnyK2hM/Exp2UnPtoHvooXJlb9KeqM9zPhOO6L4Lx1As8z4UPEtEREREwMpXyOuoVoCTG/mrvv7xwSSNwemiVWKB2Om2UDfteEVzku5QbJH2hGQDQ72RTnnw1njdovwxitZ1S0v80pQ5n5opaE/wTMjbqEGarFTHfXfD6vPv+zLPRK5VzhkRERFRSSsOyEcY+yqqq60UADDoKIncaB1DA2h119CQkAZTbwBxWkOUS7yu65YQBtFxiJqbN11CGKgK/w6Q217RMyHO/c6+705h2UJWOWdEREREJa04ZSX4c72kmgull4zGfjpdIftTGPvp79S2wys0M5UjvBDnBk4gYSccgGwMkXgXEUBitVc20J5qTzQG0XVBUGnDNhdKzEkbHMGDhKYR9SJKG9kv99Jjsk+qlF4Vn7M94TPhHODYl6CWGvPsfS9XVpJwDIG5n7MSzxIRERHRyl/qdLqtYMeRRBpC2XQCp9vH3lCHbtvQgcTLduldKuBZ8Upzt7+HoR7uauK7sFwf6lIrzwN0rB3Yqg1bDdrquU20w7J9twk9KoMH1/XRSLSXPYbi61ZrgI4CmPbUbi8lV4+luJ9l7524PdEzERTpsO1J0kpQBsF9n925ZJ7xLTKGxZ4z0bNEREREFDi3tbV1BwAuXXocAHD9+msb7RBt0uz2fkRERES0Xvf3wUBERERERBvGgJyIiIiIaIOYskJEREREtEFcISciIiIi2iAG5EREREREG8SAnIiIiIhog1a+D/k0zbTRHBfvZS0bw8lhK+He3adCM2HHp7X4cHstBF3VYNoqJN9Fr9WND8bZWD9ptXLv+7qbLffzQERERPePtQfkZTndFhwsdqT84kFOcBKlZ5Xfd3uZftJZMf99JyIiIlqXMxOQb4S8jRo8HGYGZQN0FEZr9yThfSciIiI6XWsIyGePNffdnLLSKR/Z16XSRzB15HlnUNxevYrk6etxawunpYjam54XD5bSwaTmMEVmrjlpA/1DVHUV0kydYX3Rx6dSbxapM/pLRB/teH4mq8wF7aVSRADfjf6iseicFc2nQM59zx/D7AmmwV9IDqF0RgX3QfTzQERERLSGlzo1U0fjxIKiKFAUBZaXV9aDW1MxNOQ565xc53RbcRu+24vbjAK6vOtkYwjbtsMAUYJq28HXpgYAcb09119i7OnxyUY7NS9K2eBRqIKG3sS4F7bnS2gaMoIgUEUtnpMeXDSgh+MrX6cCy5OgJq6rNPQgEA3nR2oaxe1pJmy1BrenxOOP0osWnbNF5lN831c1Z8n7IP55ICIiIgJWHZDLBpqSBytzhVfDTqrMQffQQ+XKHsQh+eqvQxhwK5aHYDUzHcgvpkQ/pR3kh3cDdBbog2dFLyM6ODj2UanWAe0qGhUPh3FOvYNu34UvbD+rTmBw5AG17ckYfBe9sI/OwTH8SlXYHiDDaErw3X7GS5NLzlnJ8UQc0X0XjqFY5n0Q/jwQERERBU4vh1zeRi1clVST3y/6+/1pX7eogvacbgt1047LJykba+KPMVpVXZUq6lG1xweTNBSni5YDQDMF7dVRrQAnNzLGusScrWU+VzlnRERERCWd8kudc+T5bvS6RYnbG3SURH63jqGB9QXlYRAd156bN11CGKjWRZ/JbW+Esa8if0Oaxeds5fO5yjkjIiIiKmm1KSvODZxAwk6YRyAbQ8Tv8TkHOPbT+cjl6iy+bjT2Z1NYFm1vUXO1N8J4Jj1dg5nIY1/K4AgeJnnMk7SR/Tl/OQm2B0ytis/ZXpTCIanmbHrJ0nNWpqwk4RgCte2wTDMTLxMLiH4eiIiIiEIrXiEfoGPtwFZt2CoAz0LPbaINAHDQbQHGUIdtTxIUglQDTO1EoQafCXfcyL8uSl/oY2+oQ7dt6EDp67JN74qR7MtowX5Ojy/s49pSVgboKIBpT+08U7I9Kbp/KJsKIm7PCSYGeiI1Jap3sTmb3blk+fkUj6Hb38NQD8t8F5brQy3ch17080BEREQUOLe1tXUHAC5dehwAcP36axvtEG3S7PZ+RERERLReK9/2kIiIiIiIymNATkRERES0QUxZISIiIiLaIK6QExERERFtEANyIiIiIqINYkBORERERLRBp3xS5xmkmbDj01p8uL0Wprez1kwbzfGaj7qn01Xivq+nWT5LRERElHamAvLTD1aCkyg9a3X7bjPguhus/r4TERERLer+TlmRt1GDhyMGZfcX3nciIiI6Q9azQp5KB5gckx6tHvfRhh6ee+5ZCva3h/HXwNTR5Z0BZo9K92ApHQwyTpaUjSH06iGUziC3vXhVtF5F8vT1idmj2X03p8x30QvOeZ9vDOF1k3V0DaatQoo/X0SGMWwD/UNUdRVSal4S9SUGkG5v/jrF81nQXs4zMTMvqfHn3feisgK59z1vDKLnbFRwH0TPEhEREdE6AnLNhK3W4PaUzJzcSkOH7llQlEEQ1DQNoNWCgvx0D9loo3FiQWnNv6SZ1Z68fSURPAOqbUMF4mBQM/VUe5ppoxn35SrQV6A4QBRstQ0ZrW4LjnAM2dc5S6W2VNDQm3B7ChQnqLNpyBh0AWOooub2oCSCXt3U4BQG+8k6g/GopoZBeF3m/RsciNsTPBPpuQ6uGxojtLqO8L4v8kzIqV+apu/7SDCG0RxzlrwPjvBZIiIiIgJWnrIiw2hK8N1+/gtyvoteGNw5B8fwK1XUy1Qt7UBbpEtZ7XVbUBQFiuUhWM1Ugq87A0A20JQ8WDmBq9PtJMbm4ODYR6VaPILi6wboRH2Yg2dFLyMm6tSuolHxcBg36KDbd+GXnMNJncDgyANq25Cjwoz5FLUnfiY07KTm2kH30EPlyt6kPVGf53wmHNF9F46hWOZ9KHiWiIiIiICVr5DXUa0AJzfyV33944NJGoPTRavEArHTbaFu2vGK5iTdodgi7QnJBoZ6I53y4K3xukX5YxSt65aW+KUpcz41U9Ce4JmQt1GDNFmpjvvuhtXn3/dlnolcq5wzIiIiopJWHJCPMPZVVFdbKQBg0FESudE6hgbQ6q6hISENpt4A4rSGKJd4XdctIQyi4xA1N2+6hDBQFf4dILe9omdCnPudfd+dwrKFrHLOiIiIiEpaccpK8Od6STUXSi8Zjf10ukL2pzD209+pbYdXaGYqR3ghzg2cQMJOOADZGCLxLiKAxGqvbKA91Z5oDKLrgqDShm0ulJiTNjiCBwlNI+pFlDayX+6lx2SfVCm9Kj5ne8JnwjnAsS9BLTXm2fterqwk4RgCcz9nJZ4lIiIiopW/1Ol0W8GOI4k0hLLpBE63j72hDt22oQOJl+3Su1TAs+KV5m5/D0M93NXEd2G5PtSlVp4H6Fg7sFUbthq01XObaIdl+24TelQGD67ro5FoL3sMxdet1gAdBTDtqd1eSq4eS3E/y947cXuiZyIo0mHbk6SVoAyC+z67c8k841tkDIs9Z6JniYiIiChwbmtr6w4AXLr0OADg+vXXNtoh2qTZ7f2IiIiIaL3u74OBiIiIiIg2jAE5EREREdEGMWWFiIiIiGiD4pc6b9365032g4iIiIjovhQH5OfPv3+T/SAiIiIiui8xh5yIiIiIaINWvg/5NM200RwX72UtG8PJYSvh3t2nQjNhx6e1+HB7LQRd1WDaKiTfRa/VjQ/G2Vg/abVy7/u6my3380BERET3j7UH5GU53RYcLHak/OJBTnASpWeV33d7mX7SWTH/fSciIiJalzMTkG+EvI0aPBxmBmUDdBRGa/ck4X0nIiIiOl1rCMhnjzX33Zyy0ikf2del0kcwdeR5Z1DcXr2K5OnrcTBH4VoAAAPNSURBVGsLp6WI2pueFw+W0sGk5jBFZq45aQP9Q1R1FdJMnWF90cenUm8WqTP6S0Qf7Xh+JqvMBe2lUkQA343+orHonBXNp0DOfc8fw+wJpsFfSA6hdEYF90H080BERES0hpc6NVNH48SCoihQFAWWl1fWg1tTMTTkOeucXOd0W3EbvtuL24wCurzrZGMI27bDAFGCatvB16YGAHG9PddfYuzp8clGOzUvStngUaiCht7EuBe250toGjKCIFBFLZ6THlw0oIfjK1+nAsuToCauqzT0IBAN50dqGsXtaSZstQa3p8Tjj9KLFp2zReZTfN9XNWfJ+yD+eSAiIiICVh2Qywaakgcrc4VXw06qzEH30EPlyh7EIfnqr0MYcCuWh2A1Mx3IL6ZEP6Ud5Id3A3QW6INnRS8jOjg49lGp1gHtKhoVD4dxTr2Dbt+FL2w/q05gcOQBte3JGHwXvbCPzsEx/EpV2B4gw2hK8N1+xkuTS85ZyfFEHNF9F46hWOZ9EP48EBEREQVOL4dc3kYtXJVUk98v+vv9aV+3qIL2nG4LddOOyycpG2vijzFaVV2VKupRtccHkzQUp4uWA0AzBe3VUa0AJzcyxrrEnK1lPlc5Z0REREQlnfJLnXPk+W70ukWJ2xt0lER+t46hgfUF5WEQHdeemzddQhio1kWfyW1vhLGvIn9DmsXnbOXzuco5IyIiIipptSkrzg2cQMJOmEcgG0PE7/E5Bzj20/nI5eosvm409mdTWBZtb1FztTfCeCY9XYOZyGNfyuAIHiZ5zJO0kf05fzkJtgdMrYrP2V6UwiGp5mx6ydJzVqasJOEYArXtsEwzEy8TC4h+HoiIiIhCK14hH6Bj7cBWbdgqAM9Cz22iDQBw0G0BxlCHbU8SFIJUA0ztRKEGnwl33Mi/Lkpf6GNvqEO3behA6euyTe+KkezLaMF+To8v7OPaUlYG6CiAaU/tPFOyPSm6fyibCiJuzwkmBnoiNSWqd7E5m925ZPn5FI+h29/DUA/LfBeW60Mt3Ide9PNAREREFDi3tbV1BwAuXXocAHD9+msb7RBt0uz2fkRERES0Xivf9pCIiIiIiMpjQE5EREREtEFxyspDD/0hAOBXv/rFRjtERERERHQ/iV/qZCBORERERHT6mLJCRERERLRBDMiJiIiIiDbozATku488iWu7u8G/yw9lf+ihy5PP7D6J3vkSFcsGhrYN27Zh2xmH08x4Cg8/91187BPz9f/UJcY1TB5mM7SxyrOQfvv8s7jVvri6Cjfs9leexTvKpntBRERENPH/AVeO8msRfemQAAAAAElFTkSuQmCC"},45214:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240602033301941-48770e554bf6411dc59e4cf6c1039797.png"},45249:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240607190154541-854d7e886ffc3920ec38aa546958f97a.png"},47420:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240530200519467-ccdc36cab1c19b0465e051b8e8cd39b9.png"},48358:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240609170635911-07fce8fdc6c3c1e0e79d53c7e7d2095e.png"},49403:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240531221607105-4c09be3a7f0cf97c54a7cf8eed6cc17d.png"},51180:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240605195031523-3780c8546ed6b5fcbd04699f01377ccc.png"},51585:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240531222759218-ec5fb6fe3466aef5b7871dde59513133.png"},53408:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240609173254821-1b77527fc75ba05f0d28bf9f2baeacf9.png"},53837:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240616173305854-9274d77dc652b6be4104421158aaf71d.png"},54991:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240601235450472-30e615b8623b1e6cb004a96fd359ae14.png"},55443:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240531164139172-c5c0e2a9c2284d8a1f5c7a9cd7eded58.png"},55738:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604223410707-54b3a2fdb39c37d757756045fb01c34d.png"},57141:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604223518509-cee2da716489d66e6773c8d6d081b3f7.png"},58309:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240609222952066-73aff71957bcd9d7a62ff60ce7546b85.png"},59466:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606185004318-c58e32477b58fd72bbe92172cc36f8db.png"},61141:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240603174831686-8f99ec46755431db00d1bc8d49c27f40.png"},63898:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240607203810120-b5496e4f3a7ccc6e2e1f396c97fa8f4a.png"},67879:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>d,contentTitle:()=>c,default:()=>o,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"cpp_server/00Task","title":"00Task","description":"00 Task C++\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1 Ch07~Ch10 \u603b\u7ed3","source":"@site/docs/06_cpp_server/00Task.md","sourceDirName":"06_cpp_server","slug":"/cpp_server/00Task","permalink":"/Notes/docs/cpp_server/00Task","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"sidebar_label":"00 Task C++\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1 Ch07~Ch10 \u603b\u7ed3"},"sidebar":"tutorialSidebar","previous":{"title":"C++ \u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1","permalink":"/Notes/docs/category/c-\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1"},"next":{"title":"01 Task C++\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1 Ch11~Ch20 \u603b\u7ed3","permalink":"/Notes/docs/cpp_server/01Task"}}');var l=e(23420),s=e(3774);const t={sidebar_label:"00 Task C++\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1 Ch07~Ch10 \u603b\u7ed3"},c=void 0,d={},a=[{value:"00 Task C++\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1 Ch07~Ch10 \u603b\u7ed3",id:"00-task-c\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1-ch07ch10-\u603b\u7ed3",level:2},{value:"00 \u8fdb\u5ea6",id:"00-\u8fdb\u5ea6",level:3},{value:"\u7b2c\u4e03\u7ae0 \u751f\u6210\u6d4b\u8bd5\u6570\u636e",id:"\u7b2c\u4e03\u7ae0-\u751f\u6210\u6d4b\u8bd5\u6570\u636e",level:2},{value:"49 \u6d4b\u8bd5\u6570\u636e\u7684\u4e1a\u52a1\u9700\u6c42",id:"49-\u6d4b\u8bd5\u6570\u636e\u7684\u4e1a\u52a1\u9700\u6c42",level:3},{value:"50 \u642d\u5efa\u7a0b\u5e8f\u7684\u6846\u67b6",id:"50-\u642d\u5efa\u7a0b\u5e8f\u7684\u6846\u67b6",level:3},{value:"51 \u52a0\u8f7d\u7ad9\u70b9\u53c2\u6570",id:"51-\u52a0\u8f7d\u7ad9\u70b9\u53c2\u6570",level:3},{value:"52 \u6a21\u62df\u89c2\u6d4b\u6570\u636e",id:"52-\u6a21\u62df\u89c2\u6d4b\u6570\u636e",level:3},{value:"53 \u628a\u6570\u636e\u5199\u5165\u6587\u4ef6",id:"53-\u628a\u6570\u636e\u5199\u5165\u6587\u4ef6",level:3},{value:"\u7b2c\u516b\u7ae0 \u670d\u52a1\u7a0b\u5e8f\u7684\u76d1\u63a7\u548c\u8c03\u5ea6",id:"\u7b2c\u516b\u7ae0-\u670d\u52a1\u7a0b\u5e8f\u7684\u76d1\u63a7\u548c\u8c03\u5ea6",level:2},{value:"54 \u76d1\u63a7\u548c\u8c03\u5ea6\u7684\u4e1a\u52a1\u9700\u6c42",id:"54-\u76d1\u63a7\u548c\u8c03\u5ea6\u7684\u4e1a\u52a1\u9700\u6c42",level:3},{value:"55 \u8c03\u5ea6\u6a21\u5757",id:"55-\u8c03\u5ea6\u6a21\u5757",level:3},{value:"56 \u8fdb\u7a0b\u7684\u5fc3\u8df3",id:"56-\u8fdb\u7a0b\u7684\u5fc3\u8df3",level:3},{value:"57 \u5b88\u62a4\u6a21\u5757",id:"57-\u5b88\u62a4\u6a21\u5757",level:3},{value:"58 \u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u7b56\u7565",id:"58-\u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u7b56\u7565",level:3},{value:"59 \u5c0f\u5de5\u5177-\u6e05\u7406\u6587\u4ef6",id:"59-\u5c0f\u5de5\u5177-\u6e05\u7406\u6587\u4ef6",level:3},{value:"60 \u5c0f\u5de5\u5177-\u538b\u7f29\u6587\u4ef6",id:"60-\u5c0f\u5de5\u5177-\u538b\u7f29\u6587\u4ef6",level:3},{value:"\u7b2c\u4e5d\u7ae0 \u57fa\u4e8eftp\u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757",id:"\u7b2c\u4e5d\u7ae0-\u57fa\u4e8eftp\u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757",level:2},{value:"61 ftp\u4f20\u8f93\u6587\u4ef6\u7684\u4e1a\u52a1\u9700\u6c42",id:"61-ftp\u4f20\u8f93\u6587\u4ef6\u7684\u4e1a\u52a1\u9700\u6c42",level:3},{value:"62 \u914d\u7f6eftp\u670d\u52a1",id:"62-\u914d\u7f6eftp\u670d\u52a1",level:3},{value:"63 \u624b\u5de5\u6267\u884cftp\u547d\u4ee4",id:"63-\u624b\u5de5\u6267\u884cftp\u547d\u4ee4",level:3},{value:"64 \u5c01\u88c5ftp\u5ba2\u6237\u7aef",id:"64-\u5c01\u88c5ftp\u5ba2\u6237\u7aef",level:3},{value:"65 \u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\uff08\u4e00\uff09",id:"65-\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\u4e00",level:3},{value:"66 \u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\uff08\u4e8c\uff09",id:"66-\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\u4e8c",level:3},{value:"67 \u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\uff08\u4e09\uff09",id:"67-\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\u4e09",level:3},{value:"68 \u6587\u4ef6\u4e0a\u4f20\u6a21\u5757",id:"68-\u6587\u4ef6\u4e0a\u4f20\u6a21\u5757",level:3},{value:"\u7b2c\u5341\u7ae0 \u57fa\u4e8e TCP \u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757",id:"\u7b2c\u5341\u7ae0-\u57fa\u4e8e-tcp-\u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757",level:2},{value:"69 TCP \u6587\u4ef6\u4f20\u8f93\u7684\u4e1a\u52a1\u9700\u6c42",id:"69-tcp-\u6587\u4ef6\u4f20\u8f93\u7684\u4e1a\u52a1\u9700\u6c42",level:3},{value:"70 \u6a21\u62df\u7f51\u4e0a\u94f6\u884cAPP\u670d\u52a1\u7aef",id:"70-\u6a21\u62df\u7f51\u4e0a\u94f6\u884capp\u670d\u52a1\u7aef",level:3},{value:"71 TCP \u77ed\u8fde\u63a5\u548c\u957f\u8fde\u63a5",id:"71-tcp-\u77ed\u8fde\u63a5\u548c\u957f\u8fde\u63a5",level:3},{value:"72 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e00\uff09",id:"72-\u4e0a\u4f20\u6587\u4ef6\u4e00",level:3},{value:"73 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e8c\uff09",id:"73-\u4e0a\u4f20\u6587\u4ef6\u4e8c",level:3},{value:"74 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e09\uff09",id:"74-\u4e0a\u4f20\u6587\u4ef6\u4e09",level:3},{value:"75 \u4e0a\u4f20\u6587\u4ef6\uff08\u56db\uff09",id:"75-\u4e0a\u4f20\u6587\u4ef6\u56db",level:3},{value:"76 \u540c\u6b65\u548c\u5f02\u6b65\u901a\u8baf",id:"76-\u540c\u6b65\u548c\u5f02\u6b65\u901a\u8baf",level:3},{value:"77 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e94\uff09",id:"77-\u4e0a\u4f20\u6587\u4ef6\u4e94",level:3},{value:"78 \u4e0b\u8f7d\u6587\u4ef6",id:"78-\u4e0b\u8f7d\u6587\u4ef6",level:3},{value:"\u672c\u7bc7\u5b8c",id:"\u672c\u7bc7\u5b8c",level:2}];function f(n){const r={a:"a",code:"code",del:"del",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.h2,{id:"00-task-c\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1-ch07ch10-\u603b\u7ed3",children:"00 Task C++\u540e\u53f0\u670d\u52a1\u5668\u5f00\u53d1 Ch07~Ch10 \u603b\u7ed3"}),"\n",(0,l.jsx)(r.p,{children:"Date\uff1a2024/05/25 16:09:47"}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.p,{children:"[TOC]"}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"00-\u8fdb\u5ea6",children:"00 \u8fdb\u5ea6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7ecf\u5386\u4e86 Qt \u7684\u9879\u76ee\u8bad\u7ec3\uff0c\u6b63\u5f0f\u4ece 51 \u8282\u5f00\u59cb\u672c\u9879\u76ee\uff082024/05/26\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b8c\u6210\u7b2c\u4e03\u7ae0\uff0849\u300150\u8282\u672a\u91cd\u65b0\u6574\u7406\uff0c2024/05/29\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5f00\u59cb\u7b2c\u516b\u7ae0\uff082024/05/29\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b8c\u6210\u7b2c\u516b\u7ae0\uff082024/06/04\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b8c\u6210\u7b2c\u4e5d\u7ae0\uff082024/06/12\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5f00\u59cb\u7b2c\u5341\u7ae0\uff082024/06/13\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b8c\u6210\u7b2c\u5341\u7ae0\uff082024/06/24\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h2,{id:"\u7b2c\u4e03\u7ae0-\u751f\u6210\u6d4b\u8bd5\u6570\u636e",children:"\u7b2c\u4e03\u7ae0 \u751f\u6210\u6d4b\u8bd5\u6570\u636e"}),"\n",(0,l.jsx)(r.h3,{id:"49-\u6d4b\u8bd5\u6570\u636e\u7684\u4e1a\u52a1\u9700\u6c42",children:"49 \u6d4b\u8bd5\u6570\u636e\u7684\u4e1a\u52a1\u9700\u6c42"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e0d\u540c\u4e1a\u52a1\uff0c\u4e0d\u540c\u6d41\u7a0b\uff0c\u719f\u6089\u6d41\u7a0b\u662f\u9996\u8981\u7684"}),"\n",(0,l.jsxs)(r.li,{children:["\u6570\u636e\u5f00\u653e\u5e73\u53f0\uff0c\u7528\u4f8b\uff1a\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5168\u56fd\u6c14\u8c61\u7ad9\u70b9\u53c2\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u5168\u56fd\u6c14\u8c61\u7ad9\u70b9\u89c2\u6d4b\u6570\u636e"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u4ecb\u7ecd\u5e76\u5c55\u793a\u4e86 csv\u3001xml\u3001Json \u683c\u5f0f\uff0c\u4e0d\u5fc5\u62d8\u6ce5\u4e8e\u6807\u51c6\u5f62\u5f0f\uff0c\u53ef\u5b66\u4e60\u5b83\u4eec\u7684\u601d\u60f3\uff0c\u56f4\u7ed5\u4e1a\u52a1\u91cd\u70b9\u5b9a\u5236\u5373\u53ef"}),"\n",(0,l.jsx)(r.li,{children:"xml \u5e38\u7528\u4e8e\u540e\u7aef\uff0c\u672c\u9879\u76ee\u7684\u5177\u4f53\u4e1a\u52a1\u3001\u6570\u636e\u7684\u60c5\u51b5"}),"\n",(0,l.jsx)(r.li,{children:"2024/03/07 21:43:29"}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"50-\u642d\u5efa\u7a0b\u5e8f\u7684\u6846\u67b6",children:"50 \u642d\u5efa\u7a0b\u5e8f\u7684\u6846\u67b6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u76ee\u5f55\u521b\u5efa bin\u3001cpp\u3001crtsurfdata.cpp\uff08main\u3001\u5e2e\u52a9\u6587\u6863\u3001\u65e5\u5fd7\u4fe1\u606f\u3001\u53c2\u6570\u63d0\u793a\u3001\u4e00\u6b65\u4e00\u8c03\u8bd5\u3001log \u6388\u6743\u3001\u5ffd\u7565\u5168\u90e8\u4fe1\u53f7\u3001\u4fe1\u53f72/15\u7279\u6b8a\u5904\u7406\u3001\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u6267\u884c\u6587\u4ef6 + \u53c2\u6570"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"makefile"}),"\uff08\uff1f\u94fe\u63a5\u5e93\uff0c\u4fbf\u4e8e\u8c03\u8bd5\uff09\u3001\u6bcf\u8282\u6e90\u4ee3\u7801\u5907\u4efd\u3001\u4e5f\u4fbf\u4e8e debug"]}),"\n",(0,l.jsx)(r.li,{children:"\u65e5\u5fd7\u7f16\u5199\u3001\u8c03\u8bd5\uff08\u67e5\u770b\u65e5\u5fd7 cat ../../log/idc/crtsurfdata.log \uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u670d\u52a1\u7a0b\u5e8f\u9000\u51fa\u4fe1\u53f7\u3001\u58f0\u660e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3001\u5b9e\u73b0\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff08\u5199\u5165\u65e5\u5fd7\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u4ee3\u7801\u5907\u4efd\uff1abak\uff0c\u4fbf\u4e8e\u5bf9\u6bd4\u6e90\u4ee3\u7801\uff0cdebug"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5b66\u4e60\u65b9\u6cd5\uff1a\u4f18\u5148\u770b\u5b8c\u4e00\u8282\u89c6\u9891\uff0c\u4e0d\u7406\u89e3\u4e5f\u6ca1\u5173\u7cfb\uff1b\u628a\u4ee3\u7801\u9ed8\u5199\uff0c\u7f16\u8bd1\u3001\u8c03\u8bd5\u3001\u5b9e\u73b0\u529f\u80fd\uff1b"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6807\u51c6\u505a\u6cd5"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"main \u8fd4\u56de 0 \u6216\u8005 -1"}),"\n",(0,l.jsx)(r.li,{children:"\u53c2\u6570\u975e\u6cd5\uff0c\u7ed9\u51fa\u5e2e\u52a9\u6587\u6863"}),"\n",(0,l.jsx)(r.li,{children:"0\u3001NULL\u3001nullptr \u6ca1\u591a\u5927\u533a\u522b\uff0c\u53ea\u662f\u54ea\u79cd\u8bed\u5883\u66f4\u6807\u51c6"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u517b\u6210\u7f16\u5199\u4e00\u90e8\u5206\u4ee3\u7801\uff0c\u6682\u505c\uff0c\u7f16\u8bd1\u68c0\u67e5\uff0c\u4e4b\u540e\u518d\u7ee7\u7eed\u7684\u4e60\u60ef"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6bcf\u8282\u8bfe\u4ee3\u7801\u505a\u5907\u4efd\uff0c\u8981\u770b\u6e90\u4ee3\u7801\uff0c\u5c31\u770b\u5907\u4efd\u7684\u6587\u4ef6\uff0c\u4e0d\u540c\u8bfe\u5171\u540c\u7ef4\u62a4\u4e00\u4e2a\u6700\u7ec8\u7248\u672c\u7684"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/03/07 22:12:17\uff0c2024/04/28 18:41:19\uff0c2024/04/29 22:34:24"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"51-\u52a0\u8f7d\u7ad9\u70b9\u53c2\u6570",children:"51 \u52a0\u8f7d\u7ad9\u70b9\u53c2\u6570"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7a0b\u5e8f\u6d41\u7a0b\u3001\u7ad9\u70b9\u53c2\u6570\u7ed3\u6784\u4f53\uff08\u7c98\u8d34\u53c2\u6570\uff0c\u786e\u5b9a\u5185\u5bb9\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u58f0\u660e\u5bb9\u5668\u3001\u58f0\u660e\u52a0\u8f7d\u51fd\u6570\uff1a\u7ad9\u70b9\u6570\u636e\u5b58\u50a8\u3001\u7ad9\u70b9\u53c2\u6570\u6587\u4ef6\u52a0\u8f7d\u5230\u5bb9\u5668"}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0 ",(0,l.jsx)(r.code,{children:"loadstcode()"})," \u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["EXIT\u3001\u65e5\u5fd7\u3001c\u98ce\u683c\u5b57\u7b26\u4e32\u8f6c\u6362 ",(0,l.jsx)(r.code,{children:".c_str()"}),"\u3001\u4f7f\u7528\u5f00\u53d1\u6846\u67b6\u4e2d\u7684\u7c7b"]}),"\n",(0,l.jsxs)(r.li,{children:["\u62c6\u5206\u4ece\u6587\u4ef6\u8bfb\u53d6\u7684\u6bcf\u4e00\u884c\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5faa\u73af\u4f53\u3001\u62c6\u5206\u5b57\u7b26\u4e32"}),"\n",(0,l.jsx)(r.li,{children:"\u7ed3\u6784\u4f53\u521d\u59cb\u5316"}),"\n",(0,l.jsxs)(r.li,{children:["\u5b58\u653e\u5b57\u7b26\u4e32 ",(0,l.jsx)(r.code,{children:"getvalue()"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ed3\u6784\u4f53\u653e\u5165\u5bb9\u5668\u4e2d ",(0,l.jsx)(r.code,{children:"stlist.push_back(stcode)"})]}),"\n",(0,l.jsx)(r.li,{children:"\u8c03\u8bd5\u4ee3\u7801"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"C++\u4e2d\u7ed3\u6784\u4f53\u7684 struct \u5173\u952e\u5b57\u53ef\u4ee5\u4e0d\u5199"}),"\n",(0,l.jsx)(r.li,{children:"\u89e3\u91ca\u4e86\u7ad9\u70b9\u53c2\u6570\u7ed3\u6784\u4f53\u4e0d\u4f7f\u7528 string \u7684\u539f\u56e0\uff1a\u6ca1\u6709\u4f18\u52bf\uff08\u64cd\u4f5c\u65b9\u4fbf\u3001\u81ea\u52a8\u6269\u5bb9\uff0c\u7531\u4e8e\u6d89\u53ca\u64cd\u4f5c\u5f88\u7b80\u5355\uff0c\u8fd9\u4e9b\u90fd\u7528\u4e0d\u4e0a\u3002\u5e76\u4e14\uff0c\u64cd\u4f5c\u6570\u636e\u5e93\uff0cstring \u6ca1\u6709\u4f18\u52bf\uff0cC \u98ce\u683c\u5b57\u7b26\u4e32\u66f4\u5408\u9002 | \u5982\u679c\u516c\u53f8\u8981\u6c42\u4f7f\u7528 sting\uff0c\u4e5f\u53ef\u4ee5\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u7ed3\u6784\u4f53\u6dfb\u52a0\u524d\u7f00 ",(0,l.jsx)(r.code,{children:"st_"}),"\uff0c\u63d0\u9ad8\u53ef\u8bfb\u6027\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4ee3\u7801\u51e0\u884c\u6216\u5341\u51e0\u884c\u5c31\u8fdb\u884c\u8c03\u8bd5\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u82e5\u5e72\u53c2\u6570\u4f20\u5165 ",(0,l.jsx)(r.code,{children:"logfile.write()"})," \uff0c\u6ce8\u610f\u68c0\u67e5\u53c2\u6570\u6570\u91cf\u662f\u5426\u4e0e\u5360\u4f4d\u7b26\u4e00\u81f4\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\uff0c",(0,l.jsx)(r.strong,{children:"\u53ef\u80fd\u4e0d\u4f1a\u62a5\u9519"}),"\uff0c\u4f46\u5f97\u5230\u7684\u7ed3\u679c\u4f1a\u9519\u4e71\u3002",(0,l.jsx)(r.strong,{children:"\u8b66\u60d5 C++ \u4e2d\u7684\u4e00\u5207\u4e0d\u4f1a\u62a5\u9519\u7684\u9519\u8bef"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:[(0,l.jsx)(r.strong,{children:"\u8bfb\u53d6\u7ad9\u70b9\u53c2\u6570\u6587\u4ef6\uff0c\u4e71\u7801"}),"\u3002\u5c1d\u8bd5\u4e86\u5f88\u591a\u65b9\u6cd5\uff0c\u4e5f\u8bd5\u4e86\u76f4\u63a5\u8fd0\u884c\u8bfe\u7a0b\u4ee3\u7801\uff0c\u8fd8\u662f\u4e71\u7801\u3002"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6655\u4e86\uff0c\u4f4e\u7ea7\u9519\u8bef\u3002",(0,l.jsx)(r.code,{children:"argv[]"})," \u4f20\u5165\u7684\u53c2\u6570\uff0c\u4ece 1 \u5f00\u59cb\u8ba1\u6570\u3002\u4e8e\u662f\uff0c\u6211\u8981\u5904\u7406\u7684\u6587\u4ef6\u9519\u4e86\uff0c\u5bfc\u81f4\u6d6a\u8d39\u4e86\u5f88\u591a\u65f6\u95f4\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"argv[0]"})," \u5373\u53ef\u6267\u884c\u6587\u4ef6\u672c\u8eab"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u641e\u6e05\u695a\u8f93\u5165\u5341\u5206\u91cd\u8981"}),"\uff0c\u4e0d\u8981\u770b\u4f3c\u7e41\u7410\u5c31\u5077\u61d2\uff0c\u6253\u5370\u51fa\u6765\u5c31\u77e5\u9053\u4e86\u3002"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"./crtsurfdata\r\nargv[1] = ../../idc/bin/crtsurfdata\r\nargv[2] = ../../idc/ini/stcode.ini\r\nargv[3] = ../../log/idc/crtsurfdata.log\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u8bfb\u53d6\u5230\u7684\u6587\u4ef6\uff081296\uff09\uff0c\u884c\u6570\u591a\u4e8e\u7ad9\u70b9\u53c2\u6570\u6587\u4ef6\uff08841\u884c\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u540c\u4e00\u4e2a\u56e0\u7d20\u5bfc\u81f4\u7684\uff0c\u8bfb\u5230\u7684\u662f\u522b\u7684\u6587\u4ef6\uff0c\u884c\u6570\u81ea\u7136\u4e0d\u540c\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/05/26 21:29:20 debug\uff0c\u4f4e\u7ea7\u9519\u8bef"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/05/28 20:59:34 \u5b8c\u6210"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"52-\u6a21\u62df\u89c2\u6d4b\u6570\u636e",children:"52 \u6a21\u62df\u89c2\u6d4b\u6570\u636e"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\uff08\u6839\u636e ",(0,l.jsx)(r.code,{children:"stlist"})," \u4e2d\u7684\u7ad9\u70b9\u6570\u636e\uff0c\u751f\u6210\u7ad9\u70b9\u89c2\u6d4b\u6570\u636e\uff0c\u5e76\u5b58\u50a8\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5b9a\u4e49\u89c2\u6d4b\u6570\u636e\u7ed3\u6784\u4f53 ",(0,l.jsx)(r.code,{children:"struct st_surfdata"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u5b58\u653e\u89c2\u6d4b\u6570\u636e\u7684\u5bb9\u5668 ",(0,l.jsx)(r.code,{children:"datalist"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u5904\u7406\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"crtsurfdata()"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0 ",(0,l.jsx)(r.code,{children:"crtsurfdata()"})," \u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u968f\u673a\u6570\u79cd\u5b50"}),"\n",(0,l.jsxs)(r.li,{children:["\u83b7\u53d6\u89c2\u6d4b\u6570\u636e\u7684\u65f6\u95f4\uff08\u58f0\u660e\u4e3a\u5168\u5c40\u53d8\u91cf\uff0c\u4ee3\u7801\u79fb\u52a8\u81f3  ",(0,l.jsx)(r.code,{children:"main"})," \u4e2d\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u58f0\u660e\u5b58\u50a8\u7684\u5bb9\u5668\uff08\u7ed3\u6784\u4f53\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u904d\u5386\u7ad9\u70b9\u6570\u636e\uff0c\u751f\u6210\u968f\u673a\u89c2\u6d4b\u6570\u636e"}),"\n",(0,l.jsx)(r.li,{children:"\u5b58\u50a8\u89c2\u6d4b\u6570\u636e"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u6c14\u8c61\u7ad9\u89c2\u6d4b\u6570\u636e\u7684\u7ed3\u6784\u4f53\r\nstruct st_surfdata {\r\n    char obtid[11];     // \u7ad9\u70b9\u4ee3\u7801\r\n    char ddatetime[15]; // \u6570\u636e\u65f6\u95f4\uff1a\u683c\u5f0f yyyymmddhh24miss\uff0c\u7cbe\u786e\u5230\u5206\u949f\uff0c\u79d2\u56fa\u5b9a\u586b00\r\n    int t;              // \u6c14\u6e29\uff1a0.1\u6444\u6c0f\u5ea6\r\n    int p;              // \u6c14\u538b\uff1a0.1\u767e\u5e15\r\n    int u;              // \u76f8\u5bf9\u6e7f\u5ea6\uff0c0-100\u4e4b\u95f4\r\n    int wd;             // \u98ce\u5411\uff0c0-360\u4e4b\u95f4\r\n    int wf;             // \u98ce\u901f\uff1a0.1m/s\r\n    int r;              // \u964d\u96e8\u91cf\uff1a0.1mm\r\n    int vis;            // \u80fd\u89c1\u5ea6\uff1a0.1\u7c73\r\n};\r\nlist<struct st_surfdata> datalist;      // \u5b58\u653e\u89c2\u6d4b\u6570\u636e\u7684\u5bb9\u5668\r\nvoid crtsurfdata();                     // \u6839\u636e stlist \u5bb9\u5668\u4e2d\u7684\u7ad9\u70b9\u53c2\u6570\uff0c\u751f\u6210\u7ad9\u70b9\u89c2\u6d4b\u6570\u636e\uff0c\u5b58\u653e\u4e8e datalist \u4e2d\r\n\r\nchar strddatetime[15];\r\n\r\nint main(int argc, char *argv[]) {\r\n\t/* ... */\r\n    // \u83b7\u53d6\u89c2\u6d4b\u6570\u636e\u7684\u65f6\u95f4\r\n    memset(strddatetime, 0, sizeof(strddatetime));\r\n    ltime(strddatetime, "yyyymmddhh24miss"); // \u83b7\u53d6\u7cfb\u7edf\u5f53\u524d\u65f6\u95f4\r\n    strncpy(strddatetime + 12, "00", 2);     // \u628a\u6570\u636e\u65f6\u95f4\u4e2d\u7684\u79d2\u56fa\u5b9a\u586b00\r\n\r\n    // 2) \u6839\u636e\u7ad9\u70b9\u53c2\u6570\uff0c\u751f\u6210\u7ad9\u70b9\u89c2\u6d4b\u6570\u636e\uff08\u968f\u673a\u6570\uff09\uff1b\r\n    crtsurfdata();\r\n}\r\n\r\nvoid crtsurfdata() {\r\n\r\n    srand(time(0));\r\n\r\n    st_surfdata stsurfdata;\r\n\r\n    for (auto &aa : stlist) {\r\n        memset(&stsurfdata, 0, sizeof(st_surfdata));\r\n\r\n        // \u586b\u5145\u89c2\u6d4b\u6570\u636e\u7684\u7ed3\u6784\u4f53\u7684\u6210\u5458\r\n        strcpy(stsurfdata.obtid, aa.obtid);             // \u7ad9\u70b9\u4ee3\u7801\r\n        strcpy(stsurfdata.ddatetime, strddatetime);     // \u6570\u636e\u65f6\u95f4\r\n        stsurfdata.t    = rand() % 350;                 // \u6c14\u6e29\r\n        stsurfdata.p    = rand() % 265 + 10000;         // \u6c14\u538b\r\n        stsurfdata.u    = rand() % 101;                 // \u76f8\u5bf9\u6e7f\u5ea6\r\n        stsurfdata.wd   = rand() % 360;                 // \u98ce\u5411\r\n        stsurfdata.wf   = rand() % 150;                 // \u98ce\u901f\r\n        stsurfdata.r    = rand() % 16;                  // \u964d\u96e8\u91cf\r\n        stsurfdata.vis  = rand() % 5001 + 100000;       // \u80fd\u89c1\u5ea6\r\n\r\n        datalist.push_back(stsurfdata);                 // \u628a\u89c2\u6d4b\u6570\u636e\u7684\u7ed3\u6784\u4f53\u653e\u5165 datalist \u5bb9\u5668\r\n    }\r\n\r\n    for (auto &aa : datalist) {\r\n        logfile.write("%s, %s, %.1f, %.1f, %d, %d, %.1f, %.1f, %.1f\\n",\\\r\n                        aa.obtid, aa.ddatetime, aa.t/10.0, aa.p/10.0, aa.u, aa.wd, aa.wd/10.0, aa.r/10.0, aa.vis/10.0);\r\n    }\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5c11\u72af\u9519\uff0c\u53ef\u72af\u53ef\u4e0d\u72af\u7684\u9519\u8bef\u4e0d\u8981\u72af\uff08\u4f8b\u5982\u6a21\u62df\u6570\u636e\u5728\u5408\u9002\u7684\u8303\u56f4\uff0c\u800c\u6c14\u6e29100\u5ea6\u5c31\u79bb\u8c31\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u521d\u59cb\u5316\u662f\u4e00\u4e2a\u597d\u4e60\u60ef\uff08\u82e5\u4e0d\u521d\u59cb\u5316\uff0c\u5bb9\u6613\u4ea7\u751f\u4f4e\u7ea7\u9519\u8bef\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/05/28 22:00:52"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"53-\u628a\u6570\u636e\u5199\u5165\u6587\u4ef6",children:"53 \u628a\u6570\u636e\u5199\u5165\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\uff08\u5c06\u4e0a\u4e00\u8282\u6a21\u62df\u6570\u636e\u5199\u5165\u6587\u4ef6\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"main"})," \u53c2\u6570\u89c4\u6a21\uff08\u6dfb\u52a0 ",(0,l.jsx)(r.code,{children:"datafmt"})," \u683c\u5f0f\u6307\u793a\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u5199\u5165\u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"main"})," \u6dfb\u52a0\u4e09\u79cd\u6587\u4ef6\u683c\u5f0f\u7684\u5224\u65ad"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\u5199\u5165\u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u62fc\u63a5\u6307\u5b9a\u683c\u5f0f\u7684\u6587\u4ef6\u540d\uff08\u8def\u5f84 / \u7ea6\u5b9a\u540d / \u65e5\u671f / \u65f6\u95f4 / \u7ebf\u7a0b\u53f7 / .\u683c\u5f0f\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5199\u5165\u6570\u636e\u683c\u5f0f\u5316\uff08csv\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u6d4b\u8bd5\u8f93\u51fa"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u73b0\u683c\u5f0f\u652f\u6301\uff08xml\u3001json\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u628a datalist \u4e2d\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u5199\u5165\u6587\u4ef6\uff0coutpath\u6570\u636e\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\uff1bdatafmt\u6570\u636e\u6587\u4ef6\u683c\u5f0f\uff0c\u53d6csv\u3001xml\u3001json\r\nbool crtsurffile(const string& outpath, const string& datafmt);\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    // \u7ad9\u70b9\u53c2\u6570\u6587\u4ef6  \u751f\u6210\u7684\u6d4b\u8bd5\u6570\u636e\u5b58\u653e\u7684\u76ee\u5f55 \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7 \u8f93\u51fa\u6570\u636e\u6587\u4ef6\u7684\u683c\u5f0f\r\n    if (argc!=5)\r\n    {\r\n        // \u5982\u679c\u53c2\u6570\u975e\u6cd5\uff0c\u7ed9\u51fa\u5e2e\u52a9\u6587\u6863\u3002\r\n        cout << "Using: ./crtsurfdata inifile outpath logfile datafmt\\n";\r\n        cout << "Examples: ../bin/crtsurfdata ../ini/stcode.ini ../../tmp/idc/surfdata ../../log/idc/crtsurfdata.log csv,xml,json\\n\\n";\r\n\r\n        // cout << "\u672c\u7a0b\u5e8f\u7528\u4e8e\u751f\u6210\u6c14\u8c61\u7ad9\u70b9\u89c2\u6d4b\u7684\u5206\u949f\u6570\u636e\uff0c\u7a0b\u5e8f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\uff0c\u7531\u8c03\u5ea6\u6a21\u5757\u542f\u52a8\u3002\\n";\r\n        cout << "inifile  \u6c14\u8c61\u7ad9\u70b9\u53c2\u6570\u6587\u4ef6\u540d\u3002\\n";\r\n        cout << "outpath  \u6c14\u8c61\u7ad9\u70b9\u6570\u636e\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\u3002\\n";\r\n        cout << "logfile  \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u540d\u3002\\n";\r\n        cout << "datafmt  \u8f93\u51fa\u6570\u636e\u6587\u4ef6\u7684\u683c\u5f0f\uff0c\u652f\u6301csv\u3001xml\u548cjson\uff0c\u4e2d\u95f4\u7528\u9017\u53f7\u5206\u9694\u3002\\n\\n";\r\n\r\n        return -1;\r\n    }\r\n\r\n    /* ... */\r\n\r\n    // 3) \u628a datalist \u4e2d\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u5199\u5165\u6587\u4ef6\uff0coutpath\u6570\u636e\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\uff1bdatafmt\u6570\u636e\u6587\u4ef6\u683c\u5f0f\uff0c\u53d6csv\u3001xml\u3001json\r\n    if (strstr(argv[4], "csv") != 0) crtsurffile(argv[2], "csv");\r\n    if (strstr(argv[4], "xml") != 0) crtsurffile(argv[2], "xml");\r\n    if (strstr(argv[4], "json") != 0) crtsurffile(argv[2], "json");\r\n\r\n    logfile.write("crtsurfdata \u8fd0\u884c\u7ed3\u675f\u3002\\n");\r\n\r\n    return 0;\r\n}\r\n\r\n\r\nbool crtsurffile(const string& outpath, const string& datafmt) {\r\n\r\n    // \u62fc\u63a5\u751f\u6210\u6570\u636e\u7684\u6587\u4ef6\u540d\uff0c\u4f8b\u5982\uff1a../../tmp/idc/surfdata/SURF_ZH_20240529183840_2333.csv\r\n    string strfilename = outpath + "/" + "SURF_ZH_" + strddatetime + "_" + to_string(getpid()) + "." + datafmt;\r\n\r\n    cofile ofile; // \u5199\u5165\u6570\u636e\u6587\u4ef6\u7684\u5bf9\u8c61\r\n\r\n    if (ofile.open(strfilename) == false) {\r\n        logfile.write("ofile.open(%s) failed.\\n", strfilename.c_str());\r\n        return false;\r\n    }\r\n\r\n    // \u89c2\u6d4b\u6570\u636e\u5199\u5165\u6587\u4ef6\r\n    if (datafmt == "csv") ofile.writeline("\u7ad9\u70b9\u4ee3\u7801\uff0c\u6570\u636e\u65f6\u95f4\uff0c\u6c14\u6e29\uff0c\u6c14\u538b\uff0c\u76f8\u5bf9\u6e7f\u5ea6\uff0c\u98ce\u5411\uff0c\u98ce\u901f\uff0c\u964d\u96e8\u91cf\uff0c\u80fd\u89c1\u5ea6\\n");\r\n    if (datafmt == "xml") ofile.writeline("<data>\\n");\r\n    if (datafmt == "json") ofile.writeline("{\\"data\\":[\\n");\r\n\r\n    // \u904d\u5386\u5b58\u653e\u89c2\u6d4b\u6570\u636e\u7684 datalist \u5bb9\u5668\r\n    for (auto &aa : datalist) {\r\n        if (datafmt == "csv")\r\n            ofile.writeline("%s, %s, %.1f, %.1f, %d, %d, %.1f, %.1f, %.1f\\n",\\\r\n                            aa.obtid, aa.ddatetime, aa.t/10.0, aa.p/10.0, aa.u, aa.wd, aa.wf/10.0, aa.r/10.0, aa.vis/10.0);\r\n        \r\n        if (datafmt == "xml")\r\n            ofile.writeline("<obtid>%s</obtid> <ddatetime>%s</ddatetime> <t>%.1f</t> <p>%.1f</p> <u>%d</u>"\\\r\n                             "<wd>%d</wd> <wf>%.1f<wf> <r>%.1f</r> <vis>%.1f</vis><endl/>\\n",\\\r\n                            aa.obtid, aa.ddatetime, aa.t/10.0, aa.p/10.0, aa.u, aa.wd, aa.wf/10.0, aa.r/10.0, aa.vis/10.0);\r\n        \r\n        if (datafmt == "json") {\r\n            ofile.writeline("{\\"obtid\\":\\"%s\\", \\"ddatetime\\":\\"%s\\", \\"t\\":\\"%.1f\\", \\"p\\":\\"%.1f\\", \\"u\\":\\"%d\\","\\\r\n                             "\\"wd\\":\\"%d\\", \\"wf\\":\\"%.1f\\", \\"r\\":\\"%.1f\\", \\"vis\\":\\"%.1f\\"}",\\\r\n                            aa.obtid, aa.ddatetime, aa.t/10.0, aa.p/10.0, aa.u, aa.wd, aa.wf/10.0, aa.r/10.0, aa.vis/10.0);\r\n            // json \u6587\u4ef6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u4e0d\u9700\u8981\u90fd\u9017\u53f7\uff0c\u4e0b\u9762\u7279\u6b8a\u5904\u7406\r\n            static int count = 0;\r\n            if (count < datalist.size() - 1) {\r\n                ofile.writeline(",\\n"); count++;\r\n            } else {\r\n                ofile.writeline("\\n");\r\n            }\r\n        }\r\n    }\r\n\r\n    if (datafmt == "xml") ofile.writeline("</data>\\n");\r\n    if (datafmt == "json") ofile.writeline("]}\\n");\r\n\r\n    ofile.closeandrename(); // \u5173\u95ed\u4e34\u65f6\u6587\u4ef6\uff0c\u5e76\u6539\u540d\u4e3a\u6b63\u5f0f\u7684\u6587\u4ef6\r\n\r\n    logfile.write("\u751f\u6210\u6570\u636e\u6587\u4ef6 %s \u6210\u529f\uff0c\u6570\u636e\u65f6\u95f4 %s\uff0c\u8bb0\u5f55\u6570 %d\u3002\\n", strfilename.c_str(), strddatetime, datalist.size());\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u601d\u8003"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4ec0\u4e48\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff0c\u8f93\u51fa\u7684\u503c\u8981\u9664\u4ee5 ",(0,l.jsx)(r.code,{children:"10.0"})," \u800c\u4e0d\u662f ",(0,l.jsx)(r.code,{children:"10"})," \uff1f"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u611f\u609f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e00\u4e9b\u7ea6\u5b9a\u6027\u8d28\u7684\u5185\u5bb9\uff0c\u5e94\u5f53\u501f\u9274\u56e2\u961f\u7684\u89c4\u8303\u3001\u770b\u4f18\u79c0\u4ee3\u7801\u7684\u7edf\u4e00\u98ce\u683c\u7b49\uff08\u591a\u770b\u5c31\u77e5\u9053\u54ea\u4e9b\u597d\u4e86\uff09\uff0c\u4f8b\u5982\u5f62\u53c2 ",(0,l.jsx)(r.code,{children:"string& outpath"})," \u7684\u5f15\u7528\u8fd0\u7b97\u7b26\uff0c\u662f\u4e0e\u7c7b\u578b\u8d34\u7740\u8fd8\u662f\u4e0e\u53d8\u91cf\u540d\u8d34\u7740\uff1b\u53c8\u5982\u82b1\u62ec\u53f7\uff0c\u662f\u53e6\u8d77\u4e00\u884c\u8fd8\u662f\u8d34\u7740\u5b9a\u4e49\u8bed\u53e5\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/03/15 21:28:04\uff0c2024/05/29 19:56:31"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h2,{id:"\u7b2c\u516b\u7ae0-\u670d\u52a1\u7a0b\u5e8f\u7684\u76d1\u63a7\u548c\u8c03\u5ea6",children:"\u7b2c\u516b\u7ae0 \u670d\u52a1\u7a0b\u5e8f\u7684\u76d1\u63a7\u548c\u8c03\u5ea6"}),"\n",(0,l.jsx)(r.h3,{id:"54-\u76d1\u63a7\u548c\u8c03\u5ea6\u7684\u4e1a\u52a1\u9700\u6c42",children:"54 \u76d1\u63a7\u548c\u8c03\u5ea6\u7684\u4e1a\u52a1\u9700\u6c42"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6982\u62ec\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u672c\u8282\u4ecb\u7ecd\u4e86 \u201c\u670d\u52a1\u7a0b\u5e8f\u4f1a\u50f5\u6b7b\u201d \u8fd9\u4e00\u666e\u904d\u73b0\u8c61\uff0c\u5f15\u51fa\u4e86\u5bf9\u670d\u52a1\u7a0b\u5e8f\u8fdb\u884c\u76d1\u63a7\u548c\u8c03\u5ea6\u7684\u5fc5\u8981\u6027\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u52a1\u7a0b\u5e8f\u4f1a\u50f5\u6b7b\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u50f5\u6b7b\u5f80\u5f80\u5e76\u975e\u7a0b\u5e8f\u5458\u6c34\u5e73\u4e0d\u591f\uff0c\u4f8b\u5982\u5fae\u8f6f\u4ea7\u54c1\uff0c\u7a0b\u5e8f\u5458\u6c34\u5e73\u80af\u5b9a\u4e0d\u4f4e\uff0c\u800c\u4e14\u6bcf\u884c\u4ee3\u7801\u90fd\u7ecf\u8fc7\u4e25\u683c\u5ba1\u67e5 --\x3e \u56e0\u6b64\uff0c\u771f\u6b63\u7684\u539f\u56e0\u662f\u590d\u6742\u7684\u800c\u96be\u4ee5\u6e05\u6670\u5316\u7684\uff1b\u6839\u636e\u7ecf\u9a8c\uff0c\u901a\u5e38\u7f51\u7edc\u670d\u52a1\u7a0b\u5e8f\u66f4\u5bb9\u6613\u50f5\u6b7b\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u7a0b\u5e8f\u5982\u4eba\u751f\uff0c\u90fd\u6709\u4e9b\u5c0f\u6027\u5b50\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5bf9\u4e8e",(0,l.jsx)(r.strong,{children:"\u4e00\u822c\u7a0b\u5e8f"}),"\uff0c\u91cd\u542f\u3001\u91cd\u88c5\u80fd\u591f\u89e3\u51b399%\u95ee\u9898\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5bf9\u4e8e",(0,l.jsx)(r.strong,{children:"\u670d\u52a1\u7a0b\u5e8f"}),"\uff0c\u5f80\u5f80\u4f5c\u4e3a\u540e\u53f0\u670d\u52a1\uff0c\u4eba\u5de5\u5e72\u9884\u4e0d\u73b0\u5b9e\uff0c\u4e8e\u662f\u9700\u8981\u670d\u52a1\u7a0b\u5e8f\u7684\u76d1\u63a7\u548c\u8c03\u5ea6\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5468\u671f\u6027\u8fd0\u884c"}),"\n",(0,l.jsx)(r.li,{children:"\u68c0\u6d4b\u5b58\u6d3b --\x3e \u672a\u5b58\u6d3b --\x3e \u7ec8\u6b62"}),"\n",(0,l.jsx)(r.li,{children:"\u7ec8\u6b62 --\x3e \u91cd\u542f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"55-\u8c03\u5ea6\u6a21\u5757",children:"55 \u8c03\u5ea6\u6a21\u5757"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6982\u62ec\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u672c\u8282\u5148\u4ecb\u7ecd\u4e86\u670d\u52a1\u7a0b\u5e8f\u7684\u4e24\u79cd\u8fd0\u884c\u65b9\u5f0f\uff0c\u5206\u522b\u4e3a\u5468\u671f\u6027\u542f\u52a8\u3001\u7ec8\u6b62\u7acb\u5373\u91cd\u542f\u3002\u5176\u540e\u521b\u5efa\u4e86\u76f8\u5173\u7684\u6587\u4ef6\u76ee\u5f55\uff0c\u5e76\u76f4\u63a5\u7ed9\u51fa\u4e86\u5b88\u62a4\u7a0b\u5e8f\u7684\u4ee3\u7801\uff0c\u5148\u5e26\u7740\u4f53\u9a8c\u4e86\u8c03\u5ea6\u7a0b\u5e8f\u7684\u529f\u80fd\uff0c\u800c\u540e\u8be6\u7ec6\u5730\u5206\u6790\u6e90\u4ee3\u7801\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u52a1\u7a0b\u5e8f\u7684\u4e24\u79cd\u8fd0\u884c\u65b9\u5f0f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5468\u671f\u6027\u8fd0\u884c\u7684\u670d\u52a1\u7a0b\u5e8f --\x3e \uff08\u5468\u671f\u6027\uff09\u542f\u52a8\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f8b\u5982\uff0c\u751f\u6210\u6d4b\u8bd5\u6570\u636e\u7684\u7a0b\u5e8f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5e38\u9a7b\u5185\u5b58\u4e2d\u7684\u670d\u52a1\u7a0b\u5e8f --\x3e \uff08\u6b63\u5e38 / \u5f02\u5e38\uff09\u7ec8\u6b62 --\x3e \uff08\u7acb\u5373\uff09\u91cd\u542f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f8b\u5982\uff0c\u7f51\u7edc\u901a\u8baf\u670d\u52a1\u7aef\u7a0b\u5e8f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"tools"})," \u5b58\u653e\u672c\u9879\u76ee",(0,l.jsx)(r.strong,{children:"\u901a\u7528\u6a21\u5757"})," \uff08\u521b\u5efa\u76ee\u5f55\u3001\u76f8\u5173\u6587\u4ef6\u5939\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"procctl.cpp"})," \u6587\u4ef6 --\x3e ",(0,l.jsx)(r.code,{children:"makefile"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u67e5\u627e\u8fdb\u7a0b ",(0,l.jsx)(r.code,{children:"ps -ef | grep procctl"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ed3\u675f\u8fdb\u7a0b ",(0,l.jsx)(r.code,{children:"killall -9 procctl"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u9010\u884c\u89e3\u91ca\u4ee3\u7801\uff08\u6309\u529f\u80fd\u6a21\u5757\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8c03\u5ea6\u7a0b\u5e8f\u5173\u95ed I/O\u3001\u8fd0\u884c\u5468\u671f\u7684\u8bbe\u7f6e"}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u5ea6\u7a0b\u5e8f\u7531\u7cfb\u7edf 1 \u53f7\u8fdb\u7a0b\u6258\u7ba1\uff08",(0,l.jsx)(r.code,{children:"fork() != 0 "})," \u5c06\u7236\u8fdb\u7a0b\u9000\u51fa\uff09"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-makefile",children:"# makefile\r\nall: procctl\r\n\r\nprocctl:procctl.cpp\r\n\t\tg++ -g -o procctl procctl.cpp\r\n\t\tcp -f procctl ../bin/.\r\n\r\nclean:\r\n\t\trm -rf procctl\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u7ed3\u6784\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5934\u6587\u4ef6 --\x3e ",(0,l.jsx)(r.code,{children:"main"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u53c2\u6570\u5c11\u4e8e 3 \u4e2a ",(0,l.jsx)(r.code,{children:"argc < 3"}),"\uff0c\u8fd4\u56de\u63d0\u793a\uff0c\u5426\u5219\u5927\u4e8e\u7b49\u4e8e3\u4e2a\uff0c\u5408\u6cd5\u6267\u884c\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53c2\u6570\u7ec4\u6210\uff08\u672c\u7a0b\u5e8f0\u3001\u8fd0\u884c\u5468\u671f1\u3001\u8c03\u5ea6\u7a0b\u5e8f2\u3001\u53ef\u53d8\u53c23...\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u5904\u7406\u4fe1\u53f7\u548c I/O\uff08\u90e8\u5206\u5c4f\u853d\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u751f\u6210\u5b50\u8fdb\u7a0b\uff0c\u9000\u51fa\u7236\u8fdb\u7a0b\uff08\u5b88\u62a4\u8fdb\u7a0b --\x3e \u540e\u53f0\u8fd0\u884c --\x3e \u7cfb\u7edf1\u8fdb\u7a0b\u6258\u7ba1\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u5b50\u8fdb\u7a0b\u9000\u51fa\u4fe1\u53f7\u6062\u590d\uff08\u4f7f\u5f97\u7236\u8fdb\u7a0b\u53ef ",(0,l.jsx)(r.code,{children:"wait()"})," \u6355\u83b7\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5c06\u90e8\u5206 ",(0,l.jsx)(r.code,{children:"argv"})," \u5b58\u4e8e\u6307\u9488\u6570\u7ec4\uff0c\u4f20\u9012\u7ed9 ",(0,l.jsx)(r.code,{children:"execv()"})," \uff08\u8c03\u5ea6\u7a0b\u5e8f\u540d + \u53ef\u53d8\u53c2\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5faa\u73af\u4f53\uff08\u8c03\u5ea6\u7a0b\u5e8f\u7684\u6838\u5fc3\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b50\u8fdb\u7a0b\u8fd0\u884c\u8c03\u5ea6\u7a0b\u5e8f"}),"\n",(0,l.jsx)(r.li,{children:"\u7236\u8fdb\u7a0b\u963b\u585e\u7b49\u5f85\u5b50\u8fdb\u7a0b\u7ec8\u6b62\uff08\u72b6\u6001\u6355\u83b7 or \u5ffd\u7565\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u672c\u7a0b\u5e8f\u4e0d\u9700\u8981\u5305\u542b_public.h\uff0c\u6ca1\u5fc5\u8981\u4f9d\u8d56\u90a3\u4e48\u591a\u5934\u6587\u4ef6\u3002\r\n#include <cstdio>\r\n#include <stdlib.h>\r\n#include <string.h>\r\n#include <unistd.h>\r\n#include <sys/types.h>\r\n#include <sys/wait.h>\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc < 3) {\r\n        printf("Using: ./procctl timetvl program argv ...\\n");\r\n        printf("Example: ../../tools/bin/procctl 10 /usr/bin/tar zcvf /tmp/tmp.tgz /usr/include\\n");\r\n  \t    printf("Example: ../../tools/bin/procctl 60 ../../idc/bin/crtsurfdata ../../idc/ini/stcode.ini ../../tmp/idc/surfdata ../../log/idc/crtsurfdata.log csv,xml,json\\n");\r\n\r\n        printf("\u672c\u7a0b\u5e8f\u662f\u670d\u52a1\u7a0b\u5e8f\u7684\u8c03\u5ea6\u7a0b\u5e8f\uff0c\u5468\u671f\u6027\u542f\u52a8\u670d\u52a1\u7a0b\u5e8f\u6216shell\u811a\u672c\u3002\\n");\r\n        printf("timetvl \u8fd0\u884c\u5468\u671f\uff0c\u5355\u4f4d\uff1a\u79d2\u3002\\n");\r\n        printf("        \u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\u540e\uff0c\u5728timetvl\u79d2\u540e\u4f1a\u88abprocctl\u91cd\u65b0\u542f\u52a8\u3002\\n");\r\n        printf("        \u5982\u679c\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u662f\u5468\u671f\u6027\u7684\u4efb\u52a1\uff0ctimetvl\u8bbe\u7f6e\u4e3a\u8fd0\u884c\u5468\u671f\u3002\\n");\r\n        printf("        \u5982\u679c\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u662f\u5e38\u9a7b\u5185\u5b58\u7684\u670d\u52a1\u7a0b\u5e8f\uff0ctimetvl\u8bbe\u7f6e\u5c0f\u4e8e5\u79d2\u3002\\n");\r\n        printf("program \u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u540d\uff0c\u5fc5\u987b\u4f7f\u7528\u5168\u8def\u5f84\u3002\\n");\r\n        printf("...     \u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u7684\u53c2\u6570\u3002\\n");\r\n        printf("\u6ce8\u610f\uff0c\u672c\u7a0b\u5e8f\u4e0d\u4f1a\u88abkill\u6740\u6b7b\uff0c\u4f46\u53ef\u4ee5\u7528kill -9\u5f3a\u884c\u6740\u6b7b\u3002\\n\\n\\n");\r\n\r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u4fe1\u53f7\u548cI/O\uff0c\u672c\u7a0b\u5e8f\u4e0d\u5e0c\u671b\u88ab\u6253\u6270\u3002\r\n    // \u6ce8\u610f\uff1a1\uff09\u4e3a\u4e86\u9632\u8c03\u5ea6\u7a0b\u5e8f\u88ab\u8bef\u6740\uff0c\u4e0d\u5904\u7406\u9000\u51fa\u4fe1\u53f7\uff1b\r\n    //       2\uff09\u5982\u679c\u5ffd\u7565\u548c\u4fe1\u53f7\u548c\u5173\u95ed\u4e86I/O\uff0c\u5c06\u5f71\u54cd\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\uff08\u4e5f\u4f1a\u5ffd\u7565\u548c\u4fe1\u53f7\u548c\u5173\u95ed\u4e86I/O\uff09\u3002 why\uff1f\u56e0\u4e3a\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u53d6\u4ee3\u4e86\u5b50\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u4f1a\u7ee7\u627f\u7236\u8fdb\u7a0b\u7684\u4fe1\u53f7\u5904\u7406\u65b9\u5f0f\u548cI/O\u3002\r\n    for (int ii = 0; ii < 64; ii++) {\r\n        signal(ii, SIG_IGN);\r\n        close(ii);\r\n    }\r\n\r\n    // \u751f\u6210\u5b50\u8fdb\u7a0b\uff0c\u7236\u8fdb\u7a0b\u9000\u51fa\uff0c\u8ba9\u7a0b\u5e8f\u8fd0\u884c\u5728\u540e\u53f0\uff0c\u7531\u7cfb\u7edf1\u53f7\u8fdb\u7a0b\u6258\u7ba1\uff0c\u4e0d\u53d7shell\u7684\u63a7\u5236\u3002\r\n    if (fork() != 0) exit(0);\r\n\r\n    // \u628a\u5b50\u8fdb\u7a0b\u9000\u51fa\u7684\u4fe1\u53f7SIGCHLD\u6062\u590d\u4e3a\u9ed8\u8ba4\u884c\u4e3a\uff0c\u8ba9\u7236\u8fdb\u7a0b\u53ef\u4ee5\u8c03\u7528wait()\u51fd\u6570\u7b49\u5f85\u5b50\u8fdb\u7a0b\u9000\u51fa\u3002\r\n    signal(SIGCHLD, SIG_DFL);\r\n\r\n    // \u5b9a\u4e49\u4e00\u4e2a\u548cargv\u4e00\u6837\u5927\u7684\u6307\u9488\u6570\u7ec4\uff0c\u5b58\u653e\u88ab\u8c03\u5ea6\u7a0b\u5e8f\u540d\u53ca\u5176\u53c2\u6570\u3002\r\n    char *pargv[argc];\r\n    for (int ii = 2; ii < argc; ii++)\r\n        pargv[ii - 2] = argv[ii];\r\n\r\n    pargv[argc - 2] = nullptr; // \u7a7a\u8868\u793a\u53c2\u6570\u5df2\u7ed3\u675f\u3002\r\n\r\n    while (true) {\r\n        if (fork() == 0) {\r\n            // \u5b50\u8fdb\u7a0b\u8fd0\u884c\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u3002\r\n            execv(argv[2], pargv);\r\n            exit(0);  // \u5982\u679c\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u8fd0\u884c\u5931\u8d25\uff0c\u624d\u4f1a\u6267\u884c\u8fd9\u884c\u4ee3\u7801\u3002\r\n        } else {\r\n            // \u7236\u8fdb\u7a0b\u7b49\u5f85\u5b50\u8fdb\u7a0b\u7ec8\u6b62\uff08\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u675f\uff09\u3002\r\n            //int status;\r\n            //wait(&status);           // wait()\u51fd\u6570\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u7ec8\u6b62\u3002\r\n            wait(nullptr);           // wait()\u51fd\u6570\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u88ab\u8c03\u5ea6\u7684\u7a0b\u5e8f\u7ec8\u6b62\u3002\r\n            sleep(atoi(argv[1]));  // \u4f11\u7720timetvl\u79d2\uff0c\u7136\u540e\u56de\u5230\u5faa\u73af\u3002\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u7ec8\u6b62\u670d\u52a1\u7a0b\u5e8f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5468\u671f\u6027\u7a0b\u5e8f ",(0,l.jsx)(r.code,{children:"killall -9"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u5e38\u9a7b\u5185\u5b58\u7a0b\u5e8f\uff1a\u540c\u65f6\u628a\u670d\u52a1\u3001\u8c03\u5ea6\u7a0b\u5e8f ",(0,l.jsx)(r.code,{children:"killall -9"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240530200519467",src:e(47420).A+"",width:"1114",height:"420"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u76f8\u5173\u7ae0\u8282"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["314\uff0c",(0,l.jsx)(r.code,{children:"exec"})," \u51fd\u6570\u7c07"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u672c\u8282\u76f4\u63a5\u7ed9\u51fa\u4ee3\u7801\uff0c\u5e76\u672a\u4ece\u96f6\u5f00\u59cb\u5199\uff0c\u8fd9\u5bf9\u4e8e\u638c\u63e1\u6574\u4f53\u7684\u4ee3\u7801\u6784\u5efa\u601d\u8def\u4e0d\u53cb\u597d\uff0c\u56e0\u4e3a\u770b\u5230\u7684\u4ee3\u7801\u662f\u6700\u7ec8\u7248\u672c\uff0c\u5373\u591a\u6b21\u601d\u7ef4 + \u4ee3\u7801\u8fed\u4ee3\u7684\u7ed3\u679c\u3002\u800c\u82e5\u60f3\u66f4\u597d\u5730\u63d0\u9ad8\u4ee3\u7801\u80fd\u529b\uff0c\u5fc5\u987b\u8981\u4e86\u89e3\u4ee3\u7801\u6784\u5efa\u7684\u5177\u4f53\u8fc7\u7a0b\uff0c\u987a\u7740\u4f5c\u8005\u7684\u601d\u8def\uff0c\u601d\u8003\u4e3a\u4ec0\u4e48\u8981\u4ee5\u8fd9\u6837\u7684\u903b\u8f91\u987a\u5e8f\u6784\u5efa\uff0c\u5148\u5904\u7406\u4e86\u4ec0\u4e48\uff0c\u540e\u5904\u7406\u4e86\u4ec0\u4e48\uff0c\u8fd9\u4e9b\u90fd\u5f88\u91cd\u8981\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5bf9\u4e8e\u672a\u63d0\u4f9b\u4ee3\u7801\u6784\u5efa\u8fc7\u7a0b\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u5148",(0,l.jsx)(r.strong,{children:"\u603b\u89c8\u4ee3\u7801"}),"\uff0c",(0,l.jsx)(r.strong,{children:"\u6982\u62ec"}),"\u4e3a\u4e0d\u540c\u6a21\u5757\uff0c\u603b\u7ed3\u51fa\u6a21\u5757\u7684",(0,l.jsx)(r.strong,{children:"\u903b\u8f91\u5173\u7cfb"}),"\uff0c\u800c\u540e\u81ea\u5df1\u6309\u7167\u8fd9\u4e2a\u5173\u7cfb\uff0c",(0,l.jsx)(r.strong,{children:"\u6574\u7406\u4ee3\u7801\u601d\u8def"}),"\uff0c\u5e76\u5199\u51fa\u76f8\u5e94\u7684",(0,l.jsx)(r.strong,{children:"\u5b9e\u73b0"}),"\uff08\u603b\u89c8 --\x3e \u6982\u62ec --\x3e \u903b\u8f91 --\x3e \u601d\u8def --\x3e \u5c1d\u8bd5\u5b9e\u73b0\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u8c03\u5ea6\u7a0b\u5e8f\u4ee3\u7801\u867d\u7136\u7b80\u5355\uff0c\u4f46\u4e00\u5b9a\u8981\u81ea\u5df1\u5199\u51fa\u6765\uff0c\u5199\u8fc7\u548c\u6ca1\u5199\u8fc7\u6548\u679c\u5b8c\u5168\u4e0d\u540c\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u5982\u4f55\u786e\u5b9a\u8fdb\u7a0b\u76f8\u5173\u7684\u5b50\u8fdb\u7a0b\u3001\u5b50\u7ebf\u7a0b\u5b8c\u5168\u9000\u51fa\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"waitpid()"})," \u6216 ",(0,l.jsx)(r.code,{children:"wait()"})," \u7b49\u7cfb\u7edf\u8c03\u7528\uff0c\u68c0\u67e5\u5b50\u8fdb\u7a0b\u9000\u51fa\u72b6\u6001\uff0c\u53ef\u786e\u4fdd\u6240\u6709\u5b50\u8fdb\u7a0b\u90fd\u5df2\u7ec8\u6b62\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:[(0,l.jsx)(r.code,{children:"ps"})," \u6307\u4ee4\u53ef\u5426\u5b8c\u5168\u67e5\u5230\uff1f"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"ps"})," \u53ef\u5217\u51fa\u6240\u6709\u8fdb\u7a0b\uff0c\u901a\u8fc7 ",(0,l.jsx)(r.code,{children:"ps -ef"})," \u6216 ",(0,l.jsx)(r.code,{children:"ps aux"})," \u53ef\u770b\u5230\u8be6\u7ec6\u8fdb\u7a0b\u4fe1\u606f\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u3001\u670d\u52a1\u7a0b\u5e8f\u53ef\u7531\u5176\u6267\u884c\u65f6\u7684\u540d\u79f0\u786e\u5b9a\uff08\u4f8b\u5982\u8c03\u5ea6\u7a0b\u5e8f\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"./procctl 8 ./server1"})," \u7684\u6267\u884c\u6307\u4ee4\u4f5c\u4e3a\u5176\u8fdb\u7a0b\u540d\u79f0\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u5982\u4f55\u6e05\u6670\u5730\u7406\u89e3 \u201c\u751f\u6210\u5b50\u8fdb\u7a0b\uff0c\u9000\u51fa\u7236\u8fdb\u7a0b\uff0c\u540e\u53f0\u6258\u7ba1\u201d \u7684\u64cd\u4f5c\uff1f\u8fd9\u4e00\u6b65\u9000\u51fa\u7684\u662f ",(0,l.jsx)(r.code,{children:"procctl"})," \uff1f\u90a3\u4e48\u7236\u8fdb\u7a0b\u9000\u51fa\u540e\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u7531\u5b50\u8fdb\u7a0b\u62f7\u8d1d\u7684\u7a7a\u95f4\u6267\u884c\uff1f"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u751f\u6210\u5b50\u8fdb\u7a0b ",(0,l.jsx)(r.code,{children:"fork()"})," \uff1b"]}),"\n",(0,l.jsxs)(r.li,{children:["\u9000\u51fa ",(0,l.jsx)(r.code,{children:"procctl"})," \u7684\u7236\u8fdb\u7a0b ",(0,l.jsx)(r.code,{children:"exit(0)"})," \uff1b"]}),"\n",(0,l.jsxs)(r.li,{children:["\u540e\u53f0\u6258\u7ba1\uff1a\u5b50\u8fdb\u7a0b\u88ab 1 \u53f7\u8fdb\u7a0b ",(0,l.jsx)(r.code,{children:"init"})," \u6216 ",(0,l.jsx)(r.code,{children:"systemd"})," \u6536\u517b\uff0c\u53d8\u6210",(0,l.jsx)(r.strong,{children:"\u5b64\u513f\u8fdb\u7a0b"}),"\uff0c\u8131\u79bb\u7ec8\u7aef\u63a7\u5236\uff0c\u6210\u4e3a\u540e\u53f0\u8fdb\u7a0b\uff1b"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u5b50\u8fdb\u7a0b\uff08\u6210\u4e3a\u65b0\u7684\u7236\u8fdb\u7a0b\uff09\u7ee7\u7eed\u6267\u884c"}),"\u4e0b\u9762\u7684\u4ee3\u7801\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["(2.4)\u4f46\u4e3a\u4ec0\u4e48\u5728\u8fdb\u5165\u5faa\u73af\u4f53\u4e4b\u524d\uff0c\u8fd8\u9700\u8981\u628a\u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\u4fe1\u53f7\u6062\u590d\u9ed8\u8ba4\uff1f(2.4.2)\u6b64\u65f6\u7684\u5b50\u8fdb\u7a0b\uff0c\u4f9d\u7136\u53eb\u505a ",(0,l.jsx)(r.code,{children:"procctl"}),"\uff1f(2.5)\u7236\u8fdb\u7a0b\u90fd\u9000\u51fa\u4e86\uff0c\u8fd8\u600e\u4e48\u5904\u7406\u5b50\u8fdb\u7a0b\u7684\u4fe1\u53f7\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u786e\u4fdd\u5728",(0,l.jsx)(r.strong,{children:"\u65b0\u7684\u5b50\u8fdb\u7a0b"}),"\u9000\u51fa\u65f6\uff0c",(0,l.jsx)(r.strong,{children:"\u65b0\u7684\u7236\u8fdb\u7a0b"}),"\u53ef\u4ee5 ",(0,l.jsx)(r.code,{children:"wait()"})," \u6355\u83b7 ",(0,l.jsx)(r.code,{children:"SIGCHLD"})," \u4fe1\u53f7\uff0c\u4ee5\u6b63\u786e\u5904\u7406\u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\u72b6\u6001\uff1b"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4f9d\u7136\u53eb\u505a ",(0,l.jsx)(r.code,{children:"procctl"}),"\uff0c\u6700\u521d\u751f\u6210\u7684\u5b50\u8fdb\u7a0b\u7ee7\u627f\u4e86\u8be5\u8fdb\u7a0b\u7684\u540d\u79f0\uff0c\u6210\u4e3a\u65b0\u7684\u7236\u8fdb\u7a0b\uff1b"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7531",(0,l.jsx)(r.strong,{children:"\u65b0\u7684\u7236\u8fdb\u7a0b"}),"\u5904\u7406",(0,l.jsx)(r.strong,{children:"\u540e\u9762\u751f\u6210\u7684\u5b50\u8fdb\u7a0b"}),"\u4fe1\u53f7\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u57fa\u4e8e\u4e0a\u9762\u51e0\u4e2a\u5173\u4e8e\u7236\u5b50\u8fdb\u7a0b\u7684\u95ee\u9898\uff0c\u5982\u4f55\u7406\u89e3\u5faa\u73af\u4f53\u5185\u7ee7\u7eed\u751f\u6210\u7684\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\uff1f\u8fd9\u91cc\u7684\u7236\u5b50\u8fdb\u7a0b\u5e94\u5f53\u662f\u5faa\u73af\u4f53",(0,l.jsx)(r.strong,{children:"\u4e4b\u524d\u751f\u6210\u7684\u5b50\u8fdb\u7a0b\u7684\u5206\u652f"}),"\u5427\uff1f\u6240\u4ee5\u7236\u8fdb\u7a0b\u6307\u7684\u662f\u524d\u9762\u7b2c\u4e00\u6b21\u751f\u6210\u7684\u5b50\u8fdb\u7a0b\u4e86\uff1f"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5faa\u73af\u4f53\u5185\u7684 ",(0,l.jsx)(r.code,{children:"fork()"})," \u8c03\u7528",(0,l.jsx)(r.strong,{children:"\u6bcf\u6b21\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u5b50\u8fdb\u7a0b"}),"\uff0c\u7236\u8fdb\u7a0b\u7b49\u5f85\u5b50\u8fdb\u7a0b\u7ed3\u675f\uff0c\u7136\u540e\u7ee7\u7eed\u4e0b\u4e00\u8f6e\u5faa\u73af\uff1b"]}),"\n",(0,l.jsx)(r.li,{children:"\u663e\u7136\uff0c\u6700\u521d\u751f\u6210\u7684\u5b50\u8fdb\u7a0b\u6210\u4e3a\u4e86\u65b0\u7684\u7236\u8fdb\u7a0b\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/05/30 17:08:10\uff0c2024/05/30 20:56:03 \u5206\u6790\u4ee3\u7801\uff0c\u7591\u95ee\u89e3\u7b54"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"56-\u8fdb\u7a0b\u7684\u5fc3\u8df3",children:"56 \u8fdb\u7a0b\u7684\u5fc3\u8df3"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u534f\u8c03\u5de5\u4f5c\uff1a\u8c03\u5ea6\u6a21\u5757\u3001\u8fdb\u7a0b\u5fc3\u8df3\u3001\u8fdb\u7a0b\u76d1\u63a7"}),"\n",(0,l.jsxs)(r.li,{children:["\u8fdb\u7a0b\u5fc3\u8df3\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5fc3\u8df3\u673a\u5236\u5f88\u91cd\u8981\uff0c\u7528\u4e8e\u68c0\u6d4b\u8fdb\u7a0b\u662f\u5426\u5b58\u6d3b\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u5171\u4eab\u5185\u5b58 --\x3e \u7ed3\u6784\u4f53\u6570\u7ec4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240531164139172",src:e(55443).A+"",width:"1103",height:"484"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5305\u542b\u5934\u6587\u4ef6"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9a\u4e49\u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\u7ed3\u6784\u4f53"}),"\n",(0,l.jsx)(r.li,{children:"\u58f0\u660e\u5171\u4eab\u5185\u5b58 id \u4e0e\u5730\u5740\u7a7a\u95f4"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"main"})," \u6dfb\u52a0\u4ee3\u7801\u6d41\u7a0b\uff0c\u51c6\u5907\u5b9e\u73b0\u5404\u529f\u80fd\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5904\u7406\u7a0b\u5e8f\u9000\u51fa\u4fe1\u53f7"}),"\n",(0,l.jsxs)(r.li,{children:["\u5171\u4eab\u5185\u5b58\uff1a\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u521b\u5efa --\x3e \u8fde\u63a5 --\x3e \u521d\u59cb\u5316\uff08\u4ee5\u6784\u9020\u51fd\u6570\u7684\u5f62\u5f0f\uff09 --\x3e"}),"\n",(0,l.jsx)(r.li,{children:"\u5185\u5b58\u6dfb\u52a0\uff08\u5bfb\u627e\u7a7a\u4f4d\u7f6e --\x3e \u4fdd\u5b58\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5faa\u73af\u4f53\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u66f4\u65b0\u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\uff08\u8bbe\u7f6e ",(0,l.jsx)(r.code,{children:"sleep()"})," \u53ca\u6dfb\u52a0\u5f53\u524d\u65f6\u95f4\uff09"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\u4fe1\u53f7\u5904\u7406\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"EXIT()"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5c06 ",(0,l.jsx)(r.code,{children:"int m_pos = -1;"})," \u7f6e\u4e3a\u5168\u5c40\u53d8\u91cf\uff1b"]}),"\n",(0,l.jsx)(r.li,{children:"\u5171\u4eab\u5185\u5b58\u6570\u636e\u5904\u7406\uff08\u5220\u9664\u5fc3\u8df3\u4fe1\u606f\u3001\u5171\u4eab\u5185\u5b58\u5206\u79bb\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u67e5\u8be2 ",(0,l.jsx)(r.code,{children:"ipcs -m"})," \u3001\u79fb\u9664 ",(0,l.jsx)(r.code,{children:"ipcrm -m pid"})]}),"\n",(0,l.jsx)(r.li,{children:"\u5171\u4eab\u5185\u5b58\u4f4d\u7f6e\u9009\u62e9\u3001\u5220\u9664\u7b49\u64cd\u4f5c\u8c03\u5f0f"}),"\n",(0,l.jsx)(r.li,{children:"\u5171\u4eab\u5185\u5b58\u4fe1\u606f\u6253\u5370\uff0c\u4fbf\u4e8e\u8c03\u8bd5\uff08\u8be5\u573a\u666f\u6bd4 gdb \u66f4\u4fbf\u6377\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5904\u7406\u5b58\u5728\u7684\u4e24\u4e2a\u95ee\u9898\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\uff081\uff09",(0,l.jsx)(r.code,{children:"EXIT"})," \u82e5\u7a0b\u5e8f\u6b63\u5e38\u9000\u51fa\uff0c\u5219\u6b63\u5e38\u5220\u9664\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u4fe1\u606f\uff1b\u82e5\u5f02\u5e38\u9000\u51fa\uff08kill -9 \u6216\u6bb5\u9519\u8bef\u7b49\uff09\uff0c\u5219\u5f53\u524d\u8fdb\u884c\u7684\u4fe1\u606f\u4f1a",(0,l.jsx)(r.strong,{children:"\u6b8b\u7559\u5728\u5171\u4eab\u5185\u5b58"}),"\u4e2d --\x3e \u65e7\u4f4d\u7f6e\u91cd\u7528"]}),"\n",(0,l.jsxs)(r.li,{children:["\uff082\uff09\u591a\u8fdb\u7a0b\u540c\u65f6\u64cd\u4f5c\u5171\u4eab\u5185\u5b58\uff0c\u5b58\u5728\u5b89\u5168\u95ee\u9898 --\x3e \u52a0\u9501\uff08\u4fe1\u53f7\u91cf\uff09 --\x3e \u5148\u660e\u786e\u4ee3\u7801\u4e2d\u5bf9\u5171\u4eab\u5185\u5b58\u7684\u64cd\u4f5c\u6709\u54ea\u4e9b\uff0c\u518d\u8003\u8651\u600e\u6837\u52a0\u9501\uff0c\u5171\u6709\u4e09\u79cd\u64cd\u4f5c\uff1a\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u5bfb\u627e\u4e00\u4e2a\u7a7a\u4f4d\u7f6e\uff0c\u628a\u5f53\u524d\u8fdb\u7a0b\u7684\u7ed3\u6784\u4f53\u5199\u5165\u5171\u4eab\u5185\u5b58 --\x3e \u4e24\u4e2a\u6b65\u9aa4\uff0c\u5982\u679c\u51fa\u73b0\u591a\u4e2a\u8fdb\u7a0b\u627e\u5230\u540c\u4e00\u4e2a\u7a7a\u4f4d\u7f6e\uff0c\u90a3\u4e48\u4f1a\u4ea7\u751f\u7ade\u6001\uff0c\u56e0\u6b64\u9700\u8981\u52a0\u9501"}),"\n",(0,l.jsx)(r.li,{children:"2\uff09\u66f4\u65b0\u81ea\u5df1\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u7ed3\u6784\u4f53\u5fc3\u8df3\u65f6\u95f4 --\x3e \u786e\u5b9a\u8fdb\u7a0b\u540e\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u53ea\u4f1a\u64cd\u4f5c\u81ea\u5df1\u7684\u7ed3\u6784\u4f53\uff0c\u56e0\u6b64\u4e0d\u5fc5\u52a0\u9501"}),"\n",(0,l.jsx)(r.li,{children:"3\uff09\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u5220\u9664\u81ea\u5df1 --\x3e \u540c\u7406\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u53ea\u4f1a\u64cd\u4f5c\u81ea\u5df1\u7684\u7ed3\u6784\u4f53\uff0c\u56e0\u6b64\u4e0d\u5fc5\u52a0\u9501"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u628a\u8fdb\u7a0b\u5fc3\u8df3",(0,l.jsx)(r.strong,{children:"\u5c01\u88c5\u6210\u901a\u7528\u7684\u7c7b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5148\u5b9e\u73b0\u529f\u80fd\uff0c\u518d\u7ec4\u88c5\u6210\u7c7b"}),"\n",(0,l.jsxs)(r.li,{children:["\u5177\u4f53\u5728 ",(0,l.jsx)(r.code,{children:"_public.cpp"}),"\uff0c\u505a\u4e86\u7b80\u5355\u4f18\u5316\u3001\u6784\u9020\u51fd\u6570\u3001\u6790\u6784\u51fd\u6570\u7b49\uff0c\u5e76\u4e14\u5f15\u5165\u4e86\u7c7b\u4f3c \u201c\u5355\u4f8b\u201d \u7684\u601d\u60f3\uff0c\u786e\u4fdd\u5fc3\u8df3\u7a0b\u5e8f\u53ea\u6709\u4e00\u4e2a"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u628a\u53c2\u6570\u5199\u6b7b\u7684\u610f\u4e49\u4e0e\u53ef\u884c\u6027\uff08\u5b8f\u5b9a\u4e49\u786c\u7f16\u7801\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "../../public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\u7684\u7ed3\u6784\u4f53\r\nstruct stprocinfo {\r\n    int    pid = 0;           // \u8fdb\u7a0bid\r\n    char   pname[51] = {0};   // \u8fdb\u7a0b\u540d\u79f0\uff0c\u53ef\u4e3a\u7a7a\r\n    int    timeout = 0;       // \u8d85\u65f6\u65f6\u95f4\uff0c\u79d2\r\n    time_t atime = 0;         // \u6700\u540e\u4e00\u6b21\u5fc3\u8df3\u65f6\u95f4\uff0c\u6574\u6570\u8868\u793a\r\n    stprocinfo() = default;   // \u542f\u7528\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff08\u6709\u81ea\u5b9a\u4e49\u6784\u9020\u51fd\u6570\uff0c\u5219\u7f16\u8bd1\u5668\u4e0d\u63d0\u4f9b\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff0c\u9700\u624b\u52a8\u542f\u7528\uff09\r\n    stprocinfo(const int in_pid, const string & in_pname, const int in_timeout, const time_t in_atime)\r\n                :pid(in_pid), timeout(in_timeout), atime(in_atime)\r\n    {\r\n        strncpy(pname, in_pname.c_str(), 50);\r\n    }  \r\n};\r\n\r\nint m_shmid = -1;            // \u5171\u4eab\u5185\u5b58\u7684id\r\nstprocinfo *m_shm = nullptr; // \u6307\u5411\u5171\u4eab\u5185\u5b58\u7684\u5730\u5740\u7a7a\u95f4\r\nint m_pos = -1;              // \u7528\u4e8e\u5b58\u653e\u5f53\u524d\u8fdb\u7a0b\u5728\u6570\u7ec4\u4e2d\u7684\u4e0b\u6807\r\n\r\nvoid EXIT(int sig);          // \u9000\u51fa\u4fe1\u53f7\u5904\u7406\u51fd\u6570\r\n\r\nint main() {\r\n   \r\n    // \u5904\u7406\u7a0b\u5e8f\u7684\u9000\u51fa\u4fe1\u53f7\r\n    signal(SIGINT, EXIT);\r\n    signal(SIGTERM, EXIT);\r\n\r\n    // \u521b\u5efa/\u83b7\u53d6\u5171\u4eab\u5185\u5b58\r\n    if ((m_shmid = shmget((key_t)0x5095, 1000 * sizeof(struct stprocinfo), 0666 | IPC_CREAT)) == -1) {\r\n        printf("\u521b\u5efa/\u83b7\u53d6\u5171\u4eab\u5185\u5b58 (%x) \u5931\u8d25\u3002\\n", 0x5095);\r\n        return -1;\r\n    }\r\n\r\n    // \u5c06\u5171\u4eab\u5185\u5b58\u8fde\u63a5\u5230\u5f53\u524d\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\r\n    m_shm = (struct stprocinfo*)shmat(m_shmid, 0, 0);\r\n\r\n    // \u628a\u5171\u4eab\u5185\u5b58\u4e2d\u5168\u90e8\u8fdb\u7a0b\u7684\u4fe1\u606f\u663e\u793a\u51fa\u6765\uff0c\u7528\u4e8e\u8c03\u8bd5\r\n    for (int i = 0; i < 1000; i++) {\r\n        if (m_shm[i].pid != 0) {\r\n            printf("i = %d, pid = %d, pname = %s, timeout = %d, atime = %ld\\n",\r\n            i, m_shm[i].pid, m_shm[i].pname, m_shm[i].timeout, m_shm[i].atime);\r\n        }\r\n    }\r\n\r\n    // \u628a\u5f53\u524d\u8fdb\u7a0b\u7684\u4fe1\u606f\u586b\u5145\u5230\u7ed3\u6784\u4f53\u4e2d\r\n    // stprocinfo procinfo;\r\n    // memset(&procinfo, 0, sizeof(struct stprocinfo));\r\n    // procinfo.pid = getpid();\r\n    // strncpy(procinfo.pname, "server1", 50);\r\n    // procinfo.timeout = 30;\r\n    // procinfo.atime = time(0);               // \u7528\u5f53\u524d\u65f6\u95f4\u586b\u5145\u6700\u540e\u4e00\u6b21\u5fc3\u8df3\u7684\u65f6\u95f4\r\n    stprocinfo procinfo(getpid(), "server1", 30, time(0));\r\n\r\n    csemp semlock; // \u7528\u4e8e\u7ed9\u5171\u4eab\u5185\u5b58\u52a0\u9501\u7684\u4fe1\u53f7\u91cf id\r\n\r\n    if (semlock.init(0x5095) == false) {\r\n        printf("\u521b\u5efa/\u83b7\u53d6\u4fe1\u53f7\u91cf (%d) \u5931\u8d25", 0x5095);\r\n        EXIT(-1);\r\n    }\r\n\r\n    semlock.wait(); // \u7ed9\u5171\u4eab\u5185\u5b58\u52a0\u9501\r\n\r\n    // \u8fdb\u7a0b id \u662f\u5faa\u73af\u4f7f\u7528\u7684\uff0c\u5982\u679c\u66fe\u7ecf\u6709\u4e00\u4e2a\u8fdb\u7a0b\u5f02\u5e38\u9000\u51fa\uff0c\u6ca1\u6709\u6e05\u7406\u81ea\u5df1\u7684\u5fc3\u8df3\u4fe1\u606f\uff0c\r\n    // \u5b83\u7684\u8fdb\u7a0b\u4fe1\u606f\u5c06\u6b8b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d\uff0c\u4e0d\u5de7\u7684\u662f\uff0c\u5982\u679c\u5f53\u524d\u8fdb\u7a0b\u91cd\u7528\u4e86\u5b83\u7684 id\uff0c\r\n    // \u6240\u4ee5\uff0c\u5982\u679c\u5171\u4eab\u5185\u5b58\u4e2d\u5df2\u5b58\u5728\u5f53\u524d\u8fdb\u7a0b\u7f16\u53f7\uff0c\u4e00\u5b9a\u662f\u5176\u4ed6\u8fdb\u7a0b\u6b8b\u7559\u7684\u4fe1\u606f\uff0c\u5f53\u524d\u8fdb\u7a0b\u5e94\u8be5\u91cd\u7528\u8fd9\u4e2a\u4f4d\u7f6e\r\n    for (int i = 0; i < 1000; i++) {\r\n        if (m_shm[i].pid == procinfo.pid) {\r\n            m_pos = i;\r\n            printf("\u627e\u5230\u65e7\u4f4d\u7f6e i = %d\\n", i);\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (m_pos == -1) {\r\n        // \u5171\u4eab\u5185\u5b58\u4e2d\u5bfb\u627e\u4e00\u4e2a\u7a7a\u7684\u4f4d\u7f6e\uff0c\u628a\u5f53\u524d\u4f4d\u7f6e\u7684\u7ed3\u6784\u4f53\u4fdd\u5b58\u5230\u5171\u4eab\u5185\u5b58\u4e2d\r\n        for (int i = 0; i < 1000; i++) {\r\n            if (m_shm[i].pid == 0) { // \u6570\u7ec4\u8868\u793a\u6cd5\uff0c\u6307\u9488\u8868\u793a\u6cd5 (m_shm + i)->pid == 0\r\n                m_pos = i;\r\n                printf("\u627e\u5230\u65b0\u4f4d\u7f6e i = %d\\n", i);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    // \u5982\u679c m_pos == -1\uff0c\u8868\u793a\u6ca1\u6709\u627e\u5230\u7a7a\u4f4d\u7f6e\uff0c\u8bf4\u660e\u5171\u4eab\u5185\u5b58\u7684\u7a7a\u95f4\u5df2\u7528\u5b8c\r\n    if (m_pos == -1) {\r\n        semlock.post(); // \u5171\u4eab\u5185\u5b58\u7528\u5b8c\uff0c\u89e3\u9501\r\n        printf("\u5171\u4eab\u5185\u5b58\u7a7a\u95f4\u5df2\u7528\u5b8c\u3002\\n");\r\n        EXIT(-1);\r\n    }\r\n\r\n    // \u628a\u5f53\u524d\u8fdb\u7a0b\u7684\u7ed3\u6784\u4f53\u4fdd\u5b58\u5230\u5171\u4eab\u5185\u5b58\u4e2d\r\n    // memcpy(m_shm + m_pos, &procinfo, sizeof(struct st_procinfo)); // \u6307\u9488\u8868\u793a\u6cd5\r\n    memcpy(&m_shm[m_pos], &procinfo, sizeof(struct st_procinfo)); // \u6570\u7ec4\u8868\u793a\u6cd5\r\n\r\n    semlock.post(); // \u627e\u5230\u4e86\u4f4d\u7f6e\uff0c\u89e3\u9501\r\n\r\n    while(1) {\r\n        printf("\u670d\u52a1\u7a0b\u5e8f\u8fd0\u884c\u4e2d...\\n");\r\n\r\n        // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\u4fe1\u606f\r\n        sleep(25); // \u4e0d\u53ef\u8d85\u8fc7\u8fdb\u7a0b\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\uff0c\u5426\u5219\u5fc3\u8df3\u4fe1\u606f\u65e0\u6548\r\n        m_shm[m_pos].atime = time(0);\r\n        sleep(25);\r\n        m_shm[m_pos].atime = time(0);\r\n    }\r\n\r\n    return 0;\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n    \r\n    printf("sig = %d\\n", sig);\r\n\r\n    // \u4ece\u5171\u4eab\u5185\u5b58\u4e2d\u5220\u9664\u5f53\u524d\u8fdb\u7a0b\u7684\u5fc3\u8df3\u4fe1\u606f\r\n    if (m_pos != -1) memset(m_shm + m_pos, 0, sizeof(struct stprocinfo));\r\n\r\n    // \u628a\u5171\u4eab\u5185\u5b58\u4ece\u5f53\u524d\u8fdb\u7a0b\u5206\u79bb\r\n    if (m_shm != 0) shmdt(m_shm);\r\n\r\n    exit(0);\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c / \u611f\u609f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u4ee5\u5148\u628a\u529f\u80fd\u5b9e\u73b0\uff0c\u540e\u9762\u518d\u95ee\u6709\u4ec0\u4e48\u7528\u3001\u4e3a\u4ec0\u4e48\u8fd9\u6837\u505a\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u4e00\u822c\u6765\u8bf4\uff0c\u670d\u52a1\u7a0b\u5e8f\u90fd\u9700\u8981\u5904\u7406\u9000\u51fa\u4fe1\u53f7\uff08\u7eb3\u5165\u4e00\u822c\u4ee3\u7801\u6d41\u7a0b\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u653e\u5728\u6b7b\u5faa\u73af\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u4e0d\u4f1a\u6267\u884c\uff0c\u56e0\u6b64\uff0c\u53ef\u4ee5\u901a\u8fc7\u5904\u7406\u9000\u51fa\u4fe1\u53f7\uff0c\u5c06\u9700\u8981\u6267\u884c\u7684\u4ee3\u7801\uff0c\u653e\u5230\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u5171\u4eab\u5185\u5b58\u7684\u4ee3\u7801\uff0c\u8bb0\u4e0d\u4f4f\u4e5f\u6ca1\u5173\u7cfb\uff0c\u9700\u8981\u7684\u65f6\u5019\u627e\u5230\u7b14\u8bb0\u6284\u56de\u6765\u5373\u53ef\uff0c\u91cd\u8981\u7684\u662f\u5bf9\u6982\u5ff5\u548c\u7528\u6cd5\u6709\u5370\u8c61\uff0c\u91cd\u65b0\u6284\u4ee3\u7801\u5c31\u5bb9\u6613\u5f88\u591a\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["C++ \u4e2d\uff0c\u7ed3\u6784\u4f53\u548c\u7c7b\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\uff0c\u5982\u679c\u60f3\u5f3a\u8c03\u7ed3\u6784\u4f53\u7684\u8bed\u4e49\uff0c\u53ef\u4ee5\u5199\u4e0a ",(0,l.jsx)(r.code,{children:"struct"})," \u5173\u952e\u5b57\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u8fdb\u7a0b\u540d + \u5176\u4ed6\u4e1c\u897f --\x3e \u53ef\u533a\u5206\u4e0d\u540c\u8fdb\u7a0b\u3002\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u540c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u80fd\u4ee5\u4e0d\u540c\u7684\u53c2\u6570\u8fd0\u884c\u591a\u4e2a\u526f\u672c\uff0c\u56e0\u6b64\u540c\u4e00\u8fdb\u7a0b\u7684\u4e0d\u540c\u540d\u79f0\u53ef\u7528\u4e8e\u533a\u5206\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u8fdb\u7a0b\u8d85\u65f6\u65f6\u95f4 --\x3e \u770b\u5177\u4f53\u4e1a\u52a1\u9700\u6c42"}),"\n",(0,l.jsx)(r.li,{children:"\u8ba1\u7b97\u673a\u4e2d\uff0c\u65f6\u95f4\u7528\u6574\u6570\u66f4\u65b9\u4fbf\uff0c\u9700\u8981\u65f6\u8f6c\u6362\u624d\u8003\u8651\u5b57\u7b26\u4e32\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u82e5\u81ea\u5b9a\u4e49\u4e86\u6784\u9020\u51fd\u6570\uff0c\u7f16\u8bd1\u5668\u5c06\u4e0d\u63d0\u4f9b\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff0c\u56e0\u6b64\u9700\u624b\u52a8\u542f\u7528\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u8865\u5145\u4e24\u79cd\u8868\u793a\u6cd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6307\u9488\u8868\u793a\u6cd5 ",(0,l.jsx)(r.code,{children:"(m_shm + ii)->pid == 0"})," \u3001",(0,l.jsx)(r.code,{children:"&m_shm[m_pos]"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6570\u7ec4\u8868\u793a\u6cd5 ",(0,l.jsx)(r.code,{children:"m_shm[ii].pid == 0"})," \u3001",(0,l.jsx)(r.code,{children:"m_shm + m_pos"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u9700\u8981\u505a\u5230\u770b\u5230\u67d0\u4e2a\u6982\u5ff5\uff0c\u5c31\u60f3\u5230\u5b83",(0,l.jsx)(r.strong,{children:"\u5bf9\u5e94\u7684\u7ed3\u6784\u3001\u5bf9\u5e94\u7684\u56fe\u50cf"}),"\u3002\u4f8b\u5982\u5171\u4eab\u5185\u5b58\uff0c\u5c31\u60f3\u5230\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u7ed3\u6784\u56fe\uff0c\u77e5\u9053\u54ea\u4e9b\u53d8\u91cf\u3001\u54ea\u4e9b\u64cd\u4f5c\u5360\u7528\u54ea\u90e8\u5206\u7684\u7a7a\u95f4\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5982\u679c\u8981\u628a",(0,l.jsx)(r.strong,{children:"\u4e00\u4e2a\u529f\u80fd\u5c01\u88c5\u6210\u7c7b"}),"\uff0c\u4e00\u822c\u4e0d\u4f1a\u4ece\u7c7b\u5f00\u59cb\u5199\u4ee3\u7801\uff0c\u800c\u662f\u5148\u628a\u5b83\u7684",(0,l.jsx)(r.strong,{children:"\u529f\u80fd\u5b9e\u73b0"}),"\uff0c\u7136\u540e\u624d",(0,l.jsx)(r.strong,{children:"\u7ec4\u88c5\u6210\u7c7b"}),"\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u8fd9\u4e00\u8282\u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\uff0c\u9700\u8981\u81ea\u5df1\u5199\u51fa\u6765\u3002\u5982\u679c\u4e0d\u7ec3\u3001\u5199\u4e0d\u51fa\u6765\uff0c\u540e\u9762\u4ee3\u7801\u66f4\u590d\u6742\u4e86\uff0c\u5c31\u53ef\u80fd\u8ddf\u4e0d\u4e0a\u8bfe\u7a0b\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4ec0\u4e48\u81ea\u5b9a\u4e49\u4e86\u6784\u9020\u51fd\u6570\uff0c\u8fd8\u8981\u542f\u7528\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff1f\u53d6\u51b3\u4e8e\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u662f\u5426\u6709\u989d\u5916\u7684\u5de5\u4f5c\uff1f\u5982\u679c\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u4e3a\u7a7a\uff0c\u5219\u65e0\u9700\u8c03\u7528\uff1f\u8fd8\u662f\u8bf4\uff0c\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u6709\u4ec0\u4e48\u7279\u6b8a\u7684\u5185\u7f6e\u5904\u7406\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u636e\u89c6\u9891\u89e3\u91ca\uff0c\u672c\u4ee3\u7801\u4e2d\uff0c\u82e5\u4e0d\u542f\u7528\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\uff0c\u5219\u4ee3\u7801 ",(0,l.jsx)(r.code,{children:"stprocinfo procinfo;"})," \u8bed\u53e5\u4f1a\u62a5\u9519\u3002\u4e3a\u4ec0\u4e48\u4f1a\u62a5\u9519\uff1f\u5f85\u4ed4\u7ec6\u5206\u6790\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5171\u4eab\u5185\u5b58\u7684\u5220\u9664\uff0c\u4ec5\u4ec5\u7528 ",(0,l.jsx)(r.code,{children:"memset()"})," \u7f6e\u4e3a 0 \u5c31\u884c\uff1f\u4e3a\u4ec0\u4e48\u4e0d\u662f\u6574\u5757\u5185\u5b58\u91ca\u653e\uff1f\u5f85\u56de\u987e\u5171\u4eab\u5185\u5b58\u7528\u6cd5\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.del,{children:"\u4e3a\u4f55\u7a0b\u5e8f\u80fd\u8bc6\u522b\u5df2\u7ecf\u6709\u6253\u5f00\u7684\u8fdb\u7a0b\uff0c\u4f46\u65e0\u6cd5 kill \u5462\uff1f\u96be\u9053\u56e0\u4e3a\u67e5\u5230\u7684\u662f\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u4e1c\u897f\uff1f"}),"\r\n* \u679c\u7136\uff0c\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"ipcrm -m pid"})," \u4e4b\u540e\uff0c\u5df2\u7ecf\u6253\u5f00\u7684\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u6210\u529f\u6e05\u7406\u4e86\u3002"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u4e0d\u8c03\u8bd5\u4e0d\u77e5\u9053\uff0c\u8fd9\u6837\u64cd\u4f5c\u4e4b\u540e\uff0c\u624d\u80fd\u66f4\u6e05\u6670\u5730\u7406\u89e3 \u201c\u5171\u4eab\u5185\u5b58\u201d \u7684\u884c\u4e3a\u548c\u4f5c\u7528\uff08\u771f\u5207\u7406\u89e3\u4e86\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u8fdb\u7a0b\u4e0e\u5728 shell \u80fd\u8bc6\u522b\u7684\u8fdb\u7a0b\u7684\u5dee\u522b\uff09\uff0c",(0,l.jsx)(r.strong,{children:"\u8fd9\u79cd\u8c03\u8bd5\u6536\u83b7\u5f88\u5927\uff0c\u5fc5\u987b\u91cd\u89c6\u90a3\u4e9b\u770b\u8d77\u6765\u4e0d\u8d77\u773c\u7684\u95ee\u9898"}),"\uff0c\u52a8\u624b\u5b9e\u8df5\u624d\u6709\u6536\u83b7\u3002"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"  * \u8fd9\u79cd\u95ee\u9898\u7684\u7814\u7a76\uff0c\u5c31\u50cf\u6478\u7740\u77f3\u5934\u8fc7\u6cb3\uff0c\u4f60\u4e0d\u77e5\u9053\u6cb3\u5e95\u6709\u4ec0\u4e48\u3001\u4e0d\u77e5\u9053\u7ed3\u6784\u600e\u4e48\u6837\uff0c\u53ea\u80fd\u78b0\u5230\u4e00\u4e2a\u832c\uff0c\u89e3\u51b3\u4e00\u4e2a\u832c\u3002\u5c31\u7b97\u7406\u8bba\u770b\u4e86\u767e\u904d\uff0c\u628a\u73b0\u8c61\u63cf\u8ff0\u5f97\u591a\u4e48\u771f\u5b9e\uff0c\u90fd\u4e0d\u5982\u4eb2\u8eab\u78b0\u5230\u4e00\u6b21\u6765\u5f97\u6df1\u523b\uff0c\u6240\u8c13\u767e\u95fb\u4e0d\u5982\u4e00\u89c1\u3002\u5373\u4fbf\u6587\u5b57\u4e0a\u5c06\u4e00\u4e2a\u6982\u5ff5\u7684\u5168\u90e8\u90fd\u5448\u73b0\u7ed9\u4f60\uff0c\u5f53\u4f60\u771f\u6b63\u9047\u5230\u5b83\u7684\u65f6\u5019\uff0c\u6216\u8bb8\u662f\u5343\u53d8\u4e07\u5316\u7684\u9762\u5b54\uff0c\u4f60\u5f88\u96be\u8ba4\u51fa\u662f\u5b83\uff0c\u5012\u4e0d\u5982\u6478\u7740\u77f3\u5934\uff0c\u8c03\u8bd5\u4ee3\u7801\uff0c\u4ece\u8c03\u8bd5\u8fc7\u7a0b\u7684\u79cd\u79cd\u8ff9\u8c61\uff0c\u5728\u8111\u6d77\u91cc\u6784\u5efa\u51fa\u5c5e\u4e8e\u5b83\u7684\u7acb\u4f53\u5f62\u8c61\uff0c\u4e8e\u662f\uff0c\u4f60\u5c31\u77e5\u9053\u4e86\u5171\u4eab\u5185\u5b58\u7684\u4e00\u4e9b\u884c\u4e3a\u662f\u600e\u6837\u7684\uff0c\u4e8e\u662f\u60f3\u8d77\u4e86\u4ee5\u524d\u770b\u8fc7\u7684\u6587\u5b57\u63cf\u8ff0\uff0c\u4e8e\u662f\uff0c\u4e0e\u8fd9\u4e2a\u6280\u672f\u70b9\u5b8c\u6210\u4e86\u4e00\u6b21\u66f4\u6df1\u5165\u7684\u9082\u9005\u3002\u5b9e\u8df5\u679c\u7136\u51fa\u771f\u77e5\u3002\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u53e6\u5916\uff0c\u7531\u4e8e\u7a0b\u5e8f\u7684\u95ee\u9898\uff0c\u8fdb\u7a0b\u5f02\u5e38\u9000\u51fa\u4f1a",(0,l.jsx)(r.strong,{children:"\u6b8b\u7559"}),"\u5728\u5171\u4eab\u5185\u5b58\u4e2d\uff0c\u4e8e\u662f\u4ea7\u751f\u4e86\u8fd9\u4e2a\u73b0\u8c61\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{src:e(51585).A+"",width:"539",height:"208"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5982\u679c\u8fdb\u7a0b\u5728\u5171\u4eab\u5185\u5b58\u4e2d\uff0c\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"ps"})," \u5c31\u4e0d\u80fd\u627e\u5230\u5b83\u4eec\u5417\uff1f\u4e3a\u4ec0\u4e48\u6ca1\u6709\u663e\u793a\u76f8\u5e94\u7684\u8fdb\u7a0b id\uff1f\u662f\u56e0\u4e3a\u5b83\u4eec\u6240\u7ba1\u8f96\u7684\u5185\u5b58\u7a7a\u95f4\u4e0d\u540c\uff1f"]}),"\n",(0,l.jsx)(r.li,{children:"\u5c06\u529f\u80fd\u5c01\u88c5\u5230\u7c7b\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5982\u4f55\u786e\u4fdd\u6709\u591a\u4e2a\u7a0b\u5e8f\u4ea7\u751f\u7684\uff1f\u6211\u7684\u610f\u601d\u662f\uff0c\u4e00\u4e2a\u901a\u7528\u7c7b\u6587\u4ef6\u91cc\u9762\u6709\u82e5\u5e72\u4e2a\u7c7b\uff0c\u8fd9\u4e9b\u7c7b\u662f\u600e\u6837\u72ec\u7acb\u4e8e\u5b83\u6240\u5728\u7684\u8fdb\u7a0b\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u7684\uff1f\u56e0\u4e3a\u662f\u72ec\u7acb\u5b9e\u73b0\u7684\uff0c\u5c01\u88c5\u7684\u65f6\u5019\u653e\u5728\u4e00\u8d77\uff0c\u5c31\u4ea7\u751f\u4e86\u8fd9\u4e2a\u7591\u95ee\u3002\u5c31\u597d\u50cf\u539f\u672c\u81ea\u5df1\u6709\u4e00\u4e2a\u86cb\u7cd5\uff0c\u73b0\u5728\u9001\u5230\u86cb\u7cd5\u5382\u4e86\uff0c\u5728\u9700\u8981\u7684\u65f6\u5019\uff0c\u600e\u4e48\u628a\u81ea\u5df1\u90a3\u4e2a\u86cb\u7cd5\u62ff\u5230\u624b\uff0c\u786e\u4fdd\u8fd9\u4e2a\u86cb\u7cd5\u8fd8\u662f\u8ddf\u539f\u6765\u7684\u4e00\u6837\uff1f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsxs)(r.del,{children:[(0,l.jsx)(r.code,{children:' printf("\u670d\u52a1\u7a0b\u5e8f\u8fd0\u884c\u4e2d...\\n");'})," \u9057\u6f0f\u4e86\u4e00\u4e2a ",(0,l.jsx)(r.code,{children:"\\n"}),"\uff0c\u5c31\u4e0d\u8f93\u51fa\u4e86\uff0c\u4e3a\u4ec0\u4e48\uff1f"]})}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u5728\u6253\u5370\u5171\u4eab\u5185\u5b58\u7684\u8fdb\u7a0b\u4fe1\u606f\u65f6\uff0c\u6ca1\u6709\u663e\u793a\u5185\u5bb9\u3002\u800c\u5982\u679c ",(0,l.jsx)(r.code,{children:"pid == 0"}),"\uff0c\u5219\u6709\u5185\u5bb9\u3002\u4f1a\u4e0d\u4f1a\u662f\u5171\u4eab\u5185\u5b58\u7684\u95ee\u9898\uff1f"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6d4b\u8bd5\u4e86\u6559\u7a0b\u4ee3\u7801\uff0c\u6709\u540c\u6837\u7684\u95ee\u9898\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u89c6\u9891\u8c03\u8bd5\u4e2d\uff0c",(0,l.jsx)(r.code,{children:"i"})," \u6709 0 \u5230 2 \u4e09\u4e2a\uff0c\u4f1a\u4e0d\u4f1a\u662f\u6253\u5f00\u7684\u8fdb\u7a0b\u6570\u91cf\uff1f"]}),"\n",(0,l.jsx)(r.li,{children:"\u679c\u7136\uff0c\u9700\u8981\u5148\u591a\u5f00\u51e0\u4e2a\u8fdb\u7a0b\uff0c\u624d\u80fd\u5b9e\u73b0\u76f8\u540c\u6548\u679c\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240531221607105",src:e(49403).A+"",width:"614",height:"128"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"time_t"})," \u7c7b\u578b\u7684 ",(0,l.jsx)(r.code,{children:"atime"})," \u53d8\u91cf\uff0c\u8bfe\u7a0b ",(0,l.jsx)(r.code,{children:"printf"})," \u4e3a ",(0,l.jsx)(r.code,{children:"%d"})," \u7c7b\u578b\uff0c\u800c\u5b9e\u9645\u7f16\u8bd1\u9700\u8981 ",(0,l.jsx)(r.code,{children:"%ld"})," \u7c7b\u578b\uff0c\u65b9\u80fd\u901a\u8fc7\u7f16\u8bd1\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/05/31 22:38:59 \u8be6\u7ec6 debug\uff0c\u7406\u89e3\u5171\u4eab\u5185\u5b58\u7684\u884c\u4e3a"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/05/31 23:43:23 \u6a21\u4eff + \u7b14\u8bb0\uff0c\u672a\u72ec\u7acb\u5b9e\u73b0\u4ee3\u7801"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"57-\u5b88\u62a4\u6a21\u5757",children:"57 \u5b88\u62a4\u6a21\u5757"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4f5c\u7528\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u68c0\u67e5\u8fdb\u7a0b\u5fc3\u8df3\uff0c\u8d85\u65f6\u7ec8\u6b62\uff1b\u5176\u540e\u7531\u8c03\u5ea6\u6a21\u5757\u91cd\u542f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u8bbe\u8ba1\u4e3a\u901a\u7528\u6a21\u5757 ",(0,l.jsx)(r.code,{children:"checkproc.cpp"})]}),"\n",(0,l.jsx)(r.li,{children:"\u6dfb\u52a0\u5e2e\u52a9\u4fe1\u606f"}),"\n",(0,l.jsxs)(r.li,{children:["\u5217\u51fa\u7a0b\u5e8f\u6d41\u7a0b\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6"}),"\n",(0,l.jsx)(r.li,{children:"\u5904\u7406\u5171\u4eab\u5185\u5b58\u903b\u8f91\uff08\u521b\u5efa/\u83b7\u53d6\u3001\u8fde\u63a5\u3001\u5206\u79bb\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u904d\u5386\u5171\u4eab\u5185\u5b58\u8bb0\u5f55"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["1\uff09\u6dfb\u52a0 ",(0,l.jsx)(r.code,{children:"demo02.cpp"})," \u6d4b\u8bd5\u6a21\u5757\uff08\u6ce8\u610f\u5168\u5c40\u5bf9\u8c61\uff09\uff0c\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\uff081\u7a97\u53e3\uff09",(0,l.jsx)(r.code,{children:"checkproc"})," ",(0,l.jsx)(r.strong,{children:"\u624b\u52a8\u542f\u52a8"}),"\u8c03\u5ea6\u7a0b\u5e8f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"../../tools/bin/checkproc ../../tmp/log/checkproc.log"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\uff083-5\u7a97\u53e3\uff09\u8fd0\u884c 3 \u4e2a ",(0,l.jsx)(r.code,{children:"demo02"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u67e5\u9605\u65e5\u5fd7 ",(0,l.jsx)(r.code,{children:"cat ../tmp/log/checkproc.log"})]}),"\n",(0,l.jsx)(r.li,{children:"\u7ec8\u6b62\u7a97\u53e33\uff0c\u518d\u6b21\u8fd0\u884c\u5b88\u62a4\u7a0b\u5e8f\uff0c\u67e5\u9605\u65e5\u5fd7 --\x3e \u5269\u4f59\u4e24\u4e2a demo02"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ee7\u7eed\u5b8c\u6210\u5fc3\u8df3\u68c0\u6d4b\u903b\u8f91\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4 --\x3e \u5224\u65ad\u662f\u5426\u8d85\u65f6 --\x3e \u8d85\u65f6\u7ec8\u6b62\u4fe1\u53f7"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["2\uff09\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u52a0\u5165\u8d85\u65f6\u53c2\u6570 --\x3e \uff08",(0,l.jsx)(r.strong,{children:"\u6301\u7eed"}),"\u6216\u7b49\u5f85\uff09\u6267\u884c\u5b88\u62a4\u7a0b\u5e8f --\x3e \u5224\u65ad\u8d85\u65f6 --\x3e \u6267\u884c\u6e05\u7406"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u6761\u4ef6\uff08\u82e5\u8fdb\u7a0b\u5df2\u4e0d\u5b58\u5728\uff0c\u9700\u5904\u7406\u5171\u4eab\u5185\u5b58\u4e2d\u6b8b\u7559\u7684\u5fc3\u8df3\u4fe1\u606f\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"kill"})," \u53d1\u9001\u4fe1\u53f7 ",(0,l.jsx)(r.code,{children:"0"}),"\uff0c\u6355\u83b7\u8fd4\u56de\u4fe1\u53f7\uff08\u7528\u53d8\u91cf\u63a5\u6536\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u82e5\u4e3a -1\uff0c\u5219\u8bf4\u660e\u8fdb\u7a0b\u4e0d\u5b58\u5728"}),"\n",(0,l.jsx)(r.li,{children:"\u5220\u9664\u8be5\u8fdb\u7a0b\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u5fc3\u8df3\u8bb0\u5f55"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["3\uff09\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\uff083-5\u7a97\u53e3\uff09\u4e24\u4e2a\u8d85\u65f6\uff0c\u4e00\u4e2a\u4e0d\u8d85\u65f6"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"kill -9"})," \u5176\u4e2d\u4e00\u4e2a\u8d85\u65f6\u4efb\u52a1\uff0c\u4f7f\u5f97\u8fdb\u7a0b\u6b8b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d"]}),"\n",(0,l.jsx)(r.li,{children:"\u6267\u884c\u5b88\u62a4\u7a0b\u5e8f --\x3e \u6267\u884c\u6e05\u7406\uff08\u6e05\u7406\u8d85\u65f6\u8fdb\u7a0b\u3001\u6e05\u7406\u6b8b\u7559\u8fdb\u7a0b\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u67e5\u9605\u65e5\u5fd7 --\x3e \u67e5\u9605\u8fdb\u7a0b --\x3e \u5df2\u5168\u90e8\u56de\u6536"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ee7\u7eed\u4f18\u5316\u5b88\u62a4\u7a0b\u5e8f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u82e5\u5df2\u8d85\u65f6\u7684\u8fdb\u7a0b\uff0c\u65e0\u6cd5\u54cd\u5e94\u4fe1\u53f715\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f"}),"\n",(0,l.jsx)(r.li,{children:"\u9700\u8981\u5148\u53d1\u9001\u4fe1\u53f715\uff0c\u82e5\u65e0\u6cd5\u7ec8\u6b62\u8be5\u8fdb\u7a0b\uff0c\u5219\u5e94\u5f53\u53d1\u9001\u4fe1\u53f79\uff0c\u5f3a\u5236\u7ec8\u6b62"}),"\n",(0,l.jsx)(r.li,{children:"\u518d\u53d1\u9001\u4fe1\u53f715\u540e\uff0c\u52a0\u5165\u52a8\u6001\u65f6\u957f\uff0c\u5224\u65ad\u8fdb\u7a0b\u662f\u5426\u9000\u51fa\uff08\u4e0a\u9650 + \u7d2f\u8ba1\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u73b0\u5f3a\u5236\u7ec8\u6b62\u903b\u8f91"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["4\uff09\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\uff083-5\u7a97\u53e3\uff09\u4e24\u4e2a\u8d85\u65f6\uff0c\u4e00\u4e2a\u4e0d\u8d85\u65f6"}),"\n",(0,l.jsx)(r.li,{children:"\u6267\u884c\u5b88\u62a4\u7a0b\u5e8f --\x3e \u5b88\u62a4\u7a0b\u5e8f\u88ab\u7ec8\u6b62"}),"\n",(0,l.jsx)(r.li,{children:"\u67e5\u770b\u8fdb\u7a0b --\x3e \u4ecd\u6709\u4e24\u4e2a\uff08\u4e00\u4e2a\u88ab\u6e05\u7406\uff0c\u4e00\u4e2a\u672a\u88ab\u6e05\u7406\uff0c\u81ea\u5df1\u4e5f\u88ab\u6e05\u7406\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\uff08\u5b88\u62a4\u8fdb\u7a0b\u6e05\u7406\u81ea\u5df1\uff09\u539f\u56e0\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"kill"})," \u4e2d\u7684\u8fdb\u7a0b\u7f16\u53f7\uff0c\u5728\u6267\u884c\u4e2d\u53d8\u6210\u4e860\uff0c\u6700\u7ec8\u6267\u884c\u4e86 ",(0,l.jsx)(r.code,{children:"kill(0, 9);"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5904\u7406\u81ea\u6e05\u7406\u95ee\u9898\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f7f\u7528\u4e34\u65f6\u53d8\u91cf\u5907\u4efd\u7ed3\u6784\u4f53\uff08\u4e0d\u76f4\u63a5\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u7684\u503c\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539 demo02 \u4e3a\u4ec5\u80fd\u88ab\u4fe1\u53f79\u6740\u6b7b"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u6700\u7ec8\u4f18\u5316\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b88\u62a4\u7a0b\u5e8f\u5ffd\u7565\u5168\u90e8\u4fe1\u53f7\u4e0eI/O"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-makefile",children:"# \u5f00\u53d1\u6846\u67b6\u5934\u6587\u4ef6\u8def\u5f84\r\nPUBINCL = -I../../public\r\n\r\n# \u5f00\u53d1\u6846\u67b6 cpp \u6587\u4ef6\u540d\uff0c\u76f4\u63a5\u548c\u7a0b\u5e8f\u7684\u6e90\u4ee3\u7801\u4e00\u8d77\u7f16\u8bd1\uff0c\u6ca1\u6709\u91c7\u7528\u94fe\u63a5\u5e93\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8c03\u8bd5\r\nPUBCPP = ../../public/_public.cpp\r\n\r\n# \u7f16\u8bd1\u9009\u9879\r\nCFLAGS = -g\r\n# CFLAGS = -O2\r\n\r\nall: procctl checkproc\r\n\r\nprocctl:procctl.cpp\r\n\t\tg++ -g -o procctl procctl.cpp\r\n\t\tcp -f procctl ../bin/.\r\n\r\ncheckproc: checkproc.cpp\r\n\t\tg++ $(CFLAGS) -o checkproc checkproc.cpp $(PUBINCL) $(PUBCPP)\r\n\t\tcp -f checkproc ../bin/.\r\n\r\nclean:\r\n\t\trm -rf procctl checkproc\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// checkproc.cpp\r\n// \u5b88\u62a4\u7a0b\u5e8f\uff1a\u68c0\u67e5\u5171\u4eab\u5185\u5b58\u4e2d\u8fdb\u7a0b\u7684\u5fc3\u8df3\uff0c\u5982\u679c\u8d85\u65f6\uff0c\u5219\u7ec8\u6b62\u8fdb\u7a0b\r\n#include "../../public/_public.h"\r\nusing namespace idc;\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    // \u7a0b\u5e8f\u7684\u5e2e\u52a9\u3002\r\n    if (argc != 2) {\r\n        printf("\\n");\r\n        printf("Using:./checkproc logfilename\\n");\r\n\r\n        printf("Example:../../tools/bin/procctl 10 ../../tools/bin/checkproc ../../tmp/log/checkproc.log\\n\\n");\r\n\r\n        printf("\u672c\u7a0b\u5e8f\u7528\u4e8e\u68c0\u67e5\u540e\u53f0\u670d\u52a1\u7a0b\u5e8f\u662f\u5426\u8d85\u65f6\uff0c\u5982\u679c\u5df2\u8d85\u65f6\uff0c\u5c31\u7ec8\u6b62\u5b83\u3002\\n");\r\n        printf("\u6ce8\u610f\uff1a\\n");\r\n        printf("  1\uff09\u672c\u7a0b\u5e8f\u7531procctl\u542f\u52a8\uff0c\u8fd0\u884c\u5468\u671f\u5efa\u8bae\u4e3a10\u79d2\u3002\\n");\r\n        printf("  2\uff09\u4e3a\u4e86\u907f\u514d\u88ab\u666e\u901a\u7528\u6237\u8bef\u6740\uff0c\u672c\u7a0b\u5e8f\u5e94\u8be5\u7528root\u7528\u6237\u542f\u52a8\u3002\\n");\r\n        printf("  3\uff09\u5982\u679c\u8981\u505c\u6b62\u672c\u7a0b\u5e8f\uff0c\u53ea\u80fd\u7528killall -9 \u7ec8\u6b62\u3002\\n\\n\\n");\r\n\r\n        return 0;\r\n    }\r\n\r\n    // \u5ffd\u7565\u5168\u90e8\u4fe1\u53f7\u548cI/O\uff0c\u4e0d\u5904\u7406\u7a0b\u5e8f\u7684\u9000\u51fa\u4fe1\u53f7\r\n    closeioandsignal(true);\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    clogfile logfile;\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("logfile.open(%s) failed.\\n", argv[1]);\r\n        return -1;\r\n    }\r\n\r\n    // \u521b\u5efa/\u83b7\u53d6\u5171\u4eab\u5185\u5b58\uff0c\u952e\u503c\u4e3a SHMKEYP\uff0c\u5927\u5c0f\u4e3a MAXNUMP \u4e2a st_procinfo \u7ed3\u6784\u4f53\u7684\u5927\u5c0f\r\n    int shmid = 0;\r\n    if ((shmid = shmget((key_t)SHMKEYP, MAXNUMP*sizeof(struct st_procinfo), 0666|IPC_CREAT)) == -1) {\r\n        logfile.write("\u521b\u5efa/\u83b7\u53d6\u5171\u4eab\u5185\u5b58 (%x) \u5931\u8d25\u3002\\n", SHMKEYP);\r\n        return false;\r\n    }\r\n\r\n    // \u5c06\u5171\u4eab\u5185\u5b58\u8fde\u63a5\u5230\u5f53\u524d\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\r\n    struct st_procinfo *shm = (struct st_procinfo *)shmat(shmid, 0, 0);\r\n\r\n    // \u904d\u5386\u5171\u4eab\u5185\u5b58\u4e2d\u5168\u90e8\u7684\u8bb0\u5f55\uff0c\u5982\u679c\u8fdb\u7a0b\u5df2\u8d85\u65f6\uff0c\u7ec8\u6b62\u5b83\r\n    for (int i = 0; i < MAXNUMP; i++) {\r\n\r\n        // \u5982\u679c\u8bb0\u5f55\u7684 pid == 0\uff0c\u8868\u793a\u7a7a\u8bb0\u5f55\uff0ccontinue\r\n        if (shm[i].pid == 0) continue;\r\n\r\n        // \u5982\u679c\u8bb0\u5f55\u7684 pid \uff01= 0\uff0c\u8868\u793a\u662f\u670d\u52a1\u7a0b\u5e8f\u7684\u5fc3\u8df3\u8bb0\u5f55\r\n\r\n        // \u663e\u793a\u8fdb\u7a0b\u4fe1\u606f\uff0c\u7a0b\u5e8f\u7a33\u5b9a\u8fd0\u884c\u540e\uff0c\u4ee5\u4e0b\u4e24\u884c\u4ee3\u7801\u53ef\u6ce8\u91ca\r\n        // logfile.write("i = %d, pid = %d, pname = %s, timeout = %d, atime = %ld\\n",\\\r\n        //                i, shm[i].pid, shm[i].pname, shm[i].timeout, shm[i].atime);\r\n        \r\n        // \u5982\u679c\u8fdb\u7a0b\u5df2\u7ecf\u4e0d\u5b58\u5728\uff0c\u5171\u4eab\u5185\u5b58\u4e2d\u662f\u6b8b\u7559\u7684\u5fc3\u8df3\u4fe1\u606f\r\n        // \u5411\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f70\uff0c\u5224\u65ad\u5b83\u662f\u5426\u8fd8\u5b58\u5728\uff0c\u82e5\u4e0d\u5b58\u5728\uff0c\u4ece\u5171\u4eab\u5185\u5b58\u4e2d\u5220\u9664\u8be5\u8bb0\u5f55\r\n        int iret = kill(shm[i].pid, 0);\r\n        if (iret == -1) {\r\n            logfile.write("\u8fdb\u7a0b pid = %d (%s) \u5df2\u7ecf\u4e0d\u5b58\u5728\u3002\\n", shm[i].pid, shm[i].pname);\r\n            memset(&shm[i], 0, sizeof(struct st_procinfo)); // \u4ece\u5171\u4eab\u5185\u5b58\u4e2d\u5220\u9664\u8be5\u8bb0\u5f55\r\n            continue;\r\n        }\r\n\r\n        // \u5224\u65ad\u8fdb\u7a0b\u7684\u5fc3\u8df3\u662f\u5426\u8d85\u65f6\uff0c\u5982\u679c\u8d85\u65f6\uff0c\u5219\u7ec8\u6b62\u5b83\r\n        time_t now = time(0); // \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\r\n\r\n        // \u5982\u679c\u8fdb\u7a0b\u672a\u8d85\u65f6\r\n        if (now - shm[i].atime < shm[i].timeout) continue;\r\n\r\n        // \u4e00\u5b9a\u8981\u628a\u8fdb\u7a0b\u7684\u7ed3\u6784\u4f53\u5907\u4efd\uff0c\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u503c\r\n        struct st_procinfo tmp = shm[i];\r\n        if (tmp.pid == 0) continue;\r\n\r\n        // \u5982\u679c\u8fdb\u7a0b\u5df2\u8d85\u65f6\r\n        logfile.write("\u8fdb\u7a0b pid = %d (%s) \u5df2\u7ecf\u8d85\u65f6\u3002\\n", tmp.pid, tmp.pname);\r\n\r\n        // \u53d1\u9001\u4fe1\u53f7 15\uff0c\u5c1d\u8bd5\u6b63\u5e38\u7ec8\u6b62\u5df2\u8d85\u65f6\u7684\u8fdb\u7a0b\r\n        kill(tmp.pid, 15);\r\n\r\n        // \u6bcf\u96941\u79d2\u5224\u65ad\u4e00\u6b21\u8fdb\u7a0b\u662f\u5426\u5b58\u5728\uff0c\u7d2f\u8ba15\u79d2\uff0c\u4e00\u822c5\u79d2\u8db3\u591f\u8ba9\u8fdb\u7a0b\u9000\u51fa\uff08\u82e5\u7acb\u5373\u6267\u884c\uff0c\u5219\u592a\u5fc3\u6025\uff1b\u82e5\u7b49\u592a\u4e45\uff0c\u65f6\u95f4\u53c8\u6d6a\u8d39\uff1b\u4e8e\u662f\u7ed9\u4e00\u4e2a\u4e0a\u9650\uff0c\u518d\u52a8\u6001\u5730\u5224\u65ad\uff09\r\n        for (int j = 0; j< 5; j++) {\r\n            sleep(1);\r\n            iret = kill(tmp.pid, 0); // \u5411\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f70\uff0c\u5224\u65ad\u5b83\u662f\u5426\u5b58\u5728\r\n            if (iret == -1) break;      // \u8fdb\u7a0b\u5df2\u9000\u51fa\r\n        }\r\n\r\n        if (iret == -1) {\r\n           logfile.write("\u8fdb\u7a0b pid = %d (%s) \u5df2\u7ecf\u6b63\u5e38\u7ec8\u6b62\u3002\\n", tmp.pid, tmp.pname);\r\n        } else {\r\n            // \u82e5\u8fdb\u7a0b\u4ecd\u5b58\u5728\uff0c\u5219\u53d1\u9001\u4fe1\u53f79\uff0c\u5f3a\u5236\u7ec8\u6b62\u5b83\r\n            kill(tmp.pid, 9);\r\n            logfile.write("\u8fdb\u7a0b pid = %d (%s) \u5df2\u7ecf\u5f3a\u5236\u7ec8\u6b62\u3002\\n", tmp.pid, tmp.pname);\r\n\r\n            // \u4ece\u5171\u4eab\u5185\u5b58\u5220\u9664\u5df2\u8d85\u65f6\u7684\u5fc3\u8df3\u8bb0\u5f55\r\n            memset(shm + i, 0, sizeof(struct st_procinfo));\r\n        }\r\n    }\r\n\r\n    // \u628a\u5171\u4eab\u5185\u5b58\u4ece\u5f53\u524d\u8fdb\u7a0b\u4e2d\u5206\u79bb\r\n    shmdt(shm);\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// demo02.cpp\r\n#include "../../public/_public.h"\r\nusing namespace idc;\r\n\r\ncpactive pactive;       // \u8fdb\u7a0b\u5fc3\u8df3\uff0c\u7528\u5168\u5c40\u5bf9\u8c61\uff08\u4fdd\u8bc1\u6790\u6784\u51fd\u6570\u4f1a\u88ab\u8c03\u7528\uff09\r\n\r\nvoid EXIT(int sig) {    // \u7a0b\u5e8f\u9000\u51fa\u548c\u4fe1\u53f72/15\u7684\u5904\u7406\u51fd\u6570\r\n    \r\n    printf("sig = %d\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    // \u5904\u7406\u7a0b\u5e8f\u7684\u9000\u51fa\u4fe1\u53f7\r\n    // signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n    closeioandsignal(true);\r\n\r\n    pactive.addpinfo(atoi(argv[1]), "demo02"); // \u628a\u5f53\u524d\u8fdb\u7a0b\u7684\u4fe1\u606f\u52a0\u5165\u5171\u4eab\u5185\u5b58\u8fdb\u7a0b\u7ec4\u4e2d\r\n\r\n    while (1) {\r\n        sleep(atoi(argv[2]));\r\n        pactive.uptatime(); // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\r\n    }\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09demo02\u6a21\u5757\u8c03\u8bd5"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240601235450472",src:e(54991).A+"",width:"1525",height:"654"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u8fdb\u7a0b\u6b63\u5e38\u9000\u51fa\uff08\u7ec8\u6b62\u4e86\u4e00\u4e2a\u8fdb\u7a0b\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240601235616489",src:e(5201).A+"",width:"795",height:"652"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"2\uff09\u8fdb\u7a0b\u672a\u8d85\u65f6 VS \u8fdb\u7a0b\u8d85\u65f6"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240602003500010",src:e(76669).A+"",width:"1147",height:"652"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"3\uff09\u5904\u7406\u5171\u4eab\u5185\u5b58\u6b8b\u7559\u4fe1\u606f"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240602033301941",src:e(45214).A+"",width:"1219",height:"659"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"4\uff09\u5b88\u62a4\u8fdb\u7a0b\u4ec5\u5b8c\u6210\u90e8\u5206\u4efb\u52a1\u540e\u88ab\u6e05\u7406"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240602040014676",src:e(7530).A+"",width:"1460",height:"658"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b88\u62a4\u8fdb\u7a0b\u6b63\u786e\u5904\u7406\uff08demo02 \u672a\u5ffd\u7565\u4fe1\u53f715\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240602041330863",src:e(32556).A+"",width:"1489",height:"659"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b88\u62a4\u8fdb\u7a0b\u6b63\u786e\u5904\u7406\uff08demo02 \u5ffd\u7565\u4fe1\u53f715\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240602041641378",src:e(14668).A+"",width:"1520",height:"666"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48\u4e0d\u91c7\u7528\u94fe\u63a5\u5e93\uff0c\u53ef\u4ee5\u65b9\u4fbf\u8c03\u8bd5\uff1f"}),"\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48\u611f\u89c9\u53ea\u662f\u7528\u4e00\u4e2a\u53d8\u91cf\u5b58\u50a8\u4e86\u4e4b\u524d\u7684\u8def\u5f84\u548c\u6587\u4ef6\u540d\uff1f\u8fd9\u5c31\u4e0d\u662f\u91c7\u7528\u94fe\u63a5\u5e93\uff1f\u611f\u89c9\u8bed\u53e5\u90fd\u662f\u4e00\u6837\u7684\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u5982\u4f55\u7406\u89e3 ",(0,l.jsx)(r.code,{children:"main"})," \u7684\u53c2\u6570 ",(0,l.jsx)(r.code,{children:"char *argv[]"})," \uff1f"]}),"\n",(0,l.jsxs)(r.li,{children:["\u56de\u987e ",(0,l.jsx)(r.code,{children:"kill()"})," \u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u672c\u4f8b\u4f7f\u7528\u8be5\u51fd\u6570\uff0c\u53d1\u9001\u4fe1\u53f70\uff0c\u4ee5\u622a\u83b7\u8fd4\u56de\u503c\uff0c\u8fdb\u800c\u5224\u65ad\u4e0e\u5904\u7406\u7279\u5b9a\u7684\u903b\u8f91\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4ec0\u4e48\u7528\u4e34\u65f6\u5907\u4efd\u7684\u7ed3\u6784\u4f53\uff0c\u64cd\u4f5c\u5e76\u6e05\u7406\u5df2\u7ec8\u6b62\u8fdb\u7a0b\u540e\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5b88\u62a4\u8fdb\u7a0b\uff1f\u662f\u5426\u8fd8\u6709 ",(0,l.jsx)(r.code,{children:"kill 0"})," \u7684\u903b\u8f91\uff1f"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5e94\u5f53\u8981\u6709\u4e00\u4e2a\u9488\u5bf9\u5f00\u53d1\u6846\u67b6\u6a21\u5757\u7684\u5730\u56fe\uff0c\u5728\u9700\u8981\u76f8\u5e94\u529f\u80fd\u7684\u65f6\u5019\uff0c\u627e\u627e\u662f\u5426\u6709\u5bf9\u5e94\u7684\u6a21\u5757\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u82e5 ",(0,l.jsx)(r.code,{children:"pactive"})," \u5b9a\u4e49\u4e3a ",(0,l.jsx)(r.code,{children:"main"})," \u7684\u5c40\u90e8\u5bf9\u8c61\uff0c\u5219\u8c03\u7528 ",(0,l.jsx)(r.code,{children:"exit"})," \u65f6\uff0c\u4e0d\u4f1a\u8c03\u7528\u5176\u6790\u6784\u51fd\u6570\uff0c\u56e0\u6b64\u4e3a\u4e86\u80fd\u591f\u6b63\u786e\u91ca\u653e\u8d44\u6e90\uff0c\u9700\u8981\u5c06\u5176\u5b9a\u4e49\u4e3a\u5168\u5c40\u5bf9\u8c61\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6ce8\u610f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u9700\u4ed4\u7ec6\u7406\u89e3 \u201c\u624b\u52a8\u542f\u52a8\u5b88\u62a4\u7a0b\u5e8f\u201d \u7684\u8c03\u8bd5\u8fc7\u7a0b\u3002\u539f\u672c\u5b88\u62a4\u7a0b\u5e8f\u7531\u8c03\u5ea6\u7a0b\u5e8f\u8fdb\u884c\u63a7\u5236\uff0c\u5468\u671f\u6027\u542f\u52a8\uff0c\u4ece\u800c\u6267\u884c\u5fc3\u8df3\u68c0\u6d4b\u4e0e\u8fdb\u7a0b\u7ec8\u6b62\u7684\u4efb\u52a1\u3002\u4e8e\u662f\uff0c\u4e0a\u9762\u7b2c\u4e8c\u6b21\u8c03\u8bd5\u65f6\uff08\u52a0\u5165\u8d85\u65f6\u53c2\u6570\u7684\u64cd\u4f5c\uff09\uff0c\u9700\u6267\u884c demo02 \u4e4b\u540e\uff0c\u7b49\u5f85\u8fdb\u7a0b\u8d85\u65f6\uff0c\u7136\u540e\u542f\u52a8\u5b88\u62a4\u7a0b\u5e8f\uff08\u5176\u5b9e\u53ef\u4ee5\u53cd\u590d\u624b\u52a8\u6267\u884c\uff0c\u53ea\u4e0d\u8fc7\u53ea\u6709\u65f6\u95f4\u9650\u5236\u5230\u4e86\uff0c\u624d\u80fd\u53d1\u6325\u6e05\u7406\u4f5c\u7528\uff09\uff0c\u68c0\u6d4b\u5230\u5b58\u5728\u8d85\u65f6\u884c\u4e3a\uff0c\u4e8e\u662f\u5bf9\u8fdb\u7a0b\u7ec8\u6b62\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u76f8\u5173\u7ae0\u8282"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["313\uff0c\u8fdb\u7a0b\u7ec8\u6b62\u3002",(0,l.jsx)(r.code,{children:"exit()"})," \u8868\u793a\u7ec8\u6b62\u8fdb\u7a0b\uff0c\u4e0d\u4f1a\u8c03\u7528\u5c40\u90e8\u5bf9\u8c61\u7684\u6790\u6784\u51fd\u6570\uff0c\u53ea\u8c03\u7528\u5168\u5c40\u5bf9\u8c61\u7684\u6790\u6784\u51fd\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/03/16 23:08:32\uff0c2024/06/01 17:57:42"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/02 4:22:20\uff0c\u5b8c\u6210\u4ee3\u7801 + \u6240\u6709\u8c03\u8bd5"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"58-\u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u7b56\u7565",children:"58 \u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u7b56\u7565"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u670d\u52a1\u7a0b\u5e8f\uff1a\u4f7f\u7528\u5fc3\u8df3\u673a\u5236\uff08\u8c03\u5ea6\u6a21\u5757\u3001\u5b88\u62a4\u6a21\u5757\u9664\u5916\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u5ea6\u6a21\u5757 ",(0,l.jsx)(r.code,{children:"procctl"})," \uff08\u542f\u52a8\u3001\u91cd\u542f\u670d\u52a1\u7a0b\u5e8f\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b88\u62a4\u6a21\u5757 ",(0,l.jsx)(r.code,{children:"checkproc"})," \uff08\u7ec8\u6b62\u8d85\u65f6\u7684\u670d\u52a1\u7a0b\u5e8f\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\uff08\u5b8c\u5584 ",(0,l.jsx)(r.code,{children:"crtsurfdata.cpp"})," \uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6d4b\u8bd5 VS \u6b63\u5f0f\uff1a\u624b\u52a8\u8fd0\u884c --\x3e \u8c03\u5ea6\u6a21\u5757\u8fd0\u884c"}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"main"})," \u53c2\u6570\u53ca\u5224\u65ad\uff1a\u6dfb\u52a0\u8c03\u5ea6\u6a21\u5757\u8def\u5f84\u3001\u6dfb\u52a0\u5e2e\u52a9\u6587\u6863"]}),"\n",(0,l.jsxs)(r.li,{children:["\u589e\u52a0\u5fc3\u8df3\uff08\u58f0\u660e\uff09 --\x3e \u5c06\u5fc3\u8df3\u52a0\u5165\u5171\u4eab\u5185\u5b58\uff08 ",(0,l.jsx)(r.code,{children:"addpinfo"})," \uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u67e5\u770b\u65e5\u5fd7 ",(0,l.jsx)(r.code,{children:"tail -f path_name"})]}),"\n",(0,l.jsx)(r.li,{children:"\u67e5\u770b\u8fdb\u7a0b"}),"\n",(0,l.jsxs)(r.li,{children:["\u7ec8\u6b62\u8c03\u5ea6\u7a0b\u5e8f ",(0,l.jsx)(r.code,{children:"killall - 9 procctl"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7f16\u5199\u811a\u672c\uff08\u542f\u52a8 / \u7ec8\u6b62\u670d\u52a1\u7a0b\u5e8f\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"start.sh"})," \uff08\u8c03\u5ea6\u542f\u52a8 ",(0,l.jsx)(r.code,{children:"checkproc"})," \u548c ",(0,l.jsx)(r.code,{children:"crtsurfdata"})," \uff09--\x3e ",(0,l.jsx)(r.code,{children:"chmod +x"})," \u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650"]}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"stop.sh"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5f00\u673a\u542f\u52a8\u670d\u52a1\u7a0b\u5e8f ",(0,l.jsx)(r.code,{children:"/etc/rc.local"})," \uff08Ubuntu \u9700\u989d\u5916\u914d\u7f6e\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"su -"})," \u5207\u6362 ",(0,l.jsx)(r.code,{children:"root"})," \u7528\u6237\uff08\u82e5\u63d0\u793a\u5931\u8d25\uff0c\u53ef ",(0,l.jsx)(r.code,{children:"sudo passwd root"})," \u91cd\u7f6e\u5bc6\u7801\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7528 ",(0,l.jsx)(r.code,{children:"root"})," \u7528\u6237\u542f\u52a8\u5b88\u62a4\u8fdb\u7a0b\uff08\u6ce8\u91ca ",(0,l.jsx)(r.code,{children:"start.sh"})," \u7684\u4e00\u884c\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u914d\u7f6e\u5f00\u673a\u542f\u52a8"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'cpactive pactive; // \u6dfb\u52a0\u5fc3\u8df3\u673a\u5236\r\n\r\nint main(int argc, char *argv[]) {\r\n    /* ... */\r\n    pactive.addpinfo(10, "crtsurfdata"); // \u628a\u5f53\u524d\u8fdb\u7a0b\u7684\u5fc3\u8df3\u52a0\u5165\u5171\u4eab\u5185\u5b58\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# start.sh\r\n#!/bin/bash\r\n\r\n# \u542f\u52a8\u5b88\u62a4\u6a21\u5757\uff08\u4f7f\u7528 root \u542f\u52a8\uff0c\u4fee\u6539 rc.local\uff09\r\n# ../../tools/bin/procctl 10 ../../tools/bin/checkproc ../../tmp/log/checkproc.log\r\n\r\n# \u751f\u6210\u6c14\u8c61\u7ad9\u70b9\u89c2\u6d4b\u7684\u5206\u949f\u6570\u636e\uff0c\u7a0b\u5e8f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\r\n../../tools/bin/procctl 60 ../../idc/bin/crtsurfdata ../../idc/ini/stcode.ini ../../tmp/idc/surfdata ../../log/idc/crtsurfdata.log csv,xml,json\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"# stop.sh\r\n#!/bin/bash\r\n\r\n# \u6b64\u811a\u672c\u7528\u4e8e\u505c\u6b62\u6570\u636e\u5171\u4eab\u5e73\u53f0\u5168\u90e8\u7684\u670d\u52a1\u7a0b\u5e8f\r\n# \u505c\u6b62\u8c03\u5ea6\u7a0b\u5e8f\r\nkillall -9 procctl\r\n\r\n# \u505c\u6b62\u5176\u4ed6\u7684\u670d\u52a1\u7a0b\u5e8f\r\n# \u5c1d\u8bd5\u8ba9\u5176\u4ed6\u670d\u52a1\u7a0b\u5e8f\u6b63\u5e38\u7ec8\u6b62\r\nkillall crtsurfdata\r\n\r\n# \u8ba9\u5176\u4ed6\u670d\u52a1\u7a0b\u5e8f\u6709\u8db3\u591f\u7684\u65f6\u95f4\u9000\u51fa\r\nsleep 5 \r\n\r\n# \u4e0d\u7ba1\u670d\u52a1\u7a0b\u5e8f\u6709\u6ca1\u6709\u9650\u5236\uff0c\u90fd\u5f3a\u5236\u6740\u6b7b\r\nkillall -9 crtsurfdata\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"## Ubuntu \u914d\u7f6e rc.local\r\n## \u670d\u52a1\u663e\u793a\u72b6\u6001\r\nsystemctl status rc-local.service\r\n\r\n## \u542f\u52a8\u670d\u52a1\r\nsystemctl start rc-local.service\r\n \r\n## \u91cd\u542f\u670d\u52a1\r\nsystemctl restart rc-local\r\n\r\n## \u670d\u52a1\u505c\u6b62\r\nsystemctl stop rc-local.service\r\n\r\n## \u5f00\u673a\u751f\u6548\r\nsystemctl enable rc-local.service\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"sudo vim /lib/systemd/system/rc-local.service\r\n\r\n## \u6dfb\u52a0 [Install]\uff08\u6ce8\u610f\u5927\u5199\u5b57\u6bcd\uff09\r\n[Install]\r\nWantedBy=multi-user.target\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:'# rc.local\r\n#!/bin/bash\r\n\r\n# \u542f\u52a8\u5b88\u62a4\u6a21\u5757\r\n/home/celfs/project/engi_cpp/49_project/tools/bin/procctl 10 /home/celfs/project/engi_cpp/49_project/tools/bin/checkproc /home/celfs/project/engi_cpp/49_project/tmp/log/checkproc.log\r\n\r\n# \u542f\u52a8\u6570\u636e\u5171\u4eab\u5e73\u53f0\u7684\u670d\u52a1\u7a0b\u5e8f\r\nsu - celfs -c "/home/celfs/project/engi_cpp/49_project/idc/cpp/start.sh"\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u53c2\u8003\u6587\u7ae0"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.a,{href:"https://blog.csdn.net/qz652219228/article/details/125107694",children:"\u5927\u6982\u501f\u9274"})}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.a,{href:"https://blog.csdn.net/weixin_44654533/article/details/87190638",children:"\u6700\u7ec8\u751f\u6548"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"celfs@ub engi_cpp % ps -ef | grep checkproc                                                        [0]\r\nroot         908       1  0 19:11 ?        00:00:00 /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 10 /home/celfs/project/engi_cpp/49_project/tools/bin/checkproc /home/celfs/project/engi_cpp/49_project/tmp/log/checkproc.log\r\ncelfs       1672    1451  0 19:12 pts/1    00:00:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox checkproc\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8c03\u8bd5"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240603165739507",src:e(19124).A+"",width:"1536",height:"659"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u811a\u672c\u542f\u52a8\u6240\u6709\u670d\u52a1\u7a0b\u5e8f"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240603174831686",src:e(61141).A+"",width:"1508",height:"324"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u7ecf\u9a8c\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u670d\u52a1\u7a0b\u5e8f\u901a\u5e38\u6709\u5f88\u591a\u4e2a\uff0c\u5982\u679c\u6bcf\u4e00\u4e2a\u90fd\u50cf\u6f14\u793a\u7684\u624b\u52a8\u5220\u9664\u8c03\u5ea6\u7a0b\u5e8f\uff0c\u5c31\u4e0d\u73b0\u5b9e\uff0c\u4e8e\u662f\u9700\u8981\u811a\u672c\u6279\u5904\u7406\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u811a\u672c\u6587\u4ef6\u7684\u8fd0\u884c\uff08\u8d4b\u53ef\u6267\u884c\u6743\u9650 ",(0,l.jsx)(r.code,{children:"chmod +x xx.sh"}),"\u3001\u8fd0\u884c ",(0,l.jsx)(r.code,{children:"sh xx.sh"})," \uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u8d8a\u590d\u6742\u7684\u7a0b\u5e8f\uff0c\u8d8a\u5bb9\u6613\u6302\u6389\uff0c\u5c24\u5176\u662f\u7528\u5230\u7f51\u7edc\u901a\u8baf\u7684\u7a0b\u5e8f\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u628a\u7cfb\u7edf\u5206\u89e3\u6210\u7b80\u5355\u7684\u6a21\u5757\u662f\u660e\u667a\u7684\u9009\u62e9\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["BUG\uff08\u672c\u7ae0\u8282\u7f16\u8bd1\u8b66\u544a\uff0c\u672a\u5904\u7406\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"[-Wreturn-type]"})," \uff1a\u51fd\u6570\u6709\u65e0\u8fd4\u56de\u503c\u4ee5\u53ca\u8fd4\u56de\u503c\u7c7b\u578b\u4e0d\u5339\u914d\uff1b"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"[-Wformat-security]"})," \uff1aC\u98ce\u683c\u8f93\u51fa\u4e0e\u8f93\u5165\u683c\u5f0f\u5b57\u7b26\u4e32\u4f7f\u7528\u4e0d\u5f53\uff1b"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"celfs@ub cpp % make\r\n\r\ng++ -g -o crtsurfdata crtsurfdata.cpp -I../../public ../../public/_public.cpp -lm -lc\r\nIn file included from crtsurfdata.cpp:4:\r\n../../public/_public.h: In instantiation of \u2018std::string idc::sformat(const char*, Args ...) [with Args = {}; std::string = std::__cxx11::basic_string<char>]\u2019:\r\n../../public/_public.h:493:43:   required from \u2018bool idc::clogfile::write(const char*, Args ...) [with Args = {}]\u2019\r\ncrtsurfdata.cpp:84:50:   required from here\r\n../../public/_public.h:167:23: warning: format not a string literal and no format arguments [-Wformat-security]\r\n  167 |     int len = snprintf( nullptr, 0, fmt, args... );      // \u5f97\u5230\u683c\u5f0f\u5316\u540e\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002\r\n      |               ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n../../public/_public.h:172:13: warning: format not a string literal and no format arguments [-Wformat-security]\r\n  172 |     snprintf(&str[0], len + 1, fmt, args... );          // linux\u5e73\u53f0\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662flen+1\uff0cwindows\u5e73\u53f0\u662flen\u3002\r\n      |     ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\ncrtsurfdata.cpp: In function \u2018bool crtsurffile(const string&, const string&)\u2019:\r\ncrtsurfdata.cpp:239:1: warning: control reaches end of non-void function [-Wreturn-type]\r\n  239 | }\r\n      | ^\r\nIn file included from ../../public/_public.cpp:6:\r\n../../public/_public.h: In instantiation of \u2018std::string idc::sformat(const char*, Args ...) [with Args = {}; std::string = std::__cxx11::basic_string<char>]\u2019:\r\n../../public/_public.h:493:43:   required from \u2018bool idc::clogfile::write(const char*, Args ...) [with Args = {}]\u2019\r\n../../public/_public.cpp:1690:74:   required from here\r\n../../public/_public.h:167:23: warning: format not a string literal and no format arguments [-Wformat-security]\r\n  167 |     int len = snprintf( nullptr, 0, fmt, args... );      // \u5f97\u5230\u683c\u5f0f\u5316\u540e\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002\r\n      |               ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n../../public/_public.h:172:13: warning: format not a string literal and no format arguments [-Wformat-security]\r\n  172 |     snprintf(&str[0], len + 1, fmt, args... );          // linux\u5e73\u53f0\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662flen+1\uff0cwindows\u5e73\u53f0\u662flen\u3002\r\n      |     ~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\ncp -f crtsurfdata ../bin/.\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u67e5\u770b\u8fdb\u7a0b\u540e\uff0c\u90a3\u4e2a\u65f6\u95f4\u540e\u9762\u7684\u95ee\u53f7 ",(0,l.jsx)(r.code,{children:"?"})," \u662f\u4ec0\u4e48\u610f\u601d\uff1f\u4e3a\u4ec0\u4e48\u4f1a\u53d8\u6210\u95ee\u53f7\uff1f\u800c\u5176\u4ed6\u7684\u662f ",(0,l.jsx)(r.code,{children:"pts/1"})," \u8fd9\u6837\u7684\uff1f"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5728 ",(0,l.jsx)(r.code,{children:"ps"})," \u547d\u4ee4\u7684\u8f93\u51fa\u4e2d\uff0c\u65f6\u95f4\u540e\u9762\u7684\u95ee\u53f7 \u201c?\u201d \u8868\u793a\u8be5\u8fdb\u7a0b\u6ca1\u6709\u4e0e\u4efb\u4f55\u7ec8\u7aef\uff08TTY\uff0cTeletypewriter\uff09\u5173\u8054\u3002TTY \u662f\u6307\u7528\u6237\u767b\u5f55\u7684\u7ec8\u7aef\u8bbe\u5907\uff0c\u901a\u5e38\u662f ",(0,l.jsx)(r.code,{children:"pts/1"})," \u8fd9\u6837\u7684\u8868\u793a\u65b9\u5f0f\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"?"})," \u901a\u5e38\u51fa\u73b0\u5728",(0,l.jsx)(r.strong,{children:"\u7cfb\u7edf\u5b88\u62a4\u8fdb\u7a0b"}),"\u3001",(0,l.jsx)(r.strong,{children:"\u540e\u53f0\u8fdb\u7a0b"}),"\u6216\u8005\u4e00\u4e9b",(0,l.jsx)(r.strong,{children:"\u542f\u52a8\u65f6\u6ca1\u6709\u7ec8\u7aef\u7684\u8fdb\u7a0b"}),"\u4e2d\u3002"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"celfs  1672  1451  0  19:12 pts/1  00:00:00  grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox checkproc\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"celfs"})," \u662f\u8fdb\u7a0b\u7684\u6240\u6709\u8005\u7528\u6237\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"1672"})," \u662f\u8fdb\u7a0b\u7684 PID\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"1451"})," \u662f\u7236\u8fdb\u7a0b\u7684 PID\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"0"})," \u662f CPU \u4f7f\u7528\u7387\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"19:12"})," \u662f\u8fdb\u7a0b\u7684\u542f\u52a8\u65f6\u95f4\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"pts/1"})," \u8868\u793a\u8fdb\u7a0b\u662f\u901a\u8fc7\u4f2a\u7ec8\u7aef\uff08pseudo-terminal\uff09 1 \u542f\u52a8\u7684\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"00:00:00"})," \u662f CPU \u5360\u7528\u65f6\u95f4\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox checkproc"})," \u662f\u8fdb\u7a0b\u542f\u52a8\u7684\u547d\u4ee4\u548c\u53c2\u6570\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/03 19:19:45\uff0c2024/06/03 22:14:14"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"59-\u5c0f\u5de5\u5177-\u6e05\u7406\u6587\u4ef6",children:"59 \u5c0f\u5de5\u5177-\u6e05\u7406\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6e05\u7406\u6587\u4ef6\uff1a\u5220\u9664\u6307\u5b9a\u76ee\u5f55\u4e2d\u7684\u5386\u53f2\u6570\u636e\u6587\u4ef6\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u524d\u9762\u5c06\u5b88\u62a4\u7a0b\u5e8f\u7b49\u8bbe\u7f6e\u4e3a\u5f00\u673a\u542f\u52a8\uff0c\u5c06\u5728 ",(0,l.jsx)(r.code,{children:"../../tmp/idc/surfdata"})," \u6301\u7eed\u4ea7\u751f\u82e5\u5e72\u6587\u4ef6\uff0c\u5e76\u4e14\u4e0d\u505a\u6e05\u7406\uff0c\u8fd9\u53ef\u80fd\u5bfc\u81f4\u78c1\u76d8\u7a7a\u95f4\u88ab\u5360\u6ee1\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"deletefiles.cpp"})," \u6587\u4ef6"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"makefile"})," \u8865\u5145"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5217\u51fa ",(0,l.jsx)(r.code,{children:"deletefiles.cpp"})," \u6d41\u7a0b\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u53c2\u6570\u5e2e\u52a9\u6587\u6863"}),"\n",(0,l.jsx)(r.li,{children:"\u5ffd\u7565\u4fe1\u53f7\u4e0e I/O\uff08\u8c03\u8bd5\u9636\u6bb5\u9700\u6253\u5f00 I/O\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9a\u4e49\u5220\u9664\u6587\u4ef6\u7684\u65f6\u95f4\u70b9\uff08\u5355\u4f4d\uff1a\u5929\uff0c1\u5c0f\u65f6\u7ea60.04\u5929\uff1b1\u5219\u5220\u96641\u5929\u524d\u6587\u4ef6\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u4f7f\u7528\u5f00\u53d1\u6846\u67b6 ",(0,l.jsx)(r.code,{children:"cdir"})," \u6253\u5f00\u76ee\u5f55"]}),"\n",(0,l.jsx)(r.li,{children:"\u904d\u5386\u76ee\u5f55\uff0c\u5bfb\u627e\u5224\u5b9a\u4e3a\u5386\u53f2\u6570\u636e\u7684\u6587\u4ef6\uff0c\u5e76\u5220\u9664"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"ls ../../tmp/idc/surfdata/"})," \u67e5\u770b\u76ee\u5f55\uff08\u6bcf 60 \u79d2\u751f\u6210 3 \u4e2a\u6587\u4ef6\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"ll ../../tmp/idc/surfdata/ | wc"})," \u7edf\u8ba1\u6587\u4ef6\u6570\u91cf"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:'"*.xml,*.json,*.csv"'})," \u4ee5\u6b63\u786e\u7684\u53c2\u6570\u5220\u9664\u8d85\u65f6\u6587\u4ef6"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ee7\u7eed\u5b8c\u5584\u4ee3\u7801\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6dfb\u52a0\u5fc3\u8df3\u673a\u5236"}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u5230\u542f\u52a8\u811a\u672c ",(0,l.jsx)(r.code,{children:"start.sh"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u5230\u7ec8\u6b62\u811a\u672c ",(0,l.jsx)(r.code,{children:"stop.sh"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u505c\u6b62\u5168\u90e8\u670d\u52a1\u7a0b\u5e8f"}),"\n",(0,l.jsx)(r.li,{children:"\u542f\u52a8\u5168\u90e8\u670d\u52a1\u7a0b\u5e8f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-makefile",children:"# \u5f00\u53d1\u6846\u67b6\u5934\u6587\u4ef6\u8def\u5f84\r\nPUBINCL = -I../../public\r\n\r\n# \u5f00\u53d1\u6846\u67b6 cpp \u6587\u4ef6\u540d\uff0c\u76f4\u63a5\u548c\u7a0b\u5e8f\u7684\u6e90\u4ee3\u7801\u4e00\u8d77\u7f16\u8bd1\uff0c\u6ca1\u6709\u91c7\u7528\u94fe\u63a5\u5e93\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8c03\u8bd5\r\nPUBCPP = ../../public/_public.cpp\r\n\r\n# \u7f16\u8bd1\u9009\u9879\r\nCFLAGS = -g\r\n# CFLAGS = -O2\r\n\r\nall: procctl checkproc deletefiles\r\n\r\nprocctl:procctl.cpp\r\n\t\tg++ -g -o procctl procctl.cpp\r\n\t\tcp -f procctl ../bin/.\r\n\r\ncheckproc: checkproc.cpp\r\n\t\tg++ $(CFLAGS) -o checkproc checkproc.cpp $(PUBINCL) $(PUBCPP)\r\n\t\tcp -f checkproc ../bin/.\r\n\r\ndeletefiles: deletefiles.cpp\r\n\t\tg++ $(CFLAGS) -o deletefiles deletefiles.cpp $(PUBINCL) $(PUBCPP)\r\n\t\tcp -f deletefiles ../bin/.\r\n\r\nclean:\r\n\t\trm -rf procctl checkproc deletefiles\n"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:'# start.sh\r\n#!/bin/bash\r\n\r\nBASE_DIR="/home/celfs/project/engi_cpp/49_project"\r\n\r\n# \u542f\u52a8\u5b88\u62a4\u6a21\u5757\r\n#../../tools/bin/procctl 10 ../../tools/bin/checkproc ../../tmp/log/checkproc.log\r\n\r\n# \u751f\u6210\u6c14\u8c61\u7ad9\u70b9\u89c2\u6d4b\u7684\u5206\u949f\u6570\u636e\uff0c\u7a0b\u5e8f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\r\n$BASE_DIR/tools/bin/procctl 60 \\\r\n$BASE_DIR/idc/bin/crtsurfdata \\\r\n$BASE_DIR/idc/ini/stcode.ini \\\r\n$BASE_DIR/tmp/idc/surfdata \\\r\n$BASE_DIR/log/idc/crtsurfdata.log csv,xml,json\r\n\r\n# \u6e05\u7406\u539f\u59cb\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u76ee\u5f55\uff08/tmp/idc/surfdata\uff09\u4e2d\u7684\u5386\u53f2\u6570\u636e\u6587\u4ef6\r\n$BASE_DIR/tools/bin/procctl 300 \\\r\n$BASE_DIR/tools/bin/deletefiles \\\r\n$BASE_DIR/tmp/idc/surfdata "*" 0.02\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "../../public/_public.h"\r\nusing namespace idc;\r\n\r\ncpactive pactive;\r\n\r\nvoid EXIT(int sig);\r\n\r\nint main(int argc, char *argv[]) {\r\n    \r\n    // \u7a0b\u5e8f\u7684\u5e2e\u52a9\r\n    if (argc != 4) {\r\n        printf("\\n");\r\n        printf("Using:   ../../tools/bin/deletefiles pathname matchstr timeout\\n\\n");\r\n\r\n        printf("Example: ../../tools/bin/deletefiles ../../tmp/idc/surfdata \\"*.xml,*.json\\" 0.01\\n");\r\n        cout << R"(         ../../tools/bin/deletefiles ../../log/idc "*.log.20*" 0.02)" << endl;\r\n        printf("         ../../tools/bin/procctl 300 ../../tools/bin/deletefiles ../../log/idc \\"*.log.20*\\" 0.02\\n");\r\n        printf("         ../../tools/bin/procctl 300 ../../tools/bin/deletefiles ../../tmp/idc/surfdata \\"*.xml,*.json\\" 0.01\\n\\n");\r\n\r\n        printf("\u8fd9\u662f\u4e00\u4e2a\u5de5\u5177\u7a0b\u5e8f\uff0c\u7528\u4e8e\u5220\u9664\u5386\u53f2\u7684\u6570\u636e\u6587\u4ef6\u6216\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n        printf("\u672c\u7a0b\u5e8f\u628apathname\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e2dtimeout\u5929\u4e4b\u524d\u7684\u5339\u914dmatchstr\u6587\u4ef6\u5168\u90e8\u5220\u9664\uff0ctimeout\u53ef\u4ee5\u662f\u5c0f\u6570\u3002\\n");\r\n        printf("\u672c\u7a0b\u5e8f\u4e0d\u5199\u65e5\u5fd7\u6587\u4ef6\uff0c\u4e5f\u4e0d\u4f1a\u5728\u63a7\u5236\u53f0\u8f93\u51fa\u4efb\u4f55\u4fe1\u606f\u3002\\n\\n\\n");\r\n\r\n        return -1;\r\n\t}\r\n\r\n    // \u5ffd\u7565\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u5173\u95ed I/O\uff0c\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\r\n    closeioandsignal(true);\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    pactive.addpinfo(30,"deletefiles");\r\n\r\n    // \u83b7\u53d6\u88ab\u5b9a\u4e49\u4e3a\u5386\u53f2\u6570\u636e\u6587\u4ef6\u7684\u65f6\u95f4\u70b9\r\n    // string strtimeout = ltime1("yyyymmddhh24miss", 0 - (int)(atof(argv[3]) * 24 * 60 * 60)); // \u5b9e\u9a8c1\uff1a\u4e0d\u8f6c\u6362\u7c7b\u578b\uff1b\u5b9e\u9a8c2\uff1a\u4e0d\u75280\u51cf\r\n    string strtimeout = ltime1("yyyymmddhh24miss", 0 - (int)(atof(argv[3]) * 24 * 60 * 60));\r\n    cout << "strtimeout = " << strtimeout << endl;\r\n\r\n    // \u6253\u5f00\u76ee\u5f55\r\n    cdir dir;\r\n    if (dir.opendir(argv[1], argv[2], 10000, true) == false) {\r\n        printf("dir.opendir(%s) failed.\\n", argv[1]);\r\n        return -1;\r\n    }\r\n\r\n    // \u904d\u5386\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff0c\u5982\u679c\u662f\u5386\u53f2\u6570\u636e\u6587\u4ef6\uff0c\u5220\u9664\u5b83\r\n    while (dir.readdir() == true) {\r\n        // \u628a\u6587\u4ef6\u7684\u65f6\u95f4\u4e0e\u5386\u53f2\u6587\u4ef6\u7684\u65f6\u95f4\u70b9\u6bd4\u8f83\uff0c\u5982\u679c\u66f4\u65e9\uff0c\u5219\u9700\u8981\u5220\u9664\r\n        if (dir.m_mtime < strtimeout) {\r\n            if (remove(dir.m_ffilename.c_str()) == 0) {\r\n                cout << "remove(" << dir.m_ffilename << ") OK.\\n";\r\n            } else {\r\n                cout << "remove(" << dir.m_ffilename << ") failed.\\n";\r\n            }\r\n        }\r\n    }\r\n\r\n    return 0;\r\n\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n\r\n    printf("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8c03\u8bd5\uff08\u505c\u6b62 + \u542f\u52a8\u670d\u52a1\u7a0b\u5e8f\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604183756142",src:e(32927).A+"",width:"1485",height:"294"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5b9a\u4e49\u4e3a\u5386\u53f2\u65f6\u95f4\u70b9\u7684\u5355\u4f4d\uff0c\u4e3a\u4ec0\u4e48\u7528 \u201c\u5929\u201d\uff1f1 / 24 \u4e0d\u662f\u9664\u4e0d\u5c3d\u5417\uff1f\u9664\u4e0d\u5c3d\u4f1a\u4e0d\u4f1a\u5bfc\u81f4\u540e\u9762\u51fa\u73b0\u610f\u60f3\u4e0d\u5230\u7684\u884c\u4e3a\uff1f"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u5982\u4f55\u7406\u89e3 ",(0,l.jsx)(r.code,{children:"ltime()"})," \u4e2d\u5c06\u65f6\u95f4\u8f6c\u6362\u4e3a\u79d2\u4e4b\u540e\uff0c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u4e3a ",(0,l.jsx)(r.code,{children:"int"}),"\uff0c\u5e76\u4e14\u7528 ",(0,l.jsx)(r.code,{children:"0 - x"})," \u7684\u64cd\u4f5c\uff1f\u4e00\u5b9a\u8981\u7528 0 \u53bb\u51cf\u5417\uff1f\u5b9e\u9a8c\u770b\u770b\u4e0d\u51cf\u4f1a\u600e\u6837\u3002\u53e6\u5916\uff0c\u4e3a\u4ec0\u4e48 0 \u51cf\u53bb\u4e00\u4e2a\u6b63\u6570\uff1f"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u5173\u4e8e\u6587\u4ef6\u6700\u540e\u4e00\u6b21\u4fee\u6539\u7684\u65f6\u95f4\uff0c\u5bf9\u6bd4\u8d85\u65f6\u65f6\u95f4\u70b9\uff0c\u5982\u679c\u66f4\u65e9\uff0c\u5219\u8bf4\u660e\u6587\u4ef6\u8d85\u65f6\uff0c\u9700\u5220\u9664\u6587\u4ef6\u3002\u7a81\u7136\u7406\u89e3\u4e86\u4e3a\u4ec0\u4e48\u4e4b\u524d HTTP \u534f\u8bae\u91cc\u9762\u7684 ",(0,l.jsx)(r.strong,{children:"HTTP \u7f13\u5b58\u8d85\u65f6\u65f6\u95f4\u7684\u8868\u8ff0"}),"\uff0c\u56e0\u4e3a\u7528\u7684\u662f\u65f6\u95f4\u6233\uff0c\u65f6\u95f4\u6233\u662f\u9012\u589e\u7684\uff0c\u56e0\u6b64\u5982\u679c\u6700\u540e\u4e00\u6b21\u4fee\u6539\u65f6\u95f4\u5c0f\u4e8e\u5f53\u524d\u5212\u5b9a\u7684\u8d85\u65f6\u65f6\u95f4\u70b9\uff0c\u5219\u8bf4\u660e\u662f\u8fd9\u4e2a\u65f6\u95f4\u70b9\u4e4b\u524d\u7684\u6587\u4ef6\uff0c\u5224\u5b9a\u4e3a\u8d85\u65f6\uff0c\u5219\u5220\u9664\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7a0b\u5e8f\u7684\u5fc3\u8df3\uff0c\u5e94\u8be5\u6dfb\u52a0\u5230\u7a0b\u5e8f\u7684\u54ea\u4e00\u90e8\u5206\uff1f\u662f\u5426\u6709\u987a\u5e8f\u8981\u6c42\uff1f"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7a0b\u5e8f\u7684\u5fc3\u8df3\u7531\u54ea\u51e0\u90e8\u5206\u7ec4\u6210\uff1f\u54ea\u4e9b\u662f\u5fc5\u987b\u7684\uff0c\u54ea\u4e9b\u662f\u53ef\u9009\u7684\uff1f\u4f55\u65f6\u9700\u8981\u5728\u5faa\u73af\u4f53\u4e2d\u4e5f\u66f4\u65b0\u5fc3\u8df3\u4fe1\u606f\uff1f"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsxs)(r.del,{children:["\u4e3a\u4ec0\u4e48 ",(0,l.jsx)(r.code,{children:"sh stop.sh"})," \u65e0\u6cd5\u505c\u6b62 ",(0,l.jsx)(r.code,{children:"checkproc"})," \u8fdb\u7a0b\uff1f\u662f\u4fe1\u53f7\u6ca1\u6709\u6b63\u786e\u5904\u7406\uff1f"]})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsxs)(r.del,{children:["\u4e3a\u4ec0\u4e48 ",(0,l.jsx)(r.code,{children:"sh stop.sh"})," \u7684\u7b2c\u4e00\u6761\u5185\u5bb9\u662f \u201c\u4e0d\u5141\u8bb8\u7684\u64cd\u4f5c\u201d\uff1f\u8fd9\u662f\u5bf9\u5b88\u62a4\u8fdb\u7a0b\uff08910\uff09\u800c\u8a00\u7684\uff0c\u5373\u524d\u9762\u7684  ",(0,l.jsx)(r.code,{children:"checkproc"})," \u8fdb\u7a0b\u3002"]})}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604183915069",src:e(44820).A+"",width:"740",height:"122"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u9a8c\u8bc1\u53d1\u73b0\uff0c\u5b88\u62a4\u8fdb\u7a0b\u53ea\u80fd\u7528 ",(0,l.jsx)(r.code,{children:"sudo"})," \u6743\u9650\u6740\u6b7b\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b88\u62a4\u8fdb\u7a0b\u8bbe\u7f6e\u4e86\u968f\u7cfb\u7edf\u542f\u52a8\uff0c\u7531\u8d85\u7ea7\u7528\u6237\u542f\u52a8\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5e76\u4e14\uff0c\u5982\u679c\u624b\u52a8\u6740\u6b7b\u4e86\u5b88\u62a4\u8fdb\u7a0b\uff0c\u4e5f\u53ea\u80fd\u624b\u52a8\u91cd\u542f\u670d\u52a1\uff08\u53ea\u9700\u8981\u8bfb\u53d6 ",(0,l.jsx)(r.code,{children:"rc.local"})," \u4e2d\u7684\u76f8\u5e94\u6307\u4ee4\uff0c\u624b\u52a8\u8fd0\u884c\u5373\u53ef\uff0c\u4f46\u8fd9\u6837\u542f\u52a8\u7684\u670d\u52a1\uff0c\u4e0d\u4f1a\u5468\u671f\u6027\u91cd\u542f\uff09\uff0c\u56e0\u6b64\u8fd8\u662f\u91cd\u542f\u7cfb\u7edf\u6765\u89e3\u51b3\uff08\u6216\u8005\u91cd\u542f ",(0,l.jsx)(r.code,{children:"rc.local"})," \u670d\u52a1\uff09\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u6d4b\u8bd5\u53d1\u73b0\uff0c\u540e\u9762\u8865\u5145\u7684 ",(0,l.jsx)(r.code,{children:"*.csv"})," \u683c\u5f0f\u53c2\u6570\uff0c\u82e5\u5199\u5728 ",(0,l.jsx)(r.code,{children:"*.xml, *.json"})," \u540e\u9762\uff0c\u5219\u65e0\u6cd5\u6b63\u786e\u5220\u9664\u5bf9\u5e94\u7684\u5386\u53f2\u6587\u4ef6\u3002\u800c\u5982\u679c\u53ea\u8f93\u5165 ",(0,l.jsx)(r.code,{children:"*.csv"})," \u6587\u4ef6\uff0c\u5219\u6b63\u786e\u5904\u7406\u3002\u8fd9\u53ef\u80fd\u610f\u5473\u7740\u67d0\u4e2a\u4ee3\u7801\u903b\u8f91\u5177\u6709\u987a\u5e8f\u4e2d\u65ad\u5173\u7cfb\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u6392\u67e5\u3002"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6392\u67e5\u53d1\u73b0\uff0c\u662f\u8f93\u5165\u683c\u5f0f\u95ee\u9898\uff0c\u591a\u4e86\u4e00\u4e2a\u7a7a\u683c ",(0,l.jsx)(r.code,{children:'"*.xml,*.json, *.csv"'}),"\uff0c\u800c\u6b63\u786e\u7684\u683c\u5f0f\u4e3a ",(0,l.jsx)(r.code,{children:'"*.xml,*.json,*.csv"'}),"\uff0c\u5176\u4e2d\u4e0d\u5f97\u6709\u7a7a\u683c\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4e86\u63d0\u9ad8\u7a0b\u5e8f\u7684\u9c81\u68d2\u6027\uff0c\u540e\u7eed\u53ef\u4ee5\u9488\u5bf9\u7a7a\u683c\u8fdb\u884c\u7279\u6b8a\u5904\u7406\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/04 18:55:21"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"60-\u5c0f\u5de5\u5177-\u538b\u7f29\u6587\u4ef6",children:"60 \u5c0f\u5de5\u5177-\u538b\u7f29\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u538b\u7f29\u6587\u4ef6\uff1a\u538b\u7f29\u6307\u5b9a\u76ee\u5f55\u4e2d\u7684\u5386\u53f2\u6570\u636e\u6587\u4ef6\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\uff08\u4e0e\u4e0a\u4e00\u8282\u903b\u8f91\u7c7b\u4f3c\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"gzipfiles.cpp"})," \uff08\u590d\u5236\u4e0a\u4e00\u8282\u4ee3\u7801\uff0c\u4fee\u6539\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u53c2\u6570\u6ce8\u91ca"}),"\n",(0,l.jsx)(r.li,{children:"\u5224\u65ad\u662f\u5426\u8fc7\u671f + \u5224\u65ad\u662f\u5426\u4e3a\u538b\u7f29\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.li,{children:["\u7cfb\u7edf\u8c03\u7528 ",(0,l.jsx)(r.code,{children:"gzip"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9a\u5411\u8f93\u51fa ",(0,l.jsx)(r.code,{children:"1>/dev/null"})," \u4e0e ",(0,l.jsx)(r.code,{children:"2>/dev/null"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"makefile"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6d4b\u8bd5 ",(0,l.jsx)(r.code,{children:"gzip"})," \u529f\u80fd\u662f\u5426\u6b63\u5e38\u8fd0\u884c"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ee7\u7eed\u5b8c\u5584\u4ee3\u7801\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u5230 ",(0,l.jsx)(r.code,{children:"start.sh"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u5230 ",(0,l.jsx)(r.code,{children:"stop.sh"})]}),"\n",(0,l.jsx)(r.li,{children:"\u5faa\u73af\u4f53\u9700\u66f4\u65b0\u8fdb\u7a0b\u5fc3\u8df3\uff0c\u5e76\u589e\u52a0\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\uff0830s --\x3e 120s\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "../../public/_public.h"\r\nusing namespace idc;\r\n\r\ncpactive pactive;\r\n\r\nvoid EXIT(int sig);\r\n\r\nint main(int argc, char *argv[]) {\r\n    \r\n    // \u7a0b\u5e8f\u7684\u5e2e\u52a9\r\n    if (argc != 4) {\r\n        printf("\\n");\r\n        printf("Using:   ../../tools/bin/gzipfiles pathname matchstr timeout\\n\\n");\r\n\r\n        printf("Example: /home/celfs/project/engi_cpp/49_project/tools/bin/gzipfiles /home/celfs/project/engi_cpp/49_project/tmp/idc/surfdata \\"*.xml,*.json\\" 0.01\\n");\r\n        cout << R"(         ../../tools/bin/gzipfiles ../../log/idc "*.log.20*" 0.02)" << endl;\r\n        printf("         ../../tools/bin/procctl 300 ../../tools/bin/gzipfiles ../../log/idc \\"*.log.20*\\" 0.02\\n");\r\n        printf("         ../../tools/bin/procctl 300 ../../tools/bin/gzipfiles ../../tmp/idc/surfdata \\"*.xml,*.json\\" 0.01\\n\\n");\r\n\r\n        printf("\u8fd9\u662f\u4e00\u4e2a\u5de5\u5177\u7a0b\u5e8f\uff0c\u7528\u4e8e\u538b\u7f29\u5386\u53f2\u7684\u6570\u636e\u6587\u4ef6\u6216\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n        printf("\u672c\u7a0b\u5e8f\u628apathname\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e2dtimeout\u5929\u4e4b\u524d\u7684\u5339\u914dmatchstr\u6587\u4ef6\u5168\u90e8\u538b\u7f29\uff0ctimeout\u53ef\u4ee5\u662f\u5c0f\u6570\u3002\\n");\r\n        printf("\u672c\u7a0b\u5e8f\u4e0d\u5199\u65e5\u5fd7\u6587\u4ef6\uff0c\u4e5f\u4e0d\u4f1a\u5728\u63a7\u5236\u53f0\u8f93\u51fa\u4efb\u4f55\u4fe1\u606f\u3002\\n");\r\n        printf("\u672c\u7a0b\u5e8f\u8c03\u7528/usr/bin/gzip\u547d\u4ee4\u538b\u7f29\u6587\u4ef6\u3002\\n\\n\\n");\r\n\r\n        return -1;\r\n\t}\r\n\r\n    // \u5ffd\u7565\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u5173\u95ed I/O\uff0c\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u51fd\u6570\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    pactive.addpinfo(120,"gzipfiles");\r\n\r\n    // \u83b7\u53d6\u88ab\u5b9a\u4e49\u4e3a\u5386\u53f2\u6570\u636e\u6587\u4ef6\u7684\u65f6\u95f4\u70b9\r\n    // string strtimeout = ltime1("yyyymmddhh24miss", 0 - (int)(atof(argv[3]) * 24 * 60 * 60)); // \u5b9e\u9a8c1\uff1a\u4e0d\u8f6c\u6362\u7c7b\u578b\uff1b\u5b9e\u9a8c2\uff1a\u4e0d\u75280\u51cf\r\n    string strtimeout = ltime1("yyyymmddhh24miss", 0 - (int)(atof(argv[3]) * 24 * 60 * 60));\r\n    cout << "strtimeout = " << strtimeout << endl;\r\n\r\n    // \u6253\u5f00\u76ee\u5f55\r\n    cdir dir;\r\n    if (dir.opendir(argv[1], argv[2], 10000, true) == false) {\r\n        printf("dir.opendir(%s) failed.\\n", argv[1]);\r\n        return -1;\r\n    }\r\n\r\n    // \u904d\u5386\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff0c\u5982\u679c\u662f\u5386\u53f2\u6570\u636e\u6587\u4ef6\uff0c\u538b\u7f29\u5b83\r\n    while (dir.readdir() == true) {\r\n        // \u628a\u6587\u4ef6\u7684\u65f6\u95f4\u4e0e\u5386\u53f2\u6587\u4ef6\u7684\u65f6\u95f4\u70b9\u6bd4\u8f83\uff0c\u5982\u679c\u66f4\u65e9\uff0c\u5e76\u4e14\u4e0d\u662f\u538b\u7f29\u6587\u4ef6\uff0c\u5219\u9700\u8981\u538b\u7f29\r\n        if ((dir.m_mtime < strtimeout) && (matchstr(dir.m_ffilename, "*.gz") == false)) {\r\n\r\n            // \u538b\u7f29\u6587\u4ef6\uff0c\u8c03\u7528\u7cfb\u7edf\u7684 gzip \u547d\u4ee4\r\n            string strcmd = "/usr/bin/gzip -f " + dir.m_ffilename + " 1>/dev/null 2>/dev/null";\r\n            if (system(strcmd.c_str()) == 0) {\r\n                cout << "gzip " << dir.m_ffilename << " OK.\\n";\r\n            } else {\r\n                cout << "gzip " << dir.m_ffilename << " failed.\\n";\r\n            }\r\n\r\n            // \u5982\u679c\u538b\u7f29\u7684\u6587\u4ef6\u6bd4\u8f83\u5927\uff0c\u6709\u51e0\u4e2aG\uff0c\u9700\u8981\u65f6\u95f4\u53ef\u80fd\u6bd4\u8f83\u957f\uff0c\u56e0\u6b64\u9700\u66f4\u65b0\u5fc3\u8df3\u4fe1\u606f\r\n            pactive.uptatime();\r\n        }\r\n    }\r\n\r\n    return 0;\r\n\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n\r\n    printf("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:'#!/bin/bash\r\n\r\nBASE_DIR="/home/celfs/project/engi_cpp/49_project"\r\n\r\n# \u542f\u52a8\u5b88\u62a4\u6a21\u5757\r\n#../../tools/bin/procctl 10 ../../tools/bin/checkproc ../../tmp/log/checkproc.log\r\n\r\n# \u751f\u6210\u6c14\u8c61\u7ad9\u70b9\u89c2\u6d4b\u7684\u5206\u949f\u6570\u636e\uff0c\u7a0b\u5e8f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\r\n$BASE_DIR/tools/bin/procctl 60 \\\r\n$BASE_DIR/idc/bin/crtsurfdata \\\r\n$BASE_DIR/idc/ini/stcode.ini \\\r\n$BASE_DIR/tmp/idc/surfdata \\\r\n$BASE_DIR/log/idc/crtsurfdata.log csv,xml,json\r\n\r\n# \u6e05\u7406\u539f\u59cb\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u76ee\u5f55\uff08/tmp/idc/surfdata\uff09\u4e2d\u7684\u5386\u53f2\u6570\u636e\u6587\u4ef6\r\n$BASE_DIR/tools/bin/procctl 300 \\\r\n$BASE_DIR/tools/bin/deletefiles \\\r\n$BASE_DIR/tmp/idc/surfdata "*" 0.02\r\n\r\n# \u538b\u7f29\u540e\u53f0\u670d\u52a1\u7a0b\u5e8f\u7684\u5907\u4efd\u65e5\u5fd7\r\n$BASE_DIR/tools/bin/procctl 300 \\\r\n$BASE_DIR/tools/bin/gzipfiles \\\r\n$BASE_DIR/tmp/idc/surfdata "*.log.20*" 0.02\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u538b\u7f29\u6587\u4ef6\u7684\u529f\u80fd\u7ecf\u5e38\u7528\u5230\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u5728 ",(0,l.jsx)(r.code,{children:".sh"})," \u6587\u4ef6\u4e2d\uff0c\u5982\u4f55\u8868\u793a\u884c\u7ee7\u7eed\uff1f\u60f3\u8981\u7c7b\u4f3c Cpp ",(0,l.jsx)(r.code,{children:"\\"})," \u7684\u6362\u884c\u529f\u80fd\u3002"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u786e\u4fdd",(0,l.jsx)(r.strong,{children:"\u53cd\u659c\u6760\u540e\u9762\u6ca1\u6709\u591a\u4f59\u7684\u7a7a\u683c"}),"\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u8bed\u6cd5\u9519\u8bef\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5982\u4f55\u7406\u89e3 ",(0,l.jsx)(r.code,{children:"start.sh"})," \u4e2d\u7684\u547d\u540d\u8bed\u6cd5\uff1f\u5373 ",(0,l.jsx)(r.code,{children:' "*.log.20*"'})," \uff0c\u8fd9\u4e2a\u7c7b\u4f3c\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u8bed\u6cd5\u3002\u4e3a\u4ec0\u4e48\u7528 ",(0,l.jsx)(r.code,{children:"*"})," \u5360\u4f4d\u5373\u53ef\u5b9e\u73b0\u6309\u65f6\u95f4\u547d\u540d\uff1f\u8fd8\u662f\u8bf4\uff0c\u6211\u5fd8\u8bb0\u4e86\u54ea\u91cc\u7684\u903b\u8f91\uff1f"]}),"\n",(0,l.jsx)(r.li,{children:"\u5982\u4f55\u786e\u5b9a\u7ed9\u8fdb\u7a0b\u5fc3\u8df3\u9884\u7559\u7684\u8d85\u65f6\u65f6\u957f\uff1f\u53ea\u80fd\u4ece\u5b9e\u9645\u8fd0\u884c\u4e2d\u53cd\u9988\u8c03\u8282\uff1f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:[(0,l.jsx)(r.code,{children:"gzip"})," \u538b\u7f29\u5931\u8d25\uff0c\u7b2c\u4e00\u6b21\u53d1\u73b0\u8f93\u51fa\u8def\u5f84\u5199\u9519\u4e86\uff1b\u7b2c\u4e8c\u6b21\u53d1\u73b0\u6761\u4ef6\u5199\u9519\u4e86\uff0c\u5176\u4e2d ",(0,l.jsx)(r.code,{children:'(matchstr(dir.m_ffilename, "*.gz") == false)'})," \u7684\u62ec\u53f7\u4f4d\u7f6e\u9519\u8bef\uff08\u4f46\u8fd9\u4e2a\u9519\u8bef\u5e76\u4e0d\u5f71\u54cd\u4ee3\u7801\u903b\u8f91\uff09\uff1b\u7b2c\u4e09\u6b21\uff0c\u8c03\u8bd5\u53d1\u73b0\uff0c\u76f4\u63a5\u4f7f\u7528 I/O \u7684\u6307\u4ee4\uff0c\u53ef\u4ee5\u6b63\u5e38\u538b\u7f29\uff0c\u4f46\u4f7f\u7528\u6587\u4ef6\u81ea\u52a8\u6267\u884c\u7684\uff0c\u5219\u5931\u8d25\uff1f"]}),(0,l.jsx)(r.strong,{children:"\u53c8\u662f\u9057\u6f0f\u4e86\u5fc5\u8981\u7684\u7a7a\u683c"}),"\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:'string strcmd = "/usr/bin/gzip -f " + dir.m_ffilename + " 1>/dev/null 2>/dev/null";'})," \u8fd9\u4e00\u53e5\u4ee3\u7801\uff0c\u6781\u5176\u5bb9\u6613\u9057\u7559\u9700\u8981\u7684\u7a7a\u683c\uff0c\u800c\u6253\u5370\u7684\u4fe1\u606f\u662f\u6b63\u786e\u7684\uff0c\u56e0\u6b64\u6b63\u5e38\u6267\u884c\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u8fd9\u90fd\u7b97\u4e0d\u4e0a\u662f BUG\uff0c\u800c\u662f\u4e0d\u6ce8\u610f\u68c0\u67e5\u4ee3\u7801\u6307\u4ee4\u7684\u6b63\u786e\u6027\uff0c\u5e76\u4e14\u8bef\u5c06\u6253\u5370\u7684\u683c\u5f0f\u4e0e\u4ea4\u7ed9\u7cfb\u7edf\u6267\u884c\u7684\u683c\u5f0f\u6df7\u6dc6\u4e86\uff01"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/03/17 21:06:32\uff0c2024/06/04 20:28:13 \u5b8c\u6210"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h2,{id:"\u7b2c\u4e5d\u7ae0-\u57fa\u4e8eftp\u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757",children:"\u7b2c\u4e5d\u7ae0 \u57fa\u4e8eftp\u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757"}),"\n",(0,l.jsx)(r.h3,{id:"61-ftp\u4f20\u8f93\u6587\u4ef6\u7684\u4e1a\u52a1\u9700\u6c42",children:"61 ftp\u4f20\u8f93\u6587\u4ef6\u7684\u4e1a\u52a1\u9700\u6c42"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u80cc\u666f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"FTP\uff08File Transfer Protocol\uff09\uff0c\u4e60\u60ef\u4e0a\u4e3a\u4e86\u4fdd\u6301\u7edf\u4e00\uff0c\u4f7f\u7528\u5c0f\u5199 ftp"}),"\n",(0,l.jsx)(r.li,{children:"\u4e09\u79cd\u5e94\u7528\u5c42\u534f\u8bae\uff08408\uff09\uff1a\u6587\u4ef6\u4f20\u8f93\u3001\u7535\u5b50\u90ae\u4ef6\u3001\u4e07\u7ef4\u7f51"}),"\n",(0,l.jsx)(r.li,{children:"\u7c7b\u6bd4\uff1a\u9632\u76d7\u95e8 VS \u623f\u95f4\u95e8"}),"\n",(0,l.jsx)(r.li,{children:"\u867d\u7136\u53e4\u8001\uff0c\u4f46\u8fd8\u6709\u5b9e\u7528\u4ef7\u503c\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u529f\u80fd\u9700\u6c42\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\uff1a\u4ece ftp \u670d\u52a1\u7aef\u4e0b\u8f7d\u6587\u4ef6"}),"\n",(0,l.jsx)(r.li,{children:"\u6587\u4ef6\u4e0a\u4f20\u6a21\u5757\uff1a\u628a\u672c\u5730\u6587\u4ef6\u4e0a\u4f20\u5230 ftp \u670d\u52a1\u7aef"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"62-\u914d\u7f6eftp\u670d\u52a1",children:"62 \u914d\u7f6eftp\u670d\u52a1"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u4e24\u79cd\u914d\u7f6e\u65b9\u5f0f\uff1a\u672c\u5730\u670d\u52a1\u5668\uff08\u81f3\u7b2c\u4e94\u6b65 ",(0,l.jsx)(r.code,{children:"active(running)"})," \uff09\u3001\u4e91\u670d\u52a1\u5668\uff08\u8fd8\u9700\u914d\u7f6e\u4e91\u5e73\u53f0\u7684\u8bbf\u95ee\u7b56\u7565\uff09"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u5b89\u88c5 ftp \u670d\u52a1\u7aef\u3001\u5ba2\u6237\u7aef"}),"\n",(0,l.jsxs)(r.li,{children:["2\uff09",(0,l.jsx)(r.code,{children:"SELINUX = disabled"})," \u7b49\u7cfb\u5217\u64cd\u4f5c\uff08Ubuntu \u6ca1\u6709\u8be5\u6587\u4ef6\uff0c\u5df2\u5b89\u88c5\u89e3\u51b3\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["3\uff09\u914d\u7f6e ftp \u6570\u636e\u7aef\u53e3\u53c2\u6570 ",(0,l.jsx)(r.code,{children:"vim /etc/vsftpd.conf"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6587\u4ef6\u5c3e\u90e8\u6307\u5b9a\u6570\u636e\u7aef\u53e3\u8303\u56f4\uff08\u4e24\u884c\u4ee3\u7801\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["4\uff09\u5f00\u901a\u9632\u706b\u5899\uff08Ubuntu \u9700\u5b89\u88c5 ",(0,l.jsx)(r.code,{children:"firewall"})," \uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["5\uff09\u542f\u52a8 ",(0,l.jsx)(r.code,{children:"vsftpd"})," \u670d\u52a1"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u914d\u7f6e\u8fc7\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u5b89\u88c5 ftp \u670d\u52a1\u7aef\u3001\u5ba2\u6237\u7aef"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# ftp \u670d\u52a1\u7aef\r\nsudo apt install vsftpd\r\n\r\n# ftp \u5ba2\u6237\u7aef\uff08\u63d0\u793a\u5df2\u5b89\u88c5\uff09\r\nsudo apt install ftp\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["ftp \u4f20\u8f93\u6a21\u5f0f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u88ab\u52a8\u6a21\u5f0f\uff08\u9ed8\u8ba4 / \u7f3a\u7701\uff0c\u4e0b\u9762\u57fa\u4e8e\u88ab\u52a8\u6a21\u5f0f\u8fdb\u884c\u914d\u7f6e\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u4e3b\u52a8\u6a21\u5f0f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["2\uff09",(0,l.jsxs)(r.del,{children:["Ubuntu \u6ca1\u6709 ",(0,l.jsx)(r.code,{children:"/etc/selinux/config"})," \u6587\u4ef6\uff0c\u53ef\u80fd\u9700\u8981\u50cf ",(0,l.jsx)(r.code,{children:"rc.local"})," \u4e00\u6837\u8bbe\u7f6e\uff0c\u4e0d\u8fc7\u4e5f\u53ef\u4ee5\u5148\u5c1d\u8bd5\u8df3\u8fc7\u8be5\u8bbe\u7f6e\uff0c\u6d4b\u8bd5\u80fd\u5426\u6b63\u5e38\u642d\u5efa ftp \u4f20\u8f93\u73af\u5883\u3002"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u67e5\u8be2\u53d1\u73b0\uff0c",(0,l.jsx)(r.code,{children:"selinux"})," \u6ca1\u6709\u5b89\u88c5\u6216\u8005\u88ab\u7981\u7528\uff0c\u4e0b\u9762\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# \u79fb\u9664 Apparmor\r\nsudo systemctl stop apparmor\r\nsudo apt-get purge apparmor\r\n\r\n# \u5b89\u88c5 selinux\r\nsudo apt-get install policycoreutils \r\nsudo apt-get install selinux-utils\r\nsudo apt-get install selinux-basics\r\n\r\n# \u521d\u6b21\u542f\u52a8\u914d\u7f6e\r\nsudo selinux-activate\r\n\r\n# \u67e5\u770b selinux \u72b6\u6001\r\nsestatus\r\n\r\n# \u4fee\u6539 selinux \u914d\u7f6e\u6587\u4ef6\r\nsudo vim /etc/selinux/config\r\n\r\n# \u914d\u7f6e\u751f\u6548\r\nsudo setenforce 0\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u51fa\u73b0 ",(0,l.jsx)(r.code,{children:"Relabeling"})," \u4fe1\u606f"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604223410707",src:e(55738).A+"",width:"800",height:"295"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u521d\u6b21\u914d\u7f6e ",(0,l.jsx)(r.code,{children:"selinux"}),"\uff0c\u91cd\u542f\u540e"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604223518509",src:e(57141).A+"",width:"654",height:"199"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u914d\u7f6e ",(0,l.jsx)(r.code,{children:"/etc/selinux/config"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"permissive"})," --\x3e ",(0,l.jsx)(r.code,{children:"disabled"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604223827647",src:e(70313).A+"",width:"660",height:"258"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["3\uff09\u6307\u5b9a\u6570\u636e\u7aef\u53e3\u8303\u56f4 ",(0,l.jsx)(r.code,{children:"vim /etc/vsftpd.conf"})]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604224636804",src:e(21891).A+"",width:"643",height:"109"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"4\uff09\u5f00\u901a\u9632\u706b\u5899"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# \u5b89\u88c5 firewalld\r\nsudo apt update\r\nsudo apt install firewalld\r\n\r\n# \u65b9\u6cd5\u4e00\uff1a\u5f00\u901a ftp \u670d\u52a1\r\nsudo firewall-cmd --zone=public --add-service=ftp --permanent\r\n\r\n# \u65b9\u6cd5\u4e8c\uff1a\u5f00\u901a ftp \u670d\u52a1\u9700\u8981\u7684\u7aef\u53e3\uff0821\u63a7\u5236\u7aef\u53e3\uff0c5000-5500\u6570\u636e\u7aef\u53e3\u8303\u56f4\uff09\r\nsudo firewall-cmd --zone=public --add-port=21/tcp --permanent\r\n\r\nsudo firewall-cmd --zone=public --add-port=5000-5500/tcp --permanent\r\n\r\n# \u91cd\u542f\u9632\u706b\u5899\r\nsystemctl restart firewalld.service\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u62a5\u9519\uff08\u9700\u8981\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"sudo"})," \u64cd\u4f5c\uff09"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604225427004",src:e(82534).A+"",width:"710",height:"53"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6267\u884c\u5b8c\u6bd5"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604225535558",src:e(35304).A+"",width:"776",height:"179"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["5\uff09\u542f\u52a8 ",(0,l.jsx)(r.code,{children:"vsftpd"})," \u670d\u52a1"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"systemctl start   vsftpd   # \u542f\u52a8\u670d\u52a1\u3002\r\nsystemctl stop    vsftpd    # \u505c\u6b62\u670d\u52a1\u3002\r\nsystemctl restart vsftpd    # \u91cd\u542f\u670d\u52a1\u3002\r\nsystemctl status  vsftpd    # \u67e5\u770b\u670d\u52a1\u72b6\u6001\u3002\r\nsystemctl enable  vsftpd    # \u542f\u7528\u5f00\u673a\u81ea\u542f\u52a8vsftpd\u670d\u52a1\u3002\r\nsystemctl disable vsftpd    # \u7981\u7528\u5f00\u673a\u81ea\u542f\u52a8vsftpd\u670d\u52a1\u3002\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"start"})," --\x3e ",(0,l.jsx)(r.code,{children:"status"})," \uff08\u81f3\u6b64\uff0c\u672c\u5730\u670d\u52a1\u5668\u914d\u7f6e\u5b8c\u6210\uff09"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604230431718",src:e(18455).A+"",width:"826",height:"217"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u914d\u7f6e\u4e91\u670d\u52a1\u8bbf\u95ee\u7b56\u7565\uff08\u963f\u91cc\u4e91\u4e3a\u4f8b\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7f51\u7edc\u548c\u5b89\u5168\u7ec4 --\x3e \u5b89\u5168\u7ec4\u914d\u7f6e --\x3e \u914d\u7f6e\u89c4\u5219 --\x3e \u624b\u52a8\u6dfb\u52a0\uff08\u5982\u4e0b\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604230849633",src:e(88364).A+"",width:"1331",height:"586"})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u8fdb\u4e00\u6b65\u4ecb\u7ecd\uff08ftp \u4f20\u8f93\u6a21\u5f0f\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u80cc\u666f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u65e9\u671f\u7684\u8ba1\u7b97\u673a\u90fd\u6709\u4e00\u4e2a IP \u5730\u5740\uff0cftp \u53ea\u6709\u4e3b\u52a8\u6a21\u5f0f\uff0c\u540e\u6765\u51fa\u73b0\u4e86\u5171\u4eab\u4e0a\u7f51\u6280\u672f\u3002\u4e3b\u52a8\u6a21\u5f0f\uff0c\u4ec5\u652f\u6301\u4e24\u4e2a\u76f8\u5bf9\u7684\u7aef\u53e3\uff0c\u82e5\u4f7f\u7528\u547d\u4ee4\u7aef\u53e3 ",(0,l.jsx)(r.code,{children:"n"}),"\uff0c\u5219\u6570\u636e\u7aef\u53e3\u4e3a ",(0,l.jsx)(r.code,{children:"n - 1"}),"\uff0c\u64cd\u4f5c\u7b80\u5355\uff0c\u7528\u4e8e\u5185\u7f51\u73af\u5883\u914d\u7f6e\u9632\u706b\u5899\u5341\u5206\u65b9\u4fbf\u3002\u88ab\u52a8\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u547d\u4ee4\u7aef\u53e3 21\uff0c\u6570\u636e\u7aef\u53e3\u5219\u968f\u673a\u5206\u914d\uff0c\u4f46\u6570\u636e\u7aef\u53e3\u7684\u8303\u56f4\u53ef\u4ee5\u914d\u7f6e\uff0c\u9632\u706b\u5899\u4e5f\u53ef\u4ee5\u914d\u7f6e\u76f8\u5e94\u7684\u7aef\u53e3\u8303\u56f4\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3b\u52a8\u6a21\u5f0f\uff08port \u6a21\u5f0f\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ea\u80fd\u7528\u4e8e\u5185\u7f51\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee"}),"\n",(0,l.jsx)(r.li,{children:"\u4ec5\u4f7f\u7528 21 \u4e0e 20 \u7aef\u53e3"}),"\n",(0,l.jsx)(r.li,{children:"\u53d1\u9001 ftp \u8bf7\u6c42\u65f6\uff0c\u7531\u5ba2\u6237\u7aef TCP \u8fde\u63a5\uff1b\u4f20\u8f93\u6570\u636e\u65f6\uff0cTCP \u8fde\u63a5\u7531\u670d\u52a1\u7aef\u53d1\u8d77"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604231848174",src:e(25130).A+"",width:"1108",height:"299"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u88ab\u52a8\u6a21\u5f0f\uff08pasv \u6a21\u5f0f\uff0c\u9ed8\u8ba4 / \u7f3a\u7701\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f7f\u7528\u9ad8\u7aef\u53e3"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240604231900952",src:e(77877).A+"",width:"1120",height:"296"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u533a\u522b\u4e0e\u8054\u7cfb\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6570\u636e\u4f20\u8f93\u6240\u7528\u7aef\u53e3\u4e0d\u540c\uff08\u56fa\u5b9a\u7aef\u53e3 VS \u968f\u673a\u9ad8\u7aef\u53e3\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u4e3b\u52a8\u6a21\u5f0f\u7531\u5ba2\u6237\u7aef\u7ecf 21 \u7aef\u53e3\u53d1\u8d77 TCP \u8bf7\u6c42"}),"\n",(0,l.jsx)(r.li,{children:"\u88ab\u52a8\u6a21\u5f0f\u7531\u5ba2\u6237\u7aef\u7ecf 21 \u7aef\u53e3\u53d1\u8d77\u547d\u4ee4\uff0c\u5f85\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u6253\u5f00\u4e00\u4e2a\u95f2\u7f6e\u7684\u9ad8\u7aef\u53e3\uff0c\u5e76\u544a\u77e5\u5ba2\u6237\u7aef\u8be5\u7aef\u53e3\uff0c\u7531\u5ba2\u6237\u7aef\u5411\u8be5\u9ad8\u7aef\u53e3\u53d1\u8d77 TCP \u8fde\u63a5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7406\u89e3\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e24\u79cd\u6a21\u5f0f\u4e0b\uff0c21\u7aef\u53e3\u90fd\u662f\u670d\u52a1\u5668\u59cb\u7ec8\u655e\u5f00\u7684\uff0c\u8fd9\u5c31\u597d\u50cf\u94f6\u884c\u7684\u5927\u95e8\u5728\u5de5\u4f5c\u65e5\u59cb\u7ec8\u5f00\u653e\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e0d\u540c\u7684\u662f\uff0c\u4e3b\u52a8\u6a21\u5f0f\u5c31\u50cf\u94f6\u884c\u53ea\u6709\u4e00\u4e2a\u4e1a\u52a1\u7a97\uff0c\u6bcf\u6b21\u5ba2\u6237\u90fd\u662f\u4ece\u94f6\u884c\u5927\u95e8\u8fdb\u53bb\uff0c\u8981\u529e\u4e1a\u52a1\u5c31\u53ea\u80fd\u5728\u540c\u4e00\u4e2a\u4e1a\u52a1\u7a97\u8fdb\u884c\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8bf7\u6ce8\u610f\uff0c20\u7aef\u53e3\u662f\u5ba2\u6237\u7aef\u7684\uff0c\u56e0\u6b64\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u4e1a\u52a1\u7a97\u672c\u6765\u5e94\u5f53\u662f\u6bcf\u4e2a\u5ba2\u6237\u81ea\u5df1\u5e26\u7740\u7684\uff0c\u4f46\u8fd9\u663e\u7136\u4e0d\u7b26\u5408\u5b9e\u9645\u3002\u867d\u7136\u8fd9\u4e2a\u4f8b\u5b50\u5e76\u4e0d\u5341\u5206\u51c6\u786e\uff0c\u4f46\u8db3\u4ee5\u8bf4\u660e\u7aef\u53e3\u5355\u4e00\u6240\u5e26\u6765\u7684\u9ebb\u70e6\uff0c\u800c\u4e14\u8fd9\u79cd\u51b2\u7a81\u4e5f\u4e0e\u65e9\u671f\u8ba1\u7b97\u673a\u5728\u5171\u4eab\u4e0a\u7f51\u6280\u672f\u4e0a\uff0c\u7531\u4e8e\u516c\u7f51\u8f6c\u6362\u6240\u5e26\u6765\u7684\u65e0\u6cd5\u51c6\u786e\u8bc6\u522b\u5bf9\u5e94\u5ba2\u6237\u7684 20 \u7aef\u53e3\u7684\u95ee\u9898\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u5c31\u597d\u6bd4\u6211\u5728\u5bb6\u6709\u4e00\u4e2a 20 \u7aef\u53e3\uff0c\u4f60\u5728\u5bb6\u4e5f\u6709\u4e00\u4e2a 20 \u7aef\u53e3\uff0c\u800c\u6211\u4eec\u5148\u540e\u5230\u94f6\u884c\uff0c\u540c\u4e00\u95f4\u94f6\u884c\u4ee3\u8868\u6211\u4eec\u7684\u76ee\u7684\u5730\u76f8\u540c\uff0c\u800c\u8fd9\u4e2a\u76ee\u7684\u5730\u88ab\u8f6c\u6362\u4e3a\u540c\u4e00\u4e2a\u516c\u7f51 IP\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u6309\u7167\u8bbe\u8ba1\uff0c\u6211\u4eec\u672c\u8eab\u90fd\u4e0d\u9700\u8981\u6392\u961f\uff0c\u4f46\u7531\u4e8e\u670d\u52a1\u7a97\u53e3\u53ea\u6709\u4e00\u4e2a\uff0c\u6211\u4eec\u4ea7\u751f\u4e86\u8bbe\u8ba1\u4ee5\u5916\u7684\u6392\u961f\u7b49\u5f85\u884c\u4e3a\uff0c\u8fd9\u79cd\u610f\u5916\u5c31\u76f8\u5f53\u4e8e\u7ed9\u8ba1\u7b97\u673a\u4e0b\u4e86\u4e00\u4e2a\u6709\u6b67\u4e49\u7684\u547d\u4ee4\uff0c\u8fd9\u76f4\u63a5\u8fdd\u80cc\u4e86\u8ba1\u7b97\u673a\u7684\u9876\u5c42\u8bbe\u8ba1\uff0c\u81ea\u7136\u5730\uff0c\u547d\u4ee4\u5c31\u4e0d\u4f1a\u6267\u884c\u4e86\u3002\u5f53\u7136\uff0c\u4e5f\u53ef\u80fd\u4f1a\u6267\u884c\uff0c\u4f46\u53ef\u80fd\u4ea7\u751f\u672a\u5b9a\u4e49\u7684\u884c\u4e3a\uff0c\u5bfc\u81f4\u610f\u5916\u7684\u53d1\u751f\u3002\u800c\u8fd9\u79cd\u6a21\u5f0f\uff0c\u5e76\u4e0d\u9002\u5408\u5171\u4eab\u4e0a\u7f51\u7684\u73af\u5883\uff0c\u4e8e\u662f\u8bde\u751f\u4e86\u88ab\u52a8\u6a21\u5f0f"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u88ab\u52a8\u6a21\u5f0f\u5c31\u50cf\u94f6\u884c\u7531\u5f88\u591a\u4e2a\u4e1a\u52a1\u7a97\uff0c\u6bcf\u6b21\u5ba2\u6237\u4e0d\u5149\u53ef\u4ee5\u8fdb\u5165\u94f6\u884c\uff0c\u800c\u4e14\u53ef\u4ee5\u5728\u95e8\u53e3\u53d6\u4e2a\u53f7\uff0c\u5c31\u80fd\u77e5\u9053\u81ea\u5df1\u8be5\u53bb\u54ea\u4e2a\u4e1a\u52a1\u7a97\u6392\u961f\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e3b\u52a8\u6a21\u5f0f\u4e0e\u88ab\u52a8\u6a21\u5f0f\u7684\u539f\u7406\uff0c",(0,l.jsx)(r.strong,{children:"\u4e00\u5b9a\u8981\u641e\u6e05\u695a"}),"\uff0c\u5426\u5219\u5f88\u591a\u95ee\u9898\u4f1a\u60f3\u4e0d\u660e\u767d\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8fd8\u662f\u6ca1\u6709\u7406\u89e3\u4e3b\u52a8\u6a21\u5f0f\u4e0e\u88ab\u52a8\u6a21\u5f0f\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u4f20\u8f93\u65b9\u5f0f\u5bf9\u5e94\u7684\u56fe\u7684\u5173\u7cfb\u3002"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u5982\u4f55\u7406\u89e3 TCP \u8bf7\u6c42\u5728 ftp \u4f20\u8f93\u5f53\u4e2d\u7684\u89d2\u8272\uff1f\u4e3a\u4ec0\u4e48\u662f TCP \u8fde\u63a5\uff0c\u800c\u4e0d\u662f\u522b\u7684\uff1fftp \u6ca1\u6709\u81ea\u5df1\u7684\u4f20\u8f93\u8fde\u63a5\u5bf9\u8c61\u5417\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"TCP \u662f\u4f20\u8f93\u5c42\u534f\u8bae\uff0c\u800c ftp \u662f\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u524d\u8005\u4e3a\u540e\u8005\u63d0\u4f9b\u53ef\u9760\u3001\u6709\u5e8f\u7684\u6570\u636e\u4f20\u8f93\uff0c\u5373\u540e\u8005\u4f9d\u8d56\u4e8e\u524d\u8005\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["FTP\u672c\u8eab\u662f\u5e94\u7528\u5c42\u534f\u8bae\uff0c",(0,l.jsx)(r.strong,{children:"\u6ca1\u6709\u72ec\u7acb\u7684\u4f20\u8f93\u673a\u5236"}),"\u3002\u5b83\u4f9d\u8d56\u4e8eTCP\u63d0\u4f9b\u7684\u4f20\u8f93\u670d\u52a1\u3002ftp \u4f7f\u7528 TCP \u8fde\u63a5\u6765\u5b9e\u73b0\u547d\u4ee4\u901a\u9053\u548c\u6570\u636e\u901a\u9053\u7684\u4f20\u8f93\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u65e2\u7136 ftp \u4f7f\u7528\u4e86 TCP \u8fde\u63a5\uff0c\u8fd9\u662f\u5426\u53ef\u4ee5\u8bf4 ftp \u76f8\u5f53\u4e8e\u4e00\u79cd\u7279\u6b8a\u7684 TCP \u534f\u8bae\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\u3002TCP \u63d0\u4f9b\u53ef\u9760\u7684\u4f20\u8f93\uff0c\u800c ftp \u5b9a\u4e49\u4e86\u6587\u4ef6\u4f20\u8f93\u7684\u5177\u4f53\u64cd\u4f5c\u548c\u683c\u5f0f\u3002\u4f46\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5b83\u4eec\u6240\u5904\u7684\u534f\u8bae\u5c42\u7ea7\u4e0d\u540c\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/04 23:54:02\uff0c2024/06/05 17:13:13\uff0cGPT \u7b54\u7591"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"63-\u624b\u5de5\u6267\u884cftp\u547d\u4ee4",children:"63 \u624b\u5de5\u6267\u884cftp\u547d\u4ee4"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6982\u62ec"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u672c\u8282\u4ecb\u7ecd\u4e86 ftp \u7684\u5e38\u7528\u547d\u4ee4\uff0c\u6f14\u793a\u4e86\u5982\u4f55\u767b\u5f55 ftp \u670d\u52a1\u5668\u3001\u5982\u4f55\u64cd\u4f5c\u5de5\u4f5c\u76ee\u5f55\uff0c\u4ee5\u53ca\u5982\u4f55\u4e0b\u8f7d\u4e0e\u4e0a\u4f20\u6587\u4ef6\uff0c\u5e76\u4e14\u7b80\u8981\u6d4b\u8bd5\u4e86 Linux \u4e0b\u7684 ftp \u4e0e Windows \u4e0b\u7684 ftp \u7684\u64cd\u4f5c\u3002\u6d89\u53ca\u7684\u5185\u5bb9\u5747\u53ef\u6839\u636e\u8bfe\u7a0b\u6587\u6863\u8fdb\u884c\u5b9e\u9a8c\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6d4b\u8bd5"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f7f\u7528\u4e91\u670d\u52a1\u5668\u4e0e\u672c\u5730\u670d\u52a1\u5668\u8fdb\u884c ftp \u8fde\u63a5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"ftp \u7528\u6237\uff08\u7f3a\u7701\u4e0b\uff0c\u7528\u6237\u540d/\u5bc6\u7801\u540c\u5f53\u524d OS \u7684\u7528\u6237\u540d/\u5bc6\u7801\uff09"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u767b\u5f55\u670d\u52a1\u5668"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u8f93\u5165\u865a\u62df\u673aIP --\x3e \u63d0\u793a Linux \u7528\u6237\u540d + \u5bc6\u7801 --\x3e \u767b\u5f55\uff08\u4e09\u79cd\u65b9\u5f0f\u5982\u4e0b\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240605194103282",src:e(20131).A+"",width:"621",height:"183"})}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240605194810999",src:e(13379).A+"",width:"627",height:"199"})}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240605195031523",src:e(51180).A+"",width:"617",height:"167"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u767b\u5f55\u3001\u76ee\u5f55\u3001\u6587\u4ef6\u76f8\u5173\u6307\u4ee4\u8c03\u8bd5"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"## \u767b\u5f55\u670d\u52a1\u5668\r\nzsh$ ftp 192.168.20.150\t\t# \u65b9\u6cd5\u4e00\r\nftp> open 192.168.20.150 \t# \u65b9\u6cd5\u4e8c\r\nzsh$ftp -n 192.168.20.150 \t# \u65b9\u6cd5\u4e09\r\nftp> user oracle pwd_oracle\r\n\r\n# \u9000\u51fa ftp \u670d\u52a1\u5668\r\nftp> quit\r\n\r\n\r\n## \u5207\u6362\u5de5\u4f5c\u76ee\u5f55\r\n# \u67e5\u770b\u670d\u52a1\u5668\u5de5\u4f5c\u76ee\u5f55\r\nftp> pwd\r\n\r\n# \u5207\u6362\u670d\u52a1\u5668\u5de5\u4f5c\u76ee\u5f55\r\nftp> cd dir_path\r\n\r\n# \u5207\u6362\u672c\u5730\u5de5\u4f5c\u76ee\u5f55\r\nftp> lcd dir_path\r\n\r\n\r\n## \u67e5\u770b\u670d\u52a1\u5668\u7684\u76ee\u5f55\u548c\u6587\u4ef6\r\nftp> ls dir_name | file_name\r\nftp> dir dir_name | file_name\r\n\r\n# \u5217\u51fa\u76ee\u5f55\u4e0b\u7684\u5339\u914d\u6587\u4ef6\u540d *.h \u7684\u4fe1\u606f\uff0c\u53ef\u91cd\u5b9a\u5411\u8f93\u51fa\u5230\u6587\u4ef6\r\nftp> nlist dir_name/*.h\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"FTP \u6587\u4ef6\u4f20\u8f93\u6a21\u5f0f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e8c\u8fdb\u5236\u6a21\u5f0f\uff1a\u4efb\u4f55\u6587\u4ef6\uff08\u538b\u7f29\u5305\u3001\u53ef\u6267\u884c\u7a0b\u5e8f\u3001\u56fe\u7247\u3001\u89c6\u9891\u3001\u97f3\u9891\u2026 --\x3e \u5b9e\u9645\u5f00\u53d1\u4f7f\u7528\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["ASCII \u7801\u6a21\u5f0f\uff1a\u4ec5\u652f\u6301 ",(0,l.jsx)(r.code,{children:".txt"}),"\u3001",(0,l.jsx)(r.code,{children:".html"})," \u7b49 ASCII \u7801\u6587\u4ef6\uff08\u6587\u4ef6\u6587\u4ef6\uff09"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# \u67e5\u770b\u5f53\u524d\u4f20\u8f93\u6a21\u5f0f\r\nftp> type\r\n\r\n# \u5207\u6362\u4f20\u8f93\u6a21\u5f0f\r\nftp> bin\r\nftp> ascii\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f20\u8f93\u6a21\u5f0f\u5207\u6362"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606181229135",src:e(72912).A+"",width:"646",height:"182"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"Windows \u4f7f\u7528 ftp \u8bbf\u95ee\u865a\u62df\u673a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8bbf\u95ee\u65b9\u5f0f\u4e0e\u5c40\u57df\u7f51\u5185\u5176\u4ed6\u53ef\u53d1\u73b0\u8bbe\u5907\u4e00\u81f4\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u8f93\u5165 ",(0,l.jsx)(r.code,{children:"ftp://192.168.20.150/"})]}),"\n",(0,l.jsx)(r.li,{children:"\u63d0\u793a\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff08\u7f3a\u7701\u4e3a Ubuntu \u865a\u62df\u673a\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u767b\u5f55\u6210\u529f\uff0c\u53ef\u4ee5\u770b\u5230\u767b\u5f55\u5728\u865a\u62df\u673a\u7684 ",(0,l.jsx)(r.code,{children:"/home/celfs"})," \u8def\u5f84"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606181933931",src:e(20954).A+"",width:"821",height:"408"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6d4b\u8bd5\u6587\u4ef6\u64cd\u4f5c\u6743\u96501\uff08\u4e3b\u673a --\x3e \u62d6\u52a8\u6587\u4ef6 --\x3e \u865a\u62df\u673a | \u6743\u9650\u4e0d\u8db3 | \u5df2\u89e3\u51b3\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606182254165",src:e(81180).A+"",width:"480",height:"247"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6d4b\u8bd5\u6587\u4ef6\u64cd\u4f5c\u6743\u96502\uff08\u865a\u62df\u673a--\x3e \u62d6\u52a8\u6587\u4ef6 --\x3e \u4e3b\u673a | \u6743\u9650\u6ee1\u8db3\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606182439282",src:e(89837).A+"",width:"704",height:"460"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u6587\u4ef6\u7684\u53cc\u5411\u4f20\u8f93\uff08\u672a\u5b9e\u73b0\uff0c\u5f85\u5904\u7406\uff0c\u53ef\u53c2\u8003 Electerm \u7684 Sftp\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u80fd\u9700\u8981\u5728\u865a\u62df\u673a\u7cfb\u7edf\u5f00\u653e\u76f8\u5e94\u7684\u8bbf\u95ee\u4e0e\u6587\u4ef6\u64cd\u4f5c\u6743\u9650\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u53ef\u80fd\u4ec5\u9700\u8981\u5728\u865a\u62df\u673a\u7684 ftp \u670d\u52a1\u5668\u8bbe\u7f6e\u76f8\u5e94\u6743\u9650\uff1b"}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.del,{children:"\u53ef\u80fd\u4ec5\u9700\u8981\u5efa\u7acb\u4e3b\u673a\u4e0e\u865a\u62df\u673a\u7684 ftp \u8fde\u63a5\uff0c\u800c\u4e0d\u7528\u4e0a\u8ff0\u8bbf\u95ee\u65b9\u5f0f\uff1b"})}),"\n",(0,l.jsx)(r.li,{children:"\u53ef\u80fd\u4ec5\u9700\u8981\u5207\u6362\u4e3a root \u7528\u6237\u8bbf\u95ee\uff1b"}),"\n",(0,l.jsxs)(r.li,{children:["\u62a5\u9519\u4fe1\u606f \uff1a",(0,l.jsx)(r.code,{children:"200, 227, 550"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u95ee\u9898\u89e3\u51b3"}),"\uff08\u4fee\u6539\u5199\u5165\u6743\u9650\u5373\u53ef | \u9ed8\u8ba4\u6ce8\u91ca\uff0c\u5373\u5173\u95ed\u5199\uff09"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"sudo vim /etc/vsftpd.conf\n"})}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606185004318",src:e(59466).A+"",width:"647",height:"147"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5199\u5165\u6210\u529f"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606185310951",src:e(29021).A+"",width:"821",height:"510"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Windows \u547d\u4ee4\u884c\u6a21\u5f0f ftp \u8fde\u63a5"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606192038149",src:e(13929).A+"",width:"683",height:"200"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ece\u670d\u52a1\u7aef\u4e0b\u8f7d\u6587\u4ef6\u5230\u4e3b\u673a"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606192403133",src:e(5563).A+"",width:"788",height:"295"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ece\u4e3b\u673a\u672c\u5730\u76ee\u5f55\u4e0a\u4f20\u6587\u4ef6\u5230\u670d\u52a1\u7aef"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240606200519630",src:e(23378).A+"",width:"666",height:"163"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6d4b\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u591a\u7aef\u5f00\u542f ftp \u8bbf\u95ee\uff08\u4e3b\u673a\u3001\u672c\u5730\u670d\u52a1\u5668\u540c\u65f6\u8bbf\u95ee\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u65e0\u6cd5\u4ece\u865a\u62df\u673a\u5185\u90e8 ftp \u5230\u4e3b\u673a ",(0,l.jsx)(r.code,{children:"ftp: connect: Connection refused"})," \uff08\u95ee\u9898\u672a\u89e3\u51b3\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u547d\u4ee4\u884c\u8fde\u63a5\uff0c\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"lcd"})," \u53cc\u5411\u4f20\u8f93\u6587\u4ef6"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"ftp \u64cd\u4f5c\u6743\u9650"}),"\uff08\u7ecf\u9a8c\u8bc1\uff0c\u4e0a\u8ff0\u95ee\u9898\u7531\u7528\u6237\u6743\u9650\u5bfc\u81f4\uff0c\u6dfb\u52a0\u5199\u5165\u6743\u9650\u5373\u53ef\u89e3\u51b3\uff09"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5bf9",(0,l.jsx)(r.strong,{children:"\u672c\u5730"}),"\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u64cd\u4f5c\u6743\u9650\uff0c\u7531\u6267\u884c ftp \u547d\u4ee4\u7684\u7528\u6237\u6743\u9650\u51b3\u5b9a\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5bf9",(0,l.jsx)(r.strong,{children:"\u670d\u52a1\u7aef"}),"\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u64cd\u4f5c\u6743\u9650\uff0c\u7531",(0,l.jsx)(r.strong,{children:"\u767b\u5f55\u7528\u6237\u7684\u6743\u9650"}),"\u51b3\u5b9a\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4e0b\u8f7d\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5355\u6587\u4ef6\u4e0b\u8f7d\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"get"})," \u6216 ",(0,l.jsx)(r.code,{children:"recv"})," \u7b49\u4ef7"]}),"\n",(0,l.jsxs)(r.li,{children:["\u6587\u4ef6\u4e0d\u5141\u8bb8\u901a\u914d\u7b26\uff0c\u5982 ",(0,l.jsx)(r.code,{children:"*, ?"})]}),"\n",(0,l.jsx)(r.li,{children:"\u8def\u5f84\u7f3a\u7701\uff0c\u8868\u793a\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\uff1b\u6587\u4ef6\u540d\u7f3a\u7701\uff0c\u8868\u793a\u540c\u540d"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u591a\u6587\u4ef6\u4e0b\u8f7d\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"mget"})," \uff08\u5b9e\u9645\u5f00\u53d1\u57fa\u672c\u4e0d\u7528\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u652f\u6491\u901a\u914d\u7b26"}),"\n",(0,l.jsx)(r.li,{children:"\u9ed8\u8ba4\u5b58\u5230\u4e8e\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\uff0c\u5404\u6587\u4ef6\u4e00\u4e00\u63d0\u793a\uff0c\u53ef\u5173\u95ed\u63d0\u793a"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# \u4e0b\u8f7d\u5355\u4e2a\u6587\u4ef6\uff0c\u7b49\u4ef7\u8bed\u6cd5\u5982\u4e0b\r\nget /home/celfs/test.cpp /home/celfs/ttdir/ok.cpp\r\nrecv /home/celfs/test.cpp /home/celfs/ttdir/ok.cpp\r\n\r\n# \u4e0b\u8f7d\u591a\u4e2a\u6587\u4ef6\uff0c\u4e00\u4e00\u63d0\u793a\r\nmget \u670d\u52a1\u7aef\u6587\u4ef61 \u670d\u52a1\u7aef\u6587\u4ef62 \u670d\u52a1\u7aef\u6587\u4ef63 \u2026\u2026 \u670d\u52a1\u7aef\u6587\u4ef6n\r\n# \u5173\u95ed\u63d0\u793a\r\nprompt\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e0a\u4f20\u6587\u4ef6\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5355\u6587\u4ef6\u4e0a\u4f20\uff08\u89c4\u5219\u4e0e\u4e0b\u8f7d\u4e00\u81f4\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# \u4e0a\u4f20\u5355\u4e2a\u6587\u4ef6\uff0c\u7b49\u4ef7\u8bed\u6cd5\u5982\u4e0b\r\nput /home/celfs/test.cpp /home/celfs/ttdir/ok.cpp\r\nsend /home/celfs/test.cpp /home/celfs/ttdir/ok.cpp\r\n\r\n# \u4e0a\u4f20\u591a\u4e2a\u6587\u4ef6\uff0c\u4e00\u4e00\u63d0\u793a\r\nmput \u672c\u5730\u6587\u4ef61 \u672c\u5730\u6587\u4ef62 \u672c\u5730\u6587\u4ef63 \u2026\u2026 \u672c\u5730\u6587\u4ef6n\r\n# \u5173\u95ed\u63d0\u793a\r\nprompt\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5176\u4ed6 ftp \u547d\u4ee4\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\u30012\u30014 \u5e38\u7528"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"# 1\uff09\u91cd\u547d\u540dftp\u670d\u52a1\u7aef\u7684\u6587\u4ef6\r\nrename \u65e7\u6587\u4ef6\u540d \u65b0\u6587\u4ef6\u540d\r\n\r\n# 2\uff09\u5220\u9664ftp\u670d\u52a1\u7aef\u4e0a\u5355\u4e2a\u6587\u4ef6\r\ndelete \u6587\u4ef6\u540d\r\n\r\n# 3\uff09\u5220\u9664ftp\u670d\u52a1\u7aef\u7684\u591a\u4e2a\u6587\u4ef6\u3002\r\nmdelete \u6587\u4ef6\u540d1 \u6587\u4ef6\u540d2 \u6587\u4ef6\u540d3 \u2026\u2026 \u6587\u4ef6\u540dn\r\n\r\n# 4\uff09\u5728ftp\u670d\u52a1\u7aef\u4e0a\u521b\u5efa\u76ee\u5f55\u3002\r\nmkdir pathname\r\n\r\n# 5\uff09\u5220\u9664ftp\u670d\u52a1\u7aef\u4e0a\u7684\u76ee\u5f55\u3002\r\nrmdir pathname\r\n\r\n# 6\uff09\u5207\u6362\u4f20\u8f93\u6a21\u5f0f\u3002\r\npassive\r\n\r\n# 7\uff09\u663e\u793a\u5e2e\u52a9\u4fe1\u606f\u3002\r\nhelp [\u547d\u4ee4\u540d]\r\n# \u663e\u793aftp\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f\uff0c\u5982\u679c\u4e0d\u8f93\u5165\u547d\u4ee4\u540d\uff0c\u5219\u663e\u793a\u5168ftp\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f\u3002\r\n\r\n# 8\uff09\u9000\u51faftp\u3002\r\nbye\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5ef6\u4f38 / \u611f\u609f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u53f0\u865a\u62df\u673a\uff0c\u5728\u5176\u4e2d\u533a\u5206\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u53ef\u4ee5\u5c1d\u8bd5\u865a\u62df\u673a\u4e0e\u672c\u673a\u7cfb\u7edf ftp \u8fde\u63a5\uff0c\u5e76\u4e14\u5c1d\u8bd5\u5b9e\u73b0\u865a\u62df\u673a\u7684\u6587\u4ef6\u5171\u4eab\u529f\u80fd\uff1f"}),"\n",(0,l.jsx)(r.li,{children:"Electerm \u8fd9\u4e2a shell\uff0c\u4f7f\u7528\u7684 Sftp \u8fdb\u884c\u4f20\u8f93\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u901a\u8fc7 ftp \u76f4\u63a5\u8bbf\u95ee\u865a\u62df\u673a\uff0c\u53d1\u73b0\u6570\u636e\u4f20\u8f93\u662f\u591a\u4e48\u7684\u4fbf\u6377\uff0c\u5c31\u597d\u50cf\u6253\u5f00\u4e86\u4e00\u5ea7\u7262\u7b3c\u7684\u901a\u9053\u3002\u539f\u672c\u4ee5\u4e3a\u865a\u62df\u673a\u4e0e\u4e3b\u673a\u7684\u8d44\u6e90\u8bbf\u95ee\u5f88\u9ebb\u70e6\uff0c\u73b0\u5728\u770b\u6765\uff0c\u5341\u5206\u4fbf\u6377\u3002\u4f46\u8fd9\u53ea\u662f\u6253\u5f00\u4e86\u7aef\u53e3\uff0c\u6587\u4ef6\u64cd\u4f5c\u6743\u9650\u4e0d\u4e00\u5b9a\u6b63\u786e\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6d4b\u8bd5\u6587\u4ef6\u53ef\u7528 ",(0,l.jsx)(r.code,{children:"/tmp/filename"})," \u8def\u5f84\uff0c\u56e0\u4e3a\u4f1a\u5b9a\u671f\u6e05\u7406\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48 \u201croot\u7528\u6237\u7684\u6743\u9650\u8fc7\u5927\uff0c\u4e0d\u5141\u8bb8\u767b\u5f55 ftp \u670d\u52a1\u5668\u201d \uff1f\u907f\u514d\u8d8a\u6743\u8bbf\u95ee\u5230\u7cfb\u7edf\u91cd\u8981\u6587\u4ef6\uff0c\u4ece\u800c\u786e\u4fdd\u4f20\u8f93\u901a\u9053\u5b89\u5168\uff1f"}),"\n",(0,l.jsx)(r.li,{children:"ftp \u7684 timeout \u9ed8\u8ba4\u503c\u4e3a\u591a\u5c11\uff1f\u4e3a\u4ec0\u4e48\u8981\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff1f\u8003\u8651\u5230 ftp \u4f20\u8f93\u673a\u5236\u57fa\u4e8e TCP\uff0c\u662f\u5426\u610f\u5473\u7740\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u4e3a 2MSL\uff1f\u5176\u4f20\u8f93\u884c\u4e3a\u662f\u5426\u90fd\u4e0e TCP \u4e00\u81f4\uff1f"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["ftp ",(0,l.jsx)(r.code,{children:"Timeout"})," \u4e4b\u540e\uff0c\u5982\u4f55\u91cd\u65b0\u767b\u5f55\uff1f\u5fc5\u987b\u8981\u9000\u51fa ftp \u5417\uff1f"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5e76\u4e0d\u9700\u8981\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\uff0c\u767b\u5f55 ftp \u670d\u52a1\u5668\u7684\u65b9\u5f0f\u6709\u4e09\u79cd\u3002\u4ec5\u9700\u4f7f\u7528\u5df2\u8fdb\u5165 ftp \u670d\u52a1\u5668\u754c\u9762\u7684\u767b\u5f55\u8bed\u53e5\uff0c\u91cd\u65b0 ",(0,l.jsx)(r.code,{children:"open IP"})," \u767b\u5f55\u5373\u53ef\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u662f\u5426\u6709\u66f4\u597d\u7684 shell \u6765\u63a7\u5236 ftp \u670d\u52a1\u5668\uff1f\u7c7b\u4f3c MySQL \u7684\u4ee3\u7801\u8865\u5168 shell\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4ec0\u4e48\u4f1a\u6709 ",(0,l.jsx)(r.code,{children:"lcd"})," \u8fd9\u79cd\u76ee\u5f55\u5207\u6362\u6a21\u5f0f\uff1f\u5bf9\u6bd4 ftp \u4e2d\u7684 ",(0,l.jsx)(r.code,{children:"cd"})," \u6709\u4f55\u533a\u522b\uff1f\u6b64\u65f6\u7684 \u201c\u670d\u52a1\u5668\u201d \u4e0e \u201c\u672c\u5730\u201d\uff0c\u5206\u522b\u6307\u7684\u662f\u54ea\u4e2a\u5bf9\u8c61\uff1f"]}),"\n",(0,l.jsx)(r.li,{children:"ftp \u8bb0\u5f55\u4e86\u767b\u5f55\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u4f55\u5207\u6362 root \u7528\u6237\u91cd\u65b0\u767b\u5f55\uff1f"}),"\n",(0,l.jsxs)(r.li,{children:["ftp \u7684\u6587\u4ef6\u4e0b\u8f7d\u4e0e\u4e0a\u4f20\uff0c\u4e4b\u6240\u4ee5\u6709 ",(0,l.jsx)(r.code,{children:"recv"})," \u548c ",(0,l.jsx)(r.code,{children:"send"}),"\uff0c\u79bb\u4e0d\u5f00 ",(0,l.jsx)(r.code,{children:"socket"})," \u5e95\u5c42\u5b9e\u73b0\u7684\u8fd9\u4e24\u4e2a\u51fd\u6570\uff1f\u4e5f\u56e0\u4e3a\u57fa\u4e8e TCP \u8fde\u63a5\u7684\u4f20\u8f93\uff0c\u65b9\u6cd5\u4e00\u6837\u5c31\u4e0d\u5947\u602a\u4e86\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u524d\u9762\u89e3\u51b3\u4e86\u5c0f\u6587\u4ef6\uff08\u4f8b\u5982\u4e00\u4e2a ",(0,l.jsx)(r.code,{children:".txt"}),"\uff09\u7684\u4e0a\u4f20\u4e0e\u4e0b\u8f7d\u6743\u9650\u95ee\u9898\uff0c\u5982\u4eca\u5728\u4e0a\u4f20 Oracle \u5305\u65f6\uff0c\u51fa\u73b0\u4e86\u53e6\u5916\u7684\u6743\u9650\u95ee\u9898 ",(0,l.jsx)(r.code,{children:"451"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/05 17:35:40\uff0c2024/06/05 19:51:45"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/06 19:31:03\uff0c\u591a\u79cd\u4ee3\u7801\u5b9e\u73b0\uff0c\u6d4b\u8bd5 ftp \u53cc\u5411\u4f20\u8f93\uff0cdebug \u7b49"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"64-\u5c01\u88c5ftp\u5ba2\u6237\u7aef",children:"64 \u5c01\u88c5ftp\u5ba2\u6237\u7aef"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u80cc\u666f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["FTP \u534f\u8bae\u6700\u5e95\u5c42\u662f TCP \u62a5\u6587\uff0c\u4f46\u5982\u679c\u4ece ",(0,l.jsx)(r.code,{children:"socket"})," \u5f00\u59cb\u7f16\u7a0b\uff0c\u5de5\u4f5c\u91cf\u5de8\u5927\u3002\u56e0\u6b64\uff0c\u597d\u7684\u529e\u6cd5\u662f\u5bfb\u627e FTP \u5ba2\u6237\u7aef\u7684\u5f00\u6e90\u5e93\uff08 ",(0,l.jsx)(r.code,{children:"ftplib"})," \uff09\uff0c\u5c01\u88c5\u6210\u7b80\u5355\u6613\u7528\u7684\u7c7b ",(0,l.jsx)(r.code,{children:"cftp"})," \u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6982\u62ec"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6f14\u793a\u4e86\u5982\u4f55\u4ece\u4e0b\u8f7d\u5f00\u6e90\u6587\u4ef6\u5230\u4e00\u6b65\u6b65\u5c01\u88c5\u7684\u8fc7\u7a0b\u3002\u5f3a\u8c03\u8981\u6293\u91cd\u70b9\u6765\u4f7f\u7528\u5f00\u6e90\u5e93\uff0c\u7528\u8d77\u6765\uff0c\u800c\u4e0d\u5fc5\u641e\u6e05\u695a\u6bcf\u4e2a\u7ec6\u8282\u3002\u4ecb\u7ecd\u4e86\u5c01\u88c5\u7684\u7ec6\u8282\uff0c\u601d\u8def\u662f\u5c06\u7ed3\u6784\u4f53\u4e0e\u82e5\u5e72\u529f\u80fd\u51fd\u6570\u6574\u5408\u8d77\u6765\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ecb\u7ecd FTP \u53ca\u54cd\u5e94\u7801"}),"\n",(0,l.jsxs)(r.li,{children:["\u67e5\u627e\u5f00\u6e90\u5e93 ",(0,l.jsx)(r.code,{children:"ftplib"})," \uff08C \u8bed\u8a00\u7248\u672c\u6f14\u793a\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"makefile"})," \u5c06\u5176\u7f16\u8bd1\u4e3a\u9759\u6001\u5e93\u4e0e\u52a8\u6001\u5e93"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5c01\u88c5\u4e3a ",(0,l.jsx)(r.code,{children:".cpp"})," \uff08\u4e09\u4e2a demo\uff0c",(0,l.jsx)(r.strong,{children:"\u5148\u6d4b\u8bd5\u529f\u80fd\uff0c\u641e\u61c2\u7528\u6cd5\uff0c\u4e0d\u7ba1\u7ec6\u8282"}),"\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["demo50\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6f14\u793a\u4e86\u83b7\u53d6 FTP \u670d\u52a1\u7aef\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4ee5\u53ca\u6587\u4ef6\u65f6\u95f4\u4e0e\u5927\u5c0f"}),"\n",(0,l.jsxs)(r.li,{children:["\u56db\u4e2a\u6210\u5458\u51fd\u6570 ",(0,l.jsx)(r.code,{children:".login(), .nlist(), .mtime(), .size()"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["demo51\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6f14\u793a\u4e86\u91c7\u7528\u5f00\u53d1\u6846\u67b6 ",(0,l.jsx)(r.code,{children:"cftpclient"})," \u7c7b\u4e0a\u4f20\u6587\u4ef6"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4f7f\u7528\u6210\u5458\u51fd\u6570 ",(0,l.jsx)(r.code,{children:".login(), .mkdir(), .chdir(), .put()"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["demo52\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6f14\u793a\u4e86\u91c7\u7528\u5f00\u53d1\u6846\u67b6 ",(0,l.jsx)(r.code,{children:"cftpclient"})," \u7c7b\u4e0b\u8f7d\u6587\u4ef6"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4f7f\u7528\u6210\u5458\u51fd\u6570 ",(0,l.jsx)(r.code,{children:".login(), .get()"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4ecb\u7ecd ",(0,l.jsx)(r.code,{children:"ftplib.h"})," \u3001 ",(0,l.jsx)(r.code,{children:"_ftp.h"})," \u53ca ",(0,l.jsx)(r.code,{children:"_ftp.cpp"})," \u7684\u5c01\u88c5\u7ec6\u8282\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u652f\u6301 Linux \u53ca Windows"}),"\n",(0,l.jsx)(r.li,{children:"\u91cd\u70b9\uff08\u4e00\u4e2a\u7ed3\u6784\u4f53 + \u4e00\u4e9b\u51fd\u6570 --\x3e \u6574\u5408\u5373\u5c01\u88c5\u601d\u8def\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u8be6\u7ec6\u4ecb\u7ecd ",(0,l.jsx)(r.code,{children:"get"})," \u53ca ",(0,l.jsx)(r.code,{children:"put"})," \u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"bcheckmtime"})," \u53c2\u6570\u901a\u8fc7\u68c0\u67e5\u4f20\u8f93\u524d\u540e\u65f6\u95f4\uff0c\u6821\u9a8c\u6587\u4ef6\u5b8c\u6574\u6027\uff08\u4e0b\u8f7d\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"bchecksize"})," \u53c2\u6570\u6838\u5bf9\u6587\u4ef6\u5927\u5c0f\uff0c\u6821\u9a8c\u6587\u4ef6\u5b8c\u6574\u6027\uff08\u4e0a\u4f20\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u4e0b\u8f7d\u8fc7\u7a0b\u4e2d\uff0c\u751f\u6210\u672c\u5730\u6587\u4ef6\u7684\u4e34\u65f6\u6587\u4ef6\u540d\uff08\u9632\u6b62\u4e0b\u8f7d\u9014\u4e2d\u88ab\u8bfb\u53d6\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u4f20\u8f93\u5b8c\u6210 --\x3e \u4fee\u6539\u6587\u4ef6\u65f6\u95f4 --\x3e \u6587\u4ef6\u6b63\u5f0f\u547d\u540d"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u5206\u6790"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u8def\u5f84"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"ftplib.h"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ee3\u7801\u89c4\u6a21\uff1a121 Line"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3b\u8981\u5185\u5bb9\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u517c\u5bb9\u6027\uff1a",(0,l.jsx)(r.code,{children:"__unix__"})," \u548c ",(0,l.jsx)(r.code,{children:"_WIN32"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ed3\u6784\u4f53\uff1a",(0,l.jsx)(r.code,{children:"netbuf"})]}),"\n",(0,l.jsx)(r.li,{children:"1\uff09\u5b9a\u4e49\u4e86\u4e00\u4e9b\u4ee3\u7801\u7248\u672c\u5206\u652f\u517c\u5bb9\u7684\u8bed\u53e5\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"2\uff09\u58f0\u660e\u4e86\u82e5\u5e72\u529f\u80fd\u51fd\u6570\u6240\u9700\u7684\u5b8f\u5b9a\u4e49\u53c2\u6570\uff0c\u4f8b\u5982\u8bbf\u95ee\u7c7b\u578b\u3001\u8bbf\u95ee\u6a21\u5f0f\u3001\u8fde\u63a5\u6a21\u5f0f\u3001\u8fde\u63a5\u9009\u9879\u540d\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"3\uff09\u58f0\u660e\u4e86\u82e5\u5e72 FTP \u529f\u80fd\u51fd\u6570\uff0c\u5305\u62ec\u521d\u59cb\u5316\u3001\u54cd\u5e94\u3001\u8fde\u63a5\u3001\u56de\u8c03\u3001\u767b\u5f55\u3001\u8bbf\u95ee\u3001\u6587\u4ef6\u8bfb\u5199\u3001\u76ee\u5f55\u5207\u6362\u3001\u76ee\u5f55\u67e5\u9605\u3001\u5b8c\u6574\u6027\u6821\u9a8c\u3001\u4e0a\u4f20\u4e0b\u8f7d\u3001\u91cd\u547d\u540d\u3001\u5220\u9664\u3001\u9000\u51fa\u7b49\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"ftplib.c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ee3\u7801\u89c4\u6a21\uff1a1456 Line"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3b\u8981\u5185\u5bb9\uff08\u5177\u4f53\u5b9e\u73b0\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u517c\u5bb9\u6027\u5b9a\u4e49 --\x3e \u7ed3\u6784\u4f53\u5b9a\u4e49 --\x3e"}),"\n",(0,l.jsx)(r.li,{children:"\u82e5\u5e72\u91cd\u8f7d\u65b9\u6cd5\uff08to 407\uff0c\u8f85\u52a9\u51fd\u6570\uff09 --\x3e"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u73b0\u529f\u80fd\u51fd\u6570\uff08\u6309\u58f0\u660e\u987a\u5e8f + \u8f85\u52a9\u51fd\u6570\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"_ftp.h"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ee3\u7801\u89c4\u6a21\uff1a118 Line"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3b\u8981\u5185\u5bb9\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e ",(0,l.jsx)(r.code,{children:"cftpclient"})," \u7c7b"]}),"\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e FTP \u5e38\u7528\u547d\u4ee4 ",(0,l.jsx)(r.code,{children:"get, put, nlist, size, mtime, chdir, site"})," \u7b49"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"_ftp.cpp"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ee3\u7801\u89c4\u6a21\uff1a233 Line"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3b\u8981\u5185\u5bb9\uff08\u5177\u4f53\u5b9e\u73b0\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u57fa\u4e8e ",(0,l.jsx)(r.code,{children:"ftplib.c"})," \u7684\u5c01\u88c5"]}),"\n",(0,l.jsxs)(r.li,{children:["\u6838\u5fc3\u4e3a ",(0,l.jsx)(r.code,{children:"get"})," \u4e0e ",(0,l.jsx)(r.code,{children:"put"})," \u7684\u5b9e\u73b0\uff0c\u4ece\u5f62\u53c2\u53ef\u77e5\uff0c\u5176\u64cd\u4f5c\u4e0e ftp \u4fdd\u6301\u4e00\u81f4"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'bool cftpclient::get(const string &remotefilename,const string &localfilename,const bool bcheckmtime)\r\n{\r\n    if (m_ftpconn == 0) return false;\r\n\r\n    // \u521b\u5efa\u672c\u5730\u6587\u4ef6\u76ee\u5f55\u3002\r\n    newdir(localfilename);\r\n\r\n    // \u751f\u6210\u672c\u5730\u6587\u4ef6\u7684\u4e34\u65f6\u6587\u4ef6\u540d\u3002\r\n    string strlocalfilenametmp=localfilename+".tmp";\r\n\r\n    // \u83b7\u53d6\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u6587\u4ef6\u7684\u65f6\u95f4\u3002\r\n    if (mtime(remotefilename) == false) return false;\r\n\r\n    // \u53d6\u6587\u4ef6\u3002\r\n    if (FtpGet(strlocalfilenametmp.c_str(),remotefilename.c_str(),FTPLIB_IMAGE,m_ftpconn) == false) return false;\r\n  \r\n    // \u5224\u65ad\u6587\u4ef6\u4e0b\u8f7d\u524d\u548c\u4e0b\u8f7d\u540e\u7684\u65f6\u95f4\uff0c\u5982\u679c\u65f6\u95f4\u4e0d\u540c\uff0c\u8868\u793a\u5728\u6587\u4ef6\u4f20\u8f93\u7684\u8fc7\u7a0b\u4e2d\u5df2\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u8fd4\u56de\u5931\u8d25\u3002\r\n    if (bcheckmtime==true)\r\n    {\r\n        string strmtime=m_mtime;\r\n\r\n        if (mtime(remotefilename) == false) return false;\r\n\r\n        if (m_mtime!=strmtime) return false;\r\n    }\r\n\r\n    // \u91cd\u7f6e\u6587\u4ef6\u65f6\u95f4\u3002\r\n    setmtime(strlocalfilenametmp,m_mtime);\r\n\r\n    // \u6539\u4e3a\u6b63\u5f0f\u7684\u6587\u4ef6\u3002\r\n    if (rename(strlocalfilenametmp.c_str(),localfilename.c_str()) != 0) return false; \r\n\r\n    // \u83b7\u53d6\u6587\u4ef6\u7684\u5927\u5c0f\u3002\r\n    m_size=filesize(localfilename);\r\n\r\n    return true;\r\n}\r\n\r\n\r\nbool cftpclient::put(const string &localfilename,const string &remotefilename,const bool bchecksize)\r\n{\r\n    if (m_ftpconn == 0) return false;\r\n\r\n    // \u751f\u6210\u670d\u52a1\u5668\u6587\u4ef6\u7684\u4e34\u65f6\u6587\u4ef6\u540d\u3002\r\n    string strremotefilenametmp=remotefilename+".tmp";\r\n\r\n    string filetime1,filetime2;\r\n    filemtime(localfilename,filetime1);   // \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4e4b\u524d\u7684\u65f6\u95f4\u3002\r\n\r\n    // \u53d1\u9001\u6587\u4ef6\u3002\r\n    if (FtpPut(localfilename.c_str(),strremotefilenametmp.c_str(),FTPLIB_IMAGE,m_ftpconn) == false) return false;\r\n\r\n    filemtime(localfilename,filetime2);   // \u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u4e4b\u540e\u7684\u65f6\u95f4\u3002\r\n\r\n    // \u5982\u679c\u6587\u4ef6\u4e0a\u4f20\u524d\u540e\u7684\u65f6\u95f4\u4e0d\u4e00\u81f4\uff0c\u8bf4\u660e\u672c\u5730\u6709\u4fee\u6539\u6587\u4ef6\uff0c\u653e\u5f03\u672c\u6b21\u4e0a\u4f20\u3002\r\n    if (filetime1!=filetime2) { ftpdelete(strremotefilenametmp); return false; }\r\n    \r\n    // \u91cd\u547d\u540d\u6587\u4ef6\u3002\r\n    if (FtpRename(strremotefilenametmp.c_str(),remotefilename.c_str(),m_ftpconn) == false) return false;\r\n\r\n    // \u5224\u65ad\u5df2\u4e0a\u4f20\u7684\u6587\u4ef6\u7684\u5927\u5c0f\u4e0e\u672c\u5730\u6587\u4ef6\u662f\u5426\u76f8\u540c\uff0c\u786e\u4fdd\u4e0a\u4f20\u6210\u529f\u3002\r\n    // \u4e00\u822c\u6765\u8bf4\uff0c\u4e0d\u4f1a\u51fa\u73b0\u6587\u4ef6\u5927\u5c0f\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u5982\u679c\u6709\uff0c\u5e94\u8be5\u662f\u670d\u52a1\u5668\u65b9\u7684\u539f\u56e0\uff0c\u4e0d\u592a\u597d\u5904\u7406\u3002\r\n    if (bchecksize==true)\r\n    {\r\n        if (size(remotefilename) == false) return false;\r\n\r\n        if (m_size != filesize(localfilename)) { ftpdelete(remotefilename); return false; }\r\n    }\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u8c03\u8bd5"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo50.cpp"})," \uff0842 Line\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"login"})," \u4fe1\u606f"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539 I/O \u8def\u5f84\uff08\u7edd\u5bf9\u8def\u5f84\uff0c\u5426\u5219\u62a5\u9519\uff1b\u56e0\u4e3a\u542f\u52a8 ftp \u9ed8\u8ba4\u5728 ",(0,l.jsx)(r.code,{children:"/home/usr"})," \uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7f16\u8bd1 --\x3e \u6267\u884c --\x3e ",(0,l.jsx)(r.code,{children:"ret = 226 Transfer done (but failed to open directory)."})," \uff08\u76f8\u5bf9\u8def\u5f84\uff0c\u5bfc\u81f4\u8f93\u5165\u7684\u8def\u5f84\u4e0d\u5b58\u5728\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u4e3a\u7edd\u5bf9\u8def\u5f84\uff0c\u6210\u529f\u8fd0\u884c"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240607190154541",src:e(45249).A+"",width:"772",height:"120"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo51.cpp"})," \uff0833 Line\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u767b\u5f55\u4fe1\u606f --\x3e \u4fee\u6539\u8def\u5f84 --\x3e \u6210\u529f\u5207\u6362\u76ee\u5f55 + \u4e0a\u4f20\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240607190707524",src:e(25744).A+"",width:"910",height:"200"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo52.cpp"})," \uff0837 Line\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u767b\u5f55\u4fe1\u606f --\x3e \u4fee\u6539\u8def\u5f84 --\x3e \u6210\u529f\u4e0b\u8f7d\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240607192230510",src:e(82606).A+"",width:"763",height:"220"})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5728\u670d\u52a1\u7aef\u521b\u5efa\u76ee\u5f55\uff0c\u4e0d\u5bb9\u6613\u5904\u7406\u3002\u56e0\u4e3a\u6bcf\u4e2a FTP \u547d\u4ee4\u90fd\u9700\u8981\u5728\u5e95\u5c42\u8fdb\u884c\u4e00\u6b21 TCP \u901a\u8baf\uff0c\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u4e2a\u62a5\u6587\uff0c\u518d\u63a5\u6536\u56de\u5e94\uff0c\u65f6\u95f4\u5f00\u9500\u6bd4\u8f83\u5927\u3002\u5982\u679c\u6bcf\u6b21\u4e0a\u4f20\u6587\u4ef6\u4e4b\u524d\uff0c\u90fd\u8981\u8fdb\u884c\u989d\u5916\u7684 TCP \u901a\u8baf\uff0c\u5219\u5f71\u54cd\u65f6\u95f4\u5e76\u5f71\u54cd\u6027\u80fd\u3002\u5982\u679c\u9700\u8981\u5728\u670d\u52a1\u7aef\u521b\u5efa\u76ee\u5f55\uff0c\u53ea\u80fd\u518d\u7a0b\u5e8f\u4e2d\u7528\u4ee3\u7801\u521b\u5efa\u3002\uff08\u8fd9\u4e2a\u8fc7\u7a0b\u7406\u89e3\u4e0d\u591f\u6e05\u6670\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c",(0,l.jsx)(r.code,{children:"response()"})," \u51fd\u6570\u53ef\u7528\u4e8e\u83b7\u53d6\u9519\u8bef\u7684\u539f\u56e0\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4e0a\u8ff0\u5c01\u88c5\u7684\u51fd\u6570\uff0c",(0,l.jsx)(r.strong,{children:"\u4e0d\u7ba1\u6709\u6ca1\u6709\u7591\u95ee\uff0c\u90fd\u8981\u52a8\u624b\u6d4b\u8bd5"}),"\uff0c\u907f\u514d\u5f97\u8fc7\u4e14\u8fc7\uff0c\u5f71\u54cd\u540e\u9762\u7684\u7406\u89e3\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u6293\u91cd\u70b9\u4f7f\u7528\u5f00\u6e90\u5e93\uff0c\u7528\u8d77\u6765\uff0c\u800c\u4e0d\u5fc5\u641e\u6e05\u695a\u6bcf\u4e2a\u7ec6\u8282\u3002\u6309\u6a21\u5757\u6574\u4f53\u7406\u89e3\uff0c\u5ffd\u7565\u90e8\u5206\u7ec6\u8282\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u8bfb\u5343\u884c\u4ee3\u7801 ",(0,l.jsx)(r.code,{children:"ftplib.cpp"})," \u53d1\u73b0\uff0c\u82e5\u5e72\u91cd\u8f7d\u6216\u8005\u4e0d\u5728\u5934\u6587\u4ef6\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u90fd\u662f\u4e3a\u529f\u80fd\u51fd\u6570\u7684\u5b9e\u73b0\u51c6\u5907\u7684\uff0c\u8fd9\u79cd\u989d\u5916\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u6709\u7684\u4f1a\u5f88\u957f\uff0c\u5177\u4f53\u9700\u8981\u6839\u636e\u529f\u80fd\u51fd\u6570\u7684\u5b9e\u73b0\u903b\u8f91\u4e0e\u6a21\u5757\u5206\u5272\u6765\u786e\u5b9a\u3002\u8d77\u7801\u77e5\u9053\u4e86\u4e00\u4e9b\u4ee3\u7801\u642d\u5efa\u7684\u7ecf\u9a8c\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53e6\u5916\uff0c\u82e5\u5c5e\u4e8e\u5927\u90e8\u5206\u529f\u80fd\u51fd\u6570\u9700\u8981\u7684\u989d\u5916\u51fd\u6570\uff0c\u5219\u5728\u6587\u4ef6\u5f00\u5934\u5b9a\u4e49\u4e0e\u5b9e\u73b0\uff0c\u82e5\u4ec5\u5c5e\u4e8e\u4e2a\u522b\u529f\u80fd\u51fd\u6570\uff0c\u5219\u5728\u5176\u524d\u9762\u90bb\u8fd1\u4f4d\u7f6e\u5b9a\u4e49\u4e0e\u5b9e\u73b0\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u611f\u609f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ecb\u7ecd\u4e86 FTP \u4e0e TCP \u7684\u5173\u7cfb\uff0c\u53ca\u5176\u54cd\u5e94\u7801\u3002\u56de\u8fc7\u5934\u6765\u60f3\uff0c\u54cd\u5e94\u7801\u4e0d\u8fc7\u662f \u201c\u4e00\u4e2a\u841d\u535c\u4e00\u4e2a\u5751\u201d \u538b\u51fa\u6765\u7684\u5751\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u80cc\u540e\u90fd\u6709\u6240\u5c5e\u7c7b\u522b\u7684\u54cd\u5e94\u7801\uff0c\u54cd\u5e94\u5373\u56de\u54cd\uff0c\u5373\u4e00\u79cd\u72b6\u6001\u53cd\u9988\u7f62\u4e86\uff0c\u5e76\u4e0d\u662f\u4ec0\u4e48\u795e\u79d8\u7684\u4e1c\u897f\uff0c\u5b83\u4eec\u5c31\u597d\u50cf\u90a3\u4e9b\u76f8\u5173\u64cd\u4f5c\u7684\u5f71\u5b50\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u672c\u8282\u6ca1\u6709\u4ee3\u7801\u5b9e\u73b0\u8fc7\u7a0b\uff0c\u4ec5\u4ec5\u4ecb\u7ecd\u4e0e\u8bb2\u8ff0\u4e863\u4e2ademo\u6587\u4ef6\uff0c4\u4e2a\u5f00\u6e90\u6587\u4ef6\u7684\u5177\u4f53\u5185\u5bb9\u3002\u90a3\u4e48\u8be5\u5982\u4f55\u6d88\u5316\u8fd9\u79cd\u5f62\u5f0f\u8f93\u5165\u7684\u4fe1\u606f\uff1f\u5982\u4f55\u66f4\u6709\u6548\u5730\u5b66\u4e60\u8fd9\u51e0\u4e2a\u6587\u4ef6\uff1f\u52a8\u624b\u6d4b\u8bd5\uff0c\u641e\u61c2\u529f\u80fd\u4e0e\u7528\u6cd5\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u4e0d\u719f\u6089\u52a8\u6001\u5e93\u4e0e\u9759\u6001\u5e93\u7684\u7f16\u8bd1\u8bed\u6cd5\uff0c\u9700\u8981\u6574\u7406 + \u56de\u987e\u3002"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-makefile",children:"# \u52a8\u6001\u5e93\u4e0e\u9759\u6001\u5e93\u7f16\u8bd1\r\nlibftp.a:ftplib.h ftplib.c\r\n\tgcc -c -o libftp.a ftplib.c \r\n\r\nlibftp.so:ftplib.h ftplib.c\r\n\tgcc -fPIC -shared -o libftp.so ftplib.c \n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4ec0\u4e48\u8981\u591a\u6b21\u5b8f\u5b9a\u4e49\u540c\u4e00\u4e2a\u5185\u5bb9\uff1f\u7c7b\u4f3c\u591a\u6b21 ",(0,l.jsx)(r.code,{children:"typedef"})," \u589e\u52a0\u53ef\u8bfb\u6027\uff1f"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:"/* FtpAccess() mode codes */\r\n#define FTPLIB_ASCII 'A'\r\n#define FTPLIB_IMAGE 'I'\r\n#define FTPLIB_TEXT FTPLIB_ASCII\r\n#define FTPLIB_BINARY FTPLIB_IMAGE\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5982\u4f55\u7406\u89e3\u5934\u6587\u4ef6\u7684\u517c\u5bb9\u6027\u8bed\u53e5\uff1f\u901a\u8fc7\u4e0d\u540c\u5e73\u53f0\u7684\u6807\u8bc6\u5b8f\uff0c\u6765\u533a\u5206\u5f53\u524d\u7a0b\u5e8f\u6240\u5904\u7684\u5e73\u53f0\uff1f\u8fdb\u800c\u63a7\u5236\u4ee3\u7801\u7684\u751f\u6548\u5206\u652f\uff1f"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u5982\u4f55\u7406\u89e3\u4e0b\u65b9\u8bed\u6cd5\uff1f\u4e3a\u4ec0\u4e48\u53ea\u6709\u534a\u4e2a\u82b1\u62ec\u53f7\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5e76\u975e\u534a\u4e2a\u82b1\u62ec\u53f7\uff0c\u800c\u662f\u5c06\u4e00\u5b8c\u6574\u8bed\u53e5\u5206\u5f00\u5b9a\u4e49\u4e86\uff0c\u8fd9\u79cd\u7528\u6cd5\u5728\u524d\u9762\u67d0\u4e2a demo \u4e5f\u7528\u8fc7\uff08\u7528\u6765\u5145\u5f53\u6ce8\u91ca\uff0c\u5176\u5b9e\u662f\u6309\u60c5\u51b5\u63a7\u5236\u5206\u652f\uff09\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#ifdef __cplusplus\r\nextern "C" {\r\n#endif\r\n    \r\n#ifdef __cplusplus\r\n};\r\n#endif\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48\u5f00\u6e90\u5e93\u6709\u7684\u4ee3\u7801\u683c\u5f0f\u5341\u5206\u4e0d\u89c4\u8303\uff1f\u4f8b\u5982\u7c7b\u4f3c K&R \u98ce\u683c\uff0c\u4f46\u53c8\u4e0d\u9075\u5faa\u7f29\u8fdb\u7684\u539f\u5219\uff081104 Line\uff09\u3002\u4f1a\u4e0d\u4f1a\u662f\u56e0\u4e3a\u683c\u5f0f\u5316\u4e86\u4ee3\u7801\uff0c\u5bfc\u81f4\u7684\u9519\u4e71\uff1f"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:"GLOBALDEF int FtpSysType(char *buf, int max, netbuf *nControl)\r\n{\r\n    int l = max;\r\n    char *b = buf;\r\n    char *s;\r\n    if (!FtpSendCmd(\"SYST\",'2',nControl))\r\n\treturn 0;\r\n    s = &nControl->response[4];\r\n    while ((--l) && (*s != ' '))\r\n\t*b++ = *s++;\r\n    *b++ = '\\0';\r\n    return 1;\r\n}\n"})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/05 17:46:55\uff0c2024/06/07 1:33:22 \u89c6\u9891 + \u7b14\u8bb0\uff0c\u672a\u8c03\u8bd5\u4ee3\u7801"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/07 17:07:17 \u89e3\u8bfb\u4e24\u4e2a\u5f00\u6e90\u5e93"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/07 19:22:40 \u5b8c\u6210\u4ee3\u7801\u89e3\u8bfb + \u4ee3\u7801\u8c03\u8bd5"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"65-\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\u4e00",children:"65 \u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\uff08\u4e00\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u80cc\u666f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u901a\u7528\u6a21\u5757\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u5f88\u5e38\u7528\uff0c\u4e0d\u5c40\u9650\u4e8e\u67d0\u4e2a\u9879\u76ee\u3002\u672c\u8282\u7a0b\u5e8f\u8f83\u4e3a\u590d\u6742\uff0c\u5b8c\u6210\u7ec3\u4e60\u53ef\u4ee5\u6709\u6548\u63d0\u9ad8\u4ee3\u7801\u80fd\u529b\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4efb\u52a1"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u4ece\u670d\u52a1\u5668\u67d0\u4e2a\u76ee\u5f55\u4e0b\u8f7d\u6587\u4ef6\uff0c\u53ef\u6307\u5b9a\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.code,{children:"ftpgetfiles.cpp"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u521b\u5efa\u6587\u4ef6"}),"\n",(0,l.jsx)(r.li,{children:"\u57fa\u672c\u6846\u67b6\uff08\u5934\u6587\u4ef6\u3001\u547d\u540d\u7a7a\u95f4\u3001\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3001\u4e3b\u51fd\u6570\uff09"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"makefile"})," \u589e\u52a0\u7f16\u8bd1\u6307\u4ee4\uff08 ",(0,l.jsx)(r.code,{children:"ftpgetfiles"})," + \u94fe\u63a5\u5e93\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"main"})," \u4f18\u5316\u53c2\u6570\u8868\u793a\uff08 ",(0,l.jsx)(r.code,{children:"xml"})," \u6807\u7b7e\u63d0\u9ad8\u53ef\u8bfb\u6027\u3001\u53ef\u6269\u5c55\u6027\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5 --\x3e \u5c06\u53c2\u6570\u5c01\u88c5\u5230\u5b50\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"_help()"})," --\x3e \u8c03\u8bd5 --\x3e \u7edd\u5bf9\u8def\u5f84"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5206\u6b65\u5b9e\u73b0 --\x3e \u5217\u51fa\u5177\u4f53\u6d41\u7a0b --\x3e \u5b9e\u73b0\u5b50\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"1\uff09\u4ece\u670d\u52a1\u5668\u67d0\u4e2a\u76ee\u5f55\u4e0b\u8f7d\u6587\u4ef6\uff0c\u53ef\u6307\u5b9a\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["1.1\uff09\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u58f0\u660e\u65e5\u5fd7\u5bf9\u8c61 --\x3e \u5f15\u5165\u65e5\u5fd7\u7ed3\u6784\u4f53 + \u5168\u5c40\u65e5\u5fd7\u5bf9\u8c61 --\x3e \u6253\u5f00\u65e5\u5fd7"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["1.2\uff09\u89e3\u6790 ",(0,l.jsx)(r.code,{children:"xml"}),"\uff0c\u5f97\u5230\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u5b50\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"_xmltoarg()"})," --\x3e \u8c03\u7528\u4ee3\u7801 --\x3e"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\u51fd\u6570\u529f\u80fd\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u521d\u59cb\u5316\u7ed3\u6784\u4f53 --\x3e \u83b7\u53d6\u670d\u52a1\u7aef IP \u53ca\u7aef\u53e3 --\x3e"}),"\n",(0,l.jsx)(r.li,{children:"\u53c2\u6570\u9010\u4e00\u5b9e\u73b0\uff08\u83b7\u53d6 + \u5224\u65ad + \u5199\u65e5\u5fd7\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"gdb"})," \u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"make"})," + \u83b7\u53d6\u53c2\u6570 --\x3e ",(0,l.jsx)(r.code,{children:"gdb ftpgetfiles"})," --\x3e"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"set args params"})," --\x3e \u8bbe\u7f6e\u65ad\u70b9 ",(0,l.jsx)(r.code,{children:"b 89"})," --\x3e ",(0,l.jsx)(r.code,{children:"run"})," --\x3e"]}),"\n",(0,l.jsxs)(r.li,{children:["\u663e\u793a\u7ed3\u6784\u4f53 ",(0,l.jsx)(r.code,{children:"p starg"})," --\x3e \u6838\u5bf9\u5404\u6210\u5458\u5185\u5bb9 --\x3e \u9000\u51fa ",(0,l.jsx)(r.code,{children:"q"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240608200131606",src:e(72209).A+"",width:"702",height:"325"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"1.3\uff09\u767b\u5f55 ftp \u670d\u52a1\u5668"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"1.4\uff09\u8fdb\u5165 ftp \u670d\u52a1\u5668\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["1.5\uff09\u8c03\u7528 ",(0,l.jsx)(r.code,{children:"ftpclient.nlist()"})," \u65b9\u6cd5\uff0c\u5217\u51fa\u670d\u52a1\u5668\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u540d\uff0c\u4fdd\u5b58\u5728\u672c\u5730\u6587\u4ef6\u4e2d"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u683c\u5f0f\u5316\u547d\u540d\u8f93\u51fa\u6587\u4ef6 --\x3e ",(0,l.jsx)(r.code,{children:".nlist"})," \u540e\u7f00\uff08\u53ef\u8bfb\u6027\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u65e5\u5fd7 + \u4f18\u5316 ",(0,l.jsx)(r.code,{children:"_help()"})," \u53c2\u6570\uff08\u8c03\u5ea6\u6a21\u5757\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["1.6\uff09\u52a0\u8f7d\u5230\u5bb9\u5668 ",(0,l.jsx)(r.code,{children:"vfilelist"})]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b9a\u4e49\u6587\u4ef6\u4fe1\u606f\u7ed3\u6784\u4f53"}),"\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e ",(0,l.jsx)(r.code,{children:"nlist"})," \u5bb9\u5668"]}),"\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u6570\u636e\u52a0\u8f7d\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"loadlistfile()"})]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"main"})," \u8c03\u7528"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\u6570\u636e\u52a0\u8f7d\u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6e05\u7a7a\u5bb9\u5668 --\x3e \u6253\u5f00\u6587\u4ef6 --\x3e"}),"\n",(0,l.jsx)(r.li,{children:"\u6309\u884c\u8bfb\u53d6\u6587\u4ef6\u540d\u5217\u8868 --\x3e \u6587\u4ef6\u5339\u914d --\x3e \u8c03\u8bd5"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["1.7\uff09\u904d\u5386 ",(0,l.jsx)(r.code,{children:"vfilelist"})," \u5bb9\u5668"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b9a\u4e49\u4e24\u4e2a\u5168\u8def\u5f84\u6587\u4ef6\u540d\u7684\u53d8\u91cf\uff08\u670d\u52a1\u7aef\u3001\u672c\u5730\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u904d\u5386\u5bb9\u5668 --\x3e \u62fc\u63a5\u5168\u8def\u5f84\u6587\u4ef6\u540d --\x3e \u5199\u65e5\u5fd7 --\x3e \u4e0b\u8f7d\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.li,{children:["\u5207\u6362 ",(0,l.jsx)(r.code,{children:"root"})," \u521b\u5efa\u76ee\u5f55 ",(0,l.jsx)(r.code,{children:"mkdor /idcdata"})," --\x3e \u6388\u6743\u666e\u901a\u7528\u6237 ",(0,l.jsx)(r.code,{children:"chown -R celfs:usr_group /idcdata"})," \uff08\u6743\u9650\u8db3\u591f\uff0c\u5ffd\u7565\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.strong,{children:"\u7a0b\u5e8f\u5907\u4efd"})," ",(0,l.jsx)(r.code,{children:"ftpgetfiles.cpp65"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "../../public/_public.h"\r\n#include "../../public/_ftp.h"\r\n\r\nusing namespace idc;\r\n\r\nvoid EXIT(int sig);\r\n\r\nstruct st_arg {\r\n    char host[31];          // \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684 IP \u548c\u7aef\u53e3\r\n    int mode;               // \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff08\u7f3a\u7701\uff09\uff1b2-\u4e3b\u52a8\u6a21\u5f0f\r\n    char username[31];\r\n    char password[31];\r\n    char remotepath[256];   // \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\r\n    char localpath[256];    // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\r\n    char matchname[256];    // \u5f85\u4e0b\u8f7d\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n} starg;\r\n\r\nbool _xmltoarg(const char *strxmlbuffer); // \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4f53\u4e2d\r\n\r\nclogfile logfile;\r\ncftpclient ftp;\r\n\r\nvoid _help();\r\n\r\nstruct st_fileinfo {    // \u6587\u4ef6\u4fe1\u606f\u7ed3\u6784\u4f53\r\n\r\n    string filename;\r\n    string mtime;\r\n    st_fileinfo() = default;\r\n    st_fileinfo(const string &in_filename, const string &in_mtime):filename(in_filename), mtime(in_mtime) {}\r\n    void clear() {\r\n        filename.clear();\r\n        mtime.clear();\r\n    }\r\n\r\n};\r\n\r\nvector<struct st_fileinfo> vfilelist;\r\nbool loadlistfile();\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) { _help(); return -1; }\r\n\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    // 1) \u4ece\u670d\u52a1\u5668\u67d0\u4e2a\u76ee\u5f55\u4e0b\u8f7d\u6587\u4ef6\uff0c\u53ef\u6307\u5b9a\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("logfile open failed (%s).\\n", argv[1]);\r\n        return -1;\r\n    }\r\n\r\n    // \u89e3\u6790 xml\uff0c\u5f97\u5230\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\r\n    if (_xmltoarg(argv[2]) == false) {\r\n        return -1;\r\n    }\r\n\r\n    // \u767b\u5f55 ftp \u670d\u52a1\u5668\r\n    if (ftp.login(starg.host, starg.username, starg.password, starg.mode) == false) {\r\n        logfile.write("ftp.login(%s, %s, %s) failed.\\n", starg.host, starg.username, starg.password); return -1;\r\n    }\r\n\r\n    logfile.write("ftp.login ok.\\n");\r\n\r\n    // \u8fdb\u5165 ftp \u670d\u52a1\u5668\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\r\n    if (ftp.chdir(starg.remotepath) == false) {\r\n        logfile.write("ftp.chdir(%s) failed.\\n", starg.remotepath); return -1;\r\n    }\r\n\r\n    // \u8c03\u7528 ftpclient.nlist() \u65b9\u6cd5\uff0c\u5217\u51fa\u670d\u52a1\u5668\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u540d\uff0c\u4fdd\u5b58\u5728\u672c\u5730\u6587\u4ef6\u4e2d\r\n    if (ftp.nlist(".", sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid())) == false) {\r\n        logfile.write("ftp.nlist(%s) failed.\\n", starg.remotepath); return -1;\r\n    }\r\n    logfile.write("nlist(%s) ok.\\n", sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid()).c_str());\r\n    \r\n\r\n    // \u628a ftpclient.nlist() \u65b9\u6cd5\u83b7\u53d6\u5230\u7684 list \u6587\u4ef6\uff0c\u52a0\u8f7d\u5230\u5bb9\u5668 vfilelist \u4e2d\r\n    if (loadlistfile() == false) {\r\n        logfile.write("loadlistfile() failed.\\n"); return -1;\r\n    }\r\n\r\n    string strremotefilename, strlocalfilename;\r\n    // \u904d\u5386 vfilelist \u5bb9\u5668\r\n    for (auto &aa : vfilelist) {\r\n\r\n        sformat(strremotefilename, "%s/%s", starg.remotepath, aa.filename.c_str());     // \u62fc\u63a5\u670d\u52a1\u7aef\u5168\u8def\u5f84\u7684\u6587\u4ef6\u540d\r\n        sformat(strlocalfilename, "%s/%s", starg.localpath, aa.filename.c_str());       // \u62fc\u63a5\u672c\u5730\u5168\u8def\u5f84\u7684\u6587\u4ef6\u540d\r\n\r\n        logfile.write("get %s ...", strremotefilename.c_str());\r\n        // \u8c03\u7528 ftpclient.get() \u65b9\u6cd5\u4e0b\u8f7d\u6587\u4ef6\r\n        if (ftp.get(strremotefilename, strlocalfilename) == false) {\r\n            logfile << "failed.\\n"; return -1;\r\n        }\r\n\r\n        logfile << "ok.\\n";\r\n    }\r\n\r\n    return 0;\r\n}\r\n\r\nbool _xmltoarg(const char *strxmlbuffer) {\r\n\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n\r\n    getxmlbuffer(strxmlbuffer, "host", starg.host, 30);\r\n    if (strlen(starg.host) == 0) {\r\n        logfile.write("host is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "mode", starg.mode);\r\n    if (starg.mode != 2) starg.mode = 1;\r\n\r\n    getxmlbuffer(strxmlbuffer, "username", starg.username, 30);\r\n    if (strlen(starg.username) == 0) {\r\n        logfile.write("username is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "password", starg.password, 30);\r\n    if (strlen(starg.password) == 0) {\r\n        logfile.write("password is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "remotepath", starg.remotepath, 255);\r\n    if (strlen(starg.remotepath) == 0) {\r\n        logfile.write("remotepath is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "localpath", starg.localpath, 255);\r\n    if (strlen(starg.localpath) == 0) {\r\n        logfile.write("localpath is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "matchname", starg.matchname, 100);\r\n    if (strlen(starg.matchname) == 0) {\r\n        logfile.write("matchname is null.\\n"); return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n    \r\n    printf("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\nvoid _help() {\r\n\r\n    printf("\\n");\r\n    printf("Using: ../../tools/bin/ftpgetfiles logfilename xmlbuffer\\n\\n");\r\n    printf("Sample: /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 30 /home/celfs/project/engi_cpp/49_project/tools/bin/ftpgetfiles /home/celfs/project/engi_cpp/49_project/log/idc/ftpgetfiles_surfdata.log " \\\r\n            "\\"<host>192.168.20.150:21</host><mode>1</mode>"\\\r\n            "<username>celfs</username><password>123</password>"\\\r\n            "<remotepath>/home/celfs/project/engi_cpp/49_project/tmp/idc/surfdata</remotepath><localpath>/home/celfs/project/engi_cpp/49_project/idcdata/surfdata</localpath>"\\\r\n            "<matchname>SURF_ZH*.XML,SURF_ZH*.CSV</matchname>\\"\\n\\n");\r\n\r\n    printf("\u672c\u7a0b\u5e8f\u662f\u901a\u7528\u7684\u529f\u80fd\u6a21\u5757\uff0c\u7528\u4e8e\u628a\u8fdc\u7a0bftp\u670d\u52a1\u7aef\u7684\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730\u76ee\u5f55\u3002\\n");\r\n    printf("logfilename\u662f\u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n    printf("xmlbuffer\u4e3a\u6587\u4ef6\u4e0b\u8f7d\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\\n");\r\n    printf("<host>192.168.150.128:21</host> \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684IP\u548c\u7aef\u53e3\u3002\\n");\r\n    printf("<mode>1</mode> \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff0c2-\u4e3b\u52a8\u6a21\u5f0f\uff0c\u7f3a\u7701\u91c7\u7528\u88ab\u52a8\u6a21\u5f0f\u3002\\n");\r\n    printf("<username>wucz</username> \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u7528\u6237\u540d\u3002\\n");\r\n    printf("<password>oraccle</password> \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u5bc6\u7801\u3002\\n");\r\n    printf("<remotepath>/tmp/idc/surfdata</remotepath> \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<localpath>/idcdata/surfdata</localpath> \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<matchname>SURF_ZH*.XML,SURF_ZH*.CSV</matchname> \u5f85\u4e0b\u8f7d\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\u3002"\\\r\n            "\u4e0d\u5339\u914d\u7684\u6587\u4ef6\u4e0d\u4f1a\u88ab\u4e0b\u8f7d\uff0c\u672c\u5b57\u6bb5\u5c3d\u53ef\u80fd\u8bbe\u7f6e\u7cbe\u786e\uff0c\u4e0d\u5efa\u8bae\u7528*\u5339\u914d\u5168\u90e8\u7684\u6587\u4ef6\u3002\\n");\r\n\r\n}\r\n\r\nbool loadlistfile() {\r\n    vfilelist.clear();\r\n\r\n    cifile ifile;\r\n    if (ifile.open(sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid())) == false) {\r\n        logfile.write("ifile.open(%s) failed.\\n", sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid())); return false;\r\n    }\r\n\r\n    string strfilename;\r\n\r\n    while (true) {\r\n        if (ifile.readline(strfilename) == false) break;\r\n\r\n        if (matchstr(strfilename, starg.matchname) == false) continue;\r\n\r\n        vfilelist.emplace_back(strfilename, "");\r\n    }\r\n\r\n    ifile.closeandremove();\r\n\r\n    for (auto &aa : vfilelist) {\r\n        logfile.write("filename = %s\\n", aa.filename.c_str());\r\n    }\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-makefile",children:"# \u5f00\u53d1\u6846\u67b6\u5934\u6587\u4ef6\u8def\u5f84\r\nPUBINCL = -I../../public\r\n\r\n# \u5f00\u53d1\u6846\u67b6 cpp \u6587\u4ef6\u540d\uff0c\u76f4\u63a5\u548c\u7a0b\u5e8f\u7684\u6e90\u4ee3\u7801\u4e00\u8d77\u7f16\u8bd1\uff0c\u6ca1\u6709\u91c7\u7528\u94fe\u63a5\u5e93\uff0c\u4e3a\u4e86\u65b9\u4fbf\u8c03\u8bd5\r\nPUBCPP = ../../public/_public.cpp\r\n\r\n# \u7f16\u8bd1\u9009\u9879\r\nCFLAGS = -g\r\n# CFLAGS = -O2\r\n\r\nall: ftpgetfiles\r\n\r\nftpgetfiles: ftpgetfiles.cpp\r\n\t\tg++ $(CFLAGS) -o ftpgetfiles ftpgetfiles.cpp $(PUBINCL) $(PUBCPP) ../../public/libftp.a ../../public/_ftp.cpp\r\n\t\tcp -f ftpgetfiles ../bin/.\r\n\r\nclean:\r\n\t\trm -rf ftpgetfiles\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u8981\u505a\u7a33\u5b9a\u53ef\u9760\u7684\u7a0b\u5e8f\u5458\uff0c",(0,l.jsx)(r.strong,{children:"\u4e0d\u8981\u505a\u6d6e\u8e81\u7684\u7a0b\u5e8f\u5458"}),"\u3002\u53c2\u6570\u6d4b\u8bd5\u6b65\u9aa4\u6bd4\u8f83\u7e41\u7410\uff0c\u4f46\u8fd9\u6b63\u662f\u63d0\u9ad8\u5de5\u4f5c\u80fd\u529b\u7684\u673a\u4f1a\u3002\u5c31\u7b97\u6280\u672f\u518d\u597d\uff0c\u505a\u4e0d\u5230\u8ba4\u771f\u8d1f\u8d23\uff0c\u90a3\u4e48\u5de5\u4f5c\u80fd\u529b\u4e5f\u5927\u6253\u6298\u6263\u3002\u80fd\u529b\u4e0d\u4ec5\u4ec5\u662f\u6280\u672f\uff0c\u8ba4\u771f\u3001\u7ec6\u5fc3\u3001\u8d1f\u8d23\u3001\u8010\u5fc3\u540c\u6837\u91cd\u8981\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u6bd4\u8f83\u5570\u55e6\u7684\u5185\u5bb9\uff0c\u90fd\u653e\u5230\u5355\u72ec\u7684\u5b50\u51fd\u6570\u4e2d\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u5728\u4f7f\u7528 ftp \u5207\u6362\u76ee\u5f55\u65f6\uff0c",(0,l.jsx)(r.strong,{children:"\u7edd\u5bf9\u8def\u5f84"}),"\u5f88\u91cd\u8981\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u601d\u8003"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5982\u679c\u4e0d\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"chdir"})," \u800c\u76f4\u63a5\u8fdb\u5165\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\uff0c\u7a0b\u5e8f\u903b\u8f91\u662f\u5426\u6709\u95ee\u9898\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u533a\u522b\uff1a\u83b7\u53d6\u7684\u6587\u4ef6\u540d\u79f0\u4e0d\u5305\u542b\u76ee\u5f55 VS \u5305\u542b\u76ee\u5f55 --\x3e \u989d\u5916\u4f20\u8f93 + \u591a\u4f59\u8def\u5f84"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u611f\u609f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5f53\u601d\u8003 / \u56de\u5fc6\u4e00\u4e2a\u7b97\u6cd5\u7684\u65f6\u5019\uff0c\u8111\u5b50\u91cc\u60f3\u5230\u7684\u662f\u6a21\u7cca\u7684\u4ee3\u7801\uff0c\u8fd9\u6837\u662f\u4e00\u5b9a\u5b66\u4e0d\u4f1a\u7684\u3002\u56e0\u4e3a\u56de\u5fc6\u4ee3\u7801\u610f\u5473\u7740\u672a\u7406\u89e3\u7b97\u6cd5\u7684\u903b\u8f91\uff0c\u672a\u7406\u89e3\u5982\u4f55\u5b9e\u73b0\u7b97\u6cd5\u7684\u5177\u4f53\u903b\u8f91\u5206\u70b9\u3002\u56e0\u6b64\uff0c\u8fd9\u662f\u4e00\u79cd\u9519\u8bef\u65b9\u6cd5\u7684\u8b66\u793a\u3002\u6b63\u786e\u5730\u4e60\u5f97\u7b97\u6cd5\uff0c\u5e94\u5f53\u662f\u80fd\u591f\u5c06\u8be5\u7b97\u6cd5\u7684\u6d41\u7a0b\u5206\u5757\u3001\u6e05\u6670\u5217\u51fa\u3002\u7ee7\u7eed\u9488\u5bf9\u4e0d\u540c\u5206\u5757\uff0c\u61c2\u5f97\u5982\u4f55\u5b9e\u73b0\u76f8\u5e94\u7684\u529f\u80fd\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ec0\u4e48\u662f\u539f\u5730\u6784\u9020\u7684\u65b9\u6cd5\uff1f\u4f8b\u5982\u539f\u672c\u8981\u4f20\u5165\u67d0\u4e2a\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u76f4\u63a5\u5728\u51fd\u6570\u8c03\u7528\u65f6\uff0c\u5c06\u8fd9\u4e2a\u683c\u5f0f\u6784\u9020\u51fa\u6765\uff0c\u5168\u90e8\u4f20\u7ed9\u8be5\u51fd\u6570\uff1f"}),"\n",(0,l.jsx)(r.li,{children:"\u58f0\u660e\u7ed3\u6784\u4f53\u65f6\uff0c\u82e5\u5728\u7ed3\u5c3e\u6dfb\u52a0\u540d\u79f0\uff0c\u5b9e\u9645\u540c\u65f6\u521b\u5efa\u4e86\u8be5\u540d\u79f0\u7684\u5168\u5c40\u7ed3\u6784\u4f53\u53d8\u91cf\u3002\u4ee5\u524d\u8fd8\u7eb3\u95f7\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u5199\uff0c\u88ab\u540c\u540d\u7684\u53d8\u91cf\u8bef\u5bfc\u4e86\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u5982\u4f55\u7406\u89e3\u89c1\u8fc7\u51e0\u79cd\u4e0d\u540c\u7528\u6cd5\uff0c\u4f7f\u7528\u5bb9\u5668\u4e4b\u524d\u90fd\u8fdb\u884c ",(0,l.jsx)(r.code,{children:"clear"})," \u6e05\u7a7a\uff1f\u5177\u4f53\u4ec0\u4e48\u65f6\u5019\u9700\u8981\u6e05\u7a7a\u5bb9\u5668\uff0c\u4ec0\u4e48\u65f6\u5019\u4e0d\u5fc5\uff1f"]}),"\n",(0,l.jsxs)(r.li,{children:["\u6587\u4ef6\u6388\u6743\u547d\u4ee4\u4e2d\u7684\u53c2\u6570 ",(0,l.jsx)(r.code,{children:"celfs:dba"}),"\uff0c\u540e\u9762\u7684 ",(0,l.jsx)(r.code,{children:"dba"})," \u662f\u4ec0\u4e48\u610f\u601d\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"dba"})," \u8868\u793a\u7528\u6237\u7ec4\u540d\uff0c\u672c\u7528\u6237 ",(0,l.jsx)(r.code,{children:"celfs"})," \u5728 ",(0,l.jsx)(r.code,{children:"sudo"})," \u7ec4\uff0c\u56e0\u6b64\u4e0d\u5fc5\u989d\u5916\u6388\u6743\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b8c\u6574\u547d\u4ee4\u793a\u4f8b\u5982\u4e0b ",(0,l.jsx)(r.code,{children:"chown -R usr_name:usr_group /dir_name"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/08 21:24:05 \u5b8c\u6210\u4ee3\u7801\u7ec3\u4e60\uff0c1h51min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"66-\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\u4e8c",children:"66 \u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\uff08\u4e8c\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4efb\u52a1"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"2\uff09\u4e0b\u8f7d\u6587\u4ef6\u540e\uff0c\u5220\u9664 ftp \u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"3\uff09\u4e0b\u8f7d\u6587\u4ef6\u540e\uff0c\u628a ftp \u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u589e\u52a0\u53c2\u6570 + \u6210\u5458"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u589e\u52a0\u53c2\u6570\uff08\u5904\u7406\u65b9\u5f0f\u3001\u5907\u4efd\u76ee\u5f55\uff1b\u8865\u5145 ",(0,l.jsx)(r.code,{children:"xml"})," \u53c2\u6570\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u589e\u52a0\u7ed3\u6784\u4f53\u6210\u5458"}),"\n",(0,l.jsx)(r.li,{children:"\u589e\u52a0\u89e3\u6790\u53c2\u6570\u7684\u51fd\u6570"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.code,{children:"main"})," \u589e\u52a0\u5224\u65ad\u903b\u8f91\uff08 ",(0,l.jsx)(r.code,{children:"ptype == 2 || 3"})," \uff09"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u65e5\u5fd7\u4f18\u5316"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5168\u90e8\u6dfb\u52a0\u670d\u52a1\u7aef\u8fd4\u56de\u4fe1\u606f ",(0,l.jsx)(r.code,{children:"ftp.response()"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u5907\u4efd\uff08 ",(0,l.jsx)(r.code,{children:".cpp66"})," \uff09"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u8c03\u8bd5"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"<ptype>2</ptype>"})," \u9a8c\u8bc1\u4e09\u4e2a\u76ee\u5f55\u7684\u6587\u4ef6 --\x3e \u6210\u529f\uff08\u5220\u9664\u4e86 ",(0,l.jsx)(r.code,{children:"json"})," \u4ee5\u5916\u7684\u6587\u4ef6\uff09"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240609170635911",src:e(48358).A+"",width:"1688",height:"463"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"<ptype>3</ptype>"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6e05\u9664\u65e5\u5fd7 --\x3e \u5220\u9664\u76f8\u5173\u76ee\u5f55 --\x3e \u6267\u884c"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u533a\u522b\uff1a\u4e0d\u4f1a\u5728\u670d\u52a1\u7aef\u81ea\u52a8\u521b\u5efa\u76ee\u5f55\uff0c\u56e0\u6b64\u9700\u624b\u52a8\u521b\u5efa\u3002\uff08\u672c\u673a\u6d4b\u8bd5\u6ca1\u6709\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a ",(0,l.jsx)(r.code,{children:"celfs"})," \u666e\u901a\u7528\u6237\u5728 ",(0,l.jsx)(r.code,{children:"sudo"})," \u7ec4\uff09"]})," \u9519\u4e86\uff0c\u53ea\u662f\u56e0\u4e3a ",(0,l.jsx)(r.code,{children:"ptype"})," \u6ca1\u6709\u6539\u6210 3\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u624b\u52a8\u521b\u5efa\u76ee\u5f55\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240609171701197",src:e(97361).A+"",width:"1613",height:"127"})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"mkdir ../../tmp/idc/surfdatabak\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6210\u529f\u53d6\u8d70 ",(0,l.jsx)(r.code,{children:"csv"})," \u53ca ",(0,l.jsx)(r.code,{children:"xml"})," \u6587\u4ef6\uff0c\u6210\u529f\u5907\u4efd\u76ee\u5f55"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240609172142090",src:e(12607).A+"",width:"1499",height:"246"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u4e24\u79cd\u62a5\u9519\u9a8c\u8bc1\u65b9\u6cd5"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u767b\u5f55 ftp \u670d\u52a1\u7aef\uff0c\u624b\u52a8\u6267\u884c\u76f8\u540c ftp \u547d\u4ee4"}),"\n",(0,l.jsxs)(r.li,{children:["2\uff09\u7a0b\u5e8f\u4e2d\u663e\u793a\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u4fe1\u606f ",(0,l.jsx)(r.code,{children:"ftp.response()"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6ce8\u610f\uff0c\u6f14\u793a\u5c06\u5907\u4efd\u76ee\u5f55\u66f4\u6539\u4e3a ",(0,l.jsx)(r.code,{children:"/root"})," \u76ee\u5f55\uff0c\u64cd\u4f5c\u5931\u8d25\uff0c\u56e0\u4e3a\u767b\u5f55 ftp \u7684\u7528\u6237\u6ca1\u6709\u76f8\u5173\u6743\u9650\uff0c\u672c\u673a\u6d4b\u8bd5\u540c\u6837\u64cd\u4f5c\u5931\u8d25\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240609172959090",src:e(77359).A+"",width:"784",height:"94"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u663e\u793a\u4e00\u81f4"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240609173254821",src:e(53408).A+"",width:"777",height:"99"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5e2e\u52a9\u6587\u6863\u975e\u5e38\u91cd\u8981\uff0c\u5982\u679c\u628a\u6587\u5b57\u7406\u6e05\u6670\u4e86\uff0c\u8bbe\u8ba1\u601d\u8def\u4e5f\u5c31\u57fa\u672c\u6e05\u6670\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"xml"})," \u5904\u7406\u53c2\u6570\uff0c\u53ef\u4fbf\u4e8e\u53c2\u6570\u6269\u5c55\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8bb0\u4f4f\uff0c\u5b8c\u6210\u4e00\u8282\uff0c",(0,l.jsx)(r.strong,{children:"\u5907\u4efd\u7a0b\u5e8f"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/09 17:38:34 \u5b8c\u6210\u89c6\u9891 + \u4ee3\u7801 + \u8c03\u8bd5 + \u7b14\u8bb0\uff0c1h20min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"67-\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\u4e09",children:"67 \u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\uff08\u4e09\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4efb\u52a1"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"4\uff09\u589e\u91cf\u4e0b\u8f7d\u6587\u4ef6\uff0c\u6bcf\u6b21\u53ea\u4e0b\u8f7d\u65b0\u589e\u7684\u548c\u4fee\u6539\u8fc7\u7684\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u601d\u8def"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6839\u636e\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\uff0c\u5224\u65ad\u6587\u4ef6\u662f\u5426\u66f4\u6539"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e24\u4e2a\u76ee\u5f55 ",(0,l.jsx)(r.code,{children:"client"})," \u548c ",(0,l.jsx)(r.code,{children:"server"}),"\uff0c\u5176\u4e2d\u6587\u4ef6\u5747\u4ece\u670d\u52a1\u7aef\u4e0b\u8f7d"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240609222952066",src:e(58309).A+"",width:"691",height:"192"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u8bbe\u8ba1 4 \u4e2a\u5bb9\u5668\uff08\u5b58\u50a8\u6587\u4ef6\u540d + \u6587\u4ef6\u65f6\u95f4\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5bb9\u56681\uff1a\u5386\u53f2\u6587\u4ef6 --\x3e \u5df2\u4e0b\u8f7d\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\uff081\uff09\u5ba2\u6237\u7aef\u672c\u5730\u76ee\u5f55\uff0c\u52a0\u8f7d\u76ee\u5f55\u6587\u4ef6\uff08\u6bcf\u6b21\u626b\u63cf\uff0c\u65f6\u95f4\u5f00\u9500\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\uff082\uff09\u4ece\u5bb9\u56683\u548c\u5bb9\u56684\uff0c\u589e\u91cf\u52a0\u8f7d\u6570\u636e"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5bb9\u56682\uff1a\u670d\u52a1\u5668\u76ee\u5f55\u6587\u4ef6\u540d\uff08\u7531 ",(0,l.jsx)(r.code,{children:"ftp.nlist()"})," \uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u5bb9\u56683\uff1a\u672a\u6539\u52a8\u6587\u4ef6 --\x3e \u4e0d\u9700\u4e0b\u8f7d\uff08\u7531\u5bb9\u56681\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5bb9\u56684\uff1a\u5df2\u6539\u52a8\u6587\u4ef6\uff08\u65b0\u589e\u3001\u4fee\u6539\uff09 --\x3e \u9700\u4e0b\u8f7d\uff08\u7531\u5bb9\u56681\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240607203810120",src:e(63898).A+"",width:"1073",height:"588"})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u6dfb\u52a0\u53c2\u6570\uff08 ",(0,l.jsx)(r.code,{children:"okfilename"}),"\u3001",(0,l.jsx)(r.code,{children:"checkmtime"})," \uff09"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u589e\u52a0\u7ed3\u6784\u4f53\u6210\u5458"}),"\n",(0,l.jsx)(r.li,{children:"\u589e\u52a0\u5e2e\u52a9\u6587\u6863\u53c2\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u589e\u52a0\u53c2\u6570\u7684\u89e3\u6790\u51fd\u6570"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.strong,{children:"\u521b\u5efa 4 \u4e2a\u5bb9\u5668"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u786e\u5b9a\u5bb9\u5668\u7c7b\u578b\uff08\u4ec5\u904d\u5386 --\x3e \u94fe\u8868\uff1b\u9700\u67e5\u627e --\x3e \u4e8c\u53c9\u6811map\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:"map<string, string> mfromok;           // \u5bb9\u56681\uff1a\u5b58\u653e\u5df2\u4e0b\u8f7d\u6210\u529f\u6587\u4ef6\uff0c\u4eceokfilename\u53c2\u6570\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u52a0\u8f7d\r\nlist<struct st_fileinfo> vfromnlist;   // \u5bb9\u56682\uff1a\u4e0b\u8f7d\u524d\u5217\u51fa\u670d\u52a1\u7aef\u6587\u4ef6\u540d\u7684\u5bb9\u5668\uff0c\u4ecenlist\u6587\u4ef6\u4e2d\u52a0\u8f7d\r\nlist<struct st_fileinfo> vtook;        // \u5bb9\u56683\uff1a\u672c\u6b21\u4e0d\u9700\u8981\u4e0b\u8f7d\u7684\u6587\u4ef6\u7684\u5bb9\u5668\r\nlist<struct st_fileinfo> vdownload;    // \u5bb9\u56684\uff1a\u672c\u6b21\u9700\u8981\u4e0b\u8f7d\u7684\u6587\u4ef6\u7684\u5bb9\u5668\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["2\uff09\u58f0\u660e 4 \u4e2a\u5bb9\u5668 --\x3e \u4fee\u6539\u539f\u5bb9\u5668\u4e3a ",(0,l.jsx)(r.code,{children:"vfromnlist"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u51c6\u5907\u5bb9\u56682\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["3\uff09\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"loadlistfile()"}),"\uff0c\u52a0\u5165\u6587\u4ef6\u65f6\u95f4\u5224\u65ad\u903b\u8f91"]}),"\n",(0,l.jsx)(r.li,{children:"4\uff09\u8c03\u8bd5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u51c6\u5907\u5bb9\u56681\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["5\uff09\u521b\u5efa + \u5b9e\u73b0 ",(0,l.jsx)(r.code,{children:"loadokfile()"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7528\u4ee5\u52a0\u8f7d\u6587\u4ef6\u5230\u5bb9\u56681\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["6\uff09",(0,l.jsx)(r.code,{children:"main"})," \u76f8\u5e94\u8c03\u7528\u4e0e\u5224\u65ad\u6761\u4ef6\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5217\u51fa\u7a0b\u5e8f\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.li,{children:["\u601d\u8003\uff1a\u5bb9\u56682\u4e0e\u5bb9\u56684\uff0c\u6839\u636e ",(0,l.jsx)(r.code,{children:"ptype"})," \u662f\u5426\u7b49\u4e8e1\uff0c\u5c06\u5206\u522b\u4ece\u5bb9\u56684\u4e0e\u5bb9\u56682\u83b7\u53d6\u4e0b\u8f7d\u6587\u4ef6\u3002\u5206\u4e24\u79cd\u60c5\u51b5\u4e0b\u8f7d\u6587\u4ef6\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u6b64\u589e\u52a0\u4ee3\u7801\uff0c\u6839\u636e ",(0,l.jsx)(r.code,{children:"ptype"})," \u6761\u4ef6\uff0c\u6309\u9700",(0,l.jsx)(r.strong,{children:"\u4ea4\u6362\u5bb9\u56682\u4e0e\u5bb9\u56684\u7684\u5185\u5bb9"}),"\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5c06\u540e\u7eed\u5bb9\u5668\u6539\u4e3a\u5bb9\u56684 ",(0,l.jsx)(r.code,{children:"vdownload"})," \uff08\u5f85\u9a8c\u8bc1\uff0c\u76ee\u524d\u6539\u4e86\u4e00\u7ec4\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["7\uff09\u521b\u5efa + \u5b9e\u73b0 ",(0,l.jsx)(r.code,{children:"compmap()"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7528\u4ee5\u6bd4\u8f83\u5bb9\u56682\u548c\u5bb9\u56681\uff0c\u5f97\u5230\u5bb9\u56683\u548c\u5bb9\u56684\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["8\uff09\u521b\u5efa + \u5b9e\u73b0 ",(0,l.jsx)(r.code,{children:"writetookfile()"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u7528\u4ee5\u5c06\u5bb9\u56683\u6570\u636e\u5199\u5165 ",(0,l.jsx)(r.code,{children:"okfilename"}),"\uff0c\u8986\u76d6\u65e7\u6587\u4ef6\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"main"})," \u904d\u5386\u5bb9\u5668\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"9\uff09\u589e\u52a0\u65f6\u95f4\u53c2\u6570"}),"\n",(0,l.jsxs)(r.li,{children:["10\uff09\u5b9e\u73b0 ",(0,l.jsx)(r.code,{children:"starg.ptype == 1"})," \u903b\u8f91"]}),"\n",(0,l.jsxs)(r.li,{children:["11\uff09\u521b\u5efa + \u5b9e\u73b0 ",(0,l.jsx)(r.code,{children:"appendtookfile()"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u76ee\u5f55\u72b6\u6001\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"client"})," \u7a7a"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"server"})," ",(0,l.jsx)(r.code,{children:"1.txt 2.txt 3.txt"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u7f16\u8bd1 --\x3e \u79fb\u9664\u65e5\u5fd7 --\x3e \u8fd0\u884c"}),"\n",(0,l.jsxs)(r.li,{children:["\u76ee\u5f55\u72b6\u6001\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"client"}),"  ",(0,l.jsx)(r.code,{children:"1.txt 2.txt 3.txt"})]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"server"})," ",(0,l.jsx)(r.code,{children:"1.txt 2.txt 3.txt"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u518d\u6b21\u5220\u9664 ",(0,l.jsx)(r.code,{children:"client"})," \u6587\u4ef6\uff0c\u7a0b\u5e8f\u4e0d\u8fd0\u884c\uff08\u8be6\u89c1\u4e0b\u6587 BUG \u8bb0\u5f55\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u65b0\u589e ",(0,l.jsx)(r.code,{children:"4.txt 5.txt"}),"\uff0c\u4fee\u6539\u6587\u4ef6 ",(0,l.jsx)(r.code,{children:"3.txt"})," --\x3e \u6d4b\u8bd5"]}),"\n",(0,l.jsxs)(r.li,{children:["\u53c2\u6570 ",(0,l.jsx)(r.code,{children:"checkmtime"})," --\x3e ",(0,l.jsx)(r.code,{children:"false"})," --\x3e \u6d4b\u8bd5"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["12\uff09\u589e\u52a0\u5fc3\u8df3\u673a\u5236\uff08\u80cc\u666f\uff1a\u7f51\u7edc\u670d\u52a1\u7a0b\u5e8f\u5bb9\u6613\u6b7b\u673a\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u786e\u5b9a\u8d85\u65f6\u65f6\u95f4\uff1a\u4e1a\u52a1\u9700\u8981 + \u7f51\u7edc\u73af\u5883"}),"\n",(0,l.jsx)(r.li,{children:"\u589e\u52a0\u53c2\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u5e2e\u52a9\u6587\u6863"}),"\n",(0,l.jsxs)(r.li,{children:["\u5728\u5408\u9002\u4f4d\u7f6e\u66f4\u65b0\u8fdb\u7a0b\u5fc3\u8df3\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u767b\u5f55 ftp \u670d\u52a1\u5668\u524d\uff0c\u52a0\u5165\u5fc3\u8df3\u4fe1\u606f\uff08\u907f\u514d\u767b\u5f55\u65f6\u6b7b\u673a\uff0c\u5fc3\u8df3\u5237\u65b0\u5bfc\u81f4\u7a0b\u5e8f\u9677\u5165\u6b7b\u5faa\u73af\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["2\uff09\u767b\u5f55 ftp \u670d\u52a1\u5668\u65f6\uff0c\u5728\u6d88\u8017\u65f6\u95f4\u8f83\u957f\u7684\u64cd\u4f5c\u540e\uff0c\u66f4\u65b0\u5fc3\u8df3\u4fe1\u606f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u8c03\u7528 ",(0,l.jsx)(r.code,{children:"ftp.nlist()"})," \u4fdd\u5b58\u76ee\u5f55\u6587\u4ef6\u540d\u540e\uff08\u82e5\u51e0\u4e07\u4e2a\u6587\u4ef6\uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u52a0\u8f7d\u6587\u4ef6\u5230\u5bb9\u5668\u540e\uff08\u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u822c\u6bd4\u8f83\u5feb\uff0c\u52a0\u4e0d\u52a0\u5fc3\u8df3\u90fd\u884c\uff0c\u82b1\u9500\u57fa\u672c\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u6bcf\u6b21\u4e0b\u8f7d\u6587\u4ef6\u540e\uff08\u539f\u56e0\u540c\u4fdd\u5b58\u76ee\u5f55\u7684\u64cd\u4f5c\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_ftp.h"\r\n\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u9000\u51fa\u548c\u4fe1\u53f72\u300115\u7684\u5904\u7406\u51fd\u6570\u3002\r\nvoid EXIT(int sig);\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u53c2\u6570\u7684\u7ed3\u6784\u4f53\u3002\r\nstruct st_arg {\r\n    char host[31];            // \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684 IP \u548c\u7aef\u53e3\r\n    int  mode;                // \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff08\u7f3a\u7701\uff09\uff1b2-\u4e3b\u52a8\u6a21\u5f0f\r\n    char username[31];\r\n    char password[31];\r\n    char remotepath[256];     // \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\r\n    char localpath[256];      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\r\n    char matchname[256];      // \u5f85\u4e0b\u8f7d\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n    int  ptype;               // \u4e0b\u8f7d\u540e\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u7a7a\uff1b2-\u5220\u9664\uff1b3-\u5907\u4efd\uff1b\r\n    char remotepathbak[256];  // \u4e0b\u8f7d\u540e\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5907\u4efd\u76ee\u5f55\r\n    char okfilename[256];     // \u5df2\u4e0b\u8f7d\u6210\u529f\u6587\u4ef6\u4fe1\u606f\u5b58\u653e\u7684\u6587\u4ef6  \r\n    bool checkmtime;          // \u662f\u5426\u9700\u8981\u68c0\u67e5\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u65f6\u95f4\uff0ctrue-\u9700\u8981\uff1bfalse-\u4e0d\u9700\u8981\uff08\u7f3a\u7701\uff09\r\n    int  timeout;             // \u8fdb\u7a0b\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\r\n    char pname[51];           // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528 \u201cftpgetfiles_\u540e\u7f00\u201d \u7684\u65b9\u5f0f\r\n} starg;\r\n\r\nbool _xmltoarg(const char *strxmlbuffer); // \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4f53\u4e2d\r\n\r\nclogfile   logfile;   // \u65e5\u5fd7\u6587\u4ef6\u5bf9\u8c61\r\ncftpclient ftp;       // \u521b\u5efa ftp \u5ba2\u6237\u7aef\u5bf9\u8c61\r\ncpactive   pactive;   // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u5bf9\u8c61\r\n\r\nvoid _help();       // \u663e\u793a\u5e2e\u52a9\u6587\u6863\r\n\r\nstruct st_fileinfo {    // \u6587\u4ef6\u4fe1\u606f\u7ed3\u6784\u4f53\r\n\r\n    string filename;    // \u6587\u4ef6\u540d\r\n    string mtime;       // \u6587\u4ef6\u65f6\u95f4\r\n    st_fileinfo() = default;\r\n    st_fileinfo(const string &in_filename, const string &in_mtime):filename(in_filename), mtime(in_mtime) {}\r\n    void clear() { filename.clear(); mtime.clear(); }\r\n\r\n};\r\n\r\nmap<string, string> mfromok;           // \u5bb9\u56681\uff1a\u5b58\u653e\u5df2\u4e0b\u8f7d\u6210\u529f\u6587\u4ef6\uff0c\u4eceokfilename\u53c2\u6570\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u52a0\u8f7d\r\nlist<struct st_fileinfo> vfromnlist;   // \u5bb9\u56682\uff1a\u4e0b\u8f7d\u524d\u5217\u51fa\u670d\u52a1\u7aef\u6587\u4ef6\u540d\u7684\u5bb9\u5668\uff0c\u4ecenlist\u6587\u4ef6\u4e2d\u52a0\u8f7d\r\nlist<struct st_fileinfo> vtook;        // \u5bb9\u56683\uff1a\u672c\u6b21\u4e0d\u9700\u8981\u4e0b\u8f7d\u7684\u6587\u4ef6\u7684\u5bb9\u5668list<struct st_fileinfo> vdownload;\r\nlist<struct st_fileinfo> vdownload;    // \u5bb9\u56684\uff1a\u672c\u6b21\u9700\u8981\u4e0b\u8f7d\u7684\u6587\u4ef6\u7684\u5bb9\u5668\r\n\r\nbool loadokfile();          // \u52a0\u8f7d okfilename \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u5230\u5bb9\u5668 vfromok \u4e2d\r\nbool loadlistfile();        // \u628aftpclient.nlist() \u65b9\u6cd5\u83b7\u53d6\u5230\u7684list\u6587\u4ef6\u52a0\u8f7d\u5230\u5bb9\u5668vfromnlist\u4e2d\r\nbool compmap();             // \u6bd4\u8f83 vfromnlist \u548c mfromok\uff0c\u5f97\u5230 vtook \u548c vdownload\r\nbool writetookfile();       // \u628a\u5bb9\u5668 vtook \u4e2d\u7684\u6570\u636e\u5199\u5165 okfilename \u6587\u4ef6\uff0c\u8986\u76d6\u65e7\u6587\u4ef6\r\nbool appendtookfile(struct st_fileinfo &stfileinfo);      // \u628a\u4e0b\u8f7d\u6210\u529f\u7684\u6587\u4ef6\u8bb0\u5f55\u8ffd\u52a0\u5230 okfilename \u6587\u4ef6\u4e2d\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    // 1) \u4ece\u670d\u52a1\u5668\u67d0\u4e2a\u76ee\u5f55\u4e0b\u8f7d\u6587\u4ef6\uff0c\u53ef\u6307\u5b9a\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n    if (argc != 3) { _help(); return -1; }\r\n\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\u3002\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\u3002\r\n    // closeioandsignal(true);       // \u5173\u95ed0\u30011\u30012\u548c\u5ffd\u7565\u5168\u90e8\u7684\u4fe1\u53f7\uff0c\u5728\u8c03\u8bd5\u9636\u6bb5\uff0c\u8fd9\u884c\u4ee3\u7801\u53ef\u4ee5\u4e0d\u542f\u7528\u3002\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("logfile open failed (%s).\\n", argv[1]);\r\n        return -1;\r\n    }\r\n\r\n    // \u89e3\u6790 xml\uff0c\u5f97\u5230\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\r\n    if (_xmltoarg(argv[2]) == false) return -1;\r\n\r\n    pactive.addpinfo(starg.timeout, starg.pname); // \u628a\u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\u5199\u5165\u5171\u4eab\u5185\u5b58\r\n\r\n    // \u767b\u5f55 ftp \u670d\u52a1\u5668\r\n    if (ftp.login(starg.host, starg.username, starg.password, starg.mode) == false) {\r\n        logfile.write("ftp.login(%s, %s, %s) failed.\\n%s\\n", starg.host, starg.username, starg.password, ftp.response()); return -1;\r\n    }\r\n\r\n    // logfile.write("ftp.login ok.\\n");\r\n\r\n    // \u8fdb\u5165 ftp \u670d\u52a1\u5668\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\r\n    if (ftp.chdir(starg.remotepath) == false) {\r\n        logfile.write("ftp.chdir(%s) failed.\\n%s\\n", starg.remotepath, ftp.response()); return -1;\r\n    }\r\n\r\n    // \u8c03\u7528 ftpclient.nlist() \u65b9\u6cd5\uff0c\u5217\u51fa\u670d\u52a1\u5668\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u540d\uff0c\u4fdd\u5b58\u5728\u672c\u5730\u6587\u4ef6\u4e2d\r\n    if (ftp.nlist(".", sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid())) == false) {\r\n        logfile.write("ftp.nlist(%s) failed.\\n%s\\n", starg.remotepath, ftp.response()); return -1;\r\n    }\r\n    logfile.write("nlist(%s) ok.\\n", sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid()).c_str());\r\n    \r\n    pactive.uptatime(); // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\r\n\r\n    // \u628a ftpclient.nlist() \u65b9\u6cd5\u83b7\u53d6\u5230\u7684 list \u6587\u4ef6\uff0c\u52a0\u8f7d\u5230\u5bb9\u5668 vfromnlist \u4e2d\r\n    if (loadlistfile() == false) {\r\n        logfile.write("loadlistfile() failed.\\n%s\\n", ftp.response()); return -1;\r\n    }\r\n\r\n    if (starg.ptype == 1) {\r\n        // \u52a0\u8f7d okfilename \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u5230\u5bb9\u5668 mfromok \u4e2d\r\n        loadokfile();\r\n\r\n        // \u6bd4\u8f83 vfromnlist \u548c mfromok\uff0c\u5f97\u5230 vtook \u548c vdownload\r\n        compmap();\r\n\r\n        // \u628a\u5bb9\u5668 vtook \u4e2d\u7684\u6570\u636e\u5199\u5165 okfilename \u6587\u4ef6\uff0c\u8986\u76d6\u4e4b\u524d\u7684\u65e7 okfilename \u6587\u4ef6\r\n        writetookfile();\r\n    } else {\r\n        vfromnlist.swap(vdownload);\r\n    }\r\n\r\n    pactive.uptatime(); // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\r\n\r\n    string strremotefilename, strlocalfilename;\r\n    // \u904d\u5386 vdownload \u5bb9\u5668\r\n    for (auto &aa : vdownload) {\r\n\r\n        sformat(strremotefilename, "%s/%s", starg.remotepath, aa.filename.c_str());     // \u62fc\u63a5\u670d\u52a1\u7aef\u5168\u8def\u5f84\u7684\u6587\u4ef6\u540d\r\n        sformat(strlocalfilename, "%s/%s", starg.localpath, aa.filename.c_str());       // \u62fc\u63a5\u672c\u5730\u5168\u8def\u5f84\u7684\u6587\u4ef6\u540d\r\n\r\n        logfile.write("get %s ...\\n", strremotefilename.c_str());\r\n        // \u8c03\u7528 ftpclient.get() \u65b9\u6cd5\u4e0b\u8f7d\u6587\u4ef6\r\n        if (ftp.get(strremotefilename, strlocalfilename, starg.checkmtime) == false) {\r\n            logfile << "failed.\\n" << ftp.response() << "\\n"; return -1;\r\n        }\r\n\r\n        // logfile << "ok.\\n";\r\n\r\n        pactive.uptatime(); // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\r\n\r\n        // ptype == 1\uff0c\u589e\u91cf\u4e0b\u8f7d\u6587\u4ef6\r\n        if (starg.ptype == 1) appendtookfile(aa);\r\n\r\n        // ptype == 2\uff0c\u5220\u9664\u670d\u52a1\u7aef\u7684\u6587\u4ef6\r\n        if (starg.ptype == 2) {\r\n            if (ftp.ftpdelete(strremotefilename) == false) {\r\n                logfile.write("ftp.ftpdelete(%s) failed.\\n%s\\n", strremotefilename.c_str(), ftp.response()); return -1;\r\n            }\r\n        }\r\n\r\n        // ptype == 3\uff0c\u5907\u4efd\u670d\u52a1\u7aef\u7684\u6587\u4ef6\r\n        if (starg.ptype == 3) {\r\n            string strremotefilenamebak = sformat("%s/%s", starg.remotepathbak, aa.filename.c_str());\r\n            if (ftp.ftprename(strremotefilename, strremotefilenamebak) == false) {\r\n                logfile.write("ftp.ftprename(%s, %s) failed.\\n%s\\n", strremotefilename.c_str(), strremotefilenamebak.c_str(), ftp.response()); return -1;\r\n            }\r\n        }\r\n    }\r\n\r\n    return 0;\r\n}\r\n\r\nvoid _help() {\r\n\r\n    printf("\\n");\r\n    printf("Using: ../../tools/bin/ftpgetfiles logfilename xmlbuffer\\n\\n");\r\n    // printf("Sample: /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 30 /home/celfs/project/engi_cpp/49_project/tools/bin/ftpgetfiles /home/celfs/project/engi_cpp/49_project/log/idc/ftpgetfiles_surfdata.log " \\\r\n    //         "\\"<host>192.168.20.150:21</host><mode>1</mode>"\\\r\n    //         "<username>celfs</username><password>123</password>"\\\r\n    //         "<remotepath>/home/celfs/project/engi_cpp/49_project/tmp/idc/surfdata</remotepath><localpath>/home/celfs/project/engi_cpp/49_project/idcdata/surfdata</localpath>"\\\r\n    //         "<matchname>SURF_ZH*.XML,SURF_ZH*.CSV</matchname>"\\\r\n    //         "<ptype>1</ptype>"\\\r\n    //         "<remotepathbak>/home/celfs/project/engi_cpp/49_project/tmp/idc/surfdatabak</remotepathbak>"\\\r\n    //         "<okfilename>/home/celfs/project/engi_cpp/49_project/idcdata/ftplist/ftpgetfiles_test.xml</okfilename>"\r\n    //         "<checkmtime>true</checkmtime>\\"\\n\\n");\r\n\r\n    printf("Sample: /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 30 /home/celfs/project/engi_cpp/49_project/tools/bin/ftpgetfiles /home/celfs/project/engi_cpp/49_project/log/idc/ftpgetfiles_surfdata.log " \\\r\n        "\\"<host>192.168.20.150:21</host><mode>1</mode>"\\\r\n        "<username>celfs</username><password>123</password>"\\\r\n        "<remotepath>/home/celfs/project/engi_cpp/49_project/tmp/ftp/server</remotepath><localpath>/home/celfs/project/engi_cpp/49_project/tmp/ftp/client</localpath>"\\\r\n        "<matchname>*.TXT</matchname>"\\\r\n        "<ptype>1</ptype>"\\\r\n        "<okfilename>/home/celfs/project/engi_cpp/49_project/idcdata/ftplist/ftpgetfiles_test.xml</okfilename>"\r\n        "<checkmtime>true</checkmtime>"\\\r\n        "<timeout>30</timeout><pname>ftpgetfiles_test</pname>\\"\\n\\n");\r\n\r\n    printf("\u672c\u7a0b\u5e8f\u662f\u901a\u7528\u7684\u529f\u80fd\u6a21\u5757\uff0c\u7528\u4e8e\u628a\u8fdc\u7a0bftp\u670d\u52a1\u7aef\u7684\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730\u76ee\u5f55\u3002\\n");\r\n    printf("logfilename\u662f\u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n    printf("xmlbuffer\u4e3a\u6587\u4ef6\u4e0b\u8f7d\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\\n");\r\n    printf("<host>192.168.150.128:21</host> \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684IP\u548c\u7aef\u53e3\u3002\\n");\r\n    printf("<mode>1</mode> \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff0c2-\u4e3b\u52a8\u6a21\u5f0f\uff0c\u7f3a\u7701\u91c7\u7528\u88ab\u52a8\u6a21\u5f0f\u3002\\n");\r\n    printf("<username>celfs</username> \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u7528\u6237\u540d\u3002\\n");\r\n    printf("<password>123</password> \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u5bc6\u7801\u3002\\n");\r\n    printf("<remotepath>/tmp/idc/surfdata</remotepath> \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<localpath>/idcdata/surfdata</localpath> \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<matchname>SURF_ZH*.XML,SURF_ZH*.CSV</matchname> \u5f85\u4e0b\u8f7d\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\u3002"\\\r\n            "\u4e0d\u5339\u914d\u7684\u6587\u4ef6\u4e0d\u4f1a\u88ab\u4e0b\u8f7d\uff0c\u672c\u5b57\u6bb5\u5c3d\u53ef\u80fd\u8bbe\u7f6e\u7cbe\u786e\uff0c\u4e0d\u5efa\u8bae\u7528*\u5339\u914d\u5168\u90e8\u7684\u6587\u4ef6\u3002\\n");\r\n    printf("<ptype>1</ptype> \u6587\u4ef6\u4e0b\u8f7d\u6210\u529f\u540e\uff0c\u8fdc\u7a0b\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a"\\\r\n            "1-\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff1b2-\u5220\u9664\uff1b3-\u5907\u4efd\uff0c\u5982\u679c\u4e3a3\uff0c\u8fd8\u8981\u6307\u5b9a\u5907\u4efd\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<remotepathbak>/tmp/idc/surfdatabak</remotepathbak> \u6587\u4ef6\u4e0b\u8f7d\u6210\u529f\u540e\uff0c\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5907\u4efd\u76ee\u5f55\uff0c"\\\r\n            "\u6b64\u53c2\u6570\u53ea\u6709\u5f53ptype=3\u65f6\u624d\u6709\u6548\u3002\\n");\r\n    printf("<okfilename>/idcdata/ftplist/ftpgetfiles_test.xml</okfilename> \u5df2\u4e0b\u8f7d\u6210\u529f\u6587\u4ef6\u540d\u6e05\u5355\uff0c"\\\r\n            "\u6b64\u53c2\u6570\u53ea\u6709\u5f53ptype=1\u65f6\u624d\u6709\u6548\u3002\\n");\r\n    printf("<checkmtime>true</checkmtime> \u662f\u5426\u9700\u8981\u68c0\u67e5\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u65f6\u95f4\uff0ctrue-\u9700\u8981\uff0cfalse-\u4e0d\u9700\u8981\uff0c"\\\r\n            "\u6b64\u53c2\u6570\u53ea\u6709\u5f53ptype=1\u65f6\u624d\u6709\u6548\uff0c\u7f3a\u7701\u4e3afalse\u3002\\n");\r\n    printf("<timeout>30</timeout> \u4e0b\u8f7d\u6587\u4ef6\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u89c6\u6587\u4ef6\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u800c\u5b9a\u3002\\n");\r\n    printf("<pname>ftpgetfiles_test</pname> \u8fdb\u7a0b\u540d\uff0c\u5c3d\u53ef\u80fd\u91c7\u7528\u6613\u61c2\u7684\u3001\u4e0e\u5176\u5b83\u8fdb\u7a0b\u4e0d\u540c\u7684\u540d\u79f0\uff0c\u65b9\u4fbf\u6545\u969c\u6392\u67e5\u3002\\n\\n\\n");\r\n\r\n}\r\n\r\n// \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4e2d\r\nbool _xmltoarg(const char *strxmlbuffer) {\r\n\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n\r\n    getxmlbuffer(strxmlbuffer, "host", starg.host, 30);            // \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684IP\u548c\u7aef\u53e3\u3002\r\n    if (strlen(starg.host) == 0) {\r\n        logfile.write("host is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "mode", starg.mode);     // \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff0c2-\u4e3b\u52a8\u6a21\u5f0f\uff0c\u7f3a\u7701\u91c7\u7528\u88ab\u52a8\u6a21\u5f0f\u3002\r\n    if (starg.mode != 2) starg.mode = 1;\r\n\r\n    getxmlbuffer(strxmlbuffer, "username", starg.username, 30);    // \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u7528\u6237\u540d\u3002\r\n    if (strlen(starg.username) == 0) {\r\n        logfile.write("username is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "password", starg.password, 30);    // \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u5bc6\u7801\u3002\r\n    if (strlen(starg.password) == 0) {\r\n        logfile.write("password is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "remotepath", starg.remotepath, 255);    // \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\r\n    if (strlen(starg.remotepath) == 0) {\r\n        logfile.write("remotepath is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "localpath", starg.localpath, 255);      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\r\n    if (strlen(starg.localpath) == 0) {\r\n        logfile.write("localpath is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "matchname", starg.matchname, 100);      // \u5f85\u4e0b\u8f7d\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n    if (strlen(starg.matchname) == 0) {\r\n        logfile.write("matchname is null.\\n"); return false;\r\n    }\r\n\r\n    // \u4e0b\u8f7d\u540e\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff1b2-\u5220\u9664\uff1b3-\u5907\u4efd\u3002\r\n    getxmlbuffer(strxmlbuffer, "ptype", starg.ptype);\r\n    if ((starg.ptype != 1) && (starg.ptype != 2) && (starg.ptype != 3)) {\r\n        logfile.write("ptype is error.\\n"); return false;\r\n    }\r\n\r\n    // \u4e0b\u8f7d\u540e\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5907\u4efd\u76ee\u5f55\r\n    if (starg.ptype == 3) {\r\n        getxmlbuffer(strxmlbuffer, "remotepathbak", starg.remotepathbak, 255);\r\n        if (strlen(starg.remotepathbak) == 0) { logfile.write("remotepathbak is null.\\n"); return false; }\r\n    }\r\n\r\n    // \u589e\u91cf\u4e0b\u8f7d\u6587\u4ef6\r\n    if (starg.ptype == 1) {\r\n\r\n        getxmlbuffer(strxmlbuffer, "okfilename", starg.okfilename, 255);    // \u5df2\u4e0b\u8f7d\u6210\u529f\u6587\u4ef6\u540d\u6e05\u5355\r\n        if (strlen(starg.okfilename) == 0) { logfile.write("okfilename is null.\\n"); return false; }\r\n\r\n        // \u662f\u5426\u9700\u8981\u68c0\u67e5\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u65f6\u95f4\uff0ctrue-\u9700\u8981\uff0cfalse-\u4e0d\u9700\u8981\uff0c\u6b64\u53c2\u6570\u53ea\u6709\u5f53 ptype == 1 \u65f6\u624d\u6709\u6548\uff0c\u7f3a\u7701\u4e3a false\u3002\r\n        getxmlbuffer(strxmlbuffer, "checkmtime", starg.checkmtime);\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "timeout", starg.timeout);   // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\r\n    if (starg.timeout == 0) { logfile.write("timeout is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "pname", starg.pname, 50);   // \u8fdb\u7a0b\u540d\r\n    // if (strlen(starg.pname) == 0) { logfile.write("pname is null.\\n"); return false; }\r\n\r\n    return true;\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n    \r\n    printf("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\n// \u628a ftp.nlist() \u65b9\u6cd5\u83b7\u53d6\u5230\u7684 list \u6587\u4ef6\u52a0\u8f7d\u5230\u5bb9\u5668 vfromnlist \u4e2d\u3002\r\nbool loadlistfile() {\r\n    vfromnlist.clear();\r\n\r\n    cifile ifile;\r\n    if (ifile.open(sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid())) == false) {\r\n        logfile.write("ifile.open(%s) failed.\\n", sformat("/home/celfs/project/engi_cpp/49_project/tmp/nlist/ftpgetfiles_%d.nlist", getpid())); return false;\r\n    }\r\n\r\n    string strfilename;\r\n\r\n    while (true) {\r\n        if (ifile.readline(strfilename) == false) break;\r\n\r\n        if (matchstr(strfilename, starg.matchname) == false) continue;\r\n\r\n        if ((starg.ptype == 1) && (starg.checkmtime == true)) {\r\n            // \u83b7\u53d6 ftp \u670d\u52a1\u7aef\u6587\u4ef6\u65f6\u95f4\r\n            if (ftp.mtime(strfilename) == false) {\r\n                // printf("mtime = %s", ftp.m_mtime);\r\n                logfile.write("ftp.mtime(%s) failed.\\n", strfilename.c_str()); return false;\r\n            }\r\n        }\r\n\r\n        vfromnlist.emplace_back(strfilename, ftp.m_mtime);\r\n    }\r\n\r\n    ifile.closeandremove();\r\n\r\n    // for (auto &aa : vfromnlist) {\r\n    //     logfile.write("filename = %s, mtime = %s\\n", aa.filename.c_str(), aa.mtime.c_str());\r\n    // }\r\n\r\n    return true;\r\n}\r\n\r\n// \u52a0\u8f7d okfilename \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u5230\u5bb9\u5668 mfromok \u4e2d\r\nbool loadokfile() {\r\n\r\n    if (starg.ptype != 1) return true;\r\n\r\n    mfromok.clear();\r\n\r\n    cifile ifile;\r\n\r\n    // \u5982\u679c\u7a0b\u5e8f\u9996\u6b21\u8fd0\u884c\uff0cstarg.okfilename \u4e0d\u5b58\u5728\uff0c\u5e76\u975e\u9519\u8bef\uff0c\u6240\u4ee5\u5e94\u5f53\u8fd4\u56de true\r\n    if ((ifile.open(starg.okfilename)) == false) return true;\r\n\r\n    string strbuffer;\r\n\r\n    struct st_fileinfo stfileinfo;\r\n\r\n    while (true) {\r\n        stfileinfo.clear();\r\n\r\n        if (ifile.readline(strbuffer) == false) break;\r\n\r\n        getxmlbuffer(strbuffer, "filename", stfileinfo.filename);\r\n        getxmlbuffer(strbuffer, "mtime", stfileinfo.mtime);\r\n\r\n        mfromok[stfileinfo.filename] = stfileinfo.mtime;\r\n    }\r\n\r\n    for (auto &aa : mfromok)\r\n       logfile.write("filename=%s, mtime=%s\\n", aa.first.c_str(), aa.second.c_str());\r\n\r\n    return true;\r\n}\r\n\r\n// \u6bd4\u8f83 vfromnlist \u548c mfromok\uff0c\u5f97\u5230 vtook \u548c vdownload\r\nbool compmap() {\r\n\r\n    vtook.clear();\r\n    vdownload.clear();\r\n\r\n    // \u904d\u5386 vfromnlist\r\n    for (auto &aa : vfromnlist) {\r\n\r\n        auto it = mfromok.find(aa.filename);    // \u5728\u5bb9\u56681\u4e2d\u7528\u6587\u4ef6\u540d\u67e5\u627e\r\n        if (it != mfromok.end()) {\r\n            // \u82e5\u627e\u5230\u6587\u4ef6\uff0c\u5219\u5224\u65ad\u6587\u4ef6\u65f6\u95f4\r\n            if (starg.checkmtime == true) {\r\n                \r\n                // \u82e5\u6587\u4ef6\u65f6\u95f4\u4e5f\u76f8\u540c\uff0c\u5219\u4e0d\u9700\u91cd\u65b0\u4e0b\u8f7d\uff0c\u5426\u5219\u91cd\u65b0\u4e0b\u8f7d\r\n                if (it->second == aa.mtime) vtook.push_back(aa);    // \u6587\u4ef6\u65f6\u95f4\u6ca1\u6709\u53d8\u5316\uff0c\u4e0d\u9700\u4e0b\u8f7d\r\n                else vdownload.push_back(aa);    // \u9700\u91cd\u65b0\u4e0b\u8f7d\r\n\r\n            } else {\r\n                vtook.push_back(aa);    // \u4e0d\u9700\u91cd\u65b0\u4e0b\u8f7d\r\n            }\r\n        } else {\r\n            // \u82e5\u672a\u627e\u5230\u6587\u4ef6\uff0c\u628a\u8bb0\u5f55\u653e\u5165 vdownload \u5bb9\u5668\r\n            vdownload.push_back(aa);\r\n        }\r\n\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u628a\u5bb9\u5668 vtook \u4e2d\u7684\u6570\u636e\u5199\u5165 okfilename \u6587\u4ef6\uff0c\u8986\u76d6\u65e7\u6587\u4ef6\r\nbool writetookfile() {\r\n\r\n    cofile ofile;\r\n\r\n    if (ofile.open(starg.okfilename) == false) {\r\n        logfile.write("file.open(%s) failed.\\n", starg.okfilename); return false;\r\n    }\r\n\r\n    for (auto &aa : vtook) {\r\n        ofile.writeline("<filename>%s</filename><mtime>%s</mtime>\\n", aa.filename.c_str(), aa.mtime.c_str());\r\n    }\r\n\r\n    ofile.closeandrename();\r\n\r\n    return true;\r\n}\r\n\r\n// \u628a\u4e0b\u8f7d\u6210\u529f\u7684\u6587\u4ef6\u8bb0\u5f55\u8ffd\u52a0\u5230 okfilename \u6587\u4ef6\u4e2d\r\nbool appendtookfile(struct st_fileinfo &stfileinfo) {\r\n\r\n    cofile ofile;\r\n\r\n    // \u4ee5\u8ffd\u52a0\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\uff0c\u6ce8\u610f\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8981 false\r\n    if (ofile.open(starg.okfilename, false, ios::app) == false) {\r\n        logfile.write("file.open(%s) failed.\\n", starg.okfilename); return false;\r\n    }\r\n\r\n    ofile.writeline("<filename>%s</filename><mtime>%s</mtime>\\n", stfileinfo.filename.c_str(), stfileinfo.mtime.c_str());\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u4ee5\u6a21\u4eff\u4e0a\u8ff0\u5bb9\u5668\u5206\u6790\u7684\u56fe\uff0c\u7528\u4ee5\u5206\u6790\u7a0b\u5e8f\u7684\u7ed3\u6784\u4e0e\u5de5\u4f5c\u7a7a\u95f4\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u66f4\u65b0\u8fdb\u7a0b\u5fc3\u8df3\uff0c\u5b9e\u9645\u662f\u4fee\u6539\u5185\u5b58\u53d8\u91cf\u4e2d\u7684\u503c\uff0c\u591a\u5199\u51e0\u6b21\u5f00\u9500\u4e5f\u4e0d\u5927\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u8fdb\u7a0b\u5fc3\u8df3\u5c31\u662f\u7528\u6765\u63d0\u793a\u5b88\u62a4\u8fdb\u7a0b"}),"\uff1a\u8fd9\u4e2a\u7a0b\u5e8f",(0,l.jsx)(r.strong,{children:"\u8fd8\u6d3b\u7740"}),"\u3002\u81ea\u7136\u5730\uff0c\u82e5\u4e0b\u4e00\u6b65\u64cd\u4f5c\u53ef\u80fd\u5bfc\u81f4\u6b7b\u673a\uff0c\u5c31\u4e0d\u80fd\u5728\u8be5\u64cd\u4f5c\u4e4b\u540e\u66f4\u65b0\u5fc3\u8df3\uff0c\u5426\u5219\u9677\u5165\u6b7b\u5faa\u73af\uff1b\u6216\u8005\u4e0b\u4e00\u6b65\u64cd\u4f5c\u65f6\u95f4\u53ef\u80fd\u8f83\u957f\uff0c\u5c31\u5e94\u8be5\u5728\u5b83\u4e4b\u540e\u66f4\u65b0\u5fc3\u8df3\uff0c\u5237\u65b0\u5171\u4eab\u5185\u5b58\uff0c\u544a\u8bc9\u5b88\u62a4\u8fdb\u7a0b\uff0c\u8fd9\u4e2a\u7a0b\u5e8f\u53ea\u662f\u6267\u884c\u4e86\u4e00\u4e2a\u957f\u64cd\u4f5c\uff0c\u8fd8\u6d3b\u7740\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u5206\u6790\uff0c\u5c31\u80fd\u591f\u7406\u89e3\u5fc3\u8df3\u8fdb\u7a0b\u7684\u610f\u4e49\uff0c\u4ee5\u53ca\u5fc3\u8df3\u4fe1\u606f\u5e94\u5f53\u5728\u4f55\u65f6\u5237\u65b0\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5bf9\u4e8e\u5bb9\u56681\u30013\u30014\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u6570\u636e\u83b7\u5f97\u5173\u7cfb\u4e0d\u591f\u6e05\u6670\u3002\u5982\u4f55\u66f4\u6e05\u6670\u5730\u7406\u89e3\u4e0e\u6784\u5efa\u76f8\u5e94\u7684\u5bb9\u5668\uff1f"}),"\n",(0,l.jsx)(r.li,{children:"\u4ee5\u5f80\u64cd\u4f5c 1 \u4e2a\u5bb9\u5668\uff0c\u73b0\u5728\u64cd\u4f5c 4 \u4e2a\u5bb9\u5668\uff0c\u9700\u591a\u52a0\u7ec3\u4e60\u624d\u80fd\u4e60\u60ef\u4e0e\u719f\u7ec3\u3002\u8fd9\u79cd\u5c42\u9762\u7684\u591a\u5bb9\u5668\u64cd\u4f5c\uff0c\u5bf9\u6bd4\u4ee5\u524d\u505a\u7b97\u6cd5\u9898\u7684\u591a\u5bb9\u5668\u64cd\u4f5c\uff0c\u66f4\u4e3a\u590d\u6742\u3002"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u5982\u4f55\u7406\u89e3\u786e\u5b9a\u56db\u4e2a\u5bb9\u5668\u540e\uff0c\u6700\u5f00\u59cb ",(0,l.jsx)(r.code,{children:"vfromok"})," \u7684\u542b\u4e49\uff1f\u4e3a\u4ec0\u4e48\u8fd8\u8981\u4e0e\u4e4b\u6bd4\u8f83\uff1f\u4e0d\u662f\u5df2\u7ecf\u4e0d\u518d\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\u4e86\u5417\uff1f"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5bf9\u6bd4\u53d1\u73b0\uff0c\u5e94\u5f53\u662f\u7b14\u8bef\uff0c\u5b9e\u9645\u662f\t ",(0,l.jsx)(r.code,{children:"mfromok"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7a0b\u5e8f\u7684\u4ee3\u7801\u91cf\u4e0a\u53bb\u4e4b\u540e\uff08\u6dfb\u52a0\u5230\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u65f6\uff0c\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"loadokfile"})," \uff09\uff0c\u8111\u5b50\u6709\u70b9\u8ddf\u4e0d\u8fc7\u6765\uff0c\u4e0d\u80fd\u7b2c\u4e00\u65f6\u95f4\u53cd\u5e94\u51fd\u6570\u7684\u529f\u80fd\uff0c\u4e0d\u80fd\u53ca\u65f6\u660e\u767d\u6b63\u5728\u8fdb\u884c\u4ee3\u7801\u5b9e\u73b0\u8fc7\u7a0b\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u8fd9\u79cd\u60c5\u51b5\uff0c\u5e94\u5f53",(0,l.jsx)(r.strong,{children:"\u7acb\u5373\u505c\u4e0b\uff0c\u5148\u6574\u7406\u5206\u6563\u7684\u601d\u8def + \u5f53\u524d\u5b66\u4e60\u72b6\u6001\u5206\u6790\uff0c\u5176\u6b21\u518d\u5206\u6790\u4ee3\u7801\u7684\u529f\u80fd\uff0c\u660e\u767d\u6b63\u5728\u505a\u4ec0\u4e48"}),"\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u9020\u6210\u8fd9\u79cd\u8ba4\u77e5\u963b\u788d\u7684\u539f\u56e0\u662f\u4ec0\u4e48\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u5206\u5fc3\uff08\u8111\u5b50\u91cc\u5192\u51fa\u6765\u4eca\u5929\u65e9\u4e0a\u7ef4\u4fee\u7f51\u7edc\u7684\u53cd\u9988\uff0c\u6709\u5f88\u591a\u5410\u69fd\u7684\u5730\u65b9\uff0c\u4e5f\u5bf9\u65e0\u6cd5\u83b7\u5f97\u6709\u6548\u7684\u95ee\u9898\u53cd\u9988\u4fe1\u606f\u7684\u4e0d\u6ee1\uff1b\u522b\u4eba\u6577\u884d\u5730\u7ef4\u4fee\uff0c\u5bfc\u81f4\u540e\u9762\u7f51\u7edc\u95ee\u9898\u4f9d\u7136\u5b58\u5728\uff0c\u53c8\u803d\u8bef\u65f6\u95f4\uff0c\u53c8\u9700\u8981\u91cd\u65b0\u89c2\u5bdf\u548c\u9884\u7ea6\uff09\uff1b"}),"\n",(0,l.jsxs)(r.li,{children:["2\uff09\u6ca1\u6709\u8bb0\u4f4f\u521a\u521b\u5efa\u7684\u51e0\u4e2a\u5bb9\u5668\u7684\u540d\u5b57\uff0c\u4f7f\u7528\u5b83\u4eec\u7684\u65f6\u5019\uff0c\u4e00\u65f6\u95f4\u60f3\u4e0d\u8d77\u6765\uff0c\u4ee5\u4e3a\u662f\u9057\u6f0f\u4e86\u4ec0\u4e48\u4fe1\u606f\uff08\u6b64\u65f6\u5229\u7528 VSC \u7684\u63d0\u793a\u529f\u80fd\u5373\u53ef\uff0c\u53e6\u5916\u5e94\u5f53\u77e5\u9053\u5bb9\u5668\u7684\u547d\u540d ",(0,l.jsx)(r.code,{children:"m_from_ok"})," \u7684\u542b\u4e49\uff0c\u6559\u7a0b\u5c06\u5b83\u4eec\u8fde\u5728\u4e00\u8d77\uff0c\u6709\u70b9\u5f71\u54cd\u7406\u89e3\uff09\uff1b"]}),"\n",(0,l.jsx)(r.li,{children:"3\uff09\u867d\u7136\u5c06\u4ee3\u7801\u6d41\u7a0b\u5206\u6b65\u5217\u51fa\uff0c\u4f46\u6709\u70b9\u673a\u68b0\u5730\u5217\u6b65\u9aa4\uff0c\u6ca1\u6709\u7d27\u6263\u6b65\u9aa4\u6765\u95ee\u81ea\u5df1\u6b63\u5728\u5b66\u4ec0\u4e48\uff0c\u6b63\u5728\u5b9e\u73b0\u4ec0\u4e48\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"4\uff09\u4f11\u606f\u4e0d\u591f + \u6709\u522b\u7684\u4e8b\u60c5\u8981\u505a\u4f46\u672a\u505a\uff08\u4e0e\u5176\u8ba9\u522b\u7684\u4e8b\u60c5\u4f7f\u5f97\u5b66\u4e60\u5206\u5fc3\uff0c\u4e0d\u5982\u5148\u5904\u7406\u90a3\u4e9b\u7834\u4e8b\uff0c\u56de\u6765\u5b89\u5b89\u7a33\u7a33\u5730\u7ee7\u7eed\uff09\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"5\uff09\u4ee3\u7801\u8de8\u5ea6\u8f83\u5927\uff0c\u8fd8\u4e0d\u4e60\u60ef\u8fd9\u79cd\u89c4\u6a21\u7684\u4e0d\u65ad\u5728\u539f\u6709\u4ee3\u7801\u4e0a\u66f4\u6539\u4e0e\u8fed\u4ee3\u7684\u590d\u6742\u4ee3\u7801\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"6\uff09\u8fd9\u4e2a\u73af\u8282\u7684\u5185\u5bb9\uff0c\u672c\u8eab\u662f\u6709\u96be\u5ea6\u7684\uff0c\u5b66\u4e60\u6ca1\u90a3\u4e48\u987a\u5229\u5f88\u6b63\u5e38\uff0c\u4e0d\u5fc5\u5984\u81ea\u83f2\u8584\uff0c\u591a\u52a0\u8010\u5fc3\u5730\u5904\u7406\u4ee3\u7801\uff0c\u505a\u597d\u8bb0\u5f55\u4e0e\u603b\u7ed3\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"7\uff09\u5b9e\u5728\u96be\u7406\u89e3\uff0c\u5219\u53ef\u4ee5\u5c06\u7a0b\u5e8f\u6d41\u7a0b\u5217\u51fa\uff0c\u6309\u6bcf\u4e00\u6b65\u7406\u89e3\u4e0e\u5b9e\u73b0\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"8\uff09\u56db\u4e2a\u5bb9\u5668\u7684\u4ee3\u7801\u5b9e\u73b0\uff0c\u5177\u6709\u5f88\u5f3a\u7684\u4e1a\u52a1\u6027\u8d28\uff0c\u8fce\u96be\u800c\u4e0a\u65b9\u80fd\u7a81\u7834\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Linux \u7c98\u8d34\u6307\u4ee4\uff0c\u603b\u662f\u51fa\u73b0 prompt \u6d88\u5931\u7684\u73b0\u8c61\u3002"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240611155740411",src:e(76158).A+"",width:"882",height:"152"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"Linux \u7c98\u8d34\u547d\u4ee4\u65f6\uff0c\u5448\u73b0\u9010\u4e2a\u5b57\u7b26\u8f93\u5165\u7684\u7c98\u8d34\u52a8\u753b\uff0c\u5bf9\u4e8e\u957f\u6307\u4ee4\uff0c\u5219\u9700\u7b49\u5f85\u8bb8\u4e45\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u5173\u4e8e\u7c98\u8d34\u7684 BUG\uff0c\u5728\u4e0d\u540c\u7684 shell \u754c\u9762\u540c\u6837\u5b58\u5728\uff0cBUG \u884c\u4e3a\u4e00\u81f4\u3002"}),"\n",(0,l.jsx)(r.li,{children:"Linux \u5728 VSC \u4e0b\uff0cctrl + k \u53ef\u80fd\u70ed\u952e\u51b2\u7a81\uff0c\u5bfc\u81f4\u65e0\u6cd5\u6b63\u786e\u6d88\u9664\u5f53\u524d\u884c\u6307\u4ee4\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u9700\u8865\u5145 Linux \u547d\u4ee4\u884c\u7684\u64cd\u4f5c\u77e5\u8bc6\uff0c\u4f8b\u5982\u8df3\u8f6c\u884c\u9996\u3001\u8df3\u8f6c\u5230\u53c2\u6570\u7b49\u3002"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u6587\u4ef6\u6210\u529f\u4e0b\u8f7d\uff0c\u4f46",(0,l.jsx)(r.strong,{children:"\u4fee\u6539\u65f6\u95f4\u4e0d\u7edf\u4e00"}),"\uff1b\u6587\u4ef6\u65f6\u95f4\u4e00\u4fa7\u7684",(0,l.jsx)(r.strong,{children:"\u7f16\u53f7\u4e5f\u4e0d\u4e00\u81f4"}),"\u3002"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.del,{children:"\u53ef\u80fd\u662f\u4e0b\u8f7d\u540e\u65f6\u95f4\u66f4\u65b0\u7684\u4ee3\u7801\u51fa\u9519\u4e86\u3002"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240611161144629",src:e(8126).A+"",width:"655",height:"205"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u7a0b\u5e8f\u4ec5\u80fd\u5728 ",(0,l.jsx)(r.code,{children:"server"})," \u6587\u4ef6\u53d1\u751f\u4fee\u6539\u65f6\uff0c\u66f4\u65b0\u5df2\u4fee\u6539\u7684\u6587\u4ef6\u3002\u82e5\u4fdd\u6301 ",(0,l.jsx)(r.code,{children:"server"}),"  \u4e0d\u53d8\uff0c\u518d\u6b21\u5c06 ",(0,l.jsx)(r.code,{children:"client"})," \u6e05\u7a7a\uff0c\u7a0b\u5e8f\u5219\u4e0d\u518d\u6267\u884c\u3002"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u8fd9\u53ef\u80fd\u7531\u4e8e\u7a0b\u5e8f\u4ec5\u4ee5\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u4f5c\u4e3a\u5224\u65ad\u4f9d\u636e\u6709\u5173\u3002"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8fd9\u4e2a\u60f3\u6cd5\u662f\u9519\u8bef\u7684\uff0c\u903b\u8f91\u662f\u5148\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u82e5\u5b58\u5728\uff0c\u624d\u6bd4\u8f83\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\uff0c\u56e0\u6b64\u66f4\u65b0\u7684\u903b\u8f91\u6ca1\u6709\u95ee\u9898\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u4f46\u662f\u7f3a\u5c11\u4e86\u6e05\u9664\u5df2\u4e0b\u8f7d\u6587\u4ef6\u6e05\u5355\u7684\u529f\u80fd\uff0c\u5bfc\u81f4\u6e05\u7a7a\u6587\u4ef6\u540e\uff0c\u82e5\u6e05\u5355\u5b58\u5728\uff0c\u91cd\u65b0\u8fd0\u884c\u7a0b\u5e8f\u65f6\uff0c\u4e0d\u4f1a\u518d\u6b21\u6267\u884c\u4e0b\u8f7d\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u8fd9\u6837\u7684\u7a0b\u5e8f\u903b\u8f91\uff0c\u4e0d\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff0c\u662f\u8fc7\u4e8e\u7b80\u5355\u7684\u5224\u65ad\u573a\u666f\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"DEBUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"1\uff09\u6392\u9664\u7c97\u5fc3\u95ee\u9898\uff1a\u5bf9\u6bd4 demo \u4ee3\u7801"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u9057\u6f0f\u5224\u65ad\u6761\u4ef6\uff08L295 - 300\uff09"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'if ((starg.ptype == 1) && (starg.checkmtim == true)) { // \u9057\u6f0f\u5224\u65ad\u6761\u4ef6\r\n    // \u83b7\u53d6 ftp \u670d\u52a1\u7aef\u6587\u4ef6\u65f6\u95f4\r\n    if (ftp.mtime(strfilename) == false) {\r\n        logfile.write("ftp.mtime(%s) failed.\\n", strfilename.c_str()); return false;\r\n    }\r\n}\n'})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2\uff09\u6392\u9664\u7c97\u5fc3\u95ee\u9898\uff1a\u68c0\u67e5\u8c03\u7528\u53c2\u6570\uff08\u6682\u672a\u53d1\u73b0\u95ee\u9898\uff09"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"3\uff09\u8ffd\u6eaf\u91cd\u7f6e\u6587\u4ef6\u65f6\u95f4\u7684\u4ee3\u7801"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"4\uff09\u8c03\u8bd5\u8bfe\u7a0b\u4ee3\u7801\uff0c\u5bf9\u6bd4\u8f93\u51fa\u7ed3\u679c\uff08\u8c03\u8bd5\u7531\u4e8e\u8def\u5f84\u548c\u4ee3\u7801\u8fed\u4ee3\u7684\u7248\u672c\uff0c\u96be\u4ee5\u76f4\u63a5\u8c03\u8bd5\uff0c\u6700\u540e\u662f\u76f4\u63a5\u5728\u6211\u7684\u4ee3\u7801\u57fa\u7840\u4e0a\u8c03\u8bd5\uff0c\u5e76\u4e14\u89e3\u51b3\u4e86\u4e24\u4e2a BUG\uff09"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"5\uff09\u8865\u5145\u6ce8\u91ca + \u8c03\u6574\u683c\u5f0f + \u8c03\u6574\u58f0\u660e\u4e0e\u5b9e\u73b0\u987a\u5e8f"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"6\uff09\u4f18\u5316\u65b9\u5411"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.del,{children:"\u5df2\u4e0b\u8f7d\u6210\u529f\u6587\u4ef6\u7684\u6e05\u5355\uff0c\u5224\u65ad\u903b\u8f91\u53ef\u80fd\u5bfc\u81f4\u518d\u6b21\u6267\u884c\u7a0b\u5e8f\u4e0d\u518d\u4e0b\u8f7d\u6587\u4ef6\uff0c\u53ef\u68c0\u67e5\u8be5\u8def\u5f84\u6587\u4ef6\uff08L257\uff09"})}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:[(0,l.jsx)(r.code,{children:"compmap()"})," \u589e\u52a0\u5224\u65ad\u903b\u8f91\uff0c\u4e0d\u4ec5\u4ec5\u4f7f\u7528\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u3002\u4f46\u8fd9\u4e2a\u903b\u8f91\u660e\u660e\u662f\u5148\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u518d\u5224\u65ad\u6587\u4ef6\u65f6\u95f4\u662f\u5426\u53d1\u751f\u53d8\u5316\uff0c\u4e3a\u4f55\u4f1a\u51fa\u73b0\u524d\u9762\u7684\u95ee\u9898\uff1f"]})," \u95ee\u9898\u662f make \u4e0d\u80fd\u540c\u6b65 ",(0,l.jsx)(r.code,{children:"_ftp.cpp"})," \u7684\u4fee\u6539\u5bfc\u81f4\u7684\uff0c\u5e76\u4e14 make \u8def\u5f84\u6709\u9519\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u662f\u5426\u53ef\u80fd\u56e0\u4e3a ",(0,l.jsx)(r.code,{children:"swap"})," \u4e24\u4e2a\u5bb9\u5668\u7684\u903b\u8f91\u5bfc\u81f4\u7684\uff1f"]})," \u5206\u6790\u53d1\u73b0\uff0c\u4e0e\u6b64\u65e0\u5173\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u800c\u4e14\u5728 ",(0,l.jsx)(r.code,{children:"writetookfile()"})," \u4e2d\u4f7f\u7528\u4e86\u8986\u76d6\u7684\u903b\u8f91\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u4e0d\u66f4\u65b0\uff1f\u96be\u9053\u8986\u76d6\u7684\u6743\u9650\u4e0d\u591f\uff1f"]})," \u65e0\u5173\uff0c\u6743\u9650\u8db3\u591f\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u68c0\u67e5 ",(0,l.jsx)(r.code,{children:"okfilename"})," \u6e05\u5355\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u518d\u6b21\u8fd0\u884c\u7a0b\u5e8f\u524d\uff0c\u4ec5\u9700\u5220\u9664\u8be5\u6e05\u5355\uff0c\u65b9\u53ef\u5c06\u6e05\u7a7a\u7684\u6587\u4ef6\u91cd\u65b0\u4e0b\u8f7d"}),"\n",(0,l.jsx)(r.li,{children:"\u4f18\u5316\uff1a\u5728\u4e0b\u8f7d\u6587\u4ef6\u524d\uff0c\u53ef\u8bfb\u53d6\u6e05\u5355\uff0c\u5224\u65ad\u5176\u4e2d\u6587\u4ef6\u662f\u5426\u5df2\u5220\u9664"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:"rm -rf /home/celfs/project/engi_cpp/49_project/idcdata/ftplist/ftpgetfiles_test.xml\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u6587\u4ef6\u65f6\u95f4 BUG\uff08\u95ee\u9898\u5df2\u89e3\u51b3\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8c03\u8bd5\u53d1\u73b0\uff0c\u6587\u4ef6\u65f6\u95f4\u6309\u7167\u8bfb\u53d6\u7684\u65f6\u5206\u5199\u5165\uff0c\u800c\u8fd9\u4e2a\u8bfb\u53d6\u7684\u65f6\u95f4\u95f4\u9694\u5b58\u5728\u95ee\u9898\uff0c\u76f8\u5dee 8 \u5c0f\u65f6\uff0c\u53ef\u80fd\u662f\u7cfb\u7edf\u65f6\u533a\u4e0e\u5f00\u53d1\u6846\u67b6\u83b7\u53d6\u7684\u6709\u51b2\u7a81\u65f6\u95f4\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"_ftp.cpp"})," \u7684 ",(0,l.jsx)(r.code,{children:"bool cftpclient::mtime()"})," \u51fd\u6570"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539\u5176\u4e2d ",(0,l.jsx)(r.code,{children:"addtime()"})," \u7684\u65f6\u95f4\u504f\u79fb\u91cf\uff0c\u51e0\u6b21\u4fee\u6539\uff0c\u672a\u751f\u6548\uff0c\u53cd\u590d\u91cd\u65b0\u7f16\u8bd1\uff0c\u65f6\u95f4\u53d8\u6b63\u786e\u4e86\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u4f46\u5b9e\u9645\u60c5\u51b5\u662f\uff0c\u83ab\u540d\u5176\u5999\u5730\u65f6\u95f4\u5bf9\u4e86\u3002\u96be\u9053\u662f\u52a8\u6001\u5e93\u7684\u7f16\u8bd1\u95ee\u9898\uff1f"})," \u662f\u7684\uff0c\u5c31\u662f\u52a8\u6001\u5e93\u7684\u94fe\u63a5\u66f4\u65b0\u95ee\u9898\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ec8\u4e8e\u53d1\u73b0\u95ee\u9898\uff0c\u786e\u5b9e\u5c31\u662f ",(0,l.jsx)(r.code,{children:"_ftp.cpp"})," \u6587\u4ef6\uff0c\u4fee\u6539\u4e86 ",(0,l.jsx)(r.code,{children:"makefile"})," \u4e3a\u7edd\u5bf9\u8def\u5f84\uff0c\u5e76\u4e14\u5c06\u65f6\u95f4\u504f\u79fb\u91cf\u8bbe\u7f6e\u4e3a 0\uff0c\u5373\u53ef\u83b7\u5f97\u6b63\u786e\u7684\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\uff08\u56e0\u4e3a\u9ed8\u8ba4\u7684\u65f6\u95f4\u504f\u79fb\u91cf\u662f\u5c06\u7cfb\u7edf\u65f6\u95f4\u4ece UST \u8f6c\u6362\u4e3a CST\uff0c\u800c\u6211\u7684\u7cfb\u7edf\u8bbe\u7f6e\u4e86 CST \u65f6\u95f4\uff0c\u4e24\u6b21\u8f6c\u6362\u5f97\u5230\u7684\u65f6\u95f4\u81ea\u7136\u9519\u8bef\uff09\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u73b0\u5728\u7684\u4e3b\u8981\u95ee\u9898\u662f\uff0c\u5982\u4f55\u628a ",(0,l.jsx)(r.code,{children:"_ftp.cpp"})," \u7684\u4fee\u6539\uff0c\u6b63\u786e\u5730\u540c\u65f6\u7f16\u8bd1\u8d77\u6765\uff0c\u6216\u8005\u8bf4\u4f7f\u5f97\u66f4\u6539\u7acb\u5373\u751f\u6548\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u53e6\u5916\uff0c\u53d1\u73b0  ",(0,l.jsx)(r.code,{children:"makefile"})," \u7684\u8def\u5f84\u5199\u9519\u4e86\uff0c\u591a\u4e86\u4e00\u4e2a ",(0,l.jsx)(r.code,{children:"//public"})," \u7b26\u53f7\uff0c\u4f46\u662f\u7f16\u8bd1\u6ca1\u6709\u62a5\u9519\uff0c\u8fd9\u4e2a\u95ee\u9898\u8fd8\u633a\u9690\u79d8\u7684\u3002\u4ee5\u540e\u4e5f\u8981\u66f4\u8ba4\u771f\u5730\u5bf9\u5f85 make \u7684\u8def\u5f84\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ecf\u6d4b\u8bd5\uff0c\u53ea\u8981\u6210\u529f\u89e6\u53d1\u4e86 make\uff0c\u5373\u53ef\u540c\u6b65\u4fee\u6539\u8be5\u65f6\u95f4\u504f\u79fb\u91cf\uff0c\u800c\u7531\u4e8e  ",(0,l.jsx)(r.code,{children:"_ftp.cpp"})," \u7684\u94fe\u63a5\u65b9\u5f0f\uff0c\u4fee\u6539\u540e\u4e0d\u4f1a\u89e6\u53d1 make\uff0c\u56e0\u6b64\u53ef\u4ee5\u4fee\u6539 ",(0,l.jsx)(r.code,{children:"ftpgetfiles.cpp"}),"\uff0c\u4f8b\u5982\u589e\u52a0\u7a7a\u683c\u540e\u5220\u9664\uff0c\u89e6\u53d1\u6587\u4ef6\u4fdd\u5b58\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'bool cftpclient::mtime(const string &remotefilename)\r\n{\r\n    if (m_ftpconn == 0) return false;\r\n  \r\n    m_mtime.clear();\r\n  \r\n    string strmtime;\r\n    strmtime.resize(14);\r\n\r\n    if (FtpModDate(remotefilename.c_str(),&strmtime[0],14,m_ftpconn) == false) return false;\r\n\r\n    // \u628aUTC\u65f6\u95f4\u8f6c\u6362\u4e3a\u672c\u5730\u65f6\u95f4\u3002\r\n    // closeioandsignal(false);\r\n    // printf("strmtime = %s\\n", strmtime);\r\n    addtime(strmtime, m_mtime, 0, "yyyymmddhh24miss");\r\n    // addtime(strmtime, m_mtime, 0-8*60*60, "yyyymmddhh24miss");\r\n\r\n    return true;\r\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG \u53cd\u601d"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u641e\u6e05\u695a\u7f16\u8bd1\u5668\u7684\u94fe\u63a5\u3001\u94fe\u63a5\u7684\u66f4\u65b0\u65b9\u5f0f\uff0c\u5341\u5206\u91cd\u8981\u3002\u56e0\u6b64\uff0c\u5b66\u5b8c 68 \u8282\u540e\uff0c\u662f\u65f6\u5019\u8981\u68b3\u7406\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u4e86\uff0c\u987a\u4fbf\u628a\u4e4b\u524d\u7684\u76f8\u5173\u7b14\u8bb0\u6574\u7406\u4e00\u4e0b\uff0c\u653e\u5230 Typora\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u53e6\u5916\uff0c\u4e00\u5b9a\u8981\u8ba4\u771f\u6838\u5bf9 make \u8def\u5f84\uff0c\u5e76\u4e14\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/10 23:31:52 \u4ee3\u7801\u5b9e\u73b0 + \u95ee\u9898\u8bb0\u5f55 + \u72b6\u6001\u5206\u6790\uff0c2h44min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/11 18:10:16 \u4ee3\u7801\u5b8c\u5584 + \u8be6\u7ec6\u8c03\u8bd5\uff0c2h20min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/11 21:36:44 \u5b8c\u6210 debug\uff0c21min + 2h10min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"68-\u6587\u4ef6\u4e0a\u4f20\u6a21\u5757",children:"68 \u6587\u4ef6\u4e0a\u4f20\u6a21\u5757"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4efb\u52a1\uff1aftp \u5ba2\u6237\u7aef\u6587\u4ef6\u4e0a\u4f20\u5230 ftp \u670d\u52a1\u7aef\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u6587\u4ef6\u884c\u4e3a\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"1\uff09\u4e0a\u4f20\u6587\u4ef6\u540e\uff0c\u5220\u9664 ftp \u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u3002"}),"\n",(0,l.jsx)(r.li,{children:"2\uff09\u4e0a\u4f20\u6587\u4ef6\u540e\uff0c\u628a ftp \u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002"}),"\n",(0,l.jsx)(r.li,{children:"3\uff09\u589e\u91cf\u4e0a\u4f20\u6587\u4ef6\uff0c\u6bcf\u6b21\u53ea\u4e0a\u4f20\u65b0\u589e\u7684\u548c\u4fee\u6539\u8fc7\u7684\u6587\u4ef6\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5bb9\u5668\u5206\u6790\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5bb9\u56681 = \u4e0a\u4e00\u6b21\u5bb9\u56683 + \u4e0a\u4e00\u6b21\u5bb9\u56684\uff08\u5c06\u7a0b\u5e8f\u4e0a\u6b21\u8fd0\u884c\u7ed3\u679c\u5199\u5165\u6587\u4ef6\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240611232444662",src:e(44281).A+"",width:"1064",height:"472"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u590d\u5236\u4e0b\u8f7d\u6a21\u5757\u4ee3\u7801 --\x3e \u4fee\u6539\u4e3a\u4e0a\u4f20\u6a21\u5757\uff08\u589e\u91cf\u4fee\u6539\u3001\u66ff\u6362\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u7ec6\u8282\u8865\u5145\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u83b7\u53d6\u6587\u4ef6\u65f6\u95f4\u7684\u53c2\u6570\uff0c\u8981\u8fdb\u884c TCP \u901a\u8baf\uff0c\u4f1a\u6d88\u8017\u65f6\u95f4\uff0c\u82e5\u670d\u52a1\u7aef\u7684\u6587\u4ef6\u53ea\u4f1a\u66f4\u65b0\u4e0d\u4f1a\u4fee\u6539\uff0c\u5219\u4e0d\u9700\u8981\u6838\u5bf9\u65f6\u95f4\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4e0a\u4f20\u6a21\u5757\u4e2d\uff0c\u6838\u5bf9\u65f6\u95f4\u662f\u672c\u5730\u64cd\u4f5c\uff0c\u4e0d\u9700\u8981 TCP \u901a\u8baf\uff0c\u4e0d\u6d88\u8017\u7f51\u7edc\u8d44\u6e90\uff0c\u5219\u7f3a\u7701\u505a\u6cd5\u4e3a\u6838\u5bf9\u65f6\u95f4\uff08 ",(0,l.jsx)(r.code,{children:"_ftp.cpp"})," \u7684 ",(0,l.jsx)(r.code,{children:"put"})," \u7f3a\u7701\u5373\u53ef\uff0c\u56e0\u6b64 ",(0,l.jsx)(r.code,{children:"put"})," \u6a21\u5757\u4e2d\u4e0d\u9700\u8981\u5199\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u811a\u672c\u66f4\u65b0\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"start.sh"})," \u8fd0\u884c\u4e0b\u8f7d\u6a21\u5757 + \u8fd0\u884c\u4e0a\u4f20\u6a21\u5757"]}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"stop.sh"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5177\u4f53\u5b9e\u73b0"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u62f7\u8d1d\u6587\u4ef6 --\x3e \u201c\u4e0b\u8f7d --\x3e \u4e0a\u4f20\u201d --\x3e \u201c\u670d\u52a1\u7aef <--\x3e \u5ba2\u6237\u7aef\u201d"}),"\n",(0,l.jsxs)(r.li,{children:["\u6a21\u5757\u5316\u66f4\u6539\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"get()"})," --\x3e ",(0,l.jsx)(r.code,{children:"put()"})]}),"\n",(0,l.jsx)(r.li,{children:"\u7a0b\u5e8f\u53c2\u6570\u3001\u53c2\u6570\u8def\u5f84\u3001\u53c2\u6570\u987a\u5e8f"}),"\n",(0,l.jsx)(r.li,{children:"\u90e8\u5206\u4ee3\u7801\u903b\u8f91\u4fee\u6539"}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"makefile"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539\u7684\u7591\u95ee\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u662f\u5426\u4ecd\u9700\u521b\u5efa ftp \u5ba2\u6237\u7aef\u5bf9\u8c61\uff1f\u6b64\u5904\u7684 put \u662f\u4ece\u5ba2\u6237\u7aef\u53d1\u8d77\u4f20\u8f93\u8bf7\u6c42\uff0c\u5e76\u53d1\u9001\u6570\u636e\u3002\u4e8e\u670d\u52a1\u7aef\u800c\u8a00\uff0c\u521b\u5efa\u5ba2\u6237\u7aef\u4f9d\u7136\u662f\u5fc5\u8981\u7684\u3002\u5ba2\u6237\u7aef\u5bf9\u8c61\u4e0e\u5728\u5ba2\u6237\u7aef\u8fd0\u884c\u7684\u4ee3\u7801\u662f\u4e0d\u540c\u7684\u4e1c\u897f\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_ftp.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u53c2\u6570\u7684\u7ed3\u6784\u4f53\u3002\r\nstruct st_arg {\r\n    char host[31];            // \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684 IP \u548c\u7aef\u53e3\r\n    int  mode;                // \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff08\u7f3a\u7701\uff09\uff1b2-\u4e3b\u52a8\u6a21\u5f0f\r\n    char username[31];\r\n    char password[31];\r\n    char remotepath[256];     // \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\r\n    char localpath[256];      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\r\n    char matchname[256];      // \u5f85\u4e0a\u4f20\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n    int  ptype;               // \u4e0a\u4f20\u540e\u5ba2\u6237\u7aef\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u7a7a\uff1b2-\u5220\u9664\uff1b3-\u5907\u4efd\uff1b\r\n    char localpathbak[256];   // \u4e0a\u4f20\u540e\u5ba2\u6237\u7aef\u6587\u4ef6\u7684\u5907\u4efd\u76ee\u5f55\r\n    char okfilename[256];     // \u5df2\u4e0a\u4f20\u6210\u529f\u6587\u4ef6\u540d\u6e05\u5355\r\n    int  timeout;             // \u8fdb\u7a0b\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\r\n    char pname[51];           // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528 \u201cftpputfiles_\u540e\u7f00\u201d \u7684\u65b9\u5f0f\r\n} starg;\r\n\r\nstruct st_fileinfo {    // \u6587\u4ef6\u4fe1\u606f\u7ed3\u6784\u4f53\r\n\r\n    string filename;    // \u6587\u4ef6\u540d\r\n    string mtime;       // \u6587\u4ef6\u65f6\u95f4\r\n    st_fileinfo() = default;\r\n    st_fileinfo(const string &in_filename, const string &in_mtime):filename(in_filename), mtime(in_mtime) {}\r\n    void clear() { filename.clear(); mtime.clear(); }\r\n\r\n};\r\n\r\nmap<string, string> mfromok;           // \u5bb9\u56681\uff1a\u5b58\u653e\u5df2\u4e0a\u4f20\u6210\u529f\u6587\u4ef6\uff0c\u4ece starg.okfilename \u4e2d\u52a0\u8f7d\r\nlist<struct st_fileinfo> vfromdir;     // \u5bb9\u56682\uff1a\u5ba2\u6237\u7aef\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u540d\r\nlist<struct st_fileinfo> vtook;        // \u5bb9\u56683\uff1a\u672c\u6b21\u4e0d\u9700\u4e0a\u4f20\u7684\u6587\u4ef6\r\nlist<struct st_fileinfo> vupload;      // \u5bb9\u56684\uff1a\u672c\u6b21\u9700\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\r\n\r\nclogfile   logfile;   // \u65e5\u5fd7\u6587\u4ef6\u5bf9\u8c61\r\ncftpclient ftp;       // \u521b\u5efa ftp \u5ba2\u6237\u7aef\u5bf9\u8c61\r\ncpactive   pactive;   // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u5bf9\u8c61\r\n\r\nbool loadlocalfile();       // \u52a0\u8f7d starg.localpath \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5217\u8868\uff0c\u5230\u5bb9\u5668 vfromdir \u4e2d\r\nbool loadokfile();          // \u52a0\u8f7d starg.okfilename \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\uff0c\u5230\u5bb9\u5668 mfromok \u4e2d\r\nbool compmap();             // \u6bd4\u8f83 vfromnlist \u548c mfromok\uff0c\u5f97\u5230 vtook \u548c vdownload\r\nbool writetookfile();       // \u628a\u5bb9\u5668 vtook \u4e2d\u7684\u5185\u5bb9\u5199\u5165 starg.okfilename \u6587\u4ef6\uff0c\u8986\u76d6\u65e7\u6587\u4ef6\r\nbool appendtookfile(struct st_fileinfo &stfileinfo);      // \u82e5 starg.ptype == 1\uff0c\u628a\u4e0a\u4f20\u6210\u529f\u7684\u6587\u4ef6\u8bb0\u5f55\u8ffd\u52a0\u5230 okfilename \u6587\u4ef6\u4e2d\r\nbool _xmltoarg(const char *strxmlbuffer);                 // \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4f53\u4e2d\r\n\r\nvoid EXIT(int sig);         // \u7a0b\u5e8f\u9000\u51fa\u548c\u4fe1\u53f72\u300115\u7684\u5904\u7406\u51fd\u6570\u3002\r\nvoid _help();               // \u663e\u793a\u5e2e\u52a9\u6587\u6863\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    // 1) \u4ece\u5ba2\u6237\u7aef\u67d0\u4e2a\u76ee\u5f55\u4e0a\u4f20\u6587\u4ef6\uff0c\u53ef\u6307\u5b9a\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n    if (argc != 3) { _help(); return -1; }\r\n\r\n    // \u8bbe\u7f6e\u4fe1\u53f7\uff0c\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\u3002\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\u3002\r\n    // closeioandsignal(true);       // \u5173\u95ed0\u30011\u30012\u548c\u5ffd\u7565\u5168\u90e8\u7684\u4fe1\u53f7\uff0c\u5728\u8c03\u8bd5\u9636\u6bb5\uff0c\u8fd9\u884c\u4ee3\u7801\u53ef\u4ee5\u4e0d\u542f\u7528\u3002\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("logfile open failed (%s).\\n", argv[1]);\r\n        return -1;\r\n    }\r\n\r\n    // \u89e3\u6790 xml\uff0c\u5f97\u5230\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\r\n    if (_xmltoarg(argv[2]) == false) return -1;\r\n\r\n    pactive.addpinfo(starg.timeout, starg.pname); // \u628a\u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\u5199\u5165\u5171\u4eab\u5185\u5b58\r\n\r\n    // \u767b\u5f55 ftp \u670d\u52a1\u5668\r\n    if (ftp.login(starg.host, starg.username, starg.password, starg.mode) == false) {\r\n        logfile.write("ftp.login(%s, %s, %s) failed.\\n%s\\n", starg.host, starg.username, starg.password, ftp.response()); return -1;\r\n    }\r\n\r\n    logfile.write("ftp.login ok.\\n");\r\n\r\n    // \u628a starg.localpath \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5217\u8868\u52a0\u8f7d\u5230 vfromdir \u5bb9\u5668\u4e2d\r\n    if (loadlocalfile() == false) {\r\n        logfile.write("loadlocalfile() failead.\\n"); return -1;\r\n    }\r\n\r\n    pactive.uptatime(); // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\r\n\r\n    if (starg.ptype == 1) {\r\n        // \u52a0\u8f7d okfilename \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u5230\u5bb9\u5668 mfromok \u4e2d\r\n        loadokfile();\r\n\r\n        // \u6bd4\u8f83 vfromdir \u548c mfromok\uff0c\u5f97\u5230 vtook \u548c vdownload\r\n        compmap();\r\n\r\n        // \u628a\u5bb9\u5668 vtook \u4e2d\u7684\u6570\u636e\u5199\u5165 okfilename \u6587\u4ef6\uff0c\u8986\u76d6\u4e4b\u524d\u7684\u65e7 okfilename \u6587\u4ef6\r\n        writetookfile();\r\n    } else {\r\n        vfromdir.swap(vupload);\r\n    }\r\n\r\n    pactive.uptatime(); // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\r\n\r\n    string strremotefilename, strlocalfilename;\r\n    // \u904d\u5386 vupload \u5bb9\u5668\u3010\u6539\u3011\r\n    for (auto &aa : vupload) {\r\n\r\n        sformat(strremotefilename, "%s/%s", starg.remotepath, aa.filename.c_str());     // \u62fc\u63a5\u670d\u52a1\u7aef\u5168\u8def\u5f84\u7684\u6587\u4ef6\u540d\r\n        sformat(strlocalfilename, "%s/%s", starg.localpath, aa.filename.c_str());       // \u62fc\u63a5\u672c\u5730\u5168\u8def\u5f84\u7684\u6587\u4ef6\u540d\r\n\r\n        logfile.write("put %s ...\\n", strremotefilename.c_str());\r\n\r\n        // \u8c03\u7528 ftpclient.put() \u65b9\u6cd5\u4e0a\u4f20\u6587\u4ef6\u5230\u670d\u52a1\u7aef\uff0c\u53c2\u6570\u4e09 true \u7528\u4ee5\u6838\u5bf9\u6587\u4ef6\u5927\u5c0f\uff0c\u786e\u4fdd\u4e0a\u4f20\u6210\u529f\r\n        if (ftp.put(strlocalfilename, strremotefilename, true) == false) {\r\n            logfile << "failed.\\n" << ftp.response() << "\\n"; return -1;\r\n        }\r\n\r\n        logfile << "ok.\\n";\r\n\r\n        pactive.uptatime(); // \u66f4\u65b0\u8fdb\u7a0b\u7684\u5fc3\u8df3\r\n\r\n        // ptype == 1\uff0c\u589e\u91cf\u4e0a\u4f20\u6587\u4ef6\r\n        if (starg.ptype == 1) appendtookfile(aa);\r\n\r\n        // ptype == 2\uff0c\u5220\u9664\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\r\n        if (starg.ptype == 2) {\r\n            if (remove(strlocalfilename.c_str()) != 0) {\r\n                logfile.write("remove(%s) failed.\\n%s\\n", strlocalfilename.c_str()); return -1;\r\n            }\r\n        }\r\n\r\n        // ptype == 3\uff0c\u5907\u4efd\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\r\n        if (starg.ptype == 3) {\r\n            string strlocalfilenamebak = sformat("%s/%s", starg.localpathbak, aa.filename.c_str());\r\n            if (renamefile(strlocalfilenamebak, strremotefilename) == false) {\r\n                logfile.write("renamefile(%s, %s) failed.\\n%s\\n", strlocalfilenamebak.c_str(), strremotefilename.c_str()); return -1;\r\n            }\r\n        }\r\n    }\r\n\r\n    return 0;\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n    \r\n    printf("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\nvoid _help() {\r\n\r\n    printf("\\n");\r\n    printf("Using: ../../tools/bin/ftpputfiles logfilename xmlbuffer\\n\\n");\r\n\r\n    printf("Sample: /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 30 /home/celfs/project/engi_cpp/49_project/tools/bin/ftpputfiles /home/celfs/project/engi_cpp/49_project/log/idc/ftpputfiles_surfdata.log " \\\r\n        "\\"<host>127.0.0.1:21</host><mode>1</mode>"\\\r\n        "<username>celfs</username><password>123</password>"\\\r\n        "<localpath>/home/celfs/project/engi_cpp/49_project/tmp/idc/surfdata</localpath><remotepath>/home/celfs/project/engi_cpp/49_project//idcdata/surfdata</remotepath>"\\\r\n        "<matchname>SURF_ZH*.JSON</matchname>"\\\r\n        "<ptype>1</ptype>"\\\r\n        "<localpathbak>/home/celfs/project/engi_cpp/49_project/tmp/idc/surfdatabak</localpathbak>"\\\r\n        "<okfilename>/home/celfs/project/engi_cpp/49_project/idcdata/ftplist/ftpputfiles_surfdata.xml</okfilename>"\\\r\n        "<timeout>80</timeout><pname>ftpputfiles_surfdata</pname>\\"\\n\\n");\r\n\r\n    printf("\u672c\u7a0b\u5e8f\u662f\u901a\u7528\u7684\u529f\u80fd\u6a21\u5757\uff0c\u7528\u4e8e\u628a\u672c\u5730\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u4e0a\u4f20\u5230\u8fdc\u7a0b\u7684ftp\u670d\u52a1\u5668\u3002\\n");\r\n    printf("logfilename\u662f\u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n    printf("xmlbuffer\u4e3a\u6587\u4ef6\u4e0a\u4f20\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\\n");\r\n    printf("<host>127.0.0.1:21</host> \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684IP\u548c\u7aef\u53e3\u3002\\n");\r\n    printf("<mode>1</mode> \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff0c2-\u4e3b\u52a8\u6a21\u5f0f\uff0c\u7f3a\u7701\u91c7\u7528\u88ab\u52a8\u6a21\u5f0f\u3002\\n");\r\n    printf("<username>celfs</username> \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u7528\u6237\u540d\u3002\\n");\r\n    printf("<password>123</password> \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u5bc6\u7801\u3002\\n");\r\n    printf("<remotepath>/tmp/ftpputest</remotepath> \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<localpath>/tmp/idc/surfdata</localpath> \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<matchname>SURF_ZH*.JSON</matchname> \u5f85\u4e0a\u4f20\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\u3002"\\\r\n            "\u4e0d\u5339\u914d\u7684\u6587\u4ef6\u4e0d\u4f1a\u88ab\u4e0a\u4f20\uff0c\u672c\u5b57\u6bb5\u5c3d\u53ef\u80fd\u8bbe\u7f6e\u7cbe\u786e\uff0c\u4e0d\u5efa\u8bae\u7528*\u5339\u914d\u5168\u90e8\u7684\u6587\u4ef6\u3002\\n");\r\n    printf("<ptype>1</ptype> \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a"\\\r\n            "1-\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff1b2-\u5220\u9664\uff1b3-\u5907\u4efd\uff0c\u5982\u679c\u4e3a3\uff0c\u8fd8\u8981\u6307\u5b9a\u5907\u4efd\u7684\u76ee\u5f55\u3002\\n");\r\n    printf("<localpathbak>/tmp/idc/surfdatabak</localpathbak> \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5907\u4efd\u76ee\u5f55\uff0c"\\\r\n            "\u6b64\u53c2\u6570\u53ea\u6709\u5f53ptype=3\u65f6\u624d\u6709\u6548\u3002\\n");\r\n    printf("<okfilename>/idcdata/ftplist/ftpputfiles_surfdata.xml</okfilename> \u5df2\u4e0a\u4f20\u6210\u529f\u6587\u4ef6\u540d\u6e05\u5355\uff0c"\\\r\n            "\u6b64\u53c2\u6570\u53ea\u6709\u5f53ptype=1\u65f6\u624d\u6709\u6548\u3002\\n");\r\n    printf("<checkmtime>true</checkmtime> \u662f\u5426\u9700\u8981\u68c0\u67e5\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u65f6\u95f4\uff0ctrue-\u9700\u8981\uff0cfalse-\u4e0d\u9700\u8981\uff0c"\\\r\n            "\u6b64\u53c2\u6570\u53ea\u6709\u5f53ptype=1\u65f6\u624d\u6709\u6548\uff0c\u7f3a\u7701\u4e3afalse\u3002\\n");\r\n    printf("<timeout>80</timeout> \u4e0a\u4f20\u6587\u4ef6\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u89c6\u6587\u4ef6\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u800c\u5b9a\u3002\\n");\r\n    printf("<pname>ftpputfiles_surfdata</pname> \u8fdb\u7a0b\u540d\uff0c\u5c3d\u53ef\u80fd\u91c7\u7528\u6613\u61c2\u7684\u3001\u4e0e\u5176\u5b83\u8fdb\u7a0b\u4e0d\u540c\u7684\u540d\u79f0\uff0c\u65b9\u4fbf\u6545\u969c\u6392\u67e5\u3002\\n\\n\\n");\r\n\r\n}\r\n\r\n// \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4e2d\r\nbool _xmltoarg(const char *strxmlbuffer) {\r\n\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n\r\n    getxmlbuffer(strxmlbuffer, "host", starg.host, 30);            // \u8fdc\u7a0b\u670d\u52a1\u7aef\u7684IP\u548c\u7aef\u53e3\u3002\r\n    if (strlen(starg.host) == 0) {\r\n        logfile.write("host is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "mode", starg.mode);     // \u4f20\u8f93\u6a21\u5f0f\uff0c1-\u88ab\u52a8\u6a21\u5f0f\uff0c2-\u4e3b\u52a8\u6a21\u5f0f\uff0c\u7f3a\u7701\u91c7\u7528\u88ab\u52a8\u6a21\u5f0f\u3002\r\n    if (starg.mode != 2) starg.mode = 1;\r\n\r\n    getxmlbuffer(strxmlbuffer, "username", starg.username, 30);    // \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u7528\u6237\u540d\u3002\r\n    if (strlen(starg.username) == 0) {\r\n        logfile.write("username is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "password", starg.password, 30);    // \u8fdc\u7a0b\u670d\u52a1\u7aefftp\u7684\u5bc6\u7801\u3002\r\n    if (strlen(starg.password) == 0) {\r\n        logfile.write("password is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "remotepath", starg.remotepath, 255);    // \u8fdc\u7a0b\u670d\u52a1\u7aef\u5b58\u653e\u6587\u4ef6\u7684\u76ee\u5f55\r\n    if (strlen(starg.remotepath) == 0) {\r\n        logfile.write("remotepath is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "localpath", starg.localpath, 255);      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\r\n    if (strlen(starg.localpath) == 0) {\r\n        logfile.write("localpath is null.\\n"); return false;\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "matchname", starg.matchname, 100);      // \u5f85\u4e0a\u4f20\u6587\u4ef6\u5339\u914d\u7684\u89c4\u5219\r\n    if (strlen(starg.matchname) == 0) {\r\n        logfile.write("matchname is null.\\n"); return false;\r\n    }\r\n\r\n    // \u4e0a\u4f20\u540e\u5ba2\u6237\u7aef\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u4ec0\u4e48\u4e5f\u4e0d\u505a\uff1b2-\u5220\u9664\uff1b3-\u5907\u4efd\u3002\r\n    getxmlbuffer(strxmlbuffer, "ptype", starg.ptype);\r\n    if ((starg.ptype != 1) && (starg.ptype != 2) && (starg.ptype != 3)) {\r\n        logfile.write("ptype is error.\\n"); return false;\r\n    }\r\n\r\n    // \u4e0a\u4f20\u540e\u5ba2\u6237\u7aef\u6587\u4ef6\u7684\u5907\u4efd\u76ee\u5f55\r\n    if (starg.ptype == 3) {\r\n        getxmlbuffer(strxmlbuffer, "localpathbak", starg.localpathbak, 255);\r\n        if (strlen(starg.localpathbak) == 0) { logfile.write("localpathbak is null.\\n"); return false; }\r\n    }\r\n\r\n    // \u589e\u91cf\u4e0a\u4f20\u6587\u4ef6\r\n    if (starg.ptype == 1) {\r\n        getxmlbuffer(strxmlbuffer, "okfilename", starg.okfilename, 255);    // \u5df2\u4e0a\u4f20\u6210\u529f\u6587\u4ef6\u540d\u6e05\u5355\r\n        if (strlen(starg.okfilename) == 0) { logfile.write("okfilename is null.\\n"); return false; }\r\n    }\r\n\r\n    getxmlbuffer(strxmlbuffer, "timeout", starg.timeout);   // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\r\n    if (starg.timeout == 0) { logfile.write("timeout is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "pname", starg.pname, 50);   // \u8fdb\u7a0b\u540d\r\n    // if (strlen(starg.pname) == 0) { logfile.write("pname is null.\\n"); return false; }\r\n\r\n    return true;\r\n}\r\n\r\n// \u628a starg.localpath \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5217\u8868\u52a0\u8f7d\u5230\u5bb9\u5668 vfromdir \u4e2d\u3002\r\nbool loadlocalfile() {\r\n    vfromdir.clear();\r\n\r\n    cdir dir;\r\n    if (dir.opendir(starg.localpath, starg.matchname) == false) {\r\n        logfile.write("dir.opendir(%s) failed.\\n", starg.localpath); return false;\r\n    }\r\n\r\n    while (true) {\r\n        if (dir.readdir() == false) break;\r\n\r\n        vfromdir.emplace_back(dir.m_filename, dir.m_mtime);\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u52a0\u8f7d starg.okfilename \u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u5230\u5bb9\u5668 mfromok \u4e2d\r\nbool loadokfile() {\r\n\r\n    mfromok.clear();\r\n\r\n    cifile ifile;\r\n\r\n    // \u5982\u679c\u7a0b\u5e8f\u9996\u6b21\u4e0a\u4f20\u6587\u4ef6\uff0cstarg.okfilename \u4e0d\u5b58\u5728\uff0c\u5e76\u975e\u9519\u8bef\uff0c\u6240\u4ee5\u5e94\u5f53\u8fd4\u56de true\r\n    if ((ifile.open(starg.okfilename)) == false) return true;\r\n\r\n    string strbuffer;\r\n\r\n    struct st_fileinfo stfileinfo;\r\n\r\n    while (true) {\r\n        stfileinfo.clear();\r\n\r\n        if (ifile.readline(strbuffer) == false) break;\r\n\r\n        getxmlbuffer(strbuffer, "filename", stfileinfo.filename);\r\n        getxmlbuffer(strbuffer, "mtime", stfileinfo.mtime);\r\n\r\n        mfromok[stfileinfo.filename] = stfileinfo.mtime;\r\n    }\r\n\r\n    for (auto &aa : mfromok)\r\n       logfile.write("filename=%s, mtime=%s\\n", aa.first.c_str(), aa.second.c_str());\r\n\r\n    return true;\r\n}\r\n\r\n// \u6bd4\u8f83 vfromdir \u548c mfromok\uff0c\u5f97\u5230 vtook \u548c vupload\r\nbool compmap() {\r\n\r\n    vtook.clear();\r\n    vupload.clear();\r\n\r\n    // \u904d\u5386 vfromdir\r\n    for (auto &aa : vfromdir) {\r\n\r\n        auto it = mfromok.find(aa.filename);    // \u5728\u5bb9\u56681\u4e2d\u7528\u6587\u4ef6\u540d\u67e5\u627e\r\n        if (it != mfromok.end()) {\r\n            // \u82e5\u627e\u5230\u6587\u4ef6\uff0c\u4e14\u65f6\u95f4\u4e5f\u76f8\u540c\uff0c\u5219\u4e0d\u9700\u91cd\u65b0\u4e0a\u4f20\uff0c\u5426\u5219\u91cd\u65b0\u4e0a\u4f20\r\n            if (it->second == aa.mtime) vtook.push_back(aa);    // \u6587\u4ef6\u65f6\u95f4\u6ca1\u6709\u53d8\u5316\uff0c\u4e0d\u9700\u4e0a\u4f20\r\n            else vupload.push_back(aa);    // \u9700\u91cd\u65b0\u4e0a\u4f20\r\n        } else {\r\n            // \u82e5\u672a\u627e\u5230\u6587\u4ef6\uff0c\u628a\u8bb0\u5f55\u653e\u5165 vupload \u5bb9\u5668\r\n            vupload.push_back(aa);\r\n        }\r\n\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u628a\u5bb9\u5668 vtook \u4e2d\u7684\u6570\u636e\u5199\u5165 okfilename \u6587\u4ef6\uff0c\u8986\u76d6\u65e7\u6587\u4ef6\r\nbool writetookfile() {\r\n\r\n    cofile ofile;\r\n\r\n    if (ofile.open(starg.okfilename) == false) {\r\n        logfile.write("file.open(%s) failed.\\n", starg.okfilename); return false;\r\n    }\r\n\r\n    for (auto &aa : vtook) {\r\n        ofile.writeline("<filename>%s</filename><mtime>%s</mtime>\\n", aa.filename.c_str(), aa.mtime.c_str());\r\n    }\r\n\r\n    ofile.closeandrename();\r\n\r\n    return true;\r\n}\r\n\r\n// \u628a\u4e0a\u4f20\u6210\u529f\u7684\u6587\u4ef6\u8bb0\u5f55\u8ffd\u52a0\u5230 okfilename \u6587\u4ef6\u4e2d\r\nbool appendtookfile(struct st_fileinfo &stfileinfo) {\r\n\r\n    cofile ofile;\r\n\r\n    // \u4ee5\u8ffd\u52a0\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\uff0c\u6ce8\u610f\u7b2c\u4e8c\u4e2a\u53c2\u6570\u8981 false\r\n    if (ofile.open(starg.okfilename, false, ios::app) == false) {\r\n        logfile.write("file.open(%s) failed.\\n", starg.okfilename); return false;\r\n    }\r\n\r\n    ofile.writeline("<filename>%s</filename><mtime>%s</mtime>\\n", stfileinfo.filename.c_str(), stfileinfo.mtime.c_str());\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4f18\u5316\u65b9\u5411"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u7ecf\u8fc7 67 \u8282\u4ee3\u7801 debug \u7684\u6d17\u793c\uff0c\u611f\u89c9\u6587\u4ef6\u884c\u4e3a\u53ef\u4ee5\u6269\u5c55\u591a\u51e0\u79cd\u3002\u4f8b\u5982\u589e\u91cf\u4e0a\u4f20\u7684\u540c\u65f6\uff0c\u68c0\u6d4b\u5ba2\u6237\u7aef\u6587\u4ef6\u662f\u5426\u88ab\u5220\u9664\uff0c\u82e5\u5220\u9664\uff0c\u5219\u91cd\u65b0\u4e0b\u8f7d\u3002\u5f53\u7136\uff0c\u6b63\u5e38\u6765\u8bf4\uff0c\u9664\u975e\u662f\u9700\u8981\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u5b8c\u5168\u540c\u6b65\uff0c\u5426\u5219\u5e76\u4e0d\u9700\u8981\u6539\u53d8\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u64cd\u4f5c\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f8b\u5b50\u4e00\uff08\u4e0d\u9700\u68c0\u6d4b\uff09\uff1a\u5047\u8bbe\u7528\u6237\u4ece\u7f51\u76d8\u4e0b\u8f7d\u4e86\u6587\u4ef6\uff0c\u7136\u540e\u7528\u5b8c\u4e86\u3001\u5220\u9664\u4e86\u8be5\u6587\u4ef6\uff0c\u670d\u52a1\u7aef\u4e0d\u53ef\u80fd\u8bf4\u6838\u5bf9\u540e\u91cd\u4f20\uff0c\u5f3a\u5236\u7528\u6237\u4fdd\u7559\u8be5\u6587\u4ef6\uff1b\u6240\u4ee5\uff0c\u8fd9\u4e9b\u6587\u4ef6\u884c\u4e3a\u662f\u6709\u4e00\u5b9a\u9002\u7528\u8303\u56f4\u7684\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u4f8b\u5b50\u4e8c\uff08\u9700\u68c0\u6d4b\uff09\uff1a\u5047\u8bbe\u670d\u52a1\u7aef\u4e0e\u5ba2\u6237\u7aef\u6587\u4ef6\u9700\u8981\u5b8c\u5168\u540c\u6b65\uff0c\u5426\u5219\u4e0d\u652f\u6301\u8fde\u63a5\u5efa\u7acb\u3002\u4f8b\u5982\u6e38\u620f\u5ba2\u6237\u7aef\uff0c\u6587\u4ef6\u6821\u9a8c\u53d1\u73b0\u5b58\u5728\u6b8b\u7f3a\uff0c\u5c31\u5fc5\u7136\u9700\u8981\u589e\u91cf\u4e0b\u8f7d\u6b8b\u7f3a\u7684\u6587\u4ef6\uff0c\u4ee5\u4fdd\u6301\u4e24\u7aef\u8d44\u6e90\u6570\u636e\u4e00\u81f4\uff0c\u907f\u514d\u610f\u5916\u548c\u975e\u6cd5\u8bbf\u95ee\u7684\u4ea7\u751f\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5c1d\u8bd5\u5b8f\u5b9a\u4e49\u957f\u8def\u5f84\uff0c\u5728 ",(0,l.jsx)(r.code,{children:".cpp"})," \u4f18\u5316\u8def\u5f84\u53c2\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:["\u4f18\u5316 ",(0,l.jsx)(r.code,{children:"start.sh"})]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u8fd8\u53ef\u8fdb\u4e00\u6b65\u5c06 ",(0,l.jsx)(r.code,{children:"idc, tmp, tools "})," \u7b49\u76ee\u5f55\u6574\u5408\u5230\u53d8\u91cf\uff0c\u8fd9\u91cc\u907f\u514d\u8bf8\u5982 ",(0,l.jsx)(r.code,{children:"idc"})," \u5728\u4e0d\u540c\u5c42\u7ea7\u5b50\u76ee\u5f55\u4e0b\u7684\u6b67\u4e49\uff0c\u5c31\u4e0d\u518d\u7ec6\u5316\u6574\u7406\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:'#!/bin/bash\r\n\r\n# \u957f\u8def\u5f84\u53d8\u91cf\r\nBASE_DIR="/home/celfs/project/engi_cpp/49_project"\r\nBIN_PROCCTL="$BASE_DIR/tools/bin/procctl"\r\n\r\nREMOTE_HOST="192.168.20.150:21"\r\n\r\n# \u542f\u52a8\u5b88\u62a4\u6a21\u5757\r\n#$BIN_PROCCTL 10 $BASE_DIR/tools/bin/checkproc $BASE_DIR/tmp/log/checkproc.log\r\n\r\n# \u751f\u6210\u6c14\u8c61\u7ad9\u70b9\u89c2\u6d4b\u7684\u5206\u949f\u6570\u636e\uff0c\u7a0b\u5e8f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\r\n$BIN_PROCCTL 60 \\\r\n$BASE_DIR/idc/bin/crtsurfdata \\\r\n$BASE_DIR/idc/ini/stcode.ini \\\r\n$BASE_DIR/tmp/idc/surfdata \\\r\n$BASE_DIR/log/idc/crtsurfdata.log csv,xml,json\r\n\r\n# \u6e05\u7406\u539f\u59cb\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u76ee\u5f55\uff08/tmp/idc/surfdata\uff09\u4e2d\u7684\u5386\u53f2\u6570\u636e\u6587\u4ef6\r\n$BIN_PROCCTL 300 \\\r\n$BASE_DIR/tools/bin/deletefiles \\\r\n$BASE_DIR/tmp/idc/surfdata "*" 0.02\r\n\r\n# \u538b\u7f29\u540e\u53f0\u670d\u52a1\u7a0b\u5e8f\u7684\u5907\u4efd\u65e5\u5fd7\r\n$BIN_PROCCTL 300 \\\r\n$BASE_DIR/tools/bin/gzipfiles \\\r\n$BASE_DIR/tmp/idc/surfdata "*.log.20*" 0.02\r\n\r\n# \u4ece\uff08/tmp/idc/surfdata\uff09\u76ee\u5f55\u4e0b\u8f7d\u539f\u59cb\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u6587\u4ef6\uff0c\u5b58\u653e\u5728\uff08/idcdata/surfdata\uff09\u76ee\u5f55\r\n$BIN_PROCCTL 30 \\\r\n$BASE_DIR/tools/bin/ftpgetfiles \\\r\n$BASE_DIR/log/idc/ftpgetfiles_surfdata.log \\\r\n"<host>$REMOTE_HOST</host><mode>1</mode>\\\r\n<username>celfs</username><password>123</password>\\\r\n<localpath>$BASE_DIR/idcdata/surfdata</localpath>\\\r\n<remotepath>$BASE_DIR/tmp/idc/surfdata</remotepath>\\\r\n<matchname>*.TXT</matchname><ptype>1</ptype>\\\r\n<okfilename>$BASE_DIR/idcdata/ftplist/ftpgetfiles_test.xml</okfilename>\\\r\n<checkmtime>true</checkmtime>\\\r\n<timeout>30</timeout><pname>ftpgetfiles_test</pname>"\r\n\r\n# \u6e05\u7406\uff08/tmp/idc/surfdata\uff09\u76ee\u5f55\u4e2d 0.04 \u5929\u4e4b\u524d\u7684\u6587\u4ef6\r\n$BIN_PROCCTL 300 \\\r\n$BASE_DIR/tools/bin/deletefiles \\\r\n$BASE_DIR/idcdata/surfdata "*" 0.04\r\n\r\n# \u628a\uff08/tmp/idc/surfdata\uff09\u76ee\u5f55\u7684\u539f\u59cb\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u6587\u4ef6\u4e0a\u4f20\u5230\uff08/tmp/ftpputtest\uff09\u76ee\u5f55\r\n# \u6ce8\u610f\uff0c\u5148\u521b\u5efa\u597d\u670d\u52a1\u7aef\u7684\u76ee\u5f55\uff1amkdir /tmp/ftpputtest\r\n$BIN_PROCCTL 30 \\\r\n$BASE_DIR/tools/bin/ftpputfiles \\\r\n$BASE_DIR/log/idc/ftpputfiles_surfdata.log \\\r\n"<host>127.0.0.1:21</host><mode>1</mode>\\\r\n<username>celfs</username><password>123</password>\\\r\n<localpath>$BASE_DIR/tmp/idc/surfdata</localpath>\\\r\n<remotepath>$BASE_DIR/tmp/ftpputtest</remotepath>\\\r\n<matchname>SURF_ZH*.JSON</matchname><ptype>1</ptype>\\\r\n<localpathbak>$BASE_DIR/tmp/idc/surfdatabak</localpathbak>\\\r\n<okfilename>$BASE_DIR/idcdata/ftplist/ftpputfiles_surfdata.xml</okfilename>\\\r\n<timeout>80</timeout><pname>ftpputfiles_surfdata</pname>"\r\n\r\n# \u6e05\u7406\uff08/tmp/ftpputest\uff09\u76ee\u5f55\u4e2d 0.04 \u5929 \u4e4b\u524d\u7684\u6587\u4ef6\r\n$BIN_PROCCTL 300 \\\r\n$BASE_DIR/tools/bin/deletefiles \\\r\n$BASE_DIR/tmp/ftpputtest "*" 0.04\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48\u4e00\u822c\u5bbd\u5e26\u7684\u4e0a\u4f20\u901f\u5ea6\u548c\u4e0b\u8f7d\u901f\u5ea6\u5dee\u522b\u80fd\u6709\u4e00\u4e2a\u6570\u91cf\u7ea7\u4e4b\u5927\uff1f"}),"\n",(0,l.jsx)(r.li,{children:"\u4e0a\u4f20\u6587\u4ef6\u4e2d\uff0c\u6838\u5bf9\u65f6\u95f4\u662f\u672c\u5730\u7684\u64cd\u4f5c\uff0c\u4e0d\u9700\u8981 TCP \u901a\u8baf\u3002\u5982\u4f55\u7406\u89e3\u8fd9\u4e00\u6b65\uff1f"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u7684\u53c2\u6570\uff0c\u592a\u957f\uff0c\u6709\u65e0\u529e\u6cd5\u7f29\u77ed\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4f8b\u5982\u811a\u672c\u8bed\u8a00\u4e2d\uff0c\u5c06\u91cd\u590d\u7684\u957f\u8def\u5f84\uff0c\u5b9a\u4e49\u4e3a\u53d8\u91cf\u3002\u540c\u7406\uff0c\u53ef\u5b8f\u5b9a\u4e49\u957f\u8def\u5f84\uff0c\u5728 ",(0,l.jsx)(r.code,{children:".cpp"})," \u4f18\u5316\u8def\u5f84\u53c2\u6570\u3002\u4ee3\u7801\u5982\u4e0b\uff1a"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:'BASE_DIR="/home/celfs/project/engi_cpp/49_project"\r\n\r\n$BASE_DIR/tools/bin/procctl\n'})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/07 20:56:37 P65-68 \u89c6\u9891"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/11 23:25:25 \u89c6\u9891 + \u6d41\u7a0b\u68b3\u7406\uff0c24min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/12 18:19:44 \u5177\u4f53\u5b9e\u73b0\uff0c\u4fee\u6539\u4ee3\u7801\u4e3a put \u6a21\u5757\uff0c2h13min + 41min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/12 20:53:50 \u5b8c\u5584\u811a\u672c\uff0c1h"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h2,{id:"\u7b2c\u5341\u7ae0-\u57fa\u4e8e-tcp-\u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757",children:"\u7b2c\u5341\u7ae0 \u57fa\u4e8e TCP \u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u6a21\u5757"}),"\n",(0,l.jsx)(r.h3,{id:"69-tcp-\u6587\u4ef6\u4f20\u8f93\u7684\u4e1a\u52a1\u9700\u6c42",children:"69 TCP \u6587\u4ef6\u4f20\u8f93\u7684\u4e1a\u52a1\u9700\u6c42"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6982\u62ec\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u57fa\u4e8e FTP \u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u7cfb\u7edf\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7b80\u5355\u3001\u901a\u7528"}),"\n",(0,l.jsx)(r.li,{children:"\u6548\u7387\u8f83\u4f4e\uff08\u5e95\u5c42 TCP \u901a\u8baf\u4e00\u95ee\u4e00\u7b54\uff0c\u4ea4\u4e92\u6b21\u6570\u8fc7\u591a\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u9002\u7528\u4e8e\u7cfb\u7edf\u4e4b\u95f4\u4f20\u8f93\u6587\u4ef6\uff0c\u4e0d\u9002\u5408\u5927\u91cf\u6587\u4ef6\u7684\u4f20\u8f93"}),"\n",(0,l.jsxs)(r.li,{children:["\u573a\u666f\uff1a\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e0b\u8f7d\uff1a\u5f00\u901a FTP \u670d\u52a1 + \u6587\u4ef6\u4e8e\u670d\u52a1\u5668 --\x3e \u5ba2\u6237\u7aef\u6309\u9700\u83b7\u53d6"}),"\n",(0,l.jsx)(r.li,{children:"\u4e0a\u4f20\uff1a\u5f00\u901a FTP \u670d\u52a1 + \u6587\u4ef6\u6307\u5b9a\u76ee\u5f55 --\x3e \u670d\u52a1\u7aef\u81ea\u884c\u83b7\u53d6"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u57fa\u4e8e TCP \u534f\u8bae\u7684\u6587\u4ef6\u4f20\u8f93\u7cfb\u7edf\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u81ea\u5b9a\u4e49\u901a\u8baf\u65b9\u5f0f"}),"\n",(0,l.jsx)(r.li,{children:"\u6548\u7387\u9ad8\uff08FTP \u7684 10 \u500d\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u9002\u7528\u4e8e\u7cfb\u7edf\u5185\u90e8\u5feb\u901f\u9ad8\u6548\u5730\u4f20\u8f93\u6587\u4ef6"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7591\u95ee\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48\u65e2\u7136 FTP \u57fa\u4e8e TCP \u901a\u8baf\u5b9e\u73b0\uff0c\u5b83\u7684\u6548\u7387\u6bd4\u76f4\u63a5\u4f7f\u7528 TCP \u534f\u8bae\u8981\u4f4e\uff1f\u662f\u56e0\u4e3a\u5c01\u88c5\u5ef6\u957f\u4e86\u901a\u8baf\u7684\u8def\u5f84\uff1f\u53e6\u5916\uff0cTCP \u534f\u8bae\u4e0d\u662f\u66f4\u57fa\u4e8e TCP \u8fde\u63a5\u7684\u901a\u8baf\u5417\uff1f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"70-\u6a21\u62df\u7f51\u4e0a\u94f6\u884capp\u670d\u52a1\u7aef",children:"70 \u6a21\u62df\u7f51\u4e0a\u94f6\u884cAPP\u670d\u52a1\u7aef"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6982\u62ec"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u672c\u8282\u5b9e\u73b0\u7f51\u4e0a\u94f6\u884cAPP\u7684\u901a\u8baf\u529f\u80fd\uff0c\u4e3b\u8981\u5e2e\u52a9\u590d\u4e60\u524d\u9762\u7f51\u7edc\u7f16\u7a0b\u7684\u77e5\u8bc6\uff0c\u4e3a\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\u70ed\u8eab\uff0c\u4e5f\u53ef\u987a\u4fbf\u5b66\u70b9\u65b0\u77e5\u8bc6\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u754c\u9762"}),"\n",(0,l.jsxs)(r.li,{children:["\u529f\u80fd\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u767b\u5f55\u4e1a\u52a1\uff08\u5206\u6790\u62a5\u6587\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u67e5\u8be2\u4f59\u989d"}),"\n",(0,l.jsx)(r.li,{children:"\u8f6c\u8d26\u4e1a\u52a1"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u5206\u6790"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5ba2\u6237\u7aef\u7a0b\u5e8f ",(0,l.jsx)(r.code,{children:"demo03_client.cpp"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5bf9\u8c61\uff1a\u5ba2\u6237\u7aef\u5bf9\u8c61"}),"\n",(0,l.jsx)(r.li,{children:"\u53d8\u91cf\uff1a\u53d1\u9001\u62a5\u6587\u7f13\u51b2\u533a\u3001\u63a5\u6536\u62a5\u6587\u7f13\u51b2\u533a"}),"\n",(0,l.jsx)(r.li,{children:"\u51fd\u6570\uff1a\u767b\u5f55\u3001\u67e5\u8be2\u4f59\u989d\u3001\u8f6c\u8d26\u5b50\u51fd\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u53c2\u6570\uff1a\u5728\u5b50\u51fd\u6570\u4e2d\uff0c\u76f4\u63a5\u5229\u7528 xml \u4f20\u9012\u7ed9\u670d\u52a1\u5668"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u52a1\u7aef\u7a0b\u5e8f ",(0,l.jsx)(r.code,{children:"demo04_server.cpp"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5bf9\u8c61\uff1a\u65e5\u5fd7\u5bf9\u8c61\u3001\u670d\u52a1\u7aef\u5bf9\u8c61"}),"\n",(0,l.jsx)(r.li,{children:"\u51fd\u6570\uff1a\u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\u3001\u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\u3001\u4e1a\u52a1\u4e3b\u51fd\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u53d8\u91cf\uff1a\u53d1\u9001\u62a5\u6587\u7f13\u51b2\u533a\u3001\u63a5\u6536\u62a5\u6587\u7f13\u51b2\u533a"}),"\n",(0,l.jsx)(r.li,{children:"\u53c2\u6570\uff1a"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8fd0\u884c\u670d\u52a1\u7aef\u7a0b\u5e8f --\x3e \u8fd0\u884c\u5ba2\u6237\u7aef\u7a0b\u5e8f --\x3e \u8fd0\u884c\u6210\u529f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240614211247268",src:e(68502).A+"",width:"701",height:"57"})}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240614211235941",src:e(18915).A+"",width:"699",height:"156"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u6a21\u62df\u7f51\u4e0a\u94f6\u884c APP \u5ba2\u6237\u7aef\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\nctcpclient tcpclient;   // \u521b\u5efa\u5ba2\u6237\u7aef\u5bf9\u8c61\r\n\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\n\r\nbool biz001();          // \u767b\u5f55\r\nbool biz002();          // \u67e5\u8be2\u4f59\u989d\r\nbool biz003();          // \u8f6c\u8d26\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using:   ./demo03 IP port\\n");\r\n        printf("Example: ./demo03 192.168.20.150 5005\\n");\r\n        return -1;\r\n    }\r\n    \r\n    if (tcpclient.connect(argv[1], atoi(argv[2])) == false) {\r\n        printf ("tcpclient.connect() failed.\\n"); return -1;\r\n    }\r\n\r\n    biz001();          // \u767b\u5f55\r\n    \r\n    biz002();          // \u67e5\u8be2\u4f59\u989d\r\n    \r\n    biz003();          // \u8f6c\u8d26\r\n\r\n    return 0;\r\n}\r\n\r\n// \u767b\u5f55\r\nbool biz001() {\r\n    strsendbuffer = "<bizid>1</bizid><username>celfs</username><password>12345</password>";\r\n    if (tcpclient.write(strsendbuffer) == false) {\r\n        printf("tcpclient.write() failed.\\n"); return false;\r\n    }\r\n    cout << "\u53d1\u9001\uff1a" << strsendbuffer << endl;\r\n\r\n    if (tcpclient.read(strrecvbuffer) == false) {\r\n        printf("tcpclient.read() failed.\\n"); return false;\r\n    }\r\n    cout << "\u63a5\u6536\uff1a" << strrecvbuffer << endl;\r\n\r\n    return true;\r\n}\r\n\r\n// \u67e5\u8be2\u4f59\u989d\r\nbool biz002() {\r\n    strsendbuffer = "<bizid>2</bizid><cardid>8888000000001</cardid>";\r\n    if (tcpclient.write(strsendbuffer) == false) {\r\n        printf("tcpclient.write() failed.\\n"); return false;\r\n    }\r\n    cout << "\u53d1\u9001\uff1a" << strsendbuffer << endl;\r\n\r\n    if (tcpclient.read(strrecvbuffer) == false) {\r\n        printf("tcpclient.read() failed.\\n"); return false;\r\n    }\r\n    cout << "\u63a5\u6536\uff1a" << strrecvbuffer << endl;\r\n\r\n    return true;\r\n}\r\n\r\n// \u8f6c\u8d26\r\nbool biz003() {\r\n    strsendbuffer = "<bizid>3</bizid><cardid1>8888000000001</cardid1><cardid2>8888000000002</cardid2><je>888.8</je>";\r\n    if (tcpclient.write(strsendbuffer) == false) {\r\n        printf("tcpclient.write() failed.\\n"); return false;\r\n    }\r\n    cout << "\u53d1\u9001\uff1a" << strsendbuffer << endl;\r\n\r\n    if (tcpclient.read(strrecvbuffer) == false) {\r\n        printf("tcpclient.read() failed.\\n"); return false;\r\n    }\r\n    cout << "\u63a5\u6536\uff1a" << strrecvbuffer << endl;\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u6a21\u62df\u7f51\u4e0a\u94f6\u884c APP \u670d\u52a1\u7aef\r\n#include "_public.h"\r\nusing namespace idc;\r\n\r\nclogfile logfile;       // \u521b\u5efa\u670d\u52a1\u7aef\u8fd0\u884c\u65e5\u5fd7\u5bf9\u8c61\r\nctcpserver tcpserver;   // \u521b\u5efa\u670d\u52a1\u7aef\u5bf9\u8c61\r\n\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\n\r\nbool bizmain();             // \u4e1a\u52a1\u529e\u7406\u4e3b\u51fd\u6570\r\n\r\nvoid FatherEXIT(int sig);   // \u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\nvoid ChildEXIT(int sig);    // \u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using:   ./demo04 port logfile\\n");\r\n        printf("Example: ./demo04 5005 /home/celfs/project/engi_cpp/49_project/tools/cpp/demo/log/idc/demo04.log\\n\\n");\r\n        return -1;\r\n    }\r\n\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, FatherEXIT); signal(SIGTERM, FatherEXIT);\r\n\r\n    if (logfile.open(argv[2]) == false) { printf("logfile.open(%s) failed.\\n", argv[2]); return -1; }\r\n\r\n    // \u670d\u52a1\u7aef\u521d\u59cb\u5316\r\n    if (tcpserver.initserver(atoi(argv[1])) == false) {\r\n        logfile.write("tcpserver.initserver(%s) failed.\\n", argv[1]); return -1;\r\n    }\r\n\r\n    while (true) {\r\n        \r\n        // \u83b7\u53d6\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\r\n        if (tcpserver.accept() == false) {\r\n            logfile.write("tcpserver.accept() failed.\\n"); FatherEXIT(-1);\r\n        }\r\n\r\n        logfile.write("\u5ba2\u6237\u7aef\uff08%s\uff09\u5df2\u8fde\u63a5\u3002\\n", tcpserver.getip());\r\n\r\n        if (fork() > 0) { tcpserver.closeclient(); continue; } // \u7236\u8fdb\u7a0b\u7ee7\u7eed\u56de\u5230 accept()\uff0c\r\n\r\n        // \u5b50\u8fdb\u7a0b\u91cd\u65b0\u8bbe\u7f6e\u9000\u51fa\u4fe1\u53f7\r\n        signal(SIGINT, ChildEXIT); signal(SIGTERM, ChildEXIT);\r\n\r\n        tcpserver.closelisten();\r\n\r\n        while (true) {\r\n\r\n            // \u5b50\u8fdb\u7a0b\u4e0e\u5ba2\u6237\u7aef\u8fdb\u7a0b\u901a\u8baf\uff0c\u5904\u7406\u4e1a\u52a1\r\n            if (tcpserver.read(strrecvbuffer) == false) {\r\n                logfile.write("tcpserver.read() failed.\\n"); ChildEXIT(-1);\r\n            }\r\n\r\n            bizmain();  // \u4e1a\u52a1\u5904\u7406\u4e3b\u51fd\u6570\r\n\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.send() failed.\\n"); ChildEXIT(-1);\r\n            }\r\n        }\r\n\r\n        ChildEXIT(0);\r\n    }\r\n}\r\n\r\nvoid FatherEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\u3002\r\n    signal(SIGINT,SIG_IGN); signal(SIGTERM,SIG_IGN);\r\n\r\n    logfile.write("\u7236\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n",sig);\r\n\r\n    tcpserver.closelisten();    // \u5173\u95ed\u76d1\u542c\u7684socket\u3002\r\n\r\n    kill(0,15);     // \u901a\u77e5\u5168\u90e8\u7684\u5b50\u8fdb\u7a0b\u9000\u51fa\u3002\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid ChildEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\u3002\r\n    signal(SIGINT,SIG_IGN); signal(SIGTERM,SIG_IGN);\r\n\r\n    logfile.write("\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0csig=%d\u3002\\n",sig);\r\n\r\n    tcpserver.closeclient();    // \u5173\u95ed\u5ba2\u6237\u7aef\u7684socket\u3002\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid biz001();   // \u767b\u5f55\u3002\r\nvoid biz002();   // \u67e5\u8be2\u4f59\u989d\u3002\r\nvoid biz003();   // \u8f6c\u5e10\u3002\r\n\r\n// \u4e1a\u52a1\u5904\u7406\u4e3b\u51fd\u6570\r\nbool bizmain() {\r\n\r\n    int bizid;  // \u4e1a\u52a1\u4ee3\u7801\r\n    getxmlbuffer(strrecvbuffer, "bizid", bizid);\r\n\r\n    switch(bizid) {\r\n        case 1:\r\n            biz001();\r\n            break;\r\n        case 2:\r\n            biz002();\r\n            break;\r\n        case 3:\r\n            biz003();\r\n            break;\r\n        default:    // \u975e\u6cd5\u62a5\u6587\r\n            strsendbuffer = "<retcode>9</retcode><message>\u4e1a\u52a1\u4e0d\u5b58\u5728\u3002</message>";\r\n            break;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nvoid biz001() {\r\n    string username, password;\r\n    getxmlbuffer(strrecvbuffer, "username", username);\r\n    getxmlbuffer(strrecvbuffer, "password", password);\r\n\r\n    if ((username == "celfs") && (password == "12345"))\r\n        strsendbuffer = "<retcode>0</retcode><message>\u6210\u529f\u3002</message>";\r\n    else\r\n        strsendbuffer = "<retcode>-1</retcode><message>\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u6b63\u786e\u3002</message>";\r\n}\r\n\r\nvoid biz002()   // \u67e5\u8be2\u4f59\u989d\u3002\r\n{\r\n    string cardid;\r\n    getxmlbuffer(strrecvbuffer, "cardid", cardid);  // \u83b7\u53d6\u5361\u53f7\u3002\r\n\r\n    // \u5047\u88c5\u64cd\u4f5c\u4e86\u6570\u636e\u5e93\uff0c\u5f97\u5230\u4e86\u5361\u7684\u4f59\u989d\u3002\r\n\r\n    strsendbuffer = "<retcode>0</retcode><ye>1888.8</ye>";\r\n}\r\n\r\nvoid biz003() {\r\n    string cardid1, cardid2;\r\n    getxmlbuffer(strrecvbuffer, "cardid1", cardid1);\r\n    getxmlbuffer(strrecvbuffer, "cardid2", cardid2);\r\n    double je;\r\n    getxmlbuffer(strrecvbuffer, "je", je);\r\n\r\n    // \u5047\u88c5\u64cd\u4f5c\u4e86\u6570\u636e\u5e93\uff0c\u66f4\u65b0\u4e86\u4e24\u4e2a\u8d26\u6237\u7684\u91d1\u989d\uff0c\u5b8c\u6210\u4e86\u8f6c\u5e10\u64cd\u4f5c\u3002\r\n\r\n    if ( je < 100 )\r\n        strsendbuffer = "<retcode>0</retcode><message>\u6210\u529f\u3002</message>";\r\n    else\r\n        strsendbuffer = "<retcode>-1</retcode><message>\u4f59\u989d\u4e0d\u8db3\u3002</message>";\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u82e5\u6709\u628a\u63e1\uff0c\u53ef\u81ea\u884c\u5199\u51fa\u7a0b\u5e8f\u3002\u5426\u5219\uff0c\u53ef\u5148\u770b\u5b8c\u89c6\u9891\uff0c\u518d\u81ea\u5df1\u5199\u51fa\u6765\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u611f\u609f / \u542f\u53d1"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5bf9\u4e8e\u6280\u672f\u7684\u590d\u76d8\uff0c\u53ef\u4ee5\u53c2\u8003\u76f4\u63a5\u5b9e\u73b0\u4e00\u4e2a\u5c0f\u578b\u9879\u76ee\uff0c\u9488\u5bf9\u6027\u5730\u590d\u4e60\u76f8\u5e94\u6280\u672f\u77e5\u8bc6\u3002\u7531\u6b64\uff0c\u5408\u7406\u800c\u51c6\u786e\u5730\u8bbe\u8ba1\u8fd9\u79cd\u590d\u76d8\u7528\u7684\u5c0f\u578b\u9879\u76ee\u5341\u5206\u91cd\u8981\uff0c\u9700\u8981\u7cfb\u7edf\u5316\u5730\u8fdb\u884c\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5177\u4f53\u5730\uff0c\u5185\u5bb9\u53ef\u4ee5\u5305\u62ec\u590d\u76d8\u77e5\u8bc6\u70b9\u3001\u77e5\u8bc6\u70b9\u7684\u8054\u7cfb\u3001UML\u3001\u9002\u91cf\u65b0\u77e5\u8bc6\uff08\u9879\u76ee\u53d8\u4f53 / \u65b0\u529f\u80fd / \u4f18\u5316\uff09\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u65e0\u8bba\u5982\u4f55\uff0c\u4f18\u5148\u5b9e\u73b0\u6280\u672f\u590d\u76d8\u7684\u76ee\u6807\uff0c\u628a\u63e1\u597d\u9879\u76ee\u7684\u590d\u6742\u7a0b\u5ea6\uff0c\u5176\u4ed6\u7684\u8865\u5145\u6027\u3001\u63d0\u9ad8\u6027\u7684\u5185\u5bb9\uff0c\u5e94\u5f53\u89c6\u60c5\u51b5\u800c\u5b9a\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u5217\u51fa\u4e86\u4ee3\u7801\u7684\u903b\u8f91\u6b65\u9aa4\uff0c\u4f46\u8ddd\u79bb\u5f00\u5c55\u66f4\u5177\u4f53\u3001\u66f4\u6709\u53ef\u64cd\u6027\u7684\u4ee3\u7801\u5b9e\u73b0\uff0c\u8fd8\u5f88\u8fdc\u3002\u56e0\u6b64\uff0c\u63a5\u7740\u9700\u8981\u5212\u5206\u6a21\u5757\uff0c\u786e\u5b9a\u6240\u9700\u7684\u5bf9\u8c61\u3001\u51fd\u6570\u8d44\u6e90\u7b49\u3002\u4f8b\u5982\uff0c\u4e09\u79cd\u4e1a\u52a1\u5148\u5b9a\u4e49\u4e09\u4e2a\u5b50\u51fd\u6570\uff0c\u4ece\u51fd\u6570\u7684\u53c2\u6570\uff0c\u786e\u5b9a\u6240\u9700\u7684\u5bf9\u8c61\u3002\u5176\u540e\u518d\u7f16\u5199\u4ee3\u7801\uff0c\u5e76\u4e14\u5728\u8fc7\u7a0b\u4e2d\u9010\u6e10\u8865\u5145\u5176\u4ed6\u8d44\u6e90\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u5bf9\u6bd4\u6211\u7684\u5b9e\u73b0\u601d\u8def\uff0c\u8bfe\u7a0b\u7684\u4ee3\u7801\u601d\u8def\u5341\u5206\u7b80\u5355\uff0c\u4e14\u6ca1\u6709\u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u53c2\u6570\u5168\u7528 xml \u89e3\u6790\uff0c\u800c\u4e14\u5176\u4e5f\u6ca1\u6709\u6309\u7167\u5e38\u89c4\u7684\u5b9e\u73b0\u903b\u8f91\uff0c\u4f8b\u5982\u4ece\u5ba2\u6237\u7aef\u4e3b\u51fd\u6570\u8f93\u5165\u4fe1\u606f\uff0c\u4ec5\u4ec5\u4f7f\u7528\u4e86\u786c\u7f16\u7801\u7684\u5b50\u51fd\u6570\u8c03\u7528\u4e09\u79cd\u4e1a\u52a1\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u8bfe\u7a0b\u4ee3\u7801\u7684\u53d1\u9001\u4e0e\u63a5\u6536\u7f13\u51b2\u533a\u53d8\u91cf\uff0c\u5176\u6ce8\u91ca\u662f\u5426\u5f04\u53cd\u4e86\uff1f"})," \u662f\u7684\uff0c\u5df2\u66f4\u6b63\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48\u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u521d\u59cb\u5316\uff1f\u91c7\u7528\u7684\u7f3a\u7701\u503c\uff1f"}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u52a1\u7aef\u7684\u7236\u8fdb\u7a0b\uff0c\u5728\u5173\u95ed\u7236\u8fdb\u7a0b\u7684\u5ba2\u6237\u7aef\u540e\uff0c\u56de\u5230\u5176 ",(0,l.jsx)(r.code,{children:"accept()"})," \u540e\uff0c\u662f\u5426\u4f1a\u963b\u585e\u7b49\u5f85\u65b0\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981\u6e05\u6670\u5730\u5206\u6790\uff0c\u96be\u9053\u5728\u4e8e\u7406\u89e3 ",(0,l.jsx)(r.code,{children:"fork()"})," \u4e4b\u540e\uff0c\u7a0b\u5e8f\u4e00\u5206\u4e3a\u4e8c\uff0c\u5c5e\u4e8e\u7236\u8fdb\u7a0b\u6216\u8005\u5b50\u8fdb\u7a0b\u7684\u4ee3\u7801\uff0c\u7531 ",(0,l.jsx)(r.code,{children:"fork()"})," \u8fd4\u56de\u7684 ",(0,l.jsx)(r.code,{children:"pid"})," \u51b3\u5b9a\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u56e0\u6b64\uff0c\u9700\u8981\u7406\u89e3 ",(0,l.jsx)(r.code,{children:"fork()"})," ",(0,l.jsx)(r.strong,{children:"\u4f55\u65f6\u8fd4\u56de"}),"\uff0c\u624d\u80fd\u4e32\u8054\u7236\u5b50\u8fdb\u7a0b\u5728\u6574\u4f53\u4ee3\u7801\u4e0a\u7684\u903b\u8f91\u5173\u7cfb\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5982\u4f55\u7406\u89e3\u7236\u8fdb\u7a0b\u4ee3\u7801\u5173\u95ed\u5ba2\u6237\u7aef\u7684\u65f6\u673a\uff1f\u662f\u5728\u5b50\u8fdb\u7a0b\u5bf9\u4e1a\u52a1\u5904\u7406\u5b8c\u6bd5\u540e\uff1f\u8fd9\u4e2a\u95ee\u9898\u4e0e ",(0,l.jsx)(r.code,{children:"fork()"})," \u7684\u8fd4\u56de\u65f6\u95f4\u76f4\u63a5\u76f8\u5173\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"logfile.open(/log/idc/demo04.log) failed."}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u7531\u4e8e\u8def\u5f84\u8f93\u5165\u9519\u8bef\uff0c\u5e94\u5f53\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"log/idc/demo04.log"})," \u8def\u5f84\uff0c\u53bb\u9664\u4e00\u4e2a\u659c\u6760\u3002\u6216\u8005\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u53e6\u5916\uff0c\u4e5f\u53ef\u80fd\u6743\u9650\u539f\u56e0\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"chmod -r 777 log/idc/demo04/log"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5ba2\u6237\u7aef\u9057\u6f0f\u4e86 IP \u4e0e\u7aef\u53e3\u83b7\u53d6\uff0c\u6f0f\u4e86 ",(0,l.jsx)(r.code,{children:"connect"})," \u6b65\u9aa4\uff0c\u8fd9\u79cd\u4f4e\u7ea7\u9519\u8bef\uff0c\u592a\u4e0d\u5e94\u8be5\u4e86\uff0c\u8bd5\u95ee\u53ea\u4f20\u5165\u4e86\u53c2\u6570\uff0c\u4e0d\u4f7f\u7528\u6216\u89e3\u6790\u53c2\u6570\uff0c\u600e\u4e48\u53ef\u80fd\u6210\u529f\u6267\u884c\uff1f"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/13 18:39:49 \u89c6\u9891 + \u4ee3\u7801\u601d\u8def\uff0c1h6min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/13 20:56:08 \u5ba2\u6237\u7aef\u4ee3\u7801\u5b9e\u73b0\uff0c1h1min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/13 22:04:10 \u670d\u52a1\u7aef\u4ee3\u7801\u90e8\u5206\u5b9e\u73b0\uff0c37min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/14 21:12:13 \u670d\u52a1\u7aef\u4ee3\u7801\u5b9e\u73b0 + \u8c03\u8bd5\uff0c1h"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"71-tcp-\u77ed\u8fde\u63a5\u548c\u957f\u8fde\u63a5",children:"71 TCP \u77ed\u8fde\u63a5\u548c\u957f\u8fde\u63a5"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6982\u62ec"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u77ed\u8fde\u63a5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f8b\u5982\u6253\u7535\u8bdd\uff0c\u63a5\u901a\u53ef\u4ee5\u4e00\u76f4\u804a\uff0c\u804a\u5b8c\u6302\u7535\u8bdd\uff1b\u4e0b\u6b21\u9700\u91cd\u65b0\u6253\u7535\u8bdd\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u7279\u70b9\uff1a\u4f7f\u7528\u7b80\u4fbf\uff0c\u4ee3\u7801\u7b80\u6d01\uff0c\u6548\u7387\u4e0d\u9ad8\uff08\u65ad\u5f00 + \u91cd\u8fde\u5f00\u9500\uff09\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240616172857955",src:e(22346).A+"",width:"1527",height:"958"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u957f\u8fde\u63a5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4f8b\u5982\u4f7f\u7528APP\uff0c\u4e00\u4f1a\u70b9\u51fb\u529f\u80fdA\uff0c\u4e00\u4f1a\u70b9\u51fb\u529f\u80fdB\uff0c\u6bcf\u70b9\u51fb\u4e00\u6b21\u529f\u80fd\uff0c\u5c06\u5efa\u7acb\u4e00\u6b21 TCP \u901a\u8baf\uff1b\u8bf7\u6c42\u62a5\u6587\u53ef\u6765\u81ea C \u7aef\u548c S \u7aef\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u7279\u70b9\uff1a\u4e00\u76f4\u8fde\u63a5\uff08\u9664\u7a0b\u5e8f\u9000\u51fa / \u65ad\u7f51\uff09\uff0c\u968f\u65f6\u901a\u8baf\uff0c\u9ad8\u6548\uff0c\u4ee3\u7801\u590d\u6742\uff0c\u9700\u4ee3\u7801\u7ba1\u7406\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8fde\u63a5\u5efa\u7acb\u524d\uff0c\u533a\u5206 S \u7aef\u548c C \u7aef\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u8fde\u63a5\u5efa\u7acb\u540e\uff0c\u53cc\u5411\u901a\u4fe1\uff0c\u4e0d\u533a\u5206 S \u7aef\u548c C \u7aef\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u7ba1\u7406\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u80cc\u666f\uff1a\u957f\u8fde\u63a5\u6d89\u53ca\u7684\u4e2d\u95f4\u53ef\u80fd\u73af\u8282\u5f88\u591a\uff0c\u5f53\u7a7a\u95f2\u65f6\u95f4\u8fc7\u957f\uff0c\u67d0\u4e2a\u73af\u8282\u53ef\u80fd\u65ad\u5f00\uff0c\u4e8e\u662f\uff0c\u4e3a\u4e86\u907f\u514d\u8fde\u63a5\u65ad\u5f00\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u53cd\u7a7a\u95f2\u62a5\u6587\uff0c\u5373\u5fc3\u8df3\u62a5\u6587\uff0c\u8fd9\u79cd\u7ba1\u7406\u5c42\u8fde\u63a5\u7684\u65b9\u6cd5\uff0c\u5373\u4e3a\u5fc3\u8df3\u673a\u5236\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5fc3\u8df3\u673a\u5236\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b9a\u671f\u5411\u8fde\u63a5\u5bf9\u7aef\u53d1\u9001\u7ea6\u5b9a\u683c\u5f0f\u7684\u62a5\u6587\uff0c\u5e76\u7b49\u5f85\u5bf9\u7aef\u56de\u5e94\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u5982\u5728\u7ea6\u5b9a\u65f6\u95f4\u5185\u8fd4\u56de\u4e86\u62a5\u6587\uff0c\u5219\u8fde\u63a5\u6b63\u5e38\uff0c\u5426\u5219\u5df2\u7ecf\u65ad\u5f00\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240616173002123",src:e(99554).A+"",width:"1425",height:"960"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6ce8\u610f\uff0c\u4e0a\u56fe\u65f6\u95f4\u5e76\u975e\u5b9e\u9645\u60c5\u51b5\uff0c\u4ec5\u4f5c\u6f14\u793a\u793a\u4f8b\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b\uff08\u5fc3\u8df3\u673a\u5236\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo03.cpp"})," --\x3e ",(0,l.jsx)(r.code,{children:"demo05.cpp"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6dfb\u52a0\u53c2\u6570"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"read()"})," \u589e\u52a0\u53c2\u6570\uff08\u5404\u5b50\u51fd\u6570\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo04.cpp"})," --\x3e ",(0,l.jsx)(r.code,{children:"demo06.cpp"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6dfb\u52a0\u53c2\u6570"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"read()"})," \u589e\u52a0\u53c2\u6570"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"makefile"})," \u4fee\u6539 --\x3e \u8c03\u8bd5 --\x3e \u8fd0\u884c\u6210\u529f"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u6a21\u62df\u7f51\u4e0a\u94f6\u884c APP \u5ba2\u6237\u7aef\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\nctcpclient tcpclient;   // \u521b\u5efa\u5ba2\u6237\u7aef\u5bf9\u8c61\r\n\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\n\r\nbool biz001(const int timeout);          // \u767b\u5f55\r\nbool biz002(const int timeout);          // \u67e5\u8be2\u4f59\u989d\r\nbool biz003(const int timeout);          // \u8f6c\u8d26\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 4) {\r\n        printf("Using:   ./demo05 IP por timeout\\n");\r\n        printf("Example: ./demo05 192.168.20.150 5005 10\\n");\r\n        return -1;\r\n    }\r\n    \r\n    if (tcpclient.connect(argv[1], atoi(argv[2])) == false) {\r\n        printf ("tcpclient.connect() failed.\\n"); return -1;\r\n    }\r\n\r\n    biz001(atoi(argv[3]));          // \u767b\u5f55\r\n    \r\n    biz002(atoi(argv[3]));          // \u67e5\u8be2\u4f59\u989d\r\n\r\n    sleep(12);      // \u4f11\u7720 13 \u79d2\uff0c\u8ba9 TCP \u8fde\u63a5\u8d85\u65f6\r\n    \r\n    biz003(atoi(argv[3]));          // \u8f6c\u8d26\r\n\r\n    return 0;\r\n}\r\n\r\n// \u767b\u5f55\r\nbool biz001(const int timeout) {\r\n    strsendbuffer = "<bizid>1</bizid><username>celfs</username><password>12345</password>";\r\n    if (tcpclient.write(strsendbuffer) == false) {\r\n        printf("tcpclient.write() failed.\\n"); return false;\r\n    }\r\n    cout << "\u53d1\u9001\uff1a" << strsendbuffer << endl;\r\n\r\n    if (tcpclient.read(strrecvbuffer, timeout) == false) {\r\n        printf("tcpclient.read() failed.\\n"); return false;\r\n    }\r\n    cout << "\u63a5\u6536\uff1a" << strrecvbuffer << endl;\r\n\r\n    return true;\r\n}\r\n\r\n// \u67e5\u8be2\u4f59\u989d\r\nbool biz002(const int timeout) {\r\n    strsendbuffer = "<bizid>2</bizid><cardid>8888000000001</cardid>";\r\n    if (tcpclient.write(strsendbuffer) == false) {\r\n        printf("tcpclient.write() failed.\\n"); return false;\r\n    }\r\n    cout << "\u53d1\u9001\uff1a" << strsendbuffer << endl;\r\n\r\n    if (tcpclient.read(strrecvbuffer, timeout) == false) {\r\n        printf("tcpclient.read() failed.\\n"); return false;\r\n    }\r\n    cout << "\u63a5\u6536\uff1a" << strrecvbuffer << endl;\r\n\r\n    return true;\r\n}\r\n\r\n// \u8f6c\u8d26\r\nbool biz003(const int timeout) {\r\n    strsendbuffer = "<bizid>3</bizid><cardid1>8888000000001</cardid1><cardid2>8888000000002</cardid2><je>888.8</je>";\r\n    if (tcpclient.write(strsendbuffer) == false) {\r\n        printf("tcpclient.write() failed.\\n"); return false;\r\n    }\r\n    cout << "\u53d1\u9001\uff1a" << strsendbuffer << endl;\r\n\r\n    if (tcpclient.read(strrecvbuffer, timeout) == false) {\r\n        printf("tcpclient.read() failed.\\n"); return false;\r\n    }\r\n    cout << "\u63a5\u6536\uff1a" << strrecvbuffer << endl;\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u6a21\u62df\u7f51\u4e0a\u94f6\u884c APP \u670d\u52a1\u7aef\r\n#include "_public.h"\r\nusing namespace idc;\r\n\r\nclogfile logfile;       // \u521b\u5efa\u670d\u52a1\u7aef\u8fd0\u884c\u65e5\u5fd7\u5bf9\u8c61\r\nctcpserver tcpserver;   // \u521b\u5efa\u670d\u52a1\u7aef\u5bf9\u8c61\r\n\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\n\r\nbool bizmain();             // \u4e1a\u52a1\u529e\u7406\u4e3b\u51fd\u6570\r\n\r\nvoid FatherEXIT(int sig);   // \u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\nvoid ChildEXIT(int sig);    // \u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 4) {\r\n        printf("Using:   ./demo06 port logfile timeout\\n");\r\n        printf("Example: ./demo06 5005 /home/celfs/project/engi_cpp/49_project/tools/cpp/demo/log/idc/demo06.log 10\\n\\n");\r\n        return -1;\r\n    }\r\n\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, FatherEXIT); signal(SIGTERM, FatherEXIT);\r\n\r\n    if (logfile.open(argv[2]) == false) { printf("logfile.open(%s) failed.\\n", argv[2]); return -1; }\r\n\r\n    // \u670d\u52a1\u7aef\u521d\u59cb\u5316\r\n    if (tcpserver.initserver(atoi(argv[1])) == false) {\r\n        logfile.write("tcpserver.initserver(%s) failed.\\n", argv[1]); return -1;\r\n    }\r\n\r\n    while (true) {\r\n        \r\n        // \u83b7\u53d6\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\r\n        if (tcpserver.accept() == false) {\r\n            logfile.write("tcpserver.accept() failed.\\n"); FatherEXIT(-1);\r\n        }\r\n\r\n        logfile.write("\u5ba2\u6237\u7aef\uff08%s\uff09\u5df2\u8fde\u63a5\u3002\\n", tcpserver.getip());\r\n\r\n        if (fork() > 0) { tcpserver.closeclient(); continue; } // \u7236\u8fdb\u7a0b\u7ee7\u7eed\u56de\u5230 accept()\uff0c\r\n\r\n        // \u5b50\u8fdb\u7a0b\u91cd\u65b0\u8bbe\u7f6e\u9000\u51fa\u4fe1\u53f7\r\n        signal(SIGINT, ChildEXIT); signal(SIGTERM, ChildEXIT);\r\n\r\n        tcpserver.closelisten();\r\n\r\n        while (true) {\r\n\r\n            // \u5b50\u8fdb\u7a0b\u4e0e\u5ba2\u6237\u7aef\u8fdb\u7a0b\u901a\u8baf\uff0c\u5904\u7406\u4e1a\u52a1\r\n            if (tcpserver.read(strrecvbuffer, atoi(argv[3])) == false) {\r\n                logfile.write("tcpserver.read() failed.\\n"); ChildEXIT(0);\r\n            }\r\n\r\n            bizmain();  // \u4e1a\u52a1\u5904\u7406\u4e3b\u51fd\u6570\r\n\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.send() failed.\\n"); ChildEXIT(0);\r\n            }\r\n        }\r\n\r\n        ChildEXIT(0);\r\n    }\r\n}\r\n\r\nvoid FatherEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\u3002\r\n    signal(SIGINT,SIG_IGN); signal(SIGTERM,SIG_IGN);\r\n\r\n    logfile.write("\u7236\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n",sig);\r\n\r\n    tcpserver.closelisten();    // \u5173\u95ed\u76d1\u542c\u7684socket\u3002\r\n\r\n    kill(0,15);     // \u901a\u77e5\u5168\u90e8\u7684\u5b50\u8fdb\u7a0b\u9000\u51fa\u3002\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid ChildEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\u3002\r\n    signal(SIGINT,SIG_IGN); signal(SIGTERM,SIG_IGN);\r\n\r\n    logfile.write("\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0csig=%d\u3002\\n",sig);\r\n\r\n    tcpserver.closeclient();    // \u5173\u95ed\u5ba2\u6237\u7aef\u7684socket\u3002\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid biz001();   // \u767b\u5f55\u3002\r\nvoid biz002();   // \u67e5\u8be2\u4f59\u989d\u3002\r\nvoid biz003();   // \u8f6c\u5e10\u3002\r\n\r\n// \u4e1a\u52a1\u5904\u7406\u4e3b\u51fd\u6570\r\nbool bizmain() {\r\n\r\n    int bizid;  // \u4e1a\u52a1\u4ee3\u7801\r\n    getxmlbuffer(strrecvbuffer, "bizid", bizid);\r\n\r\n    switch(bizid) {\r\n        case 1:\r\n            biz001();\r\n            break;\r\n        case 2:\r\n            biz002();\r\n            break;\r\n        case 3:\r\n            biz003();\r\n            break;\r\n        default:    // \u975e\u6cd5\u62a5\u6587\r\n            strsendbuffer = "<retcode>9</retcode><message>\u4e1a\u52a1\u4e0d\u5b58\u5728\u3002</message>";\r\n            break;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nvoid biz001() {\r\n    string username, password;\r\n    getxmlbuffer(strrecvbuffer, "username", username);\r\n    getxmlbuffer(strrecvbuffer, "password", password);\r\n\r\n    if ((username == "celfs") && (password == "12345"))\r\n        strsendbuffer = "<retcode>0</retcode><message>\u6210\u529f\u3002</message>";\r\n    else\r\n        strsendbuffer = "<retcode>-1</retcode><message>\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u6b63\u786e\u3002</message>";\r\n}\r\n\r\nvoid biz002()   // \u67e5\u8be2\u4f59\u989d\u3002\r\n{\r\n    string cardid;\r\n    getxmlbuffer(strrecvbuffer, "cardid", cardid);  // \u83b7\u53d6\u5361\u53f7\u3002\r\n\r\n    // \u5047\u88c5\u64cd\u4f5c\u4e86\u6570\u636e\u5e93\uff0c\u5f97\u5230\u4e86\u5361\u7684\u4f59\u989d\u3002\r\n\r\n    strsendbuffer = "<retcode>0</retcode><ye>1888.8</ye>";\r\n}\r\n\r\nvoid biz003() {\r\n    string cardid1, cardid2;\r\n    getxmlbuffer(strrecvbuffer, "cardid1", cardid1);\r\n    getxmlbuffer(strrecvbuffer, "cardid2", cardid2);\r\n    double je;\r\n    getxmlbuffer(strrecvbuffer, "je", je);\r\n\r\n    // \u5047\u88c5\u64cd\u4f5c\u4e86\u6570\u636e\u5e93\uff0c\u66f4\u65b0\u4e86\u4e24\u4e2a\u8d26\u6237\u7684\u91d1\u989d\uff0c\u5b8c\u6210\u4e86\u8f6c\u5e10\u64cd\u4f5c\u3002\r\n\r\n    if ( je < 888.8 )\r\n        strsendbuffer = "<retcode>0</retcode><message>\u6210\u529f\u3002</message>";\r\n    else\r\n        strsendbuffer = "<retcode>-1</retcode><message>\u4f59\u989d\u4e0d\u8db3\u3002</message>";\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4f55\u5b50\u8fdb\u7a0b\u7684\u9000\u51fa\u51fd\u6570\uff0c\u5728\u5f02\u5e38\u65f6\uff0c\u5176\u8c03\u7528\u6539\u4e3a\u4e86\u586b\u5165 0\uff1f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/14 21:45:09 31min\uff0c2024/06/14 22:37:58 30min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"72-\u4e0a\u4f20\u6587\u4ef6\u4e00",children:"72 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e00\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"FTP \u4e0e TCP \u534f\u8bae"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"FTP \u901a\u5e38\u53ea\u9700\u5b9e\u73b0\u5ba2\u6237\u7aef\uff0cLinux \u81ea\u5e26\u5176\u670d\u52a1\u7aef\uff0c\u5176\u5e95\u5c42\u57fa\u4e8e TCP \u8fde\u63a5\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"TCP \u9700\u5b9a\u4e49\u5ba2\u6237\u7aef\u4ee5\u53ca\u670d\u52a1\u7aef\uff0c\u5176\u5e95\u5c42\u57fa\u4e8e\u81ea\u5b9a\u4e49\u7684\u901a\u4fe1\u534f\u8bae\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b\uff08\u642d\u5efa\u7a0b\u5e8f\u6846\u67b6 + \u5fc3\u8df3\u673a\u5236\uff09\r\n*\r\n*"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u672c\u7ae0\u4e0d\u4f1a\u5148\u4ecb\u7ecd\u7a0b\u5e8f\u7684\u6d41\u7a0b\u548c\u529f\u80fd\uff0c\u5c06\u4ece\u7b80\u5355\u6a21\u5757\u5f00\u59cb\uff0c\u4e00\u6b65\u6b65\u8fbe\u5230\u76ee\u6807\u3002\u6574\u4f53\u7740\u91cd\u5f53\u4e0b\uff0c\u641e\u6e05\u695a\u6bcf\u8282\u8bfe\u5185\u5bb9\u5373\u53ef\uff0c\u5b66\u5b8c\u81ea\u7136\u80fd\u591f\u7406\u89e3\u7a0b\u5e8f\u7684\u6d41\u7a0b\u548c\u529f\u80fd\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u7f51\u7edc\u901a\u8baf\u7a0b\u5e8f\u7684\u5f00\u53d1\uff0c\u901a\u5e38\u662f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e00\u8d77\u5199\u3001\u4e00\u8d77\u8c03\u8bd5\uff0c\u8fb9\u5199\u8fb9\u8c03\u8bd5\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"fileserver.cpp"})," \u4e2d\uff0c",(0,l.jsx)(r.code,{children:"listen()"})," \u64cd\u4f5c\u662f\u5728\u54ea\u4e2a\u73af\u8282\u8fdb\u884c\u7684\uff1f\u4e3a\u4ec0\u4e48\u53ea\u770b\u5230\u4e86 ",(0,l.jsx)(r.code,{children:"clostlisten()"})," \uff1f"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/15 1:26:46 \u5b8c\u6210\u4ee3\u7801\uff0c1h3min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"73-\u4e0a\u4f20\u6587\u4ef6\u4e8c",children:"73 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e8c\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u589e\u91cf\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53c2\u6570\u7ed3\u6784\u4f53\uff08\u641e\u61c2\u53c2\u6570\u542b\u4e49 --\x3e \u4e60\u5f97\u7a0b\u5e8f\u6d41\u7a0b\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u51fd\u6570\uff08\u5e2e\u52a9\u6587\u6863\u51fd\u6570\u3001 ",(0,l.jsx)(r.code,{children:"xml"})," \u89e3\u6790\u51fd\u6570\u3001\u767b\u5f55\u51fd\u6570\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"main"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5ba2\u6237\u7aef\u3001\u670d\u52a1\u7aef\u903b\u8f91\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4fe1\u53f7\u3001\u65e5\u5fd7\u3001\u53c2\u6570\u89e3\u6790\u3001\u8fde\u63a5\u3001\u767b\u5f55\u3001\u5fc3\u8df3"}),"\n",(0,l.jsx)(r.li,{children:"\u4fe1\u53f7\u3001\u65e5\u5fd7\u3001\u521d\u59cb\u5316\u3001\u7b49\u5f85\u8fde\u63a5\u3001\u7236\u8fdb\u7a0b\uff08\u5173\u95ed\u5ba2\u6237\u7aef\uff09\u3001\u5b50\u8fdb\u7a0b\uff08\u5173\u95ed\u76d1\u542c\u3001\u4fe1\u53f7\u91cd\u7f6e\u3001\u5904\u7406\u62a5\u6587\u3001\u4e0a\u4f20\u6587\u4ef6\u3001\u4fe1\u53f7\u9000\u51fa\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\u5b50\u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5fc3\u8df3\u62a5\u6587\u3001\u9000\u51fa\u51fd\u6570\u3001\u5e2e\u52a9\u6587\u6863\u3001\u53c2\u6570\u89e3\u6790\u3001\u767b\u5f55"}),"\n",(0,l.jsx)(r.li,{children:"\u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\u3001\u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\u3001\u5904\u7406\u6587\u4ef6\u62a5\u6587\u3001\u5904\u7406\u767b\u5f55\u62a5\u6587\uff08\u6839\u636e\u5ba2\u6237\u7aef\u7c7b\u578b\uff0c\u9009\u53d6\u5408\u9002\u7684\u4ee3\u7801\u8c03\u7528\uff0c\u9632\u6b62\u975e\u6cd5\u8bbf\u95ee\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u57fa\u4e8e TCP \u534f\u8bae\u7684\u6587\u4ef6\u4e0a\u4f20\u6a21\u5757\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\r\nstruct st_arg {\r\n    int  clienttype;         // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b1\r\n    char ip[31];             // \u670d\u52a1\u7aef\u7684 IP \u5730\u5740\r\n    int  port;               // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\r\n    char clientpath[256];    // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55 /data /data/dir1 /data/dir2\r\n    int  ptype;              // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\r\n    char clientpathbak[256]; // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5907\u4efd\u6839\u76ee\u5f55\uff0c\u5f53 ptype == 2 \u65f6\u6709\u6548\r\n    bool andchild;           // \u662f\u5426\u4e0a\u4f20 clientpath \u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\r\n    char matchname[256];     // \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\u3002\u5982 "*.TXT,*.XML"\r\n    char srvpath[256];       // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\uff0c\u63a7\u5236\u662f\u5426\u9012\u5f52\u8bbf\u95ee\u5b50\u76ee\u5f55\r\n    int  timetvl;            // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    int  timeout;            // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\r\n    char pname[51];          // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528 \u201ctcpputfiles_\u540e\u7f00\u201d \u7684\u65b9\u5f0f\r\n} starg;\r\n\r\n// \u5e2e\u52a9\u6587\u6863\r\nvoid _help();\r\n\r\n// \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4e2d\r\nbool _xmltoarg(const char *strxmlbuffer);\r\n\r\nclogfile logfile;       // \u521b\u5efa\u65e5\u5fd7\u5bf9\u8c61\r\nctcpclient tcpclient;   // \u521b\u5efa TCP \u901a\u8baf\u7684\u5ba2\u6237\u7aef\u5bf9\u8c61\r\n\r\n// \u7a0b\u5e8f\u9000\u51fa\u4fe1\u53f72\u300115\u7684\u5904\u7406\u51fd\u6570\r\nvoid EXIT(int sig);\r\n\r\nbool activetest();      // \u5fc3\u8df3\r\n\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv);\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        _help();\r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\u3002\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\u3002\r\n    // \u5728\u7f51\u7edc\u901a\u8baf\u7a0b\u5e8f\u4e2d\uff0c\u4e00\u822c\u4e0d\u5173IO\uff0c\u56e0\u4e3a\u67d0\u4e9b\u51fd\u6570\u53ef\u80fd\u4f1a\u5f801\u548c2\u4e2d\u8f93\u51fa\u4fe1\u606f\r\n    // \u5982\u679c\u5173\u4e861\u548c2\uff0c\u90a3\u4e481\u548c2\u4f1a\u88absocket\u91cd\u7528\uff0c\u54111\u548c2\u8f93\u51fa\u7684\u4fe1\u606f\u4f1a\u53d1\u9001\u5230\u7f51\u7edc\u4e2d\u3002\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u5931\u8d25\uff08%s\uff09\u3002\\n",argv[1]); return -1;\r\n    }\r\n\r\n    if (_xmltoarg(argv[2]) == false) return -1;\r\n\r\n    // \u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\r\n    if (tcpclient.connect(starg.ip, starg.port) == false) {\r\n        logfile.write("tcpclient.connect(%s, %d) failed.\\n", starg.ip, starg.port); EXIT(-1);\r\n    }\r\n\r\n    if (login(argv[2]) == false) { logfile.write("login() failed.\\n"); EXIT(-1); }\r\n\r\n    while (true) {\r\n\r\n        sleep(10);\r\n\r\n        // \u53d1\u9001\u5fc3\u8df3\u62a5\u6587\r\n        if (activetest() == false) break;\r\n\r\n    }\r\n\r\n    EXIT(0);\r\n}\r\n\r\n// \u5fc3\u8df3\r\nbool activetest() {\r\n\r\n    strsendbuffer = "<activetest>ok</activetest>";\r\n    logfile.write("\u53d1\u9001\uff1a%s\\n", strsendbuffer.c_str());\r\n    if (tcpclient.write(strsendbuffer) == false) return false;      // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\r\n\r\n    if (tcpclient.read(strrecvbuffer, 60) == false) return false;   // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\r\n    logfile.write("\u63a5\u6536\uff1a%s\\n", strsendbuffer.c_str());\r\n\r\n    // \u5fc3\u8df3\u673a\u5236\u7684\u4ee3\u7801\u53ef\u7b80\u5355\u5316\u5904\u7406\uff0c\u53ea\u9700\u8981\u6536\u5230\u5bf9\u7aef\u7684\u56de\u5e94\u5c31\u884c\u4e86\uff0c\u4e0d\u5fc5\u5224\u65ad\u56de\u5e94\u7684\u5185\u5bb9\r\n\r\n    return true;\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n\r\n    logfile.write("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\nvoid _help() {\r\n\r\n    string base_bin = "/home/celfs/project/engi_cpp/49_project";\r\n\r\n    printf("\\n");\r\n    printf("Using: %s/tools/bin/tcpputfiles logfilename xmlbuffer\\n\\n", base_bin.c_str());\r\n    printf(\r\n        "Example: %s/tools/bin/procctl 20 %s/tools/bin/tcpputfiles %s/log/idc/tcpputfiles_surfdata.log "\\\r\n        "\\"<ip>192.168.20.150</ip><port>5005</port>"\\\r\n        "<clientpath>%s/tmp/client</clientpath><ptype>1</ptype>"\\\r\n        "<srvpath>%s/tmp/server</srvpath>"\\\r\n        "<andchild>true</andchild><matchname>*.xml,*.txt</matchname><timetvl>10</timetvl>"\\\r\n        "<timeout>50</timeout><pname>tcpputfiles_surfdata</pname>\\"\\n\\n", \r\n        base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str()\r\n    ); \r\n\r\n    printf("\u672c\u7a0b\u5e8f\u662f\u6570\u636e\u4e2d\u5fc3\u7684\u516c\u5171\u529f\u80fd\u6a21\u5757\uff0c\u91c7\u7528tcp\u534f\u8bae\u628a\u6587\u4ef6\u4e0a\u4f20\u7ed9\u670d\u52a1\u7aef\u3002\\n");\r\n    printf("logfilename   \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n    printf("xmlbuffer     \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\\n");\r\n    printf("ip            \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\\n");\r\n    printf("port          \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\\n");\r\n    printf("ptype         \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\\n");\r\n    printf("clientpath    \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("clientpathbak \u6587\u4ef6\u6210\u529f\u4e0a\u4f20\u540e\uff0c\u672c\u5730\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\\n");\r\n    printf("andchild      \u662f\u5426\u4e0a\u4f20clientpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\uff0c\u7f3a\u7701\u4e3afalse\u3002\\n");\r\n    printf("matchname     \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982\\"*.TXT,*.XML\\"\\n");\r\n    printf("srvpath       \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("timetvl       \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u53d6\u503c\u57281-30\u4e4b\u95f4\u3002\\n");\r\n    printf("timeout       \u672c\u7a0b\u5e8f\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u89c6\u6587\u4ef6\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u800c\u5b9a\uff0c\u5efa\u8bae\u8bbe\u7f6e50\u4ee5\u4e0a\u3002\\n");\r\n    printf("pname         \u8fdb\u7a0b\u540d\uff0c\u5c3d\u53ef\u80fd\u91c7\u7528\u6613\u61c2\u7684\u3001\u4e0e\u5176\u5b83\u8fdb\u7a0b\u4e0d\u540c\u7684\u540d\u79f0\uff0c\u65b9\u4fbf\u6545\u969c\u6392\u67e5\u3002\\n\\n");\r\n}\r\n\r\nbool _xmltoarg(const char *strxmlbuffer) {\r\n\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n\r\n    getxmlbuffer(strxmlbuffer, "ip", starg.ip);\r\n    if (strlen(starg.ip) == 0) { logfile.write("ip is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "port", starg.port);\r\n    if (starg.port == 0) { logfile.write("port is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "ptype", starg.ptype);\r\n    if ((starg.ptype != 1) && (starg.ptype != 2)) { logfile.write("ptype not in (1, 2).\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "clientpath", starg.clientpath);\r\n    if (strlen(starg.clientpath) == 0) { logfile.write("clientpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "clientpathbak", starg.clientpathbak);\r\n    if ((starg.ptype == 2) && (strlen(starg.clientpathbak) == 0)) { logfile.write("clientpathbak is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "andchild", starg.andchild);\r\n\r\n    getxmlbuffer(strxmlbuffer, "matchname", starg.matchname);\r\n    if (strlen(starg.matchname) == 0) { logfile.write("matchname is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "srvpath", starg.srvpath);\r\n    if (strlen(starg.srvpath) == 0) { logfile.write("srvpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "timetvl", starg.timetvl);\r\n    if (starg.timetvl == 0) { logfile.write("timetvl is null.\\n"); return false; }\r\n\r\n    // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    // starg.timetvl\u6ca1\u6709\u5fc5\u8981\u8d85\u8fc730\u79d2\r\n    if (starg.timetvl > 30) starg.timetvl = 30;\r\n\r\n    // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e00\u5b9a\u8981\u5927\u4e8e starg.timetvl\r\n    getxmlbuffer(strxmlbuffer, "timeout", starg.timeout);\r\n    if (starg.timeout == 0) { logfile.write("timeout is null.\\n"); return false; }\r\n    if (starg.timeout <= starg.timetvl) { logfile.write("starg.timeout(%d) <= starg.timetvl(%d)\\n", starg.timeout, starg.timetvl); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "pname", starg.pname, 50);\r\n    //if (strlen(starg.pname) == 0) { logfile.write("pname is null.\\n"); return false; }\r\n\r\n    return true;\r\n}\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv) {\r\n\r\n    sformat(strsendbuffer, "%s<clienttype>1</clienttype>", argv);\r\n    logfile.write("\u53d1\u9001\uff1a%s\\n", strsendbuffer.c_str());\r\n    if (tcpclient.write(strsendbuffer) == false) return false;      // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\r\n\r\n    if (tcpclient.read(strrecvbuffer, 20) == false) return false;  // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\r\n    logfile.write("\u63a5\u6536\uff1a%s\\n", strrecvbuffer.c_str());\r\n\r\n    logfile.write("\u767b\u5f55(%s:%d)\u6210\u529f\u3002\\n", starg.ip, starg.port);\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\u3002\r\nstruct st_arg\r\n{\r\n    int  clienttype;           // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b1\u3002\r\n    char ip[31];               // \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\r\n    int  port;                 // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\r\n    char clientpath[256];      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002 /data /data/aaa /data/bbb\r\n    int  ptype;                // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\r\n    char clientpathbak[256];   // \u6587\u4ef6\u6210\u529f\u4e0a\u4f20\u540e\uff0c\u672c\u5730\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\r\n    bool andchild;             // \u662f\u5426\u4e0a\u4f20clientpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\u3002\r\n    char matchname[256];       // \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982"*.TXT,*.XML"\u3002\r\n    char srvpath[256];         // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002/data1 /data1/aaa /data1/bbb\r\n    int  timetvl;              // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\u3002 \r\n    int  timeout;              // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\u3002\r\n    char pname[51];            // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528"tcpputfiles_\u540e\u7f00"\u7684\u65b9\u5f0f\u3002\r\n} starg;\r\n\r\nclogfile logfile;        // \u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u65e5\u5fd7\r\nctcpserver tcpserver;    // \u521b\u5efatcp\u901a\u8baf\u7684\u670d\u52a1\u7aef\u5bf9\u8c61\r\n\r\nvoid FathEXIT(int sig);  // \u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\nvoid ChldEXIT(int sig);  // \u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin();\r\n\r\n// \u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid recvfilesmain();\r\n\r\nstring strsendbuffer;    // \u53d1\u9001\u62a5\u6587\u7684buffer\r\nstring strrecvbuffer;    // \u63a5\u6536\u62a5\u6587\u7684buffer\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using:./fileserver port logfile\\n");\r\n        printf("Example:./fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n"); \r\n        printf("         /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 10 /home/celfs/project/engi_cpp/49_project/tools/bin/fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n\\n\\n"); \r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\r\n    //closeioandsignal(false); \r\n    signal(SIGINT,FathEXIT); signal(SIGTERM,FathEXIT);\r\n\r\n    if (logfile.open(argv[2]) == false) {\r\n        printf("logfile.open(%s) failed.\\n", argv[2]); return -1;\r\n    }\r\n\r\n    // \u670d\u52a1\u7aef\u521d\u59cb\u5316\u3002\r\n    if (tcpserver.initserver(atoi(argv[1]))==false) {\r\n      logfile.write("tcpserver.initserver(%s) failed.\\n",argv[1]); return -1;\r\n    }\r\n\r\n    while (true) {\r\n\r\n        // \u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\r\n        if (tcpserver.accept() == false) {\r\n            logfile.write("tcpserver.accept() failed.\\n"); FathEXIT(-1);\r\n        }\r\n\r\n        logfile.write("\u5ba2\u6237\u7aef\uff08%s\uff09\u5df2\u8fde\u63a5\u3002\\n", tcpserver.getip());\r\n\r\n        if (fork() > 0) { tcpserver.closeclient(); continue; }   // \u7236\u8fdb\u7a0b\u7ee7\u7eed\u56de\u5230Accept()\r\n\r\n        // \u5b50\u8fdb\u7a0b\u91cd\u65b0\u8bbe\u7f6e\u9000\u51fa\u4fe1\u53f7\r\n        signal(SIGINT,ChldEXIT); signal(SIGTERM,ChldEXIT);\r\n\r\n        tcpserver.closelisten();\r\n\r\n        // \u5b50\u8fdb\u7a0b\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u901a\u8baf\uff0c\u5904\u7406\u4e1a\u52a1\u3002\r\n\r\n        // \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n        if (clientlogin()==false) ChldEXIT(-1);\r\n\r\n        // \u5982\u679cstarg.clienttype==1\uff0c\u8c03\u7528\u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        if (starg.clienttype==1)  recvfilesmain();  \r\n\r\n        // \u5982\u679cstarg.clienttype==2\uff0c\u8c03\u7528\u4e0b\u8f7d\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        // if (starg.clienttype==2) sendfilesmain();\r\n\r\n        ChldEXIT(0);\r\n    }\r\n}\r\n\r\nvoid FathEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u7236\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closelisten();    // \u5173\u95ed\u76d1\u542c\u7684socket\r\n\r\n    kill(0, 15);     // \u901a\u77e5\u5168\u90e8\u7684\u5b50\u8fdb\u7a0b\u9000\u51fa\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid ChldEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closeclient();    // \u5173\u95ed\u5ba2\u6237\u7aef\u7684socket\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid recvfilesmain() {\r\n\r\n    while (true) {\r\n\r\n        // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u62a5\u6587\r\n        if (tcpserver.read(strrecvbuffer, 60) == false) {\r\n            logfile.write("tcpserver.read() failed.\\n"); return;\r\n        }\r\n        logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u5fc3\u8df3\u62a5\u6587\r\n        if (strrecvbuffer == "<activetest>ok</activetest>") {\r\n\r\n            strsendbuffer = "ok.";\r\n            logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.write() failed.\\n"); return;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin()\r\n{\r\n    // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n    if (tcpserver.read(strrecvbuffer,20)==false)\r\n    {\r\n        logfile.write("tcpserver.read() failed.\\n"); return false;\r\n    }\r\n    logfile.write("strrecvbuffer=%s\\n",strrecvbuffer.c_str());\r\n\r\n    // \u89e3\u6790\u5ba2\u6237\u7aef\u767b\u5f55\u62a5\u6587\uff0c\u4e0d\u9700\u8981\u5bf9\u53c2\u6570\u505a\u5408\u6cd5\u6027\u5224\u65ad\uff0c\u5ba2\u6237\u7aef\u5df2\u7ecf\u5224\u65ad\u8fc7\u4e86\u3002\r\n    memset(&starg,0,sizeof(struct st_arg));\r\n    getxmlbuffer(strrecvbuffer,"clienttype",starg.clienttype);\r\n    getxmlbuffer(strrecvbuffer,"clientpath",starg.clientpath);\r\n    getxmlbuffer(strrecvbuffer,"srvpath",starg.srvpath);\r\n\r\n    // \u4e3a\u4ec0\u4e48\u8981\u5224\u65ad\u5ba2\u6237\u7aef\u7684\u7c7b\u578b\uff1f\u4e0d\u662f\u53ea\u67091\u548c2\u5417\uff1f \u9632\u6b62\u975e\u6cd5\u7684\u8fde\u63a5\u8bf7\u6c42\u3002\r\n    if ( (starg.clienttype!=1) && (starg.clienttype!=2) )\r\n        strsendbuffer="failed";\r\n    else\r\n        strsendbuffer="ok";\r\n\r\n    if (tcpserver.write(strsendbuffer)==false)\r\n    {\r\n        logfile.write("tcpserver.write() failed.\\n"); return false;\r\n    }\r\n\r\n    logfile.write("%s login %s.\\n",tcpserver.getip(),strsendbuffer.c_str());\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u591a\u8fdb\u7a0b\u7684\u4ee3\u7801\uff0c\u7528 GDB \u8c03\u8bd5\u6bd4\u8f83\u9ebb\u70e6\uff0c\u73b0\u9636\u6bb5\u53ef\u4ee5\u5c06\u5176\u6ce8\u91ca\u6389\uff0c\u8ba9\u7a0b\u5e8f\u53d8\u6210\u5355\u8fdb\u7a0b\uff0c\u4fbf\u4e8e\u8c03\u8bd5\uff08\u53ef\u5199\u65e5\u5fd7\u3001GDB\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"printf()"})," \u4e2d\uff0c\u82e5\u8fde\u7eed\u591a\u4e2a\u5360\u4f4d\u7b26\u5bf9\u5e94\u7684\u53d8\u91cf\u90fd\u662f\u540c\u4e00\u4e2a\uff0c\u662f\u5426\u6709\u4fbf\u6377\u7684\u5199\u6cd5\uff1f"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u5982\u4f55\u7406\u89e3 \u201c\u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e00\u5b9a\u8981\u5927\u4e8e\u626b\u63cf\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\u201d\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5982\u679c\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\u6bd4\u4efb\u52a1\u6240\u9700\u65f6\u95f4\u8fd8\u77ed\uff0c\u90a3\u4e48\u4efb\u52a1\u8fd8\u6ca1\u7ed3\u675f\uff0c\u5c31\u5df2\u7ecf\u88ab\u5fc3\u8df3\u7ec8\u6b62\u4e86\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsxs)(r.p,{children:[(0,l.jsx)(r.del,{children:"I have checked several times, but could not find the cause of the bug."})," OK."]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"A segmentation fault typically indicates that your program is trying to access a memory location that it's not allowed to access."}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:'/home/celfs/project/engi_cpp/49_project/tools/bin/tcpputfiles /home/celfs/project/engi_cpp/49_project/log/idc/tcpputfiles_surfdata.log "<ip>192.168.20.150</ip><port>5005</port><clientpath>/home/celfs/project/engi_cpp/49_project/tmp/client</clientpath><ptype>1</ptype><srvpath>/home/celfs/project/engi_cpp/49_project/tmp/server</srvpath><andchild>true</andchild><matchname>.xml,.txt</matchname><timetvl>10</timetvl><timeout>50</timeout><pname>tcpputfiles_surfdata</pname>"\r\n[1] 2245 segmentation fault /home/celfs/project/engi_cpp/49_project/tools/bin/tcpputfiles\n'})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"GDB"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"run"})," --\x3e ",(0,l.jsx)(r.code,{children:"backtrace"})," --\x3e ",(0,l.jsx)(r.code,{children:"0x00005555555595e9 in main"})," --\x3e \u6210\u529f\u5b9a\u4f4d\u95ee\u9898 --\x3e \u7531 ",(0,l.jsx)(r.code,{children:"atoi(argv[3])"})," \u7684\u5408\u6cd5\u6027\u5bfc\u81f4"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-bash",children:'(gdb) run\r\nStarting program: /home/celfs/project/engi_cpp/49_project/tools/bin/tcpputfiles /home/celfs/project/engi_cpp/49_project/log/idc/tcpputfiles_surfdata.log "<ip>192.168.20.150</ip><port>5005</port><clientpath>/home/celfs/project/engi_cpp/49_project/tmp/client</clientpath><ptype>1</ptype><srvpath>/home/celfs/project/engi_cpp/49_project/tmp/server</srvpath><andchild>true</andchild><matchname>*.xml,*.txt</matchname><timetvl>10</timetvl><timeout>50</timeout><pname>tcpputfiles_surfdata</pname>"\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n__GI_____strtol_l_internal (nptr=0x0, endptr=endptr@entry=0x0, base=base@entry=10, group=group@entry=0, \r\n    loc=0x7ffff7d294a0 <_nl_global_locale>) at ../stdlib/strtol_l.c:292\r\n292     ../stdlib/strtol_l.c: No such file or directory.\r\n\r\n\r\n(gdb) backtrace\r\n#0  __GI_____strtol_l_internal (nptr=0x0, endptr=endptr@entry=0x0, base=base@entry=10, group=group@entry=0, \r\n    loc=0x7ffff7d294a0 <_nl_global_locale>) at ../stdlib/strtol_l.c:292\r\n#1  0x00007ffff7b84ab6 in __strtol (nptr=<optimized out>, endptr=endptr@entry=0x0, base=base@entry=10)\r\n    at ../stdlib/strtol.c:106\r\n#2  0x00007ffff7b805c4 in __GI_atoi (nptr=<optimized out>) at atoi.c:27\r\n#3  0x00005555555595e9 in main (argc=3, argv=0x7fffffffdea8) at tcpputfiles.cpp:64\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4ee3\u7801\u4fee\u6539"}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\r\nif (tcpclient.connect(argv[2], atoi(argv[3])) == false) {\r\n    logfile.write("tcpclient.connect(%s, %d) failed.\\n", argv[2], atoi(argv[3])); EXIT(-1);\r\n}\r\n\r\n// \u4fee\u6539\u540e\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\u3002\r\nif (tcpclient.connect(starg.ip, starg.port) == false) {\r\n    logfile.write("tcpclient.connect(%s, %d) failed.\\n", starg.ip, starg.port); EXIT(-1);\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7ecf\u8fc7\u8fd9\u6b21\u4f7f\u7528 GDB\uff0c\u624d\u611f\u89c9\u5230\u8fd9\u662f\u4e2a\u795e\u5668\uff0c\u5fc5\u987b\u597d\u597d\u638c\u63e1\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u53ef\u89c1\uff0c\u53c2\u6570\u7684\u4e00\u81f4\u6027\u3001\u660e\u767d\u6570\u636e\u5b58\u50a8\u3001\u8f93\u5165\u7684\u7ed3\u6784\uff0c\u5341\u5206\u91cd\u8981\u3002\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u672c\u8282\u7684\u53c2\u6570\u4f20\u9012\uff0c\u670d\u52a1\u7aef\u53c2\u6570\u7531\u5ba2\u6237\u7aef\u51b3\u5b9a\uff0c\u56e0\u6b64\uff0c\u5c06\u5ba2\u6237\u7aef\u7684\u6240\u6709 xml \u53c2\u6570\u90fd\u901a\u8fc7 ",(0,l.jsx)(r.code,{children:"login"})," \u4f20\u9012\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/15 13:27:42 \u4ee3\u7801\uff0c1h35min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/15 21:17:17 \u5b8c\u6210\u4ee3\u7801\uff0cdebug\uff0c15min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/16 17:26:55 debug \u5b8c\u6210\uff0c1h4min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"74-\u4e0a\u4f20\u6587\u4ef6\u4e09",children:"74 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e09\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b\uff08\u4e0a\u4f20\u6587\u4ef6\u8bf7\u6c42\u53d1\u9001\uff0c\u6536\u5230\u670d\u52a1\u7aef\u786e\u8ba4\u62a5\u6587\uff09"}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240616173305854",src:e(53837).A+"",width:"1638",height:"1034"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5ba2\u6237\u7aef\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6587\u4ef6\u4e0a\u4f20\u4e3b\u51fd\u6570 --\x3e ",(0,l.jsx)(r.code,{children:"main"})," \u8c03\u7528 --\x3e"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\u4e0a\u4f20\u4e3b\u51fd\u6570\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6253\u5f00\u76ee\u5f55 --\x3e \u904d\u5386\u76ee\u5f55 --\x3e"}),"\n",(0,l.jsx)(r.li,{children:"\u6784\u9020\u6587\u4ef6\u540d\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6587\u4ef6\u5927\u5c0f --\x3e \u53d1\u9001\u5230\u5bf9\u7aef"}),"\n",(0,l.jsx)(r.li,{children:"\u63a5\u6536\u786e\u8ba4\u62a5\u6587"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u52a1\u7aef\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b8c\u5584\u6587\u4ef6\u63a5\u6536\u51fd\u6570"}),"\n",(0,l.jsxs)(r.li,{children:["\u5904\u7406\u670d\u52a1\u7aef\u786e\u8ba4\u62a5\u6587\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"ptype == 1"})," \u53ca ",(0,l.jsx)(r.code,{children:"ptype == 2"})," \u7684\u60c5\u51b5"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u8c03\u8bd5\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e24\u4e2a\u76ee\u5f55 ",(0,l.jsx)(r.code,{children:"/tmp/client"}),"\uff08 ",(0,l.jsx)(r.code,{children:"1.txt, 2.xml"})," \uff09 \u548c ",(0,l.jsx)(r.code,{children:"/tmp/server"})]}),"\n",(0,l.jsx)(r.li,{children:"\u8fd0\u884c\u670d\u52a1\u7aef\u7a0b\u5e8f"}),"\n",(0,l.jsx)(r.li,{children:"\u8fd0\u884c\u5ba2\u6237\u7aef\u7a0b\u5e8f"}),"\n",(0,l.jsx)(r.li,{children:"\u5b8c\u6210\u62a5\u6587\u786e\u8ba4\u540e\uff0c\u8c03\u8bd5 --\x3e \u672a\u5b9e\u73b0\u670d\u52a1\u7aef\u63a5\u6536\u6587\u4ef6\u7684\u903b\u8f91"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u57fa\u4e8e TCP \u534f\u8bae\u7684\u6587\u4ef6\u4e0a\u4f20\u6a21\u5757\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\r\nstruct st_arg {\r\n    int  clienttype;         // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b1\r\n    char ip[31];             // \u670d\u52a1\u7aef\u7684 IP \u5730\u5740\r\n    int  port;               // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\r\n    char clientpath[256];    // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55 /data /data/dir1 /data/dir2\r\n    int  ptype;              // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\r\n    char clientpathbak[256]; // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5907\u4efd\u6839\u76ee\u5f55\uff0c\u5f53 ptype == 2 \u65f6\u6709\u6548\r\n    bool andchild;           // \u662f\u5426\u4e0a\u4f20 clientpath \u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\r\n    char matchname[256];     // \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\u3002\u5982 "*.TXT,*.XML"\r\n    char srvpath[256];       // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\uff0c\u63a7\u5236\u662f\u5426\u9012\u5f52\u8bbf\u95ee\u5b50\u76ee\u5f55\r\n    int  timetvl;            // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    int  timeout;            // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\r\n    char pname[51];          // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528 \u201ctcpputfiles_\u540e\u7f00\u201d \u7684\u65b9\u5f0f\r\n} starg;\r\n\r\n// \u5e2e\u52a9\u6587\u6863\r\nvoid _help();\r\n\r\n// \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4e2d\r\nbool _xmltoarg(const char *strxmlbuffer);\r\n\r\nclogfile logfile;       // \u521b\u5efa\u65e5\u5fd7\u5bf9\u8c61\r\nctcpclient tcpclient;   // \u521b\u5efa TCP \u901a\u8baf\u7684\u5ba2\u6237\u7aef\u5bf9\u8c61\r\n\r\n// \u7a0b\u5e8f\u9000\u51fa\u4fe1\u53f72\u300115\u7684\u5904\u7406\u51fd\u6570\r\nvoid EXIT(int sig);\r\n\r\nbool activetest();      // \u5fc3\u8df3\r\n\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv);\r\n\r\n// \u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\nbool _tcpputfiles();\r\n\r\n// \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8f6c\u5b58\u672c\u5730\u7684\u6587\u4ef6\uff09\r\nbool ackmessage(const string &strrecvbuffer);\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        _help();\r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\u3002\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\u3002\r\n    // \u5728\u7f51\u7edc\u901a\u8baf\u7a0b\u5e8f\u4e2d\uff0c\u4e00\u822c\u4e0d\u5173IO\uff0c\u56e0\u4e3a\u67d0\u4e9b\u51fd\u6570\u53ef\u80fd\u4f1a\u5f801\u548c2\u4e2d\u8f93\u51fa\u4fe1\u606f\r\n    // \u5982\u679c\u5173\u4e861\u548c2\uff0c\u90a3\u4e481\u548c2\u4f1a\u88absocket\u91cd\u7528\uff0c\u54111\u548c2\u8f93\u51fa\u7684\u4fe1\u606f\u4f1a\u53d1\u9001\u5230\u7f51\u7edc\u4e2d\u3002\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u5931\u8d25\uff08%s\uff09\u3002\\n",argv[1]); return -1;\r\n    }\r\n\r\n    if (_xmltoarg(argv[2]) == false) return -1;\r\n\r\n    // \u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\r\n    if (tcpclient.connect(starg.ip, starg.port) == false) {\r\n        logfile.write("tcpclient.connect(%s, %d) failed.\\n", starg.ip, starg.port); EXIT(-1);\r\n    }\r\n\r\n    if (login(argv[2]) == false) { logfile.write("login() failed.\\n"); EXIT(-1); }\r\n\r\n    while (true) {\r\n\r\n        // \u8c03\u7528\u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\n        if (_tcpputfiles() == false) { logfile.write("_tcpputfiles() failed.\\n"); EXIT(-1); }\r\n\r\n        sleep(starg.timetvl);\r\n\r\n        // \u53d1\u9001\u5fc3\u8df3\u62a5\u6587\r\n        if (activetest() == false) break;\r\n\r\n    }\r\n\r\n    EXIT(0);\r\n}\r\n\r\n// \u5fc3\u8df3\r\nbool activetest() {\r\n\r\n    strsendbuffer = "<activetest>ok</activetest>";\r\n    logfile.write("\u53d1\u9001\uff1a%s\\n", strsendbuffer.c_str());\r\n    if (tcpclient.write(strsendbuffer) == false) return false;      // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\r\n\r\n    if (tcpclient.read(strrecvbuffer, 60) == false) return false;   // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\r\n    logfile.write("\u63a5\u6536\uff1a%s\\n", strsendbuffer.c_str());\r\n\r\n    // \u5fc3\u8df3\u673a\u5236\u7684\u4ee3\u7801\u53ef\u7b80\u5355\u5316\u5904\u7406\uff0c\u53ea\u9700\u8981\u6536\u5230\u5bf9\u7aef\u7684\u56de\u5e94\u5c31\u884c\u4e86\uff0c\u4e0d\u5fc5\u5224\u65ad\u56de\u5e94\u7684\u5185\u5bb9\r\n\r\n    return true;\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n\r\n    logfile.write("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\nvoid _help() {\r\n\r\n    string base_bin = "/home/celfs/project/engi_cpp/49_project";\r\n\r\n    printf("\\n");\r\n    printf("Using: %s/tools/bin/tcpputfiles logfilename xmlbuffer\\n\\n", base_bin.c_str());\r\n    printf(\r\n        "Example: %s/tools/bin/procctl 20 %s/tools/bin/tcpputfiles %s/log/idc/tcpputfiles_surfdata.log "\\\r\n        "\\"<ip>192.168.20.150</ip><port>5005</port>"\\\r\n        "<clientpath>%s/tmp/client</clientpath><ptype>1</ptype>"\\\r\n        "<srvpath>%s/tmp/server</srvpath>"\\\r\n        "<andchild>true</andchild><matchname>*.xml,*.txt</matchname><timetvl>10</timetvl>"\\\r\n        "<timeout>50</timeout><pname>tcpputfiles_surfdata</pname>\\"\\n\\n", \r\n        base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str()\r\n    ); \r\n\r\n    printf("\u672c\u7a0b\u5e8f\u662f\u6570\u636e\u4e2d\u5fc3\u7684\u516c\u5171\u529f\u80fd\u6a21\u5757\uff0c\u91c7\u7528tcp\u534f\u8bae\u628a\u6587\u4ef6\u4e0a\u4f20\u7ed9\u670d\u52a1\u7aef\u3002\\n");\r\n    printf("logfilename   \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n    printf("xmlbuffer     \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\\n");\r\n    printf("ip            \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\\n");\r\n    printf("port          \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\\n");\r\n    printf("ptype         \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\\n");\r\n    printf("clientpath    \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("clientpathbak \u6587\u4ef6\u6210\u529f\u4e0a\u4f20\u540e\uff0c\u672c\u5730\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\\n");\r\n    printf("andchild      \u662f\u5426\u4e0a\u4f20clientpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\uff0c\u7f3a\u7701\u4e3afalse\u3002\\n");\r\n    printf("matchname     \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982\\"*.TXT,*.XML\\"\\n");\r\n    printf("srvpath       \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("timetvl       \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u53d6\u503c\u57281-30\u4e4b\u95f4\u3002\\n");\r\n    printf("timeout       \u672c\u7a0b\u5e8f\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u89c6\u6587\u4ef6\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u800c\u5b9a\uff0c\u5efa\u8bae\u8bbe\u7f6e50\u4ee5\u4e0a\u3002\\n");\r\n    printf("pname         \u8fdb\u7a0b\u540d\uff0c\u5c3d\u53ef\u80fd\u91c7\u7528\u6613\u61c2\u7684\u3001\u4e0e\u5176\u5b83\u8fdb\u7a0b\u4e0d\u540c\u7684\u540d\u79f0\uff0c\u65b9\u4fbf\u6545\u969c\u6392\u67e5\u3002\\n\\n");\r\n}\r\n\r\nbool _xmltoarg(const char *strxmlbuffer) {\r\n\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n\r\n    getxmlbuffer(strxmlbuffer, "ip", starg.ip);\r\n    if (strlen(starg.ip) == 0) { logfile.write("ip is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "port", starg.port);\r\n    if (starg.port == 0) { logfile.write("port is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "ptype", starg.ptype);\r\n    if ((starg.ptype != 1) && (starg.ptype != 2)) { logfile.write("ptype not in (1, 2).\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "clientpath", starg.clientpath);\r\n    if (strlen(starg.clientpath) == 0) { logfile.write("clientpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "clientpathbak", starg.clientpathbak);\r\n    if ((starg.ptype == 2) && (strlen(starg.clientpathbak) == 0)) { logfile.write("clientpathbak is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "andchild", starg.andchild);\r\n\r\n    getxmlbuffer(strxmlbuffer, "matchname", starg.matchname);\r\n    if (strlen(starg.matchname) == 0) { logfile.write("matchname is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "srvpath", starg.srvpath);\r\n    if (strlen(starg.srvpath) == 0) { logfile.write("srvpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "timetvl", starg.timetvl);\r\n    if (starg.timetvl == 0) { logfile.write("timetvl is null.\\n"); return false; }\r\n\r\n    // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    // starg.timetvl\u6ca1\u6709\u5fc5\u8981\u8d85\u8fc730\u79d2\r\n    if (starg.timetvl > 30) starg.timetvl = 30;\r\n\r\n    // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e00\u5b9a\u8981\u5927\u4e8e starg.timetvl\r\n    getxmlbuffer(strxmlbuffer, "timeout", starg.timeout);\r\n    if (starg.timeout == 0) { logfile.write("timeout is null.\\n"); return false; }\r\n    if (starg.timeout <= starg.timetvl) { logfile.write("starg.timeout(%d) <= starg.timetvl(%d)\\n", starg.timeout, starg.timetvl); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "pname", starg.pname, 50);\r\n    //if (strlen(starg.pname) == 0) { logfile.write("pname is null.\\n"); return false; }\r\n\r\n    return true;\r\n}\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv) {\r\n\r\n    sformat(strsendbuffer, "%s<clienttype>1</clienttype>", argv);\r\n    logfile.write("\u53d1\u9001\uff1a%s\\n", strsendbuffer.c_str());\r\n    if (tcpclient.write(strsendbuffer) == false) return false;      // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\r\n\r\n    if (tcpclient.read(strrecvbuffer, 20) == false) return false;  // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\r\n    logfile.write("\u63a5\u6536\uff1a%s\\n", strrecvbuffer.c_str());\r\n\r\n    logfile.write("\u767b\u5f55(%s:%d)\u6210\u529f\u3002\\n", starg.ip, starg.port);\r\n\r\n    return true;\r\n}\r\n\r\n// \u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\nbool _tcpputfiles() {\r\n\r\n    cdir dir;\r\n\r\n    if (dir.opendir(starg.clientpath, starg.matchname, 10000, starg.andchild) == false) {\r\n        logfile.write("dir.opendir(%s) failed.\\n", starg.clientpath); return false;\r\n    }\r\n\r\n    // \u904d\u5386\u76ee\u5f55\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\r\n    while (dir.readdir()) {\r\n\r\n        // \u628a\u6587\u4ef6\u540d\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6587\u4ef6\u5927\u5c0f\u7ec4\u6210\u62a5\u6587\uff0c\u53d1\u9001\u7ed9\u5bf9\u7aef\r\n        sformat(strsendbuffer, "<filename>%s</filename><mtime>%s</mtime><size>%d</size>", \r\n                dir.m_ffilename.c_str(), dir.m_mtime.c_str(), dir.m_filesize);\r\n        \r\n        logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n        if (tcpclient.write(strsendbuffer) == false) {\r\n            logfile.write("tcpclien.write() failed.\\n"); return false;\r\n        }\r\n\r\n        // \u53d1\u9001\u6587\u4ef6\u5185\u5bb9\r\n\r\n        // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u62a5\u6587\r\n        if (tcpclient.read(strrecvbuffer, 20) == false) break;\r\n        logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u62a5\u6587\uff08\u5220\u9664\u672c\u5730\u6587\u4ef6\u6216\u628a\u672c\u5730\u672c\u6587\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\uff09\r\n        ackmessage(strrecvbuffer);\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8f6c\u5b58\u672c\u5730\u7684\u6587\u4ef6\uff09\r\nbool ackmessage(const string &strrecvbuffer) {\r\n\r\n    // <filename>/tmp/client/1.txt</filename><result>ok</result>\r\n    string filename;    // \u672c\u5730\u6587\u4ef6\u540d\r\n    string result;      // \u5bf9\u7aef\u63a5\u6536\u6587\u4ef6\u7684\u7ed3\u679c\r\n    getxmlbuffer(strrecvbuffer, "filename", filename);\r\n    getxmlbuffer(strrecvbuffer, "result", result);\r\n\r\n    // \u5982\u679c\u670d\u52a1\u7aef\u63a5\u6536\u6587\u4ef6\u4e0d\u6210\u529f\uff0c\u76f4\u63a5\u8fd4\u56de\uff08\u4e0b\u6b21\u6267\u884c\u6587\u4ef6\u4f20\u8f93\u4efb\u52a1\u65f6\u5c06\u4f1a\u91cd\u4f20\uff09\r\n    if (result != "ok") return true;\r\n\r\n    // \u5982\u679c starg.ptype == 1\uff0c\u5220\u9664\u6587\u4ef6\r\n    if (starg.ptype == 1) {\r\n        if (remove(filename.c_str()) != 0) { logfile.write("remove(%s) failed.\\n", filename.c_str()); return false; }\r\n    }\r\n\r\n    // \u5982\u679c starg.ptype == 2\uff0c\u79fb\u52a8\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\r\n    if (starg.ptype == 2) {\r\n        // \r\n        string bakfilename = filename;\r\n        replacestr(bakfilename, starg.clientpath, starg.clientpathbak, false); // \u6ce8\u610f\uff0c\u7b2c\u56db\u4e2a\u53c2\u6570\u4e00\u5b9a\u586b false\r\n        if (renamefile(filename, bakfilename) == false) {\r\n            logfile.write("renamefile(%s, %s) failed.\\n", filename.c_str(), bakfilename.c_str()); return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\u3002\r\nstruct st_arg\r\n{\r\n    int  clienttype;           // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b1\u3002\r\n    char ip[31];               // \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\r\n    int  port;                 // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\r\n    char clientpath[256];      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002 /data /data/aaa /data/bbb\r\n    int  ptype;                // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\r\n    char clientpathbak[256];   // \u6587\u4ef6\u6210\u529f\u4e0a\u4f20\u540e\uff0c\u672c\u5730\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\r\n    bool andchild;             // \u662f\u5426\u4e0a\u4f20clientpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\u3002\r\n    char matchname[256];       // \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982"*.TXT,*.XML"\u3002\r\n    char srvpath[256];         // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002/data1 /data1/aaa /data1/bbb\r\n    int  timetvl;              // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\u3002 \r\n    int  timeout;              // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\u3002\r\n    char pname[51];            // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528"tcpputfiles_\u540e\u7f00"\u7684\u65b9\u5f0f\u3002\r\n} starg;\r\n\r\nclogfile logfile;        // \u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u65e5\u5fd7\r\nctcpserver tcpserver;    // \u521b\u5efatcp\u901a\u8baf\u7684\u670d\u52a1\u7aef\u5bf9\u8c61\r\n\r\nvoid FathEXIT(int sig);  // \u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\nvoid ChldEXIT(int sig);  // \u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin();\r\n\r\n// \u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid recvfilesmain();\r\n\r\nstring strsendbuffer;    // \u53d1\u9001\u62a5\u6587\u7684buffer\r\nstring strrecvbuffer;    // \u63a5\u6536\u62a5\u6587\u7684buffer\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using:./fileserver port logfile\\n");\r\n        printf("Example:./fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n"); \r\n        printf("         /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 10 /home/celfs/project/engi_cpp/49_project/tools/bin/fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n\\n\\n"); \r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\r\n    //closeioandsignal(false); \r\n    signal(SIGINT,FathEXIT); signal(SIGTERM,FathEXIT);\r\n\r\n    if (logfile.open(argv[2]) == false) {\r\n        printf("logfile.open(%s) failed.\\n", argv[2]); return -1;\r\n    }\r\n\r\n    // \u670d\u52a1\u7aef\u521d\u59cb\u5316\u3002\r\n    if (tcpserver.initserver(atoi(argv[1]))==false) {\r\n      logfile.write("tcpserver.initserver(%s) failed.\\n",argv[1]); return -1;\r\n    }\r\n\r\n    while (true) {\r\n\r\n        // \u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\r\n        if (tcpserver.accept() == false) {\r\n            logfile.write("tcpserver.accept() failed.\\n"); FathEXIT(-1);\r\n        }\r\n\r\n        logfile.write("\u5ba2\u6237\u7aef\uff08%s\uff09\u5df2\u8fde\u63a5\u3002\\n", tcpserver.getip());\r\n\r\n        // \u6682\u4e0d\u4f7f\u7528\u591a\u8fdb\u7a0b\uff0c\u4fbf\u4e8e GDB \u8c03\u8bd5\r\n        // if (fork() > 0) { tcpserver.closeclient(); continue; }   // \u7236\u8fdb\u7a0b\u7ee7\u7eed\u56de\u5230Accept()\r\n\r\n        // \u5b50\u8fdb\u7a0b\u91cd\u65b0\u8bbe\u7f6e\u9000\u51fa\u4fe1\u53f7\r\n        // signal(SIGINT, ChldEXIT); signal(SIGTERM, ChldEXIT);\r\n\r\n        // tcpserver.closelisten();\r\n\r\n        // \u5b50\u8fdb\u7a0b\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u901a\u8baf\uff0c\u5904\u7406\u4e1a\u52a1\u3002\r\n\r\n        // \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n        if (clientlogin() == false) ChldEXIT(-1);\r\n\r\n        // \u5982\u679cstarg.clienttype == 1\uff0c\u8c03\u7528\u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        if (starg.clienttype == 1)  recvfilesmain();  \r\n\r\n        // \u5982\u679c starg.clienttype == 2\uff0c\u8c03\u7528\u4e0b\u8f7d\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        // if (starg.clienttype == 2) sendfilesmain();\r\n\r\n        ChldEXIT(0);\r\n    }\r\n}\r\n\r\nvoid FathEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u7236\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closelisten();    // \u5173\u95ed\u76d1\u542c\u7684socket\r\n\r\n    kill(0, 15);     // \u901a\u77e5\u5168\u90e8\u7684\u5b50\u8fdb\u7a0b\u9000\u51fa\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid ChldEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closeclient();    // \u5173\u95ed\u5ba2\u6237\u7aef\u7684socket\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid recvfilesmain() {\r\n\r\n    while (true) {\r\n\r\n        // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u62a5\u6587\r\n        if (tcpserver.read(strrecvbuffer, 60) == false) {\r\n            logfile.write("tcpserver.read() failed.\\n"); return;\r\n        }\r\n        logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u5fc3\u8df3\u62a5\u6587\r\n        if (strrecvbuffer == "<activetest>ok</activetest>") {\r\n\r\n            strsendbuffer = "ok.";\r\n            logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.write() failed.\\n"); return;\r\n            }\r\n        }\r\n\r\n        // \u5904\u7406\u4e0a\u4f20\u6587\u4ef6\u7684\u8bf7\u6c42\u62a5\u6587\r\n        if (strrecvbuffer.find("<filename>") != string::npos) {\r\n            // \u89e3\u6790\u4e0a\u4f20\u6587\u4ef6\u8bf7\u6c42\u62a5\u6587\u7684 xml\r\n            string clientfilename;  // \u5bf9\u7aef\u7684\u6587\u4ef6\u540d\r\n            string mtime;           // \u6587\u4ef6\u7684\u65f6\u95f4\r\n            int filesize = 0;       // \u6587\u4ef6\u5927\u5c0f\r\n            getxmlbuffer(strrecvbuffer, "filename", clientfilename);\r\n            getxmlbuffer(strrecvbuffer, "mtime", mtime);\r\n            getxmlbuffer(strrecvbuffer, "size", filesize);\r\n\r\n            // \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\n\r\n            // \u5047\u8bbe\u6210\u529f\u7684\u63a5\u6536\u4e86\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u62fc\u63a5\u786e\u8ba4\u62a5\u6587\u7684\u5185\u5bb9\r\n            sformat(strsendbuffer, "<filename>%s</filename><result>ok</result>", clientfilename.c_str());\r\n\r\n            // \u628a\u786e\u8ba4\u62a5\u6587\u8fd4\u56de\u7ed9\u5bf9\u7aef\r\n            logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.write() failed.\\n"); return;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin()\r\n{\r\n    // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n    if (tcpserver.read(strrecvbuffer, 20) == false)\r\n    {\r\n        logfile.write("tcpserver.read() failed.\\n"); return false;\r\n    }\r\n    logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n    // \u89e3\u6790\u5ba2\u6237\u7aef\u767b\u5f55\u62a5\u6587\uff0c\u4e0d\u9700\u8981\u5bf9\u53c2\u6570\u505a\u5408\u6cd5\u6027\u5224\u65ad\uff0c\u5ba2\u6237\u7aef\u5df2\u7ecf\u5224\u65ad\u8fc7\u4e86\u3002\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n    getxmlbuffer(strrecvbuffer,"clienttype", starg.clienttype);\r\n    getxmlbuffer(strrecvbuffer,"clientpath", starg.clientpath);\r\n    getxmlbuffer(strrecvbuffer,"srvpath", starg.srvpath);\r\n\r\n    // \u4e3a\u4ec0\u4e48\u8981\u5224\u65ad\u5ba2\u6237\u7aef\u7684\u7c7b\u578b\uff1f\u4e0d\u662f\u53ea\u67091\u548c2\u5417\uff1f \u9632\u6b62\u975e\u6cd5\u7684\u8fde\u63a5\u8bf7\u6c42\u3002\r\n    if ( (starg.clienttype != 1) && (starg.clienttype != 2) )\r\n        strsendbuffer = "failed";\r\n    else\r\n        strsendbuffer = "ok";\r\n\r\n    if (tcpserver.write(strsendbuffer) == false)\r\n    {\r\n        logfile.write("tcpserver.write() failed.\\n"); return false;\r\n    }\r\n\r\n    logfile.write("%s login %s.\\n", tcpserver.getip(), strsendbuffer.c_str());\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"2024/06/16 17:51:13 24min"}),"\n",(0,l.jsx)(r.li,{children:"2024/06/16 21:50:31 \u4ee3\u7801\u5b9e\u73b0\uff0c33min"}),"\n",(0,l.jsx)(r.li,{children:"2024/06/17 18:06:07 \u4ee3\u7801\u5b9e\u73b0\uff0c40min"}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"75-\u4e0a\u4f20\u6587\u4ef6\u56db",children:"75 \u4e0a\u4f20\u6587\u4ef6\uff08\u56db\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\uff08\u6587\u4ef6\u5185\u5bb9\u53d1\u9001\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5ba2\u6237\u7aef\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u53d1\u9001\u6587\u4ef6\u5185\u5bb9\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"sendfile()"})]}),"\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u6587\u4ef6\u4e0a\u4f20\u4e3b\u51fd\u6570\uff08\u53d1\u9001\u6587\u4ef6\u5185\u5bb9\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u73b0\u53d1\u9001\u5185\u5bb9\u51fd\u6570"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u52a1\u7aef\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u58f0\u660e\u63a5\u6536\u5185\u5bb9\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"recvfile()"})]}),"\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u6587\u4ef6\u63a5\u6536\u4e3b\u51fd\u6570\uff08\u6784\u9020\u670d\u52a1\u7aef\u6587\u4ef6\u8def\u5f84\u3001\u63a5\u6536\u6587\u4ef6\u5185\u5bb9\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u73b0\u63a5\u6536\u6587\u4ef6\u5185\u5bb9\u51fd\u6570"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u628a\u6587\u4ef6\u7684\u5185\u5bb9\u53d1\u9001\u7ed9\u5bf9\u7aef\r\nbool sendfile(const string &filename, const int filesize);\r\n\r\n// \u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\nbool _tcpputfiles() {\r\n    /* ... */\r\n    while (dir.readdir()) {\r\n        /* ... */\r\n        // \u53d1\u9001\u6587\u4ef6\u5185\u5bb9\r\n        logfile.write("send %s(%d) ...", dir.m_ffilename.c_str(), dir.m_filesize);\r\n        if (sendfile(dir.m_ffilename, dir.m_filesize) == true) {\r\n            logfile << "ok.\\n";\r\n        } else {\r\n            logfile << "failed.\\n"; tcpclient.close(); return false;\r\n        }\r\n        /* ... */\r\n    }\r\n    return true;\r\n}\r\n\r\n// \u628a\u6587\u4ef6\u7684\u5185\u5bb9\u53d1\u9001\u7ed9\u5bf9\u7aef\r\nbool sendfile(const string &filename, const int filesize) {\r\n\r\n    int onread = 0;         // \u6bcf\u6b21\u6253\u7b97\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u7684\u5b57\u8282\u6570\r\n    char buffer[1000];      // \u5b58\u653e\u8bfb\u53d6\u6570\u636e\u7684buffer\uff0cbuffer\u7684\u5927\u5c0f\u53ef\u53c2\u8003\u786c\u76d8\u4e00\u6b21\u8bfb\u53d6\u6570\u636e\u91cf\uff084K\u4e3a\u5b9c\uff09\r\n    int totalbytes = 0;     // \u4ece\u6587\u4ef6\u4e2d\u5df2\u8bfb\u53d6\u7684\u5b57\u8282\u603b\u6570\r\n    cifile ifile;           // \u8bfb\u53d6\u6587\u4ef6\u7684\u5bf9\u8c61\r\n\r\n    // \u5fc5\u987b\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u64cd\u4f5c\u6587\u4ef6\r\n    if (ifile.open(filename, ios::in | ios::binary) == false) return false;\r\n\r\n    while (true) {\r\n        memset(buffer, 0, sizeof(buffer));\r\n\r\n        // \u4ece\u8ba1\u7b97\u672c\u6b21\u5e94\u8be5\u8bfb\u53d6\u7684\u5b57\u8282\u6570\uff0c\u5982\u679c\u5269\u4f59\u7684\u6570\u636e\u8d85\u8fc7 1000 \u5b57\u8282\uff0c\u5c31\u8bfb 1000 \u5b57\u8282\r\n        if (filesize - totalbytes > 1000) onread = 1000;\r\n        else onread = filesize - totalbytes;\r\n\r\n        // \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\r\n        ifile.read(buffer, onread);\r\n\r\n        // \u628a\u8bfb\u53d6\u5230\u7684\u6570\u636e\u53d1\u9001\u7ed9\u5bf9\u7aef\r\n        if (tcpclient.write(buffer, onread) == false) return false;\r\n\r\n        // \u8ba1\u7b97\u6587\u4ef6\u5df2\u8bfb\u53d6\u7684\u5b57\u8282\u603b\u6570\uff0c\u5982\u679c\u5df2\u8bfb\u5b8c\uff0c\u8df3\u51fa\u5faa\u73af\r\n        totalbytes = totalbytes + onread;\r\n\r\n        if (totalbytes == filesize) break;\r\n    }\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, int filesize);\r\n\r\nvoid recvfilesmain() {\r\n    while (true) {\r\n        // \u5904\u7406\u4e0a\u4f20\u6587\u4ef6\u7684\u8bf7\u6c42\u62a5\u6587\r\n        if (strrecvbuffer.find("<filename>") != string::npos) {\r\n            /* ... */\r\n            // \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\n            // starg.clientpath = /tmp/client\r\n            // starg.srvpath = /tmp/server\r\n            // \u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u540d\uff1aclientfilename = /tmp/client/aaa/1/txt\r\n            // \u670d\u52a1\u7aef\u7684\u6587\u4ef6\u540d\uff1aserverfilename = /tmp/server/aaa/1/txt\r\n            string serverfilename;\r\n            serverfilename = clientfilename;\r\n            replacestr(serverfilename, starg.clientpath, starg.srvpath);\r\n\r\n            logfile.write("recv %s(%d) ...", serverfilename.c_str(), filesize);\r\n            if (recvfile(serverfilename, mtime, filesize) == true) {\r\n                logfile << "ok.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>ok</result>", clientfilename.c_str());\r\n            } else {\r\n                logfile << "failed.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>failed</result>", clientfilename.c_str());\r\n            }\r\n            /* ... */\r\n        }\r\n    }\r\n}\r\n\r\n// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, int filesize) {\r\n\r\n    int totalbytes = 0;     // \u5df2\u63a5\u6536\u6587\u4ef6\u7684\u603b\u5b57\u8282\u6570\r\n    int onread = 0;         // \u672c\u6b21\u6253\u7b97\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n    char buffer[1000];      // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\u7684\u7f13\u51b2\u533a\r\n    cofile ofile;           // \u5199\u5165\u6587\u4ef6\u7684\u5bf9\u8c61\r\n\r\n    // \u5fc5\u987b\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u64cd\u4f5c\u6587\u4ef6\r\n    if (ofile.open(filename, true, ios::out | ios::binary) == false) return false;\r\n\r\n    while (true) {\r\n\r\n        memset(buffer, 0, sizeof(buffer));\r\n\r\n        // \u8ba1\u7b97\u672c\u6b21\u5e94\u8be5\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n        if (filesize - totalbytes > 1000) onread = 1000;\r\n        else onread = filesize - totalbytes;\r\n\r\n        // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\r\n        if (tcpserver.read(buffer, onread) == false) return false;\r\n\r\n        // \u628a\u63a5\u6536\u5230\u7684\u5185\u5bb9\u5199\u5165\u6587\u4ef6\r\n        ofile.write(buffer, onread);\r\n\r\n        // \u8ba1\u7b97\u5df2\u7ecf\u63a5\u6536\u6587\u4ef6\u7684\u603b\u5b57\u8282\u6570\uff0c\u5982\u679c\u6587\u4ef6\u63a5\u6536\u5b8c\uff0c\u8df3\u51fa\u5faa\u73af\r\n        totalbytes = totalbytes + onread;\r\n\r\n        if (totalbytes == filesize) break;\r\n    }\r\n\r\n    ofile.closeandrename();\r\n\r\n    // \u6587\u4ef6\u65f6\u95f4\u7528\u5f53\u524d\u65f6\u95f4\u6ca1\u6709\u610f\u4e49\uff0c\u5e94\u8be5\u4e0e\u5bf9\u7aef\u7684\u6587\u4ef6\u65f6\u95f4\u4fdd\u6301\u4e00\u81f4\r\n    setmtime(filename, mtime);\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4fe1\u606f\u8865\u5145"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8bfe\u7a0b\u6587\u6863 350 \u5c0f\u8282\uff0c\u5b9e\u73b0\u6587\u4ef6\u4f20\u8f93\u529f\u80fd"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6ce8\u610f\uff0c\u5173\u95ed\u5ba2\u6237\u7aef\u4e0e\u5173\u95edTCP\u8fde\u63a5\uff0c\u662f\u4e24\u79cd\u4e0d\u540c\u7684\u884c\u4e3a\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u8c03\u8bd5\u53d1\u73b0\uff0c\u672c\u7a0b\u5e8f\u8fd0\u884c\u4e00\u6b21\uff0c\u53ea\u80fd\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\u5230\u76ee\u6807\u76ee\u5f55\uff0c\u4f46\u8bfe\u7a0b\u4e2d\u7684\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u5c06\u5ba2\u6237\u7aef\u76ee\u5f55\u4e2d\u7684\u6240\u6709\u6587\u4ef6\uff0c\u90fd\u4e0a\u4f20\u5230\u670d\u52a1\u7aef\u7684\u76ee\u5f55\u3002"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u68c0\u67e5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u95ee\u9898\u5728\u4e8e\u6211\u7684\u6d4b\u8bd5\u76ee\u5f55 ",(0,l.jsx)(r.code,{children:"/tmp/client"})," \u591a\u4e86\u4e00\u4e2a ",(0,l.jsx)(r.code,{children:".json"})," \u6587\u4ef6\uff0c\u53ef\u80fd\u662f\u5904\u7406\u903b\u8f91\u9047\u5230\u975e\u6cd5\u6587\u4ef6\u7c7b\u578b\uff0c\u5bfc\u81f4\u7684\u63d0\u524d\u4e2d\u65ad\u4e0a\u4f20\u3002\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u901a\u8fc7\u52a0\u5165\u76f8\u5173\u5904\u7406\u903b\u8f91\u5f97\u5230\u89e3\u51b3\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/17 20:25:30 1h6min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"76-\u540c\u6b65\u548c\u5f02\u6b65\u901a\u8baf",children:"76 \u540c\u6b65\u548c\u5f02\u6b65\u901a\u8baf"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u6982\u62ec"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u540c\u6b65\u901a\u8baf\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53d1\u9001\u65b9\u5728\u53d1\u51fa\u62a5\u6587\u540e\uff0c\u9700\u7b49\u5f85\u5bf9\u65b9\u7684\u56de\u590d\uff0c\u624d\u80fd\u53d1\u9001\u4e0b\u4e00\u4e2a\u62a5\u6587\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u7279\u70b9\uff1a\u7f16\u7a0b\u7b80\u5355\uff0c\u6548\u7387\u4f4e"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u73b0\uff1a\u524d\u9762\u7ae0\u8282\u7684\u901a\u8baf\u65b9\u5f0f\uff0c\u5373\u4e3a\u540c\u6b65\u901a\u8baf\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240618121218816",src:e(25137).A+"",width:"1342",height:"941"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5f02\u6b65\u901a\u8baf\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53d1\u9001\u65b9\u5728\u53d1\u51fa\u62a5\u6587\u540e\uff0c\u4e0d\u5fc5\u7b49\u5f85\u5bf9\u65b9\u7684\u56de\u590d\uff0c\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u4e2a\u62a5\u6587\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u7279\u70b9\uff1a\u6548\u7387\u9ad8\uff0c\u7f16\u7a0b\u590d\u6742"}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\uff08\u6309\u6279\u53d1\u9001\u4e0e\u63a5\u6536\uff0c",(0,l.jsx)(r.strong,{children:"\u6279\u5904\u7406"}),"\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u591a\u8fdb\u7a0b\uff08\u5efa\u7acb TCP\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53d1\u9001\u62a5\u6587\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u63a5\u6536\u62a5\u6587\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u591a\u7ebf\u7a0b\uff08\u5efa\u7acb TCP\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u53d1\u9001\u62a5\u6587\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u63a5\u6536\u62a5\u6587\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["I/O \u590d\u7528\uff08 ",(0,l.jsx)(r.code,{children:"select, poll, epoll"})," \uff09"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:(0,l.jsx)(r.img,{alt:"image-20240618121321093",src:e(16163).A+"",width:"1349",height:"926"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6ce8\u610f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6b64\u5904\u8ba8\u8bba\u7684\u540c\u6b65\u4e0e\u5f02\u6b65\uff0c\u662f\u5728\u901a\u8baf\u5c42\u9762\u800c\u8a00\u7684\u3002"}),"\n",(0,l.jsx)(r.li,{children:"\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4e24\u79cd\u901a\u8baf\u65b9\u5f0f\u90fd\u4f1a\u4f7f\u7528\uff0c\u6839\u636e\u573a\u666f\u4e0e\u4e1a\u52a1\u7684\u9002\u914d\u60c5\u51b5\u9009\u62e9\u5373\u53ef\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u5206\u6790"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo07"})," \u540c\u6b65\u901a\u8baf\u5ba2\u6237\u7aef\u7a0b\u5e8f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5f00\u9500\uff1a\u65f6\u95f4\u4e3b\u8981\u7528\u4e8e\u7b49\u5f85"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo08"})," \u670d\u52a1\u7aef\u7a0b\u5e8f"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo09"})," \u591a\u8fdb\u7a0b\u5f02\u6b65\u901a\u8baf\u5ba2\u6237\u7aef\u7a0b\u5e8f"]}),"\n",(0,l.jsxs)(r.li,{children:["\u6838\u5fc3\uff1a\u7236\u5b50\u8fdb\u7a0b\u7684\u5206\u5de5\u8bbe\u8ba1\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5b50\u8fdb\u7a0b\uff08\u53ea\u5411\u670d\u52a1\u7aef\u53d1\u9001\u62a5\u6587\uff09\u3001\u7236\u8fdb\u7a0b\uff08\u53ea\u63a5\u6536\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u62a5\u6587\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"demo10"})," I/O\u590d\u7528\u5f02\u6b65\u901a\u8baf\u5ba2\u6237\u7aef\u7a0b\u5e8f"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u540c\u6b65\u901a\u8baf\u5ba2\u6237\u7aef\u7a0b\u5e8f, demo07.cpp\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using: ./demo07 IP port\\n");\r\n        printf("Example: ./demo07 192.168.20.150 5005\\n");\r\n        return -1;\r\n    }\r\n\r\n    clogfile logfile;\r\n    logfile.open("./log/demo07.log");\r\n\r\n    ctcpclient tcpclient;\r\n    if (tcpclient.connect(argv[1], atoi(argv[2])) == false) {\r\n        logfile.write("tcpclient.connect(%s, %d) failed.\\n", argv[1], atoi(argv[2])); return -1;\r\n    }\r\n    \r\n    logfile.write("connect ok.\\n");\r\n\r\n    string strsendbuffer, strrecvbuffer;\r\n\r\n    for (int i = 1; i <= 100; i++) {\r\n        sformat(strsendbuffer, "\u8fd9\u662f\u7b2c %d \u4e2a\u54f2\u5b66\u5bb6", i);\r\n        logfile.write("%s\\n", strsendbuffer.c_str());\r\n        tcpclient.write(strsendbuffer);     // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u62a5\u6587\r\n\r\n        tcpclient.read(strrecvbuffer);      // \u7b49\u5f85\u670d\u52a1\u7aef\u7684\u56de\u5e94\r\n        logfile.write("%s\\n", strrecvbuffer.c_str());\r\n    }\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u670d\u52a1\u7aef\u7a0b\u5e8f, demo08.cpp\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 2) {\r\n        printf("Using: ./demo08 port\\n");\r\n        printf("Example: ./demo08 5005\\n");\r\n        return -1;\r\n    }\r\n\r\n    ctcpserver tcpserver;\r\n    if (tcpserver.initserver(atoi(argv[1])) == false) {\r\n        cout << "tcpserver.initserver() failed.\\n"; return -1;\r\n    }\r\n\r\n    tcpserver.accept();\r\n\r\n    string strsendbuffer, strrecvbuffer;\r\n    while (true) {\r\n        if (tcpserver.read(strrecvbuffer) == false) break;         // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u62a5\u6587\r\n\r\n        sformat(strsendbuffer, "\u56de\u590d: %s", strrecvbuffer.c_str()); // \u7b80\u5355\u5728\u63a5\u6536\u62a5\u6587\u52a0\u56de\u590d\u4e8c\u5b57\uff0c\u8fd4\u56de\r\n        if (tcpserver.write(strsendbuffer) == false) break;        // \u5411\u5ba2\u6237\u7aef\u53d1\u9001\u56de\u5e94\u62a5\u6587\r\n    }\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u591a\u8fdb\u7a0b\u5f02\u6b65\u901a\u8baf\u5ba2\u6237\u7aef\u7a0b\u5e8f, demo09.cpp\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using: ./demo09 IP port\\n");\r\n        printf("Example: ./demo09 192.168.20.150 5005\\n");\r\n        return -1;\r\n    }\r\n\r\n    clogfile logfile;\r\n    logfile.open("./log/demo09.log");\r\n\r\n    ctcpclient tcpclient;\r\n    if (tcpclient.connect(argv[1], atoi(argv[2])) == false) {\r\n        logfile.write("tcpclient.connect(%s, %d) failed.\\n", argv[1], atoi(argv[2])); return -1;\r\n    }\r\n    \r\n    logfile.write("connect ok.\\n");\r\n\r\n    if (fork() == 0) {\r\n\r\n        string strsendbuffer;\r\n\r\n        for (int i = 1; i <= 100000; i++) {\r\n            sformat(strsendbuffer, "\u8fd9\u662f\u7b2c %d \u4e2a\u54f2\u5b66\u5bb6", i);\r\n            logfile.write("%s\\n", strsendbuffer.c_str());\r\n            tcpclient.write(strsendbuffer);     // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u62a5\u6587\r\n        }\r\n\r\n    } else {\r\n\r\n        string strrecvbuffer;\r\n\r\n        for (int i = 1; i <= 100000; i++) {\r\n            tcpclient.read(strrecvbuffer);      // \u7b49\u5f85\u670d\u52a1\u7aef\u7684\u56de\u5e94\r\n            logfile.write("%s\\n", strrecvbuffer.c_str());\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// I/O\u590d\u7528\u5f02\u6b65\u901a\u8baf\u5ba2\u6237\u7aef\u7a0b\u5e8f, demo10.cpp\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using: ./demo10 IP port\\n");\r\n        printf("Example: ./demo10 192.168.20.150 5005\\n");\r\n        return -1;\r\n    }\r\n\r\n    clogfile logfile;\r\n    logfile.open("./log/demo10.log");\r\n\r\n    ctcpclient tcpclient;\r\n    if (tcpclient.connect(argv[1], atoi(argv[2])) == false) {\r\n        logfile.write("tcpclient.connect(%s, %d) failed.\\n", argv[1], atoi(argv[2])); return -1;\r\n    }\r\n    \r\n    logfile.write("connect ok.\\n");\r\n\r\n    string strsendbuffer, strrecvbuffer;\r\n\r\n    int ack = 0; // \u5df2\u63a5\u6536\u56de\u5e94\u62a5\u6587\u7684\u8ba1\u6570\u5668\r\n\r\n    for (int i = 1; i <= 100000; i++) {\r\n        sformat(strsendbuffer, "\u8fd9\u662f\u7b2c %d \u4e2a\u54f2\u5b66\u5bb6", i);\r\n        logfile.write("%s\\n", strsendbuffer.c_str());\r\n        tcpclient.write(strsendbuffer);     // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u62a5\u6587\r\n\r\n        while (tcpclient.read(strrecvbuffer, -1) == true) { // \u68c0\u67e5 TCP \u7684\u7f13\u51b2\u533a\u4e2d\u662f\u5426\u6709\u670d\u52a1\u7aef\u56de\u5e94\u62a5\u6587\uff0c\u8d85\u65f6\u7b49\u5f85-1\uff0c\u8868\u793a\u4e0d\u7b49\u5f85\r\n            logfile.write("%s\\n", strrecvbuffer.c_str());\r\n            ack++;\r\n        }\r\n    }\r\n\r\n    while (ack < 100000) {\r\n        if (tcpclient.read(strrecvbuffer) == true) { // \u7b49\u5f85\u670d\u52a1\u7aef\u56de\u5e94\u62a5\u6587\uff0c\u7f3a\u77010\r\n            logfile.write("%s\\n", strrecvbuffer.c_str());\r\n            ack++;\r\n        }\r\n    }\r\n    \r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"VSC \u5982\u4f55\u67e5\u9605\u6240\u6709\u7684\u91cd\u8f7d\u51fd\u6570\uff1f"}),"\n",(0,l.jsxs)(r.li,{children:["\u5e94\u5f53\u5148\u6253\u5f00\u65e5\u5fd7\uff0c\u8fd8\u662f\u5148\u8fde\u63a5\u5230\u5ba2\u6237\u7aef\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e2a\u4eba\u503e\u5411\u4e8e\uff0c\u65e0\u8bba\u662f\u8c03\u8bd5\u9636\u6bb5\u8fd8\u662f\u4f7f\u7528\u9636\u6bb5\uff0c\u90fd\u4f18\u5148\u6253\u5f00\u65e5\u5fd7\uff08\u4fbf\u4e8e\u8bb0\u5f55\u95ee\u9898\uff0c\u9664\u975e\u7a0b\u5e8f\u5341\u5206\u7b80\u5355\uff09\uff0c\u5982\u679c\u5148\u8fde\u63a5\u5ba2\u6237\u7aef\uff0c\u5373\u4f7f\u62a5\u9519\u4fe1\u606f\u8fd4\u56de\u5230\u5ba2\u6237\u7aef\uff0c\u4e5f\u4e0d\u5229\u4e8e\u670d\u52a1\u7aef\u7684\u8c03\u8bd5\uff0c\u5982\u4eca\u7701\u7565\u65e5\u5fd7\u7684\u5199\u6cd5\uff0c\u53ea\u662f\u5728\u7a0b\u5e8f\u5458\u80fd\u770b\u5230\u4e24\u4e2a\u7aef\u4fe1\u606f\u7684\u9636\u6bb5\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u800c\u5df2\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u5728\u524d\u9762\u51e0\u7ae0\u7684\u540c\u6b65\u901a\u8baf\u5f53\u4e2d\uff0c\u591a\u8fdb\u7a0b\u7684\u4ee3\u7801\u662f\u5728\u670d\u52a1\u7aef\u7684\uff0c\u5bf9\u6bd4\u672c\u8282\u591a\u8fdb\u7a0b\u5f02\u6b65\u901a\u8baf\uff0c\u7a0d\u6709\u4e0d\u540c\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["**\u5982\u4f55\u7406\u89e3 I/O \u590d\u7528\u7684\u4ee3\u7801\uff1f\u54ea\u90e8\u5206\u5b9e\u73b0\u4e86\u590d\u7528\uff1f**\u4e0a\u8ff0 ",(0,l.jsx)(r.code,{children:"demo10.cpp"})," \u5bf9\u6bd4\u4e09\u79cd I/O \u590d\u7528\u65b9\u6cd5\uff0c\u66f4\u50cf\u54ea\u4e00\u79cd\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u68b3\u7406"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u4e3a\u4ec0\u4e48\u591a\u8fdb\u7a0b\u7684\u6548\u7387\u6bd4 I/O \u590d\u7528\u7684\u9ad8\u4e00\u70b9\u70b9\uff1f\u4e3b\u8981\u5dee\u5f02\u5728\u54ea\uff1f\u5982\u4f55\u5224\u65ad\u4e24\u8005\u7684\u9002\u7528\u573a\u666f\uff1f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/17 20:37:28 \u89c6\u9891\uff0c12min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/18 13:36:17 \u4ee3\u7801\uff0c1h28min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"77-\u4e0a\u4f20\u6587\u4ef6\u4e94",children:"77 \u4e0a\u4f20\u6587\u4ef6\uff08\u4e94\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u6d41\u7a0b\uff08\u5c06\u6587\u4ef6\u4e0a\u4f20\u6539\u4e3a\u5f02\u6b65\u901a\u8baf\uff09\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0 I/O \u8ba1\u6570 ",(0,l.jsx)(r.code,{children:"delayed"})]}),"\n",(0,l.jsx)(r.li,{children:"\u6ce8\u91ca\u90e8\u5206\u65e5\u5fd7"}),"\n",(0,l.jsxs)(r.li,{children:["\u521b\u5efa\u5343\u4e2a\u6d4b\u8bd5\u6587\u4ef6\uff08\u7edf\u8ba1 ",(0,l.jsx)(r.code,{children:"ls */|wc"})," \uff09"]}),"\n",(0,l.jsx)(r.li,{children:"\u8c03\u8bd5"}),"\n",(0,l.jsxs)(r.li,{children:["\u7ec6\u8282\u8865\u5145\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6807\u8bb0\u4f4d\uff08\u8fdb\u7a0b\u4e0d\u4f11\u7720\uff0c\u82e5\u4e0a\u4f20\u8fc7\u7a0b\u4ea7\u751f\u4e86\u65b0\u6587\u4ef6\uff0c\u5219\u53ef\u5c3d\u5feb\u4e0a\u4f20\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u8fdb\u7a0b\u5fc3\u8df3\uff08\u5ba2\u6237\u7aef\u3001\u670d\u52a1\u7aef\uff1b\u82e5\u8fd0\u884c\u53ef\u80fd\u8d85\u65f6\uff0c\u5c31\u66f4\u65b0\u5fc3\u8df3\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u542f\u7528\u670d\u52a1\u7aef\u591a\u8fdb\u7a0b\u4ee3\u7801"}),"\n",(0,l.jsx)(r.li,{children:"\u4fee\u6539\u5ba2\u6237\u7aef\u3001\u670d\u52a1\u7aef\u7684\u63a5\u6536\u62a5\u6587\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u5907\u4efd\u7a0b\u5e8f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u57fa\u4e8e TCP \u534f\u8bae\u7684\u6587\u4ef6\u4e0a\u4f20\u6a21\u5757\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\r\nstruct st_arg {\r\n    int  clienttype;         // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b1\r\n    char ip[31];             // \u670d\u52a1\u7aef\u7684 IP \u5730\u5740\r\n    int  port;               // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\r\n    char clientpath[256];    // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55 /data /data/dir1 /data/dir2\r\n    int  ptype;              // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\r\n    char clientpathbak[256]; // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\uff0c\u672c\u5730\u6587\u4ef6\u7684\u5907\u4efd\u6839\u76ee\u5f55\uff0c\u5f53 ptype == 2 \u65f6\u6709\u6548\r\n    bool andchild;           // \u662f\u5426\u4e0a\u4f20 clientpath \u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\r\n    char matchname[256];     // \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\u3002\u5982 "*.TXT,*.XML"\r\n    char srvpath[256];       // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\uff0c\u63a7\u5236\u662f\u5426\u9012\u5f52\u8bbf\u95ee\u5b50\u76ee\u5f55\r\n    int  timetvl;            // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    int  timeout;            // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\r\n    char pname[51];          // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528 \u201ctcpputfiles_\u540e\u7f00\u201d \u7684\u65b9\u5f0f\r\n} starg;\r\n\r\n// \u5e2e\u52a9\u6587\u6863\r\nvoid _help();\r\n\r\n// \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4e2d\r\nbool _xmltoarg(const char *strxmlbuffer);\r\n\r\nclogfile logfile;       // \u521b\u5efa\u65e5\u5fd7\u5bf9\u8c61\r\nctcpclient tcpclient;   // \u521b\u5efa TCP \u901a\u8baf\u7684\u5ba2\u6237\u7aef\u5bf9\u8c61\r\n\r\n// \u7a0b\u5e8f\u9000\u51fa\u4fe1\u53f72\u300115\u7684\u5904\u7406\u51fd\u6570\r\nvoid EXIT(int sig);\r\n\r\nbool activetest();      // \u5fc3\u8df3\r\n\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv);\r\n\r\n// \u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\nbool _tcpputfiles(bool &bcontinue);\r\n\r\n// \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8f6c\u5b58\u672c\u5730\u7684\u6587\u4ef6\uff09\r\nbool ackmessage(const string &strrecvbuffer);\r\n\r\n// \u628a\u6587\u4ef6\u7684\u5185\u5bb9\u53d1\u9001\u7ed9\u5bf9\u7aef\r\nbool sendfile(const string &filename, const int filesize);\r\n\r\ncpactive pactive; // \u8fdb\u7a0b\u5fc3\u8df3\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        _help();\r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\u3002\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\u3002\r\n    // \u5728\u7f51\u7edc\u901a\u8baf\u7a0b\u5e8f\u4e2d\uff0c\u4e00\u822c\u4e0d\u5173IO\uff0c\u56e0\u4e3a\u67d0\u4e9b\u51fd\u6570\u53ef\u80fd\u4f1a\u5f801\u548c2\u4e2d\u8f93\u51fa\u4fe1\u606f\r\n    // \u5982\u679c\u5173\u4e861\u548c2\uff0c\u90a3\u4e481\u548c2\u4f1a\u88absocket\u91cd\u7528\uff0c\u54111\u548c2\u8f93\u51fa\u7684\u4fe1\u606f\u4f1a\u53d1\u9001\u5230\u7f51\u7edc\u4e2d\u3002\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u5931\u8d25\uff08%s\uff09\u3002\\n",argv[1]); return -1;\r\n    }\r\n\r\n    // \u89e3\u6790 xml\uff0c\u5f97\u5230\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\r\n    if (_xmltoarg(argv[2]) == false) return -1;\r\n\r\n    pactive.addpinfo(starg.timeout, starg.pname); // \u628a\u8fdb\u7a0b\u7684\u5fc3\u8df3\u4fe1\u606f\u5199\u5165\u5171\u4eab\u5185\u5b58\r\n\r\n    // \u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\r\n    if (tcpclient.connect(starg.ip, starg.port) == false) {\r\n        logfile.write("tcpclient.connect(%s, %d) failed.\\n", starg.ip, starg.port); EXIT(-1);\r\n    }\r\n\r\n    if (login(argv[2]) == false) { logfile.write("login() failed.\\n"); EXIT(-1); }\r\n\r\n    bool bcontinue = true; // \u5982\u679c\u8c03\u7528 _tcpputfiles() \u53d1\u9001\u4e86\u6587\u4ef6\uff0cbcontinue \u4e3a true\uff0c\u5426\u5219\u4e3a false\uff0c\u521d\u59cb\u5316\u4e3a true\r\n\r\n    while (true) {\r\n\r\n        // \u8c03\u7528\u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\n        if (_tcpputfiles(bcontinue) == false) { logfile.write("_tcpputfiles() failed.\\n"); EXIT(-1); }\r\n\r\n        // \u5982\u679c\u521a\u624d\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u5019\u4e0a\u4f20\u4e86\u6587\u4ef6\uff0c\u90a3\u4e48\uff0c\u5728\u4e0a\u4f20\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u6709\u65b0\u7684\u6587\u4ef6\u9646\u7eed\u5df2\u751f\u6210\r\n        // \u4e3a\u4fdd\u8bc1\u6587\u4ef6\u88ab\u5c3d\u5feb\u4e0a\u4f20\uff0c\u8fdb\u7a0b\u4e0d\u4f11\u7720\uff08\u53ea\u6709\u5728\u521a\u624d\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u5019\u6ca1\u6709\u4e0a\u4f20\u6587\u4ef6\u7684\u60c5\u51b5\u624d\u4f11\u7720\uff09\r\n        if (bcontinue == false) {\r\n            sleep(starg.timetvl);\r\n\r\n            // \u53d1\u9001\u5fc3\u8df3\u62a5\u6587\r\n            if (activetest() == false) break;\r\n        }\r\n\r\n        pactive.uptatime();\r\n    }\r\n\r\n    EXIT(0);\r\n}\r\n\r\n// \u5fc3\u8df3\r\nbool activetest() {\r\n\r\n    strsendbuffer = "<activetest>ok</activetest>";\r\n    // xxxxxxxxxx logfile.write("\u53d1\u9001\uff1a%s\\n", strsendbuffer.c_str());\r\n    if (tcpclient.write(strsendbuffer) == false) return false;      // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\r\n\r\n    if (tcpclient.read(strrecvbuffer, 10) == false) return false;   // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\r\n    // xxxxxxxxxx logfile.write("\u63a5\u6536\uff1a%s\\n", strsendbuffer.c_str());\r\n\r\n    // \u5fc3\u8df3\u673a\u5236\u7684\u4ee3\u7801\u53ef\u7b80\u5355\u5316\u5904\u7406\uff0c\u53ea\u9700\u8981\u6536\u5230\u5bf9\u7aef\u7684\u56de\u5e94\u5c31\u884c\u4e86\uff0c\u4e0d\u5fc5\u5224\u65ad\u56de\u5e94\u7684\u5185\u5bb9\r\n\r\n    return true;\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n\r\n    logfile.write("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\nvoid _help() {\r\n\r\n    string base_bin = "/home/celfs/project/engi_cpp/49_project";\r\n\r\n    printf("\\n");\r\n    printf("Using: %s/tools/bin/tcpputfiles logfilename xmlbuffer\\n\\n", base_bin.c_str());\r\n    printf(\r\n        "Example: %s/tools/bin/procctl 20 %s/tools/bin/tcpputfiles %s/log/idc/tcpputfiles_surfdata.log "\\\r\n        "\\"<ip>192.168.20.150</ip><port>5005</port>"\\\r\n        "<clientpath>%s/tmp/client</clientpath><ptype>1</ptype>"\\\r\n        "<srvpath>%s/tmp/server</srvpath>"\\\r\n        "<andchild>true</andchild><matchname>*.xml,*.txt,*.csv</matchname><timetvl>10</timetvl>"\\\r\n        "<timeout>50</timeout><pname>tcpputfiles_surfdata</pname>\\"\\n\\n", \r\n        base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str()\r\n    ); \r\n\r\n    printf("\u672c\u7a0b\u5e8f\u662f\u6570\u636e\u4e2d\u5fc3\u7684\u516c\u5171\u529f\u80fd\u6a21\u5757\uff0c\u91c7\u7528tcp\u534f\u8bae\u628a\u6587\u4ef6\u4e0a\u4f20\u7ed9\u670d\u52a1\u7aef\u3002\\n");\r\n    printf("logfilename   \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n    printf("xmlbuffer     \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\\n");\r\n    printf("ip            \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\\n");\r\n    printf("port          \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\\n");\r\n    printf("ptype         \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\\n");\r\n    printf("clientpath    \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("clientpathbak \u6587\u4ef6\u6210\u529f\u4e0a\u4f20\u540e\uff0c\u672c\u5730\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\\n");\r\n    printf("andchild      \u662f\u5426\u4e0a\u4f20clientpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\uff0c\u7f3a\u7701\u4e3afalse\u3002\\n");\r\n    printf("matchname     \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982\\"*.TXT,*.XML\\"\\n");\r\n    printf("srvpath       \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("timetvl       \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u53d6\u503c\u57281-30\u4e4b\u95f4\u3002\\n");\r\n    printf("timeout       \u672c\u7a0b\u5e8f\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u89c6\u6587\u4ef6\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u800c\u5b9a\uff0c\u5efa\u8bae\u8bbe\u7f6e50\u4ee5\u4e0a\u3002\\n");\r\n    printf("pname         \u8fdb\u7a0b\u540d\uff0c\u5c3d\u53ef\u80fd\u91c7\u7528\u6613\u61c2\u7684\u3001\u4e0e\u5176\u5b83\u8fdb\u7a0b\u4e0d\u540c\u7684\u540d\u79f0\uff0c\u65b9\u4fbf\u6545\u969c\u6392\u67e5\u3002\\n\\n");\r\n}\r\n\r\nbool _xmltoarg(const char *strxmlbuffer) {\r\n\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n\r\n    getxmlbuffer(strxmlbuffer, "ip", starg.ip);\r\n    if (strlen(starg.ip) == 0) { logfile.write("ip is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "port", starg.port);\r\n    if (starg.port == 0) { logfile.write("port is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "ptype", starg.ptype);\r\n    if ((starg.ptype != 1) && (starg.ptype != 2)) { logfile.write("ptype not in (1, 2).\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "clientpath", starg.clientpath);\r\n    if (strlen(starg.clientpath) == 0) { logfile.write("clientpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "clientpathbak", starg.clientpathbak);\r\n    if ((starg.ptype == 2) && (strlen(starg.clientpathbak) == 0)) { logfile.write("clientpathbak is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "andchild", starg.andchild);\r\n\r\n    getxmlbuffer(strxmlbuffer, "matchname", starg.matchname);\r\n    if (strlen(starg.matchname) == 0) { logfile.write("matchname is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "srvpath", starg.srvpath);\r\n    if (strlen(starg.srvpath) == 0) { logfile.write("srvpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "timetvl", starg.timetvl);\r\n    if (starg.timetvl == 0) { logfile.write("timetvl is null.\\n"); return false; }\r\n\r\n    // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    // starg.timetvl\u6ca1\u6709\u5fc5\u8981\u8d85\u8fc730\u79d2\r\n    if (starg.timetvl > 30) starg.timetvl = 30;\r\n\r\n    // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e00\u5b9a\u8981\u5927\u4e8e starg.timetvl\r\n    getxmlbuffer(strxmlbuffer, "timeout", starg.timeout);\r\n    if (starg.timeout == 0) { logfile.write("timeout is null.\\n"); return false; }\r\n    if (starg.timeout <= starg.timetvl) { logfile.write("starg.timeout(%d) <= starg.timetvl(%d)\\n", starg.timeout, starg.timetvl); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "pname", starg.pname, 50);\r\n    //if (strlen(starg.pname) == 0) { logfile.write("pname is null.\\n"); return false; }\r\n\r\n    return true;\r\n}\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv) {\r\n\r\n    sformat(strsendbuffer, "%s<clienttype>1</clienttype>", argv);\r\n    // xxxxxxxxxx logfile.write("\u53d1\u9001\uff1a%s\\n", strsendbuffer.c_str());\r\n    if (tcpclient.write(strsendbuffer) == false) return false;      // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\r\n\r\n    if (tcpclient.read(strrecvbuffer, 10) == false) return false;  // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\r\n    // xxxxxxxxxx logfile.write("\u63a5\u6536\uff1a%s\\n", strrecvbuffer.c_str());\r\n\r\n    logfile.write("\u767b\u5f55(%s:%d)\u6210\u529f\u3002\\n", starg.ip, starg.port);\r\n\r\n    return true;\r\n}\r\n\r\n// \u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\nbool _tcpputfiles(bool &bcontinue) {\r\n\r\n    bcontinue = false;\r\n\r\n    cdir dir;\r\n\r\n    // \u6253\u5f00 starg.client \u76ee\u5f55\r\n    if (dir.opendir(starg.clientpath, starg.matchname, 10000, starg.andchild) == false) {\r\n        logfile.write("dir.opendir(%s) failed.\\n", starg.clientpath); return false;\r\n    }\r\n\r\n    int delayed = 0; // \u672a\u6536\u5230\u5bf9\u7aef\u786e\u8ba4\u62a5\u6587\u7684\u6587\u4ef6\u6570\u91cf\uff0c\u53d1\u9001\u4e86\u4e00\u4e2a\u6587\u4ef6\u5c31\u52a01\uff0c\u63a5\u6536\u4e86\u4e00\u4e2a\u56de\u5e94\u5c31\u51cf1\r\n\r\n    // \u904d\u5386\u76ee\u5f55\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\r\n    while (dir.readdir()) {\r\n    \r\n        bcontinue = true;\r\n\r\n        // \u628a\u6587\u4ef6\u540d\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6587\u4ef6\u5927\u5c0f\u7ec4\u6210\u62a5\u6587\uff0c\u53d1\u9001\u7ed9\u5bf9\u7aef\r\n        sformat(strsendbuffer, "<filename>%s</filename><mtime>%s</mtime><size>%d</size>", \r\n                dir.m_ffilename.c_str(), dir.m_mtime.c_str(), dir.m_filesize);\r\n        \r\n        // xxxxxxxxxx logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n        if (tcpclient.write(strsendbuffer) == false) {\r\n            logfile.write("tcpclien.write() failed.\\n"); return false;\r\n        }\r\n\r\n        // \u53d1\u9001\u6587\u4ef6\u5185\u5bb9\r\n        logfile.write("send %s(%d) ...", dir.m_ffilename.c_str(), dir.m_filesize);\r\n        if (sendfile(dir.m_ffilename, dir.m_filesize) == true) {\r\n            logfile << "ok.\\n";\r\n            delayed++;\r\n        } else {\r\n            logfile << "failed.\\n"; tcpclient.close(); return false;\r\n        }\r\n\r\n        pactive.uptatime();\r\n\r\n        while (delayed > 0) {\r\n            // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u62a5\u6587\r\n            if (tcpclient.read(strrecvbuffer, -1) == false) break;\r\n            // xxxxxxxxxx logfile.write("strrecvbuffer1 = %s\\n", strrecvbuffer.c_str());\r\n\r\n            // \u5904\u7406\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u62a5\u6587\uff08\u5220\u9664\u672c\u5730\u6587\u4ef6\u6216\u628a\u672c\u5730\u6587\u4ef6\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\uff09\r\n            ackmessage(strrecvbuffer);\r\n        }\r\n    }\r\n\r\n    // \u7ee7\u7eed\u63a5\u6536\u5bf9\u7aef\u7684\u786e\u8ba4\u62a5\u6587\r\n    while (delayed > 0) {\r\n        if (tcpclient.read(strrecvbuffer, 10) == false) break;\r\n        // xxxxxxxxxx logfile.write("strrecvbuffer2 = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8f6c\u5b58\u672c\u5730\u7684\u6587\u4ef6\uff09\r\n        delayed--;\r\n        ackmessage(strrecvbuffer);\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u628a\u6587\u4ef6\u7684\u5185\u5bb9\u53d1\u9001\u7ed9\u5bf9\u7aef\r\nbool sendfile(const string &filename, const int filesize) {\r\n\r\n    int onread = 0;         // \u6bcf\u6b21\u6253\u7b97\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u7684\u5b57\u8282\u6570\r\n    char buffer[1000];      // \u5b58\u653e\u8bfb\u53d6\u6570\u636e\u7684buffer\uff0cbuffer\u7684\u5927\u5c0f\u53ef\u53c2\u8003\u786c\u76d8\u4e00\u6b21\u8bfb\u53d6\u6570\u636e\u91cf\uff084K\u4e3a\u5b9c\uff09\r\n    int totalbytes = 0;     // \u4ece\u6587\u4ef6\u4e2d\u5df2\u8bfb\u53d6\u7684\u5b57\u8282\u603b\u6570\r\n    cifile ifile;           // \u8bfb\u53d6\u6587\u4ef6\u7684\u5bf9\u8c61\r\n\r\n    // \u5fc5\u987b\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u64cd\u4f5c\u6587\u4ef6\r\n    if (ifile.open(filename, ios::in | ios::binary) == false) return false;\r\n\r\n    while (true) {\r\n        memset(buffer, 0, sizeof(buffer));\r\n\r\n        // \u4ece\u8ba1\u7b97\u672c\u6b21\u5e94\u8be5\u8bfb\u53d6\u7684\u5b57\u8282\u6570\uff0c\u5982\u679c\u5269\u4f59\u7684\u6570\u636e\u8d85\u8fc7 1000 \u5b57\u8282\uff0c\u5c31\u8bfb 1000 \u5b57\u8282\r\n        if (filesize - totalbytes > 1000) onread = 1000;\r\n        else onread = filesize - totalbytes;\r\n\r\n        // \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\r\n        ifile.read(buffer, onread);\r\n\r\n        // \u628a\u8bfb\u53d6\u5230\u7684\u6570\u636e\u53d1\u9001\u7ed9\u5bf9\u7aef\r\n        if (tcpclient.write(buffer, onread) == false) { return false; }\r\n        // logfile.write("tcpclient.write() buffer is: %s\\n", buffer); // \u6d4b\u8bd5\u53d1\u73b0\uff0c\u53d1\u9001\u7684\u6570\u636e\u6b63\u5e38\uff0c\u8bf4\u660e\u63a5\u6536\u6570\u636e\u6709\u95ee\u9898\r\n\r\n        // \u8ba1\u7b97\u6587\u4ef6\u5df2\u8bfb\u53d6\u7684\u5b57\u8282\u603b\u6570\uff0c\u5982\u679c\u5df2\u8bfb\u5b8c\uff0c\u8df3\u51fa\u5faa\u73af\r\n        totalbytes = totalbytes + onread;\r\n\r\n        if (totalbytes == filesize) break;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8f6c\u5b58\u672c\u5730\u7684\u6587\u4ef6\uff09\r\nbool ackmessage(const string &strrecvbuffer) {\r\n\r\n    // <filename>/tmp/client/1.txt</filename><result>ok</result>\r\n    string filename;    // \u672c\u5730\u6587\u4ef6\u540d\r\n    string result;      // \u5bf9\u7aef\u63a5\u6536\u6587\u4ef6\u7684\u7ed3\u679c\r\n    getxmlbuffer(strrecvbuffer, "filename", filename);\r\n    getxmlbuffer(strrecvbuffer, "result", result);\r\n\r\n    // \u5982\u679c\u670d\u52a1\u7aef\u63a5\u6536\u6587\u4ef6\u4e0d\u6210\u529f\uff0c\u76f4\u63a5\u8fd4\u56de\uff08\u4e0b\u6b21\u6267\u884c\u6587\u4ef6\u4f20\u8f93\u4efb\u52a1\u65f6\u5c06\u4f1a\u91cd\u4f20\uff09\r\n    if (result != "ok") return true;\r\n\r\n    // \u5982\u679c starg.ptype == 1\uff0c\u5220\u9664\u6587\u4ef6\r\n    if (starg.ptype == 1) {\r\n        if (remove(filename.c_str()) != 0) { logfile.write("remove(%s) failed.\\n", filename.c_str()); return false; }\r\n    }\r\n\r\n    // \u5982\u679c starg.ptype == 2\uff0c\u79fb\u52a8\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\r\n    if (starg.ptype == 2) {\r\n        // \r\n        string bakfilename = filename;\r\n        replacestr(bakfilename, starg.clientpath, starg.clientpathbak, false); // \u6ce8\u610f\uff0c\u7b2c\u56db\u4e2a\u53c2\u6570\u4e00\u5b9a\u586b false\r\n        if (renamefile(filename, bakfilename) == false) {\r\n            logfile.write("renamefile(%s, %s) failed.\\n", filename.c_str(), bakfilename.c_str()); return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\u3002\r\nstruct st_arg\r\n{\r\n    int  clienttype;           // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b1\u3002\r\n    char ip[31];               // \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\r\n    int  port;                 // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\r\n    char clientpath[256];      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002 /data /data/aaa /data/bbb\r\n    int  ptype;                // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\r\n    char clientpathbak[256];   // \u6587\u4ef6\u6210\u529f\u4e0a\u4f20\u540e\uff0c\u672c\u5730\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\r\n    bool andchild;             // \u662f\u5426\u4e0a\u4f20clientpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\u3002\r\n    char matchname[256];       // \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982"*.TXT,*.XML"\u3002\r\n    char srvpath[256];         // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002/data1 /data1/aaa /data1/bbb\r\n    int  timetvl;              // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\u3002 \r\n    int  timeout;              // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\u3002\r\n    char pname[51];            // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528"tcpputfiles_\u540e\u7f00"\u7684\u65b9\u5f0f\u3002\r\n} starg;\r\n\r\nclogfile logfile;        // \u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u65e5\u5fd7\r\nctcpserver tcpserver;    // \u521b\u5efatcp\u901a\u8baf\u7684\u670d\u52a1\u7aef\u5bf9\u8c61\r\n\r\nvoid FathEXIT(int sig);  // \u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\nvoid ChldEXIT(int sig);  // \u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin();\r\n\r\n// \u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid recvfilesmain();\r\n\r\nstring strsendbuffer;    // \u53d1\u9001\u62a5\u6587\u7684buffer\r\nstring strrecvbuffer;    // \u63a5\u6536\u62a5\u6587\u7684buffer\r\n\r\n// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, int filesize);\r\n\r\ncpactive pactive; // \u8fdb\u7a0b\u5fc3\u8df3\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using:./fileserver port logfile\\n");\r\n        printf("Example:./fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n"); \r\n        printf("         /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 10 /home/celfs/project/engi_cpp/49_project/tools/bin/fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n\\n\\n"); \r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\r\n    //closeioandsignal(false); \r\n    signal(SIGINT, FathEXIT); signal(SIGTERM, FathEXIT);\r\n\r\n    if (logfile.open(argv[2]) == false) {\r\n        printf("logfile.open(%s) failed.\\n", argv[2]); return -1;\r\n    }\r\n\r\n    // \u670d\u52a1\u7aef\u521d\u59cb\u5316\u3002\r\n    if (tcpserver.initserver(atoi(argv[1]))==false) {\r\n      logfile.write("tcpserver.initserver(%s) failed.\\n",argv[1]); return -1;\r\n    }\r\n\r\n    while (true) {\r\n\r\n        // \u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\r\n        if (tcpserver.accept() == false) {\r\n            logfile.write("tcpserver.accept() failed.\\n"); FathEXIT(-1);\r\n        }\r\n\r\n        logfile.write("\u5ba2\u6237\u7aef\uff08%s\uff09\u5df2\u8fde\u63a5\u3002\\n", tcpserver.getip());\r\n\r\n        // \u4e0d\u4f7f\u7528\u591a\u8fdb\u7a0b\u65f6\uff0c\u53ef\u4fbf\u4e8e GDB \u8c03\u8bd5\r\n        if (fork() > 0) { tcpserver.closeclient(); continue; }   // \u7236\u8fdb\u7a0b\u7ee7\u7eed\u56de\u5230Accept()\r\n\r\n        // \u5b50\u8fdb\u7a0b\u91cd\u65b0\u8bbe\u7f6e\u9000\u51fa\u4fe1\u53f7\r\n        signal(SIGINT, ChldEXIT); signal(SIGTERM, ChldEXIT);\r\n\r\n        tcpserver.closelisten();\r\n\r\n        // \u5b50\u8fdb\u7a0b\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u901a\u8baf\uff0c\u5904\u7406\u4e1a\u52a1\u3002\r\n\r\n        // \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n        if (clientlogin() == false) ChldEXIT(-1);\r\n\r\n        // \u628a\u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\u5199\u5165\u5171\u4eab\u5185\u5b58\uff08\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u5fc3\u8df3\uff09\r\n        pactive.addpinfo(starg.timeout, starg.pname);\r\n\r\n        // \u5982\u679cstarg.clienttype == 1\uff0c\u8c03\u7528\u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        if (starg.clienttype == 1)  recvfilesmain();  \r\n\r\n        // \u5982\u679c starg.clienttype == 2\uff0c\u8c03\u7528\u4e0b\u8f7d\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        // if (starg.clienttype == 2) sendfilesmain();\r\n\r\n        ChldEXIT(0);\r\n    }\r\n}\r\n\r\nvoid FathEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u7236\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closelisten();    // \u5173\u95ed\u76d1\u542c\u7684socket\r\n\r\n    kill(0, 15);     // \u901a\u77e5\u5168\u90e8\u7684\u5b50\u8fdb\u7a0b\u9000\u51fa\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid ChldEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closeclient();    // \u5173\u95ed\u5ba2\u6237\u7aef\u7684socket\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\n// \u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid recvfilesmain() {\r\n\r\n    while (true) {\r\n\r\n        pactive.uptatime(); // \u53ea\u9700\u6b64\u5904\u4e00\u4e2a\u5730\u65b9\u66f4\u65b0\u5fc3\u8df3\r\n\r\n        // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u62a5\u6587\r\n        if (tcpserver.read(strrecvbuffer, starg.timetvl + 10) == false) {\r\n            logfile.write("tcpserver.read() failed.\\n"); return;\r\n        }\r\n        // xxxxxxxxxx logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u5fc3\u8df3\u62a5\u6587\r\n        if (strrecvbuffer == "<activetest>ok</activetest>") {\r\n\r\n            strsendbuffer = "ok.";\r\n            // xxxxxxxxxx logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.write() failed.\\n"); return;\r\n            }\r\n        }\r\n\r\n        // \u5904\u7406\u4e0a\u4f20\u6587\u4ef6\u7684\u8bf7\u6c42\u62a5\u6587\r\n        if (strrecvbuffer.find("<filename>") != string::npos) {\r\n            // \u89e3\u6790\u4e0a\u4f20\u6587\u4ef6\u8bf7\u6c42\u62a5\u6587\u7684 xml\r\n            string clientfilename;  // \u5bf9\u7aef\u7684\u6587\u4ef6\u540d\r\n            string mtime;           // \u6587\u4ef6\u7684\u65f6\u95f4\r\n            int filesize = 0;       // \u6587\u4ef6\u5927\u5c0f\r\n            getxmlbuffer(strrecvbuffer, "filename", clientfilename);\r\n            getxmlbuffer(strrecvbuffer, "mtime", mtime);\r\n            getxmlbuffer(strrecvbuffer, "size", filesize);\r\n            // logfile.write("start --\x3e strrecvbuffer is :%s\\n", strrecvbuffer.c_str());// aaaaaa\r\n\r\n            // \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\n            // starg.clientpath = /tmp/client\r\n            // starg.srvpath = /tmp/server\r\n            // \u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u540d\uff1aclientfilename = /tmp/client/aaa/1/txt\r\n            // \u670d\u52a1\u7aef\u7684\u6587\u4ef6\u540d\uff1aserverfilename = /tmp/server/aaa/1/txt\r\n            string serverfilename;\r\n            serverfilename = clientfilename;\r\n            replacestr(serverfilename, starg.clientpath, starg.srvpath, false);\r\n            // logfile.write("filename is: %s\\n", serverfilename.c_str());// aaaaaa\r\n\r\n            logfile.write("recv %s(%d) ...", serverfilename.c_str(), filesize);\r\n            if (recvfile(serverfilename, mtime, filesize) == true) {\r\n                logfile << "ok.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>ok</result>", clientfilename.c_str());\r\n                // logfile << "ok --\x3e strsendbuffer is : " + strsendbuffer + " \\n";// aaaaaa\r\n                // logfile.write("ok --\x3e strsendbuffer is :%s\\n", strsendbuffer.c_str());// aaaaaa\r\n            } else {\r\n                logfile << "failed.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>failed</result>", clientfilename.c_str());\r\n                // logfile.write("failed --\x3e strsendbuffer is :%s\\n", strsendbuffer.c_str());// aaaaaa\r\n            }\r\n\r\n            // \u5047\u8bbe\u6210\u529f\u7684\u63a5\u6536\u4e86\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u62fc\u63a5\u786e\u8ba4\u62a5\u6587\u7684\u5185\u5bb9\r\n            // sformat(strsendbuffer, "<filename>%s</filename><result>ok</result>", clientfilename.c_str());\r\n\r\n            // \u628a\u786e\u8ba4\u62a5\u6587\u8fd4\u56de\u7ed9\u5bf9\u7aef\r\n            // xxxxxxxxxx logfile.write("back to strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.write() failed.\\n"); return;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, int filesize) {\r\n\r\n    int totalbytes = 0;     // \u5df2\u63a5\u6536\u6587\u4ef6\u7684\u603b\u5b57\u8282\u6570\r\n    int onread = 0;         // \u672c\u6b21\u6253\u7b97\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n    char buffer[1000];      // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\u7684\u7f13\u51b2\u533a\r\n    cofile ofile;           // \u5199\u5165\u6587\u4ef6\u7684\u5bf9\u8c61\r\n\r\n    // \u5fc5\u987b\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u64cd\u4f5c\u6587\u4ef6\r\n    if (ofile.open(filename, true, ios::out | ios::binary) == false) return false;\r\n\r\n    while (true) {\r\n\r\n        memset(buffer, 0, sizeof(buffer));\r\n\r\n        // \u8ba1\u7b97\u672c\u6b21\u5e94\u8be5\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n        if (filesize - totalbytes > 1000) onread = 1000;\r\n        else onread = filesize - totalbytes;\r\n\r\n        // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\r\n        if (tcpserver.read(buffer, onread) == false) return false;\r\n\r\n        // \u628a\u63a5\u6536\u5230\u7684\u5185\u5bb9\u5199\u5165\u6587\u4ef6\r\n        ofile.write(buffer, onread);\r\n        // logfile.write("ofile.write(buffer, onread) is: %s (%d)\\n", buffer, onread);// aaaaaa\r\n\r\n        // \u8ba1\u7b97\u5df2\u7ecf\u63a5\u6536\u6587\u4ef6\u7684\u603b\u5b57\u8282\u6570\uff0c\u5982\u679c\u6587\u4ef6\u63a5\u6536\u5b8c\uff0c\u8df3\u51fa\u5faa\u73af\r\n        totalbytes = totalbytes + onread;\r\n\r\n        if (totalbytes == filesize) break;\r\n    }\r\n\r\n    ofile.closeandrename();\r\n\r\n    // \u6587\u4ef6\u65f6\u95f4\u7528\u5f53\u524d\u65f6\u95f4\u6ca1\u6709\u610f\u4e49\uff0c\u5e94\u8be5\u4e0e\u5bf9\u7aef\u7684\u6587\u4ef6\u65f6\u95f4\u4fdd\u6301\u4e00\u81f4\r\n    idc::setmtime(filename, mtime);\r\n\r\n    return true;\r\n}\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin()\r\n{\r\n    // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n    if (tcpserver.read(strrecvbuffer, 10) == false)\r\n    {\r\n        logfile.write("tcpserver.read() failed.\\n"); return false;\r\n    }\r\n    // xxxxxxxxxx logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n    // \u89e3\u6790\u5ba2\u6237\u7aef\u767b\u5f55\u62a5\u6587\uff0c\u4e0d\u9700\u8981\u5bf9\u53c2\u6570\u505a\u5408\u6cd5\u6027\u5224\u65ad\uff0c\u5ba2\u6237\u7aef\u5df2\u7ecf\u5224\u65ad\u8fc7\u4e86\u3002\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n    getxmlbuffer(strrecvbuffer,"clienttype", starg.clienttype);\r\n    getxmlbuffer(strrecvbuffer,"clientpath", starg.clientpath);\r\n    getxmlbuffer(strrecvbuffer,"srvpath", starg.srvpath);\r\n\r\n    getxmlbuffer(strrecvbuffer,"timetvl",starg.timetvl);        // \u6267\u884c\u4efb\u52a1\u7684\u5468\u671f\u3002\r\n    getxmlbuffer(strrecvbuffer,"timeout",starg.timeout);     // \u8fdb\u7a0b\u8d85\u65f6\u7684\u65f6\u95f4\u3002\r\n    getxmlbuffer(strrecvbuffer,"pname",starg.pname,50);    // \u8fdb\u7a0b\u540d\u3002\r\n\r\n    // \u4e3a\u4ec0\u4e48\u8981\u5224\u65ad\u5ba2\u6237\u7aef\u7684\u7c7b\u578b\uff1f\u4e0d\u662f\u53ea\u67091\u548c2\u5417\uff1f \u9632\u6b62\u975e\u6cd5\u7684\u8fde\u63a5\u8bf7\u6c42\u3002\r\n    if ( (starg.clienttype != 1) && (starg.clienttype != 2) )\r\n        strsendbuffer = "failed";\r\n    else\r\n        strsendbuffer = "ok";\r\n\r\n    if (tcpserver.write(strsendbuffer) == false)\r\n    {\r\n        logfile.write("tcpserver.write() failed.\\n"); return false;\r\n    }\r\n\r\n    logfile.write("%s login %s.\\n", tcpserver.getip(), strsendbuffer.c_str());\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7ecf\u9a8c"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6ce8\u91ca\u4ee3\u7801\uff0c\u53ef\u52a0\u5165\u7279\u5b9a\u524d\u7f00\uff0c\u4fbf\u4e8e\u67e5\u627e\u5e76\u53d6\u6d88\u6ce8\u91ca\u3002\u4f8b\u5982\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"// xxxxxxxxxx"})," \uff08\u7edf\u4e00\u4e3a\u5341\u4e2a ",(0,l.jsx)(r.code,{children:"x"})," \uff09\u8fdb\u884c\u6ce8\u91ca\uff0c\u9700\u8981\u53d6\u6d88\u65f6\uff0c\u53ef\u8003\u8651\u4e00\u952e\u66ff\u6362\uff0c\u4e5f\u53ef\u8003\u8651\u67e5\u627e\u5b57\u7b26\u4e32\u540e\uff0c\u6309\u9700\u53d6\u6d88\u6ce8\u91ca\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u67e5\u770b\u7aef\u53e3\u72b6\u6001\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"ss | grep port"})}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.code,{children:"netstat"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4f55\u5df2\u7ecf\u7528 ",(0,l.jsx)(r.code,{children:"delayed > 0"})," \u6765\u754c\u5b9a\u4e86\u63a5\u6536\u670d\u52a1\u7aef\u786e\u8ba4\u62a5\u6587\u540e\uff0c\u8fd8\u8981\u5728\u5faa\u73af\u5916\u7ee7\u7eed\u63a5\u6536\u5bf9\u7aef\u7684\u786e\u8ba4\u62a5\u6587\uff1f"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4ec0\u4e48\u5728\u5185\u5c42\u5faa\u73af\u4e0d\u4f7f\u7528 ",(0,l.jsx)(r.code,{children:"delayed--"})," \u800c\u5728\u5916\u5c42\u5faa\u73af\u4f7f\u7528\uff1f"]}),"\n",(0,l.jsxs)(r.li,{children:["\u4e3a\u4ec0\u4e48\u4e00\u4e2a ",(0,l.jsx)(r.code,{children:"delayed"})," \u5c31\u80fd\u5b9e\u73b0 I/O \u590d\u7528\u7684\u5f02\u6b65\u901a\u8baf\uff1f"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u4e3a\u4ec0\u4e48\u8c03\u8bd5\u65f6\uff0c\u5ba2\u6237\u7aef\u62a5\u6587\u6709\u6587\u4ef6\u53d1\u9001\u65e5\u5fd7\uff0c\u4f46\u5b9e\u9645\u6587\u4ef6\u5e76\u6ca1\u6709\u53d1\u9001\u5230\u670d\u52a1\u7684\u7684\u76ee\u5f55\uff1f"}),"\uff08\u8be6\u89c1 BUG\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u65e5\u5fd7\u6ce8\u91ca\u7684\u539f\u5219\u662f\u4ec0\u4e48\uff1f\u54ea\u4e9b\u662f\u5fc5\u8981\u7684\uff0c\u54ea\u4e9b\u662f\u4e0d\u5fc5\u8981\u7684\uff1f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5f80\u6765\u7684\u62a5\u6587"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5982\u4f55\u7406\u89e3\u628a\u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\u5199\u5165\u5171\u4eab\u5185\u5b58\u7684\u6dfb\u52a0\u65f6\u673a\uff1f"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["1\uff09\u5f3a\u5236\u7ec8\u6b62\u670d\u52a1\u7aef\uff0c\u518d\u6b21\u8fd0\u884c\uff0c\u62a5\u9519 ",(0,l.jsx)(r.code,{children:"'std::length_error'"})]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7b49\u5f85\u7a0b\u5e8f\u8d85\u65f6\uff0c\u518d\u6b21\u8fd0\u884c\uff0c\u95ee\u9898\u590d\u73b0"}),"\n",(0,l.jsx)(r.li,{children:"\u591a\u6b21\u91cd\u65b0\u8fd0\u884c\uff0c\u95ee\u9898\u6682\u65f6\u6d88\u5931"}),"\n",(0,l.jsx)(r.li,{children:"\u91cd\u65b0\u7f16\u8bd1\uff0c\u95ee\u9898\u6682\u65f6\u6d88\u5931"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u63a8\u6d4b"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"5005"})," \u7aef\u53e3\u95ee\u9898"]}),"\n",(0,l.jsx)(r.li,{children:"\u67d0\u4e2a\u5904\u7406\u51fd\u6570\u53c2\u6570\u95ee\u9898"}),"\n",(0,l.jsx)(r.li,{children:"\u76ee\u5f55\u6587\u4ef6\u542b\u7a7a\u683c\uff0c\u5bfc\u81f4\u89e3\u6790\u9519\u8bef"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'(gdb) run\r\nStarting program: /home/celfs/project/engi_cpp/49_project/tools/bin/fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\r\nterminate called after throwing an instance of \'std::length_error\'\r\n  what():  basic_string::_M_replace_aux\r\n\r\nProgram received signal SIGABRT, Aborted.\r\n__GI_raise (sig=sig@entry=6)\r\n    at ../sysdeps/unix/sysv/linux/raise.c:50\r\n50      ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\r\n(gdb) backtrace\r\n#0  __GI_raise (sig=sig@entry=6)\r\n    at ../sysdeps/unix/sysv/linux/raise.c:50\r\n#1  0x00007ffff7b5e859 in __GI_abort () at abort.c:79\r\n#2  0x00007ffff7df7ee6 in ?? ()\r\n   from /lib/x86_64-linux-gnu/libstdc++.so.6\r\n#3  0x00007ffff7e09f8c in ?? ()\r\n   from /lib/x86_64-linux-gnu/libstdc++.so.6\r\n#4  0x00007ffff7e09ff7 in std::terminate() ()\r\n   from /lib/x86_64-linux-gnu/libstdc++.so.6\r\n#5  0x00007ffff7e0a258 in __cxa_throw ()\r\n   from /lib/x86_64-linux-gnu/libstdc++.so.6\r\n#6  0x00007ffff7dfb211 in std::__throw_length_error(char const*) ()\r\n   from /lib/x86_64-linux-gnu/libstdc++.so.6\r\n#7  0x00007ffff7ead59b in std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::_M_replace_aux(unsigned long, unsig\r\n--Type <RET> for more, q to quit, c to continue without paging--c\r\nned long, unsigned long, char) () from /lib/x86_64-linux-gnu/libstdc++.so.6\r\n#8  0x0000555555560ab1 in idc::tcpread (sockfd=5, buffer="<filename>/home/celfs/project/engi_cpp/49_project/tmp/client/eee/SURF_ZH_20240609172000_27469.csv</filename><mtime>20240620233315</mtime><szie>53524</size>", itimeout=60) at /home/celfs/project/engi_cpp/49_project/public/_public.cpp:1475\r\n#9  0x000055555556069a in idc::ctcpserver::read (this=0x555555571740 <tcpserver>, buffer="<filename>/home/celfs/project/engi_cpp/49_project/tmp/client/eee/SURF_ZH_20240609172000_27469.csv</filename><mtime>20240620233315</mtime><szie>53524</size>", itimeout=60) at /home/celfs/project/engi_cpp/49_project/public/_public.cpp:1354\r\n#10 0x0000555555559806 in recvfilesmain () at fileserver.cpp:128\r\n#11 0x00005555555596ab in main (argc=3, argv=0x7fffffffdf38) at fileserver.cpp:86\r\n(gdb) quit\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:"celfs@ub cpp % /home/celfs/project/engi_cpp/49_project/tools/bin/fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\r\nterminate called after throwing an instance of 'std::length_error'\r\n  what():  basic_string::_M_replace_aux\r\n[1]    7495 abort      /home/celfs/project/engi_cpp/49_project/tools/bin/fileserver 5005 \n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["2\uff09\u670d\u52a1\u7aef\u4ec5\u6587\u4ef6\u5939 ",(0,l.jsx)(r.code,{children:"eee"})," \u6709\u6587\u4ef6\u66f4\u65b0\uff0c\u5176\u4f59\u82e5\u5e72\u5ba2\u6237\u7aef\u4e0a\u4f20\u7684\u6587\u4ef6\uff0c\u4ec5\u6709\u5ba2\u6237\u7aef\u65e5\u5fd7\u8bb0\u5f55\uff08\u63d0\u793a\u53d1\u9001\u6210\u529f\uff09"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8fd9\u4e2a bug \u53ef\u80fd\u5bfc\u81f4\u4e86\u7b2c\u4e00\u4e2a bug"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"3\uff09\u4e00\u6b21\u8fd0\u884c\uff0c\u53ea\u4e0a\u4f20\u4e86\u4e00\u4e2a\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6e05\u7a7a\u4e86 ",(0,l.jsx)(r.code,{children:"client"})," \u6587\u4ef6\uff0c\u91cd\u65b0\u590d\u5236\u6587\u4ef6\u5939\u5185\u5bb9\uff08xml \u6587\u4ef6\u5728\u524d\uff09\uff0c\u91cd\u65b0\u8fd0\u884c\uff0c\u95ee\u9898\u89e3\u51b3\uff08\u8c03\u8bd5\u65b9\u5f0f\u4e3a\u5220\u9664\u5ba2\u6237\u7aef\u6587\u4ef6\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"4\uff09\u62f7\u8d1d\u5f97\u5230\u7684\u6587\u4ef6\uff0c\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53ef\u80fd\u670d\u52a1\u7aef\u63a5\u53d7\u6587\u4ef6\u51fa\u9519"}),"\n",(0,l.jsx)(r.li,{children:"\u53ef\u80fd\u5ba2\u6237\u7aef\u53d1\u9001\u6587\u4ef6\u51fa\u9519"}),"\n",(0,l.jsx)(r.li,{children:"\u53ef\u80fd\u4e8c\u8fdb\u5236\u89e3\u6790\u3001\u5199\u5165\u6587\u4ef6\u5931\u8d25"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsxs)(r.del,{children:["\u5b9a\u4f4d\u5230 ",(0,l.jsx)(r.code,{children:"sformat()"})," \u51fd\u6570\uff0c\u6d89\u53ca\u5230\u7f16\u8bd1\u8b66\u544a"]}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u7ecf\u6d4b\u8bd5\uff0c\u5e76\u4e0d\u662f\u8fd9\u4e2a\u95ee\u9898\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u53c8\u72af\u4e86\u4e00\u4e2a\u4f4e\u7ea7\u9519\u8bef\uff0c\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff0c\u9057\u6f0f\u4e86\u683c\u5f0f\u5316\u5360\u4f4d\u7b26\uff01\u5f15\u4ee5\u4e3a\u6212\uff01"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u4e86\uff0c\u7ed3\u679c\u662f\u4e00\u4e2a\u975e\u5e38\u4f4e\u7ea7\u7684\u9519\u8bef\uff0c\u5bfc\u81f4\u7684\u957f\u65f6\u95f4 debug\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u6beb\u65e0\u4ef7\u503c\uff0c\u4f46\u53c8\u53ef\u4ee5\u4ef7\u503c\u8fde\u57ce\u7684\u9519\u8bef\u3002\u4e00\u4e2a\u5b57\u7b26\u7684\u4e0d\u4e25\u8c28\uff0c\u5bfc\u81f4\u7684\u6df1\u523b\u6559\u8bad\uff0c\u539f\u672c\u53ef\u4ee5\u7528\u8fd9\u51e0\u4e2a\u5c0f\u65f6\u505a\u66f4\u591a\u6709\u610f\u4e49\u7684\u4e8b\u60c5\uff0c\u7ed3\u679c\u81ea\u4ee5\u4e3a\u903b\u8f91\u6709\u95ee\u9898\uff0c\u4e0d\u65ad debug\uff0c\u8ffd\u6eaf\u5230\u6e90\u4ee3\u7801\uff0c\u7136\u800c\u65b9\u5411\u9519\u4e86\u3002"}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"<size>%d</size>"})," \u5199\u9519\u6210 ",(0,l.jsx)(r.code,{children:"<szie>%d</size>"})]}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.strong,{children:"\u65e2\u4e0d\u662f\u903b\u8f91\u95ee\u9898\uff0c\u4e5f\u4e0d\u662f\u8b66\u544a\u6ca1\u6709\u6d88\u9664\uff0c\u4e5f\u4e0d\u662f\u8bfb\u53d6\u73af\u8282\u95ee\u9898\uff0c\u800c\u662f\u62fc\u5199\u9519\u8bef\uff01"})}),"\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u9645",(0,l.jsx)(r.strong,{children:"\u62fc\u9519\u5bfc\u81f4\u7684\u89e3\u6790\u51fa\u9519"}),"\uff0c\u65e0\u6cd5\u6784\u5efa\u6709\u6548\u7684 xml \u6807\u7b7e\u5bfc\u81f4\u7684\u7cfb\u5217\u95ee\u9898\u3002\u53ef\u89c1\uff0c\u89e3\u6790\u51fa\u9519\uff0c\u4f1a\u5bfc\u81f4\u591a\u4e48\u4e25\u91cd\u7684\u95ee\u9898\uff01"]}),"\n",(0,l.jsxs)(r.li,{children:["\u53e6\u5916\uff0c",(0,l.jsx)(r.strong,{children:"\u8fd9\u4e2a\u95ee\u9898\u5176\u5b9e\u5728 GDB \u76f4\u63a5\u68c0\u6d4b\u51fa\u6765\u4e86\uff01\u4f46\u6211\u8fd8\u662f\u6ca1\u6709\u770b\u6e05\u695a\uff0c\u4ece\u800c\u9519\u8fc7\u4e86\u76f4\u63a5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u5951\u673a"}),"\uff0c\u8d70\u4e86\u5f88\u591a\u5f2f\u8def\u3002\u771f\u7684\u8981\u597d\u597d\u770b\u6e05\u695a GDB \u7684\u7ed3\u679c\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:["\u540e\u9762\uff0c\u4e0d\u4ec5\u5e94\u5f53\u4f7f\u7528 AI ",(0,l.jsx)(r.strong,{children:"\u6bd4\u8f83\u4ee3\u7801\u7248\u672c\u5dee\u5f02"}),"\uff0c\u8fd8\u5e94\u5f53\u6ce8\u91cd",(0,l.jsx)(r.strong,{children:"\u8bc6\u522b\u62fc\u5199\u9519\u8bef"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u628a\u6587\u4ef6\u540d\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6587\u4ef6\u5927\u5c0f\u7ec4\u6210\u62a5\u6587\uff0c\u53d1\u9001\u7ed9\u5bf9\u7aef\r\nsformat(strsendbuffer, "<filename>%s</filename><mtime>%s</mtime><size>%d</size>", dir.m_ffilename.c_str(), dir.m_mtime.c_str(), dir.m_filesize);\n'})}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/18 23:31:42 \u89c6\u9891 24min\uff1b2024/06/20 23:44:04 \u4ee3\u7801 + \u8c03\u8bd5\uff0c32min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/22 11:45:08 \u4ee3\u7801 + debug\uff0c2h1min\uff1b2024/06/23 3:09:52 debug\uff0c\u672a\u89e3\u51b3\uff0c53min\uff1b2024/06/23 3:48:08 debug\uff0c\u9010\u6b65\u5b9a\u4f4d\u95ee\u9898\uff0c38min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/23 4:46:25 debug\uff0c\u89e3\u51b3\u95ee\u9898\uff0c59min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/23 5:26:59 \u4ee3\u7801\u5b8c\u6210\uff0c40min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h3,{id:"78-\u4e0b\u8f7d\u6587\u4ef6",children:"78 \u4e0b\u8f7d\u6587\u4ef6"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5173\u4e8e TCP \u8fde\u63a5"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"TCP \u8fde\u63a5\u8bf7\u6c42\u7531\u5ba2\u6237\u7aef\u4e3b\u52a8\u53d1\u8d77\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"TCP \u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u4e0d\u518d\u533a\u5206\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"TCP \u8fde\u63a5\u662f\u5168\u53cc\u5de5\u7684\u901a\u9053\uff0c\u4efb\u4f55\u4e00\u65b9\u90fd\u53ef\u53d1\u9001\u548c\u63a5\u6536\u62a5\u6587\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5173\u4e8e TCP \u62a5\u6587"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u8bf7\u6c42/\u56de\u5e94\u62a5\u6587\u662f\u4e1a\u52a1\u5c42\u9762\u7684\u6982\u5ff5\uff0c\u672c\u8d28\u90fd\u662f TCP \u62a5\u6587\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u8bf7\u6c42\u62a5\u6587\u53ef\u4ee5\u7531\u4efb\u4f55\u4e00\u65b9\u53d1\u8d77\uff0c\u7531\u4e1a\u52a1\u51b3\u5b9a\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"TCP \u901a\u8baf\u65b9\u5f0f\u6ca1\u6709\u56fa\u5b9a\u7684\u6a21\u5f0f\uff0c\u53ea\u9700\u53cc\u65b9\u7ea6\u5b9a\uff08\u7edf\u4e00\u534f\u8bae\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u5173\u4e8e\u6587\u4ef6\u4e0a\u4f20/\u4e0b\u8f7d"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u4e0a\u4f20 / \u4e0b\u8f7d\u6587\u4ef6\u662f\u4e1a\u52a1\u5c42\u9762\u7684\u6982\u5ff5\uff0c\u672c\u8d28\u90fd\u662f\u4f20\u8f93\u6587\u4ef6"}),"\n",(0,l.jsx)(r.li,{children:"\u7aef1 --\x3e \u626b\u63cf\u672c\u5730\u76ee\u5f55 --\x3e \u6587\u4ef6\u53d1\u9001 --\x3e \u7aef2\uff08\u4e0a\u4f20 / \u4e0b\u8f7d\uff0c\u7aef\u4e92\u6362\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u4ee3\u7801\u6d41\u7a0b\uff08\u4e0b\u8f7d\u6a21\u5757\uff09"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5ba2\u6237\u7aef ",(0,l.jsx)(r.code,{children:"tcpgetfiles.cpp"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5168\u5c40\u4fe1\u606f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u62f7\u8d1d\u4e0a\u4f20\u6a21\u5757\uff0c\u4fee\u6539\u4ee3\u7801\u4e3a\u4e0b\u8f7d\u6a21\u5757"}),"\n",(0,l.jsxs)(r.li,{children:["\u53c2\u6570\u7ed3\u6784\u4f53\uff08\u6dfb\u52a0\u53c2\u6570 ",(0,l.jsx)(r.code,{children:"srvpathbak"}),"\uff0c\u4fee\u6539\u4e3b\u8def\u5f84\uff09"]}),"\n",(0,l.jsxs)(r.li,{children:["\u5220\u9664\u5904\u7406\u4f20\u8f93\u6587\u4ef6\u54cd\u5e94\u62a5\u6587\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"ackmessage()"})]}),"\n",(0,l.jsx)(r.li,{children:"\u5220\u9664\u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u6dfb\u52a0\u6587\u4ef6\u4e0b\u8f7d\u7684\u4e3b\u51fd\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u5220\u9664\u6587\u4ef6\u5185\u5bb9\u53d1\u9001\u51fd\u6570"}),"\n",(0,l.jsx)(r.li,{children:"\u6dfb\u52a0\u6587\u4ef6\u5185\u5bb9\u63a5\u6536\u51fd\u6570"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"main"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u6587\u4ef6\u4e0a\u4f20\u4e3b\u51fd\u6570 --\x3e \u8c03\u7528\u6587\u4ef6\u4e0b\u8f7d\u4e3b\u51fd\u6570"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"_help()"})," \u4e0d\u53d8"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"_xmltoarg()"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u89e3\u6790 ",(0,l.jsx)(r.code,{children:"srvpathbak"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"_tcpgetfiles()"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u4ee3\u7801\u903b\u8f91\u540c ",(0,l.jsx)(r.code,{children:"fileserver.cpp"})," \u7684 ",(0,l.jsx)(r.code,{children:"recvfilesmain()"})]}),"\n",(0,l.jsx)(r.li,{children:"\u4e92\u6362\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u8def\u5f84"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.code,{children:"recvfile()"})," \u540c ",(0,l.jsx)(r.code,{children:"fileserver.cpp"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u670d\u52a1\u7aef ",(0,l.jsx)(r.code,{children:"fileserver.cpp"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5168\u5c40\u4fe1\u606f\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u53c2\u6570\u7ed3\u6784\u4f53\uff08\u6ce8\u91ca\u65e0\u7528\u53c2\u6570\uff09"}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u4e0b\u8f7d\u6587\u4ef6\u7684\u4e3b\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"sendfilesmain()"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u6587\u4ef6\u5185\u5bb9\u53d1\u9001\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"sendfile()"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u6587\u4ef6\u4e0b\u8f7d\u7684 ",(0,l.jsx)(r.code,{children:"_tcpputfiles()"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u5904\u7406\u4f20\u8f93\u6587\u4ef6\u54cd\u5e94\u62a5\u6587\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"ackmessage()"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6dfb\u52a0\u5fc3\u8df3\u62a5\u6587\u51fd\u6570 ",(0,l.jsx)(r.code,{children:"activetest"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u6574\u4f53\u4e0a\uff0c\u670d\u52a1\u7aef\u6dfb\u52a0\u4e86\u5ba2\u6237\u7aef\u4e0a\u4f20\u6a21\u5757\u6539\u4e3a\u4e0b\u8f7d\u6a21\u5757\u65f6\u5220\u9664\u7684\u5185\u5bb9\uff0c\u76f8\u5f53\u4e8e\u5728\u670d\u52a1\u7aef\u6dfb\u52a0\u4e86\u4e0a\u4f20\u7684\u76f8\u5173\u903b\u8f91\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.li,{children:"\u8c03\u8bd5"}),"\n",(0,l.jsxs)(r.li,{children:["\u4fee\u6539\u811a\u672c ",(0,l.jsx)(r.code,{children:"start.sh"})," \u53ca ",(0,l.jsx)(r.code,{children:"stop.sh"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u5b9e\u73b0\u6548\u679c\uff1a",(0,l.jsx)(r.code,{children:"ftpputtest"})," --\x3e ",(0,l.jsx)(r.code,{children:"tcpputtest"})," --\x3e ",(0,l.jsx)(r.code,{children:"tcpgettest"})]}),"\n",(0,l.jsxs)(r.li,{children:["\u6ce8\u610f\uff0c\u524d\u9762\u7ae0\u8282\u751f\u6210\u4e86\u6570\u636e\u6587\u4ef6\u5230 ",(0,l.jsx)(r.code,{children:"ftpputtest"})," \u76ee\u5f55"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'// \u57fa\u4e8e TCP \u534f\u8bae\u7684\u6587\u4ef6\u4e0b\u8f7d\u6a21\u5757\r\n#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\r\nstruct st_arg {\r\n    int  clienttype;         // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b2\r\n    char ip[31];             // \u670d\u52a1\u7aef\u7684 IP \u5730\u5740\r\n    int  port;               // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\r\n    char srvpath[256];       // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\r\n    int  ptype;              // \u6587\u4ef6\u4e0b\u8f7d\u6210\u529f\u540e\uff0c\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\r\n    char srvpathbak[256];    // \u6587\u4ef6\u4e0b\u8f7d\u6210\u529f\u540e\uff0c\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5907\u4efd\u6839\u76ee\u5f55\uff0c\u5f53 ptype == 2 \u65f6\u6709\u6548\r\n    bool andchild;           // \u662f\u5426\u4e0b\u8f7d srvpath \u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\r\n    char matchname[256];     // \u5f85\u4e0b\u8f7d\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\u3002\u5982 "*.TXT,*.XML"\r\n    char clientpath[256];    // \u5ba2\u6237\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\r\n    int  timetvl;            // \u626b\u63cf\u670d\u52a1\u7aef\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    int  timeout;            // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\r\n    char pname[51];          // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528 \u201ctcpgetfiles_\u540e\u7f00\u201d \u7684\u65b9\u5f0f\r\n} starg;\r\n\r\n// \u5e2e\u52a9\u6587\u6863\r\nvoid _help();\r\n\r\n// \u628a xml \u89e3\u6790\u5230\u53c2\u6570 starg \u7ed3\u6784\u4e2d\r\nbool _xmltoarg(const char *strxmlbuffer);\r\n\r\n// \u7a0b\u5e8f\u9000\u51fa\u4fe1\u53f72\u300115\u7684\u5904\u7406\u51fd\u6570\r\nvoid EXIT(int sig);\r\n\r\nclogfile logfile;       // \u521b\u5efa\u65e5\u5fd7\u5bf9\u8c61\r\nctcpclient tcpclient;   // \u521b\u5efa TCP \u901a\u8baf\u7684\u5ba2\u6237\u7aef\u5bf9\u8c61\r\n\r\nstring strsendbuffer;   // \u53d1\u9001\u62a5\u6587\u7684 buffer\r\nstring strrecvbuffer;   // \u63a5\u6536\u62a5\u6587\u7684 buffer\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv);\r\n\r\n// \u6587\u4ef6\u4e0b\u8f7d\u7684\u4e3b\u51fd\u6570\r\nvoid _tcpgetfiles();\r\n\r\n// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, const int filesize);\r\n\r\ncpactive pactive; // \u8fdb\u7a0b\u5fc3\u8df3\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        _help();\r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\u3002\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\u3002\r\n    // \u5728\u7f51\u7edc\u901a\u8baf\u7a0b\u5e8f\u4e2d\uff0c\u4e00\u822c\u4e0d\u5173IO\uff0c\u56e0\u4e3a\u67d0\u4e9b\u51fd\u6570\u53ef\u80fd\u4f1a\u5f801\u548c2\u4e2d\u8f93\u51fa\u4fe1\u606f\r\n    // \u5982\u679c\u5173\u4e861\u548c2\uff0c\u90a3\u4e481\u548c2\u4f1a\u88absocket\u91cd\u7528\uff0c\u54111\u548c2\u8f93\u51fa\u7684\u4fe1\u606f\u4f1a\u53d1\u9001\u5230\u7f51\u7edc\u4e2d\u3002\r\n    // closeioandsignal(true);\r\n    signal(SIGINT, EXIT); signal(SIGTERM, EXIT);\r\n\r\n    // \u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\r\n    if (logfile.open(argv[1]) == false) {\r\n        printf("\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u5931\u8d25\uff08%s\uff09\u3002\\n",argv[1]); return -1;\r\n    }\r\n\r\n    // \u89e3\u6790 xml\uff0c\u5f97\u5230\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\r\n    if (_xmltoarg(argv[2]) == false) return -1;\r\n\r\n    pactive.addpinfo(starg.timeout, starg.pname); // \u628a\u8fdb\u7a0b\u7684\u5fc3\u8df3\u4fe1\u606f\u5199\u5165\u5171\u4eab\u5185\u5b58\r\n\r\n    // \u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\r\n    if (tcpclient.connect(starg.ip, starg.port) == false) {\r\n        logfile.write("tcpclient.connect(%s, %d) failed.\\n", starg.ip, starg.port); EXIT(-1);\r\n    }\r\n\r\n    if (login(argv[2]) == false) { logfile.write("login() failed.\\n"); EXIT(-1); }\r\n\r\n    // \u8c03\u7528\u6587\u4ef6\u4e0b\u8f7d\u7684\u4e3b\u51fd\u6570\r\n    _tcpgetfiles();\r\n\r\n    EXIT(0);\r\n}\r\n\r\nvoid EXIT(int sig) {\r\n\r\n    logfile.write("\u7a0b\u5e8f\u9000\u51fa\uff0csig = %d\\n\\n", sig);\r\n\r\n    exit(0);\r\n}\r\n\r\nvoid _help() {\r\n\r\n    string base_bin = "/home/celfs/project/engi_cpp/49_project";\r\n\r\n    printf("\\n");\r\n    printf("Using: %s/tools/bin/tcpgetfiles logfilename xmlbuffer\\n\\n", base_bin.c_str());\r\n    printf(\r\n        "Example: %s/tools/bin/procctl 20 %s/tools/bin/tcpgetfiles %s/log/idc/tcpgetfiles_surfdata.log "\\\r\n        "\\"<ip>192.168.20.150</ip><port>5005</port>"\\\r\n        "<clientpath>%s/tmp/client</clientpath><ptype>1</ptype>"\\\r\n        "<srvpath>%s/tmp/server</srvpath>"\\\r\n        "<andchild>true</andchild><matchname>*</matchname><timetvl>10</timetvl>"\\\r\n        "<timeout>50</timeout><pname>tcpgetfiles_surfdata</pname>\\"\\n\\n", \r\n        base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str(), base_bin.c_str()\r\n    ); \r\n\r\n    printf("\u672c\u7a0b\u5e8f\u662f\u6570\u636e\u4e2d\u5fc3\u7684\u516c\u5171\u529f\u80fd\u6a21\u5757\uff0c\u91c7\u7528tcp\u534f\u8bae\u4ece\u670d\u52a1\u7aef\u4e0b\u8f7d\u6587\u4ef6\u3002\\n");\r\n    printf("logfilename   \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65e5\u5fd7\u6587\u4ef6\u3002\\n");\r\n    printf("xmlbuffer     \u672c\u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\uff0c\u5982\u4e0b\uff1a\\n");\r\n    printf("ip            \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\\n");\r\n    printf("port          \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\\n");\r\n    printf("ptype         \u6587\u4ef6\u4e0b\u8f7d\u6210\u529f\u540e\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\\n");\r\n    printf("srvpath       \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("srvpathbak    \u6587\u4ef6\u6210\u529f\u4e0b\u8f7d\u540e\uff0c\u670d\u52a1\u7aef\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\\n");\r\n    printf("andchild      \u662f\u5426\u4e0b\u8f7dsrvpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\uff0c\u7f3a\u7701\u4e3afalse\u3002\\n");\r\n    printf("matchname     \u5f85\u4e0b\u8f7d\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982\\"*.TXT,*.XML\\"\\n");\r\n    printf("clientpath    \u5ba2\u6237\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002\\n");\r\n    printf("timetvl       \u626b\u63cf\u670d\u52a1\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u53d6\u503c\u57281-30\u4e4b\u95f4\u3002\\n");\r\n    printf("timeout       \u672c\u7a0b\u5e8f\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u89c6\u6587\u4ef6\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u800c\u5b9a\uff0c\u5efa\u8bae\u8bbe\u7f6e50\u4ee5\u4e0a\u3002\\n");\r\n    printf("pname         \u8fdb\u7a0b\u540d\uff0c\u5c3d\u53ef\u80fd\u91c7\u7528\u6613\u61c2\u7684\u3001\u4e0e\u5176\u5b83\u8fdb\u7a0b\u4e0d\u540c\u7684\u540d\u79f0\uff0c\u65b9\u4fbf\u6545\u969c\u6392\u67e5\u3002\\n\\n");\r\n}\r\n\r\nbool _xmltoarg(const char *strxmlbuffer) {\r\n\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n\r\n    getxmlbuffer(strxmlbuffer, "ip", starg.ip);\r\n    if (strlen(starg.ip) == 0) { logfile.write("ip is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "port", starg.port);\r\n    if (starg.port == 0) { logfile.write("port is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "ptype", starg.ptype);\r\n    if ((starg.ptype != 1) && (starg.ptype != 2)) { logfile.write("ptype not in (1, 2).\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "srvpath", starg.srvpath);\r\n    if (strlen(starg.srvpath) == 0) { logfile.write("srvpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "srvpathbak", starg.srvpathbak);\r\n    if ((starg.ptype == 2) && (strlen(starg.srvpathbak) == 0)) { logfile.write("srvpathbak is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "andchild", starg.andchild);\r\n\r\n    getxmlbuffer(strxmlbuffer, "matchname", starg.matchname);\r\n    if (strlen(starg.matchname) == 0) { logfile.write("matchname is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "clientpath", starg.clientpath);\r\n    if (strlen(starg.clientpath) == 0) { logfile.write("clientpath is null.\\n"); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "timetvl", starg.timetvl);\r\n    if (starg.timetvl == 0) { logfile.write("timetvl is null.\\n"); return false; }\r\n\r\n    // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\r\n    // starg.timetvl\u6ca1\u6709\u5fc5\u8981\u8d85\u8fc730\u79d2\r\n    if (starg.timetvl > 30) starg.timetvl = 30;\r\n\r\n    // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e00\u5b9a\u8981\u5927\u4e8e starg.timetvl\r\n    getxmlbuffer(strxmlbuffer, "timeout", starg.timeout);\r\n    if (starg.timeout == 0) { logfile.write("timeout is null.\\n"); return false; }\r\n    if (starg.timeout <= starg.timetvl) { logfile.write("starg.timeout(%d) <= starg.timetvl(%d)\\n", starg.timeout, starg.timetvl); return false; }\r\n\r\n    getxmlbuffer(strxmlbuffer, "pname", starg.pname, 50);\r\n    //if (strlen(starg.pname) == 0) { logfile.write("pname is null.\\n"); return false; }\r\n\r\n    return true;\r\n}\r\n\r\n// \u5411\u670d\u52a1\u7aef\u53d1\u9001\u767b\u5f55\u62a5\u6587\uff0c\u628a\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7684\u53c2\u6570\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\r\nbool login(const char *argv) {\r\n\r\n    sformat(strsendbuffer, "%s<clienttype>2</clienttype>", argv);\r\n    // xxxxxxxxxx logfile.write("\u53d1\u9001\uff1a%s\\n", strsendbuffer.c_str());\r\n    if (tcpclient.write(strsendbuffer) == false) return false;      // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\r\n\r\n    if (tcpclient.read(strrecvbuffer, 10) == false) return false;  // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\r\n    // xxxxxxxxxx logfile.write("\u63a5\u6536\uff1a%s\\n", strrecvbuffer.c_str());\r\n\r\n    logfile.write("\u767b\u5f55(%s:%d)\u6210\u529f\u3002\\n", starg.ip, starg.port);\r\n\r\n    return true;\r\n}\r\n\r\n// \u6587\u4ef6\u4e0b\u8f7d\u7684\u4e3b\u51fd\u6570\r\nvoid _tcpgetfiles() {\r\n \r\n    while (true) {\r\n\r\n        pactive.uptatime();\r\n\r\n        // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u62a5\u6587\r\n        if (tcpclient.read(strrecvbuffer, starg.timetvl + 10) == false) {\r\n            logfile.write("tcpclient.read() failed.\\n"); return;\r\n        }\r\n        // xxxxxxxxxx logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u5fc3\u8df3\u62a5\u6587\r\n        if (strrecvbuffer == "<activetest>ok</activetest>") {\r\n\r\n            strsendbuffer = "ok.";\r\n            // xxxxxxxxxx logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpclient.write(strsendbuffer) == false) {\r\n                logfile.write("tcpclient.write() failed.\\n"); return;\r\n            }\r\n        }\r\n\r\n        // \u5904\u7406\u4e0b\u8f7d\u6587\u4ef6\u7684\u8bf7\u6c42\u62a5\u6587\r\n        if (strrecvbuffer.find("<filename>") != string::npos) {\r\n            // \u89e3\u6790\u4e0b\u8f7d\u6587\u4ef6\u8bf7\u6c42\u62a5\u6587\u7684 xml\r\n            string serverfilename;  // \u5bf9\u7aef\u7684\u6587\u4ef6\u540d\r\n            string mtime;           // \u6587\u4ef6\u7684\u65f6\u95f4\r\n            int filesize = 0;       // \u6587\u4ef6\u5927\u5c0f\r\n            getxmlbuffer(strrecvbuffer, "filename", serverfilename);\r\n            getxmlbuffer(strrecvbuffer, "mtime", mtime);\r\n            getxmlbuffer(strrecvbuffer, "size", filesize);\r\n            // logfile.write("start --\x3e strrecvbuffer is :%s\\n", strrecvbuffer.c_str());// aaaaaa\r\n\r\n            // \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u76ee\u5f55\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4ee5\u4e0b\u4ee3\u7801\u751f\u6210\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u540d\r\n            // \u628a\u6587\u4ef6\u540d\u4e2d\u7684 srvpath \u66ff\u6362\u4e58 clientpath\uff0c\u8981\u5c0f\u65b0\u7b2c\u4e09\u4e2a\u53c2\u6570\r\n            string clientfilename;\r\n            clientfilename = serverfilename;\r\n            replacestr(clientfilename, starg.srvpath, starg.clientpath, false);\r\n            // logfile.write("filename is: %s\\n", serverfilename.c_str());// aaaaaa\r\n\r\n            // \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\n            logfile.write("recv %s(%d) ...", clientfilename.c_str(), filesize);\r\n            if (recvfile(clientfilename, mtime, filesize) == true) {\r\n                logfile << "ok.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>ok</result>", serverfilename.c_str());\r\n                // logfile << "ok --\x3e strsendbuffer is : " + strsendbuffer + " \\n";// aaaaaa\r\n                // logfile.write("ok --\x3e strsendbuffer is :%s\\n", strsendbuffer.c_str());// aaaaaa\r\n            } else {\r\n                logfile << "failed.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>failed</result>", serverfilename.c_str());\r\n                // logfile.write("failed --\x3e strsendbuffer is :%s\\n", strsendbuffer.c_str());// aaaaaa\r\n            }\r\n\r\n            // \u628a\u63a5\u6536\u7ed3\u679c\u8fd4\u56de\u7ed9\u5bf9\u7aef\r\n            // xxxxxxxxxx logfile.write("back to strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpclient.write(strsendbuffer) == false) {\r\n                logfile.write("tcpclient.write() failed.\\n"); return;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, int filesize) {\r\n\r\n    int  onread = 0;         // \u672c\u6b21\u6253\u7b97\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n    char buffer[1000];       // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\u7684\u7f13\u51b2\u533a\r\n    int  totalbytes = 0;     // \u5df2\u63a5\u6536\u6587\u4ef6\u7684\u603b\u5b57\u8282\u6570\r\n    cofile ofile;            // \u63a5\u6536\u6587\u4ef6\u7684\u5bf9\u8c61\r\n\r\n    newdir(filename);\r\n    // logfile.write("ok --\x3e filename is %s\\n", filename.c_str());\r\n\r\n    // \u5fc5\u987b\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u64cd\u4f5c\u6587\u4ef6\r\n    if (ofile.open(filename, ios::in | ios::binary) == false) return false;\r\n\r\n    while (true) {\r\n        memset(buffer, 0, sizeof(buffer));\r\n\r\n        // \u8ba1\u7b97\u672c\u6b21\u5e94\u8be5\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n        if (filesize - totalbytes > 1000) onread = 1000;\r\n        else onread = filesize - totalbytes;\r\n\r\n        // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\r\n        if (tcpclient.read(buffer, onread) == false) return false;\r\n\r\n        // \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\r\n        ofile.write(buffer, onread);\r\n\r\n        // \u8ba1\u7b97\u6587\u4ef6\u5df2\u63a5\u6536\u7684\u5b57\u8282\u603b\u6570\uff0c\u5982\u679c\u6587\u4ef6\u63a5\u6536\u5b8c\uff0c\u8df3\u51fa\u5faa\u73af\r\n        totalbytes = totalbytes + onread;\r\n\r\n        if (totalbytes == filesize) break;\r\n    }\r\n\r\n    ofile.closeandrename();\r\n\r\n    // \u91cd\u7f6e\u6587\u4ef6\u7684\u65f6\u95f4\r\n    setmtime(filename, mtime);\r\n\r\n    return true;\r\n}\r\n\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-cpp",children:'#include "/home/celfs/project/engi_cpp/49_project/public/_public.h"\r\nusing namespace idc;\r\n\r\n// \u7a0b\u5e8f\u8fd0\u884c\u7684\u53c2\u6570\u7ed3\u6784\u4f53\u3002\r\nstruct st_arg\r\n{\r\n    int  clienttype;           // \u5ba2\u6237\u7aef\u7c7b\u578b\uff0c1-\u4e0a\u4f20\u6587\u4ef6\uff1b2-\u4e0b\u8f7d\u6587\u4ef6\uff0c\u672c\u7a0b\u5e8f\u56fa\u5b9a\u586b1\u3002\r\n    // char ip[31];               // \u670d\u52a1\u7aef\u7684IP\u5730\u5740\u3002\r\n    // int  port;                 // \u670d\u52a1\u7aef\u7684\u7aef\u53e3\u3002\r\n    char clientpath[256];      // \u672c\u5730\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002 /data /data/aaa /data/bbb\r\n    int  ptype;                // \u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u672c\u5730\u6587\u4ef6\u7684\u5904\u7406\u65b9\u5f0f\uff1a1-\u5220\u9664\u6587\u4ef6\uff1b2-\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\u3002\r\n    // char clientpathbak[256];   // \u6587\u4ef6\u6210\u529f\u4e0a\u4f20\u540e\uff0c\u672c\u5730\u6587\u4ef6\u5907\u4efd\u7684\u6839\u76ee\u5f55\uff0c\u5f53ptype==2\u65f6\u6709\u6548\u3002\r\n    bool andchild;             // \u662f\u5426\u4e0a\u4f20clientpath\u76ee\u5f55\u4e0b\u5404\u7ea7\u5b50\u76ee\u5f55\u7684\u6587\u4ef6\uff0ctrue-\u662f\uff1bfalse-\u5426\u3002\r\n    char matchname[256];       // \u5f85\u4e0a\u4f20\u6587\u4ef6\u540d\u7684\u5339\u914d\u89c4\u5219\uff0c\u5982"*.TXT,*.XML"\u3002\r\n    char srvpath[256];         // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002/data1 /data1/aaa /data1/bbb\r\n    char srvpathbak[256];         // \u670d\u52a1\u7aef\u6587\u4ef6\u5b58\u653e\u7684\u6839\u76ee\u5f55\u3002/data1 /data1/aaa /data1/bbb\r\n    int  timetvl;              // \u626b\u63cf\u672c\u5730\u76ee\u5f55\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff08\u6267\u884c\u6587\u4ef6\u4e0a\u4f20\u4efb\u52a1\u7684\u65f6\u95f4\u95f4\u9694\uff09\uff0c\u5355\u4f4d\uff1a\u79d2\u3002 \r\n    int  timeout;              // \u8fdb\u7a0b\u5fc3\u8df3\u7684\u8d85\u65f6\u65f6\u95f4\u3002\r\n    char pname[51];            // \u8fdb\u7a0b\u540d\uff0c\u5efa\u8bae\u7528"tcpputfiles_\u540e\u7f00"\u7684\u65b9\u5f0f\u3002\r\n} starg;\r\n\r\nclogfile logfile;        // \u670d\u52a1\u7a0b\u5e8f\u7684\u8fd0\u884c\u65e5\u5fd7\r\nctcpserver tcpserver;    // \u521b\u5efatcp\u901a\u8baf\u7684\u670d\u52a1\u7aef\u5bf9\u8c61\r\n\r\nvoid FathEXIT(int sig);  // \u7236\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\nvoid ChldEXIT(int sig);  // \u5b50\u8fdb\u7a0b\u9000\u51fa\u51fd\u6570\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin();\r\n\r\n// \u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid recvfilesmain();\r\n\r\n// \u4e0b\u8f7d\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid sendfilesmain();\r\n\r\nstring strsendbuffer;    // \u53d1\u9001\u62a5\u6587\u7684buffer\r\nstring strrecvbuffer;    // \u63a5\u6536\u62a5\u6587\u7684buffer\r\n\r\n// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, int filesize);\r\n\r\n// \u628a\u6587\u4ef6\u7684\u5185\u5bb9\u53d1\u9001\u7ed9\u5bf9\u7aef\u3002\r\nbool sendfile(const string &filename, const int filesize);\r\n\r\n// \u6587\u4ef6\u4e0b\u8f7d\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0b\u8f7d\u7684\u4efb\u52a1\u3002\r\nbool _tcpputfiles(bool &bcontinue);\r\n\r\n// \u5fc3\u8df3\u3002\r\nbool activetest();\r\n\r\n// \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8005\u8f6c\u5b58\u670d\u52a1\u7aef\u7684\u6587\u4ef6\uff09\u3002\r\nbool ackmessage(const string &strrecvbuffer);\r\n\r\ncpactive pactive; // \u8fdb\u7a0b\u5fc3\u8df3\r\n\r\nint main(int argc, char *argv[]) {\r\n\r\n    if (argc != 3) {\r\n        printf("Using:./fileserver port logfile\\n");\r\n        printf("Example:./fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n"); \r\n        printf("         /home/celfs/project/engi_cpp/49_project/tools/bin/procctl 10 /home/celfs/project/engi_cpp/49_project/tools/bin/fileserver 5005 /home/celfs/project/engi_cpp/49_project/log/idc/fileserver.log\\n\\n\\n"); \r\n        return -1;\r\n    }\r\n\r\n    // \u5173\u95ed\u5168\u90e8\u7684\u4fe1\u53f7\u548c\u8f93\u5165\u8f93\u51fa\u3002\r\n    // \u8bbe\u7f6e\u4fe1\u53f7,\u5728shell\u72b6\u6001\u4e0b\u53ef\u7528 "kill + \u8fdb\u7a0b\u53f7" \u6b63\u5e38\u7ec8\u6b62\u4e9b\u8fdb\u7a0b\r\n    // \u4f46\u8bf7\u4e0d\u8981\u7528 "kill -9 +\u8fdb\u7a0b\u53f7" \u5f3a\u884c\u7ec8\u6b62\r\n    //closeioandsignal(false); \r\n    signal(SIGINT, FathEXIT); signal(SIGTERM, FathEXIT);\r\n\r\n    if (logfile.open(argv[2]) == false) {\r\n        printf("logfile.open(%s) failed.\\n", argv[2]); return -1;\r\n    }\r\n\r\n    // \u670d\u52a1\u7aef\u521d\u59cb\u5316\u3002\r\n    if (tcpserver.initserver(atoi(argv[1])) == false) {\r\n      logfile.write("tcpserver.initserver(%s) failed.\\n", argv[1]); return -1;\r\n    }\r\n\r\n    while (true) {\r\n\r\n        // \u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\r\n        if (tcpserver.accept() == false) {\r\n            logfile.write("tcpserver.accept() failed.\\n"); FathEXIT(-1);\r\n        }\r\n\r\n        logfile.write("\u5ba2\u6237\u7aef\uff08%s\uff09\u5df2\u8fde\u63a5\u3002\\n", tcpserver.getip());\r\n\r\n        // \u4e0d\u4f7f\u7528\u591a\u8fdb\u7a0b\u65f6\uff0c\u53ef\u4fbf\u4e8e GDB \u8c03\u8bd5\r\n        if (fork() > 0) { tcpserver.closeclient(); continue; }   // \u7236\u8fdb\u7a0b\u7ee7\u7eed\u56de\u5230Accept()\r\n\r\n        // \u5b50\u8fdb\u7a0b\u91cd\u65b0\u8bbe\u7f6e\u9000\u51fa\u4fe1\u53f7\r\n        signal(SIGINT, ChldEXIT); signal(SIGTERM, ChldEXIT);\r\n\r\n        tcpserver.closelisten();\r\n\r\n        // \u5b50\u8fdb\u7a0b\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u901a\u8baf\uff0c\u5904\u7406\u4e1a\u52a1\u3002\r\n\r\n        // \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n        if (clientlogin() == false) ChldEXIT(-1);\r\n\r\n        // \u628a\u8fdb\u7a0b\u5fc3\u8df3\u4fe1\u606f\u5199\u5165\u5171\u4eab\u5185\u5b58\uff08\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u5fc3\u8df3\uff09\r\n        pactive.addpinfo(starg.timeout, starg.pname);\r\n\r\n        // \u5982\u679cstarg.clienttype == 1\uff0c\u8c03\u7528\u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        if (starg.clienttype == 1)  recvfilesmain();  \r\n\r\n        // \u5982\u679c starg.clienttype == 2\uff0c\u8c03\u7528\u4e0b\u8f7d\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\u3002\r\n        if (starg.clienttype == 2) sendfilesmain();\r\n\r\n        ChldEXIT(0);\r\n    }\r\n}\r\n\r\nvoid FathEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u7236\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closelisten();    // \u5173\u95ed\u76d1\u542c\u7684socket\r\n\r\n    kill(0, 15);     // \u901a\u77e5\u5168\u90e8\u7684\u5b50\u8fdb\u7a0b\u9000\u51fa\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\nvoid ChldEXIT(int sig) {\r\n\r\n    // \u4ee5\u4e0b\u4ee3\u7801\u662f\u4e3a\u4e86\u9632\u6b62\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4fe1\u53f7\u4e2d\u65ad\r\n    signal(SIGINT, SIG_IGN); signal(SIGTERM, SIG_IGN);\r\n\r\n    logfile.write("\u5b50\u8fdb\u7a0b\u9000\u51fa\uff0csig = %d\u3002\\n", sig);\r\n\r\n    tcpserver.closeclient();    // \u5173\u95ed\u5ba2\u6237\u7aef\u7684socket\r\n\r\n    exit(0);\r\n\r\n}\r\n\r\n// \u4e0a\u4f20\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid recvfilesmain() {\r\n\r\n    while (true) {\r\n\r\n        pactive.uptatime(); // \u53ea\u9700\u6b64\u5904\u4e00\u4e2a\u5730\u65b9\u66f4\u65b0\u5fc3\u8df3\r\n\r\n        // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u62a5\u6587\r\n        if (tcpserver.read(strrecvbuffer, starg.timetvl + 10) == false) {\r\n            logfile.write("tcpserver.read() failed.\\n"); return;\r\n        }\r\n        // xxxxxxxxxx logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u5fc3\u8df3\u62a5\u6587\r\n        if (strrecvbuffer == "<activetest>ok</activetest>") {\r\n\r\n            strsendbuffer = "ok.";\r\n            // xxxxxxxxxx logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.write() failed.\\n"); return;\r\n            }\r\n        }\r\n\r\n        // \u5904\u7406\u4e0a\u4f20\u6587\u4ef6\u7684\u8bf7\u6c42\u62a5\u6587\r\n        if (strrecvbuffer.find("<filename>") != string::npos) {\r\n            // \u89e3\u6790\u4e0a\u4f20\u6587\u4ef6\u8bf7\u6c42\u62a5\u6587\u7684 xml\r\n            string clientfilename;  // \u5bf9\u7aef\u7684\u6587\u4ef6\u540d\r\n            string mtime;           // \u6587\u4ef6\u7684\u65f6\u95f4\r\n            int filesize = 0;       // \u6587\u4ef6\u5927\u5c0f\r\n            getxmlbuffer(strrecvbuffer, "filename", clientfilename);\r\n            getxmlbuffer(strrecvbuffer, "mtime", mtime);\r\n            getxmlbuffer(strrecvbuffer, "size", filesize);\r\n            // logfile.write("start --\x3e strrecvbuffer is :%s\\n", strrecvbuffer.c_str());// aaaaaa\r\n\r\n            // \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u6587\u4ef6\u7684\u76ee\u5f55\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4ee5\u4e0b\u4ee3\u7801\u751f\u6210\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u540d\u3002\r\n            // \u628a\u6587\u4ef6\u540d\u4e2d\u7684clientpath\u66ff\u6362\u6210srvpath\uff0c\u8981\u5c0f\u5fc3\u7b2c\u4e09\u4e2a\u53c2\u6570\r\n            string serverfilename;\r\n            serverfilename = clientfilename;\r\n            replacestr(serverfilename, starg.clientpath, starg.srvpath, false);\r\n            // logfile.write("filename is: %s\\n", serverfilename.c_str());// aaaaaa\r\n\r\n            logfile.write("recv %s(%d) ...", serverfilename.c_str(), filesize);\r\n            if (recvfile(serverfilename, mtime, filesize) == true) {\r\n                logfile << "ok.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>ok</result>", clientfilename.c_str());\r\n                // logfile << "ok --\x3e strsendbuffer is : " + strsendbuffer + " \\n";// aaaaaa\r\n                // logfile.write("ok --\x3e strsendbuffer is :%s\\n", strsendbuffer.c_str());// aaaaaa\r\n            } else {\r\n                logfile << "failed.\\n";\r\n                sformat(strsendbuffer, "<filename>%s</filename><result>failed</result>", clientfilename.c_str());\r\n                // logfile.write("failed --\x3e strsendbuffer is :%s\\n", strsendbuffer.c_str());// aaaaaa\r\n            }\r\n\r\n            // \u5047\u8bbe\u6210\u529f\u7684\u63a5\u6536\u4e86\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u62fc\u63a5\u786e\u8ba4\u62a5\u6587\u7684\u5185\u5bb9\r\n            // sformat(strsendbuffer, "<filename>%s</filename><result>ok</result>", clientfilename.c_str());\r\n\r\n            // \u628a\u786e\u8ba4\u62a5\u6587\u8fd4\u56de\u7ed9\u5bf9\u7aef\r\n            // xxxxxxxxxx logfile.write("back to strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n            if (tcpserver.write(strsendbuffer) == false) {\r\n                logfile.write("tcpserver.write() failed.\\n"); return;\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// \u63a5\u6536\u6587\u4ef6\u7684\u5185\u5bb9\r\nbool recvfile(const string &filename, const string &mtime, int filesize) {\r\n\r\n    int totalbytes = 0;     // \u5df2\u63a5\u6536\u6587\u4ef6\u7684\u603b\u5b57\u8282\u6570\r\n    int onread = 0;         // \u672c\u6b21\u6253\u7b97\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n    char buffer[1000];      // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\u7684\u7f13\u51b2\u533a\r\n    cofile ofile;           // \u5199\u5165\u6587\u4ef6\u7684\u5bf9\u8c61\r\n\r\n    // \u5fc5\u987b\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u64cd\u4f5c\u6587\u4ef6\r\n    if (ofile.open(filename, true, ios::out | ios::binary) == false) return false;\r\n\r\n    while (true) {\r\n\r\n        memset(buffer, 0, sizeof(buffer));\r\n\r\n        // \u8ba1\u7b97\u672c\u6b21\u5e94\u8be5\u63a5\u6536\u7684\u5b57\u8282\u6570\r\n        if (filesize - totalbytes > 1000) onread = 1000;\r\n        else onread = filesize - totalbytes;\r\n\r\n        // \u63a5\u6536\u6587\u4ef6\u5185\u5bb9\r\n        if (tcpserver.read(buffer, onread) == false) return false;\r\n\r\n        // \u628a\u63a5\u6536\u5230\u7684\u5185\u5bb9\u5199\u5165\u6587\u4ef6\r\n        ofile.write(buffer, onread);\r\n        // logfile.write("ofile.write(buffer, onread) is: %s (%d)\\n", buffer, onread);// aaaaaa\r\n\r\n        // \u8ba1\u7b97\u5df2\u7ecf\u63a5\u6536\u6587\u4ef6\u7684\u603b\u5b57\u8282\u6570\uff0c\u5982\u679c\u6587\u4ef6\u63a5\u6536\u5b8c\uff0c\u8df3\u51fa\u5faa\u73af\r\n        totalbytes = totalbytes + onread;\r\n\r\n        if (totalbytes == filesize) break;\r\n    }\r\n\r\n    ofile.closeandrename();\r\n\r\n    // \u6587\u4ef6\u65f6\u95f4\u7528\u5f53\u524d\u65f6\u95f4\u6ca1\u6709\u610f\u4e49\uff0c\u5e94\u8be5\u4e0e\u5bf9\u7aef\u7684\u6587\u4ef6\u65f6\u95f4\u4fdd\u6301\u4e00\u81f4\r\n    setmtime(filename, mtime);\r\n\r\n    return true;\r\n}\r\n\r\n// \u5904\u7406\u767b\u5f55\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\nbool clientlogin()\r\n{\r\n    // \u63a5\u6536\u5ba2\u6237\u7aef\u7684\u767b\u5f55\u62a5\u6587\u3002\r\n    if (tcpserver.read(strrecvbuffer, 10) == false)\r\n    {\r\n        logfile.write("tcpserver.read() failed.\\n"); return false;\r\n    }\r\n    // xxxxxxxxxx logfile.write("strrecvbuffer = %s\\n", strrecvbuffer.c_str());\r\n\r\n    // \u89e3\u6790\u5ba2\u6237\u7aef\u767b\u5f55\u62a5\u6587\uff0c\u4e0d\u9700\u8981\u5bf9\u53c2\u6570\u505a\u5408\u6cd5\u6027\u5224\u65ad\uff0c\u5ba2\u6237\u7aef\u5df2\u7ecf\u5224\u65ad\u8fc7\u4e86\u3002\r\n    memset(&starg, 0, sizeof(struct st_arg));\r\n    getxmlbuffer(strrecvbuffer, "clienttype", starg.clienttype);\r\n    getxmlbuffer(strrecvbuffer, "clientpath", starg.clientpath);\r\n    getxmlbuffer(strrecvbuffer, "srvpath", starg.srvpath);\r\n    getxmlbuffer(strrecvbuffer, "srvpathbak", starg.srvpathbak);\r\n    getxmlbuffer(strrecvbuffer, "andchild", starg.andchild);\r\n    getxmlbuffer(strrecvbuffer, "ptype", starg.ptype);\r\n    getxmlbuffer(strrecvbuffer, "matchname", starg.matchname);\r\n\r\n    getxmlbuffer(strrecvbuffer, "timetvl", starg.timetvl);     // \u6267\u884c\u4efb\u52a1\u7684\u5468\u671f\u3002\r\n    getxmlbuffer(strrecvbuffer, "timeout", starg.timeout);     // \u8fdb\u7a0b\u8d85\u65f6\u7684\u65f6\u95f4\u3002\r\n    getxmlbuffer(strrecvbuffer, "pname", starg.pname, 50);     // \u8fdb\u7a0b\u540d\u3002\r\n\r\n    // \u4e3a\u4ec0\u4e48\u8981\u5224\u65ad\u5ba2\u6237\u7aef\u7684\u7c7b\u578b\uff1f\u4e0d\u662f\u53ea\u67091\u548c2\u5417\uff1f \u9632\u6b62\u975e\u6cd5\u7684\u8fde\u63a5\u8bf7\u6c42\u3002\r\n    if ( (starg.clienttype != 1) && (starg.clienttype != 2) )\r\n        strsendbuffer = "failed";\r\n    else\r\n        strsendbuffer = "ok";\r\n\r\n    if (tcpserver.write(strsendbuffer) == false)\r\n    {\r\n        logfile.write("tcpserver.write() failed.\\n"); return false;\r\n    }\r\n\r\n    logfile.write("%s login %s.\\n", tcpserver.getip(), strsendbuffer.c_str());\r\n\r\n    return true;\r\n}\r\n\r\n// \u4e0b\u8f7d\u6587\u4ef6\u7684\u4e3b\u51fd\u6570\r\nvoid sendfilesmain() {\r\n\r\n    pactive.addpinfo(starg.timeout, starg.pname);\r\n\r\n    bool bcontinue = true; // \u5982\u679c\u8c03\u7528 _tcpputfiles() \u53d1\u9001\u4e86\u6587\u4ef6\uff0cbcontinue \u4e3a true\uff0c\u5426\u5219\u4e3a false\uff0c\u521d\u59cb\u5316\u4e3a true\r\n\r\n    while (true) {\r\n\r\n        // \u8c03\u7528\u6587\u4ef6\u4e0b\u8f7d\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0b\u8f7d\u7684\u4efb\u52a1\r\n        if (_tcpputfiles(bcontinue) == false) { logfile.write("_tcpputfiles() failed.\\n"); return; }\r\n\r\n        if (bcontinue == false) {\r\n            sleep(starg.timetvl);\r\n\r\n            // \u53d1\u9001\u5fc3\u8df3\u62a5\u6587\r\n            if (activetest() == false) break;\r\n        }\r\n\r\n        pactive.uptatime();\r\n    }\r\n}\r\n\r\n// \u5fc3\u8df3\u3002\r\nbool activetest()\r\n{\r\n    strsendbuffer="<activetest>ok</activetest>";\r\n    // xxxxxxxxxxxxx logfile.write("\u53d1\u9001\uff1a%s\\n",strsendbuffer.c_str());\r\n    if (tcpserver.write(strsendbuffer) == false) return false; // \u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u62a5\u6587\u3002\r\n\r\n    if (tcpserver.read(strrecvbuffer, 20) == false) return false; // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u56de\u5e94\u62a5\u6587\u3002\r\n    // xxxxxxxxxxxxx logfile.write("\u63a5\u6536\uff1a%s\\n",strrecvbuffer.c_str());\r\n\r\n    return true;\r\n}\r\n\r\n// \u6587\u4ef6\u4e0a\u4f20\u7684\u4e3b\u51fd\u6570\uff0c\u6267\u884c\u4e00\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u4efb\u52a1\r\nbool _tcpputfiles(bool &bcontinue) {\r\n\r\n    bcontinue = false;\r\n\r\n    cdir dir;\r\n\r\n    // \u6253\u5f00 starg.client \u76ee\u5f55\r\n    if (dir.opendir(starg.srvpath, starg.matchname, 10000, starg.andchild) == false) {\r\n        logfile.write("dir.opendir(%s) failed.\\n", starg.srvpath); return false;\r\n    }\r\n\r\n    int delayed = 0; // \u672a\u6536\u5230\u5bf9\u7aef\u786e\u8ba4\u62a5\u6587\u7684\u6587\u4ef6\u6570\u91cf\r\n\r\n    // \u904d\u5386\u76ee\u5f55\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\r\n    while (true) {\r\n    \r\n        if (dir.readdir() == false) break;\r\n\r\n        bcontinue = true;\r\n\r\n        // \u628a\u6587\u4ef6\u540d\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6587\u4ef6\u5927\u5c0f\u7ec4\u6210\u62a5\u6587\uff0c\u53d1\u9001\u7ed9\u5bf9\u7aef\r\n        sformat(strsendbuffer, "<filename>%s</filename><mtime>%s</mtime><size>%d</size>", \r\n                dir.m_ffilename.c_str(), dir.m_mtime.c_str(), dir.m_filesize);\r\n        \r\n        // xxxxxxxxxx logfile.write("strsendbuffer = %s\\n", strsendbuffer.c_str());\r\n        if (tcpserver.write(strsendbuffer) == false) {\r\n            logfile.write("tcpserver.write() failed.\\n"); return false;\r\n        }\r\n\r\n        // \u53d1\u9001\u6587\u4ef6\u5185\u5bb9\u7ed9\u5bf9\u7aef\r\n        logfile.write("send %s(%d) ...", dir.m_ffilename.c_str(), dir.m_filesize);\r\n        if (sendfile(dir.m_ffilename, dir.m_filesize) == true) {\r\n            logfile << "ok.\\n";\r\n            delayed++;\r\n        } else {\r\n            logfile << "failed.\\n"; tcpserver.closeclient(); return false;\r\n        }\r\n\r\n        pactive.uptatime();\r\n\r\n        while (delayed > 0) {\r\n            // \u63a5\u6536\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u62a5\u6587\r\n            if (tcpserver.read(strrecvbuffer, -1) == false) break;\r\n            // xxxxxxxxxx logfile.write("strrecvbuffer1 = %s\\n", strrecvbuffer.c_str());\r\n\r\n            // \u5904\u7406\u670d\u52a1\u7aef\u7684\u786e\u8ba4\u62a5\u6587\uff08\u5220\u9664\u672c\u5730\u6587\u4ef6\u6216\u628a\u672c\u5730\u6587\u4ef6\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55\uff09\r\n            // delayed--;\r\n            ackmessage(strrecvbuffer);\r\n        }\r\n    }\r\n\r\n    // \u7ee7\u7eed\u63a5\u6536\u5bf9\u7aef\u7684\u786e\u8ba4\u62a5\u6587\r\n    while (delayed > 0) {\r\n        if (tcpserver.read(strrecvbuffer, 10) == false) break;\r\n        // xxxxxxxxxx logfile.write("strrecvbuffer2 = %s\\n", strrecvbuffer.c_str());\r\n\r\n        // \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8f6c\u5b58\u672c\u5730\u7684\u6587\u4ef6\uff09\r\n        delayed--;\r\n        ackmessage(strrecvbuffer);\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u628a\u6587\u4ef6\u7684\u5185\u5bb9\u53d1\u9001\u7ed9\u5bf9\u7aef\u3002\r\nbool sendfile(const string &filename,const int filesize)\r\n{\r\n    int  onread=0;        // \u6bcf\u6b21\u8c03\u7528fread\u65f6\u6253\u7b97\u8bfb\u53d6\u7684\u5b57\u8282\u6570\u3002 \r\n    char buffer[1000];    // \u5b58\u653e\u8bfb\u53d6\u6570\u636e\u7684buffer\u3002\r\n    int  totalbytes=0;    // \u4ece\u6587\u4ef6\u4e2d\u5df2\u8bfb\u53d6\u7684\u5b57\u8282\u603b\u6570\u3002\r\n    cifile ifile;\r\n\r\n    // \u4ee5"rb"\u7684\u6a21\u5f0f\u6253\u5f00\u6587\u4ef6\u3002\r\n    if (ifile.open(filename,ios::in|ios::binary)==false) return false;\r\n\r\n    while (true)\r\n    {\r\n        memset(buffer,0,sizeof(buffer));\r\n\r\n        // \u8ba1\u7b97\u672c\u6b21\u5e94\u8be5\u8bfb\u53d6\u7684\u5b57\u8282\u6570\uff0c\u5982\u679c\u5269\u4f59\u7684\u6570\u636e\u8d85\u8fc71000\u5b57\u8282\uff0c\u5c31\u6253\u7b97\u8bfb1000\u5b57\u8282\u3002\r\n        if (filesize-totalbytes>1000) onread=1000;\r\n        else onread=filesize-totalbytes;\r\n\r\n        // \u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\r\n        ifile.read(buffer,onread);    \r\n\r\n        // \u628a\u8bfb\u53d6\u5230\u7684\u6570\u636e\u53d1\u9001\u7ed9\u5bf9\u7aef\u3002\r\n        if (tcpserver.write(buffer,onread)==false)  { return false; }\r\n\r\n        // \u8ba1\u7b97\u6587\u4ef6\u5df2\u8bfb\u53d6\u7684\u5b57\u8282\u603b\u6570\uff0c\u5982\u679c\u6587\u4ef6\u5df2\u8bfb\u5b8c\uff0c\u8df3\u51fa\u5faa\u73af\u3002\r\n        totalbytes=totalbytes+onread;\r\n\r\n        if (totalbytes==filesize) break;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// \u5904\u7406\u4f20\u8f93\u6587\u4ef6\u7684\u54cd\u5e94\u62a5\u6587\uff08\u5220\u9664\u6216\u8f6c\u5b58\u672c\u5730\u7684\u6587\u4ef6\uff09\r\nbool ackmessage(const string &strrecvbuffer) {\r\n\r\n    string filename;\r\n    string result;\r\n\r\n    getxmlbuffer(strrecvbuffer, "filename", filename);\r\n    getxmlbuffer(strrecvbuffer, "result", result);\r\n    // logfile.write("get --\x3e filename is %s\\n", filename.c_str());\r\n\r\n    // \u5982\u679c\u670d\u52a1\u7aef\u63a5\u6536\u6587\u4ef6\u4e0d\u6210\u529f\uff0c\u76f4\u63a5\u8fd4\u56de\uff08\u4e0b\u6b21\u6267\u884c\u6587\u4ef6\u4f20\u8f93\u4efb\u52a1\u65f6\u5c06\u4f1a\u91cd\u4f20\uff09\r\n    if (result != "ok") return true;\r\n\r\n    // \u5982\u679c starg.ptype == 1\uff0c\u5220\u9664\u6587\u4ef6\r\n    if (starg.ptype == 1) {\r\n        // logfile.write("remove --\x3e filename is %s\\n", filename.c_str());\r\n        if (remove(filename.c_str()) != 0) { logfile.write("remove(%s) failed.\\n", filename.c_str()); return false; }\r\n    }\r\n\r\n    // \u5982\u679c starg.ptype == 2\uff0c\u79fb\u52a8\u6587\u4ef6\u5230\u5907\u4efd\u76ee\u5f55\r\n    if (starg.ptype == 2) {\r\n        // \u751f\u6210\u8f6c\u5b58\u540e\u7684\u5907\u4efd\u76ee\u5f55\u6587\u4ef6\u540d\r\n        string bakfilename = filename;\r\n        replacestr(bakfilename, starg.srvpath, starg.srvpathbak, false); // \u6ce8\u610f\uff0c\u7b2c\u56db\u4e2a\u53c2\u6570\u4e00\u5b9a\u586b false\r\n        if (renamefile(filename, bakfilename) == false) {\r\n            logfile.write("renamefile(%s, %s) failed.\\n", filename.c_str(), bakfilename.c_str()); return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:'#!/bin/bash\r\n\r\n# \u957f\u8def\u5f84\u53d8\u91cf\r\nBASE_DIR="/home/celfs/project/engi_cpp/49_project"\r\nBIN_PROCCTL="$BASE_DIR/tools/bin/procctl"\r\nBIN_DELETE="$BASE_DIR/tools/bin/deletefiles"\r\n\r\nREMOTE_HOST="192.168.20.150:21"\r\n\r\n# \u542f\u52a8\u5b88\u62a4\u6a21\u5757\r\n#$BIN_PROCCTL 10 $BASE_DIR/tools/bin/checkproc $BASE_DIR/tmp/log/checkproc.log\r\n\r\n# \u751f\u6210\u6c14\u8c61\u7ad9\u70b9\u89c2\u6d4b\u7684\u5206\u949f\u6570\u636e\uff0c\u7a0b\u5e8f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\r\n$BIN_PROCCTL 60 \\\r\n$BASE_DIR/idc/bin/crtsurfdata \\\r\n$BASE_DIR/idc/ini/stcode.ini \\\r\n$BASE_DIR/tmp/idc/surfdata \\\r\n$BASE_DIR/log/idc/crtsurfdata.log csv,xml,json\r\n\r\n# \u6e05\u7406\u539f\u59cb\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u76ee\u5f55\uff08/tmp/idc/surfdata\uff09\u4e2d\u7684\u5386\u53f2\u6570\u636e\u6587\u4ef6\r\n$BIN_PROCCTL 300 \\\r\n$BIN_DELETE \\\r\n$BASE_DIR/tmp/idc/surfdata "*" 0.02\r\n\r\n# \u538b\u7f29\u540e\u53f0\u670d\u52a1\u7a0b\u5e8f\u7684\u5907\u4efd\u65e5\u5fd7\r\n$BIN_PROCCTL 300 \\\r\n$BASE_DIR/tools/bin/gzipfiles \\\r\n$BASE_DIR/tmp/idc/surfdata "*.log.20*" 0.02\r\n\r\n# \u4ece\uff08/tmp/idc/surfdata\uff09\u76ee\u5f55\u4e0b\u8f7d\u539f\u59cb\u7684\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u6587\u4ef6\uff0c\u5b58\u653e\u5728\uff08/idcdata/surfdata\uff09\u76ee\u5f55\r\n$BIN_PROCCTL 30 \\\r\n$BASE_DIR/tools/bin/ftpgetfiles \\\r\n$BASE_DIR/log/idc/ftpgetfiles_surfdata.log \\\r\n"<host>$REMOTE_HOST</host><mode>1</mode>\\\r\n<username>celfs</username><password>123</password>\\\r\n<localpath>$BASE_DIR/idcdata/surfdata</localpath>\\\r\n<remotepath>$BASE_DIR/tmp/idc/surfdata</remotepath>\\\r\n<matchname>*.TXT</matchname><ptype>1</ptype>\\\r\n<okfilename>$BASE_DIR/idcdata/ftplist/ftpgetfiles_test.xml</okfilename>\\\r\n<checkmtime>true</checkmtime>\\\r\n<timeout>30</timeout><pname>ftpgetfiles_test</pname>"\r\n\r\n# \u6e05\u7406\uff08/tmp/idc/surfdata\uff09\u76ee\u5f55\u4e2d 0.04 \u5929\u4e4b\u524d\u7684\u6587\u4ef6\r\n$BIN_PROCCTL 300 \\\r\n$BIN_DELETE \\\r\n$BASE_DIR/idcdata/surfdata "*" 0.04\r\n\r\n# \u628a\uff08/tmp/idc/surfdata\uff09\u76ee\u5f55\u7684\u539f\u59cb\u6c14\u8c61\u89c2\u6d4b\u6570\u636e\u6587\u4ef6\u4e0a\u4f20\u5230\uff08/tmp/ftpputtest\uff09\u76ee\u5f55\r\n# \u6ce8\u610f\uff0c\u5148\u521b\u5efa\u597d\u670d\u52a1\u7aef\u7684\u76ee\u5f55\uff1amkdir /tmp/ftpputtest\r\n$BIN_PROCCTL 30 \\\r\n$BASE_DIR/tools/bin/ftpputfiles \\\r\n$BASE_DIR/log/idc/ftpputfiles_surfdata.log \\\r\n"<host>127.0.0.1:21</host><mode>1</mode>\\\r\n<username>celfs</username><password>123</password>\\\r\n<localpath>$BASE_DIR/tmp/idc/surfdata</localpath>\\\r\n<remotepath>$BASE_DIR/tmp/ftpputtest</remotepath>\\\r\n<matchname>SURF_ZH*.JSON</matchname><ptype>1</ptype>\\\r\n<localpathbak>$BASE_DIR/tmp/idc/surfdatabak</localpathbak>\\\r\n<okfilename>$BASE_DIR/idcdata/ftplist/ftpputfiles_surfdata.xml</okfilename>\\\r\n<timeout>80</timeout><pname>ftpputfiles_surfdata</pname>"\r\n\r\n# \u6e05\u7406\uff08/tmp/ftpputest\uff09\u76ee\u5f55\u4e2d 0.04 \u5929 \u4e4b\u524d\u7684\u6587\u4ef6\r\n$BIN_PROCCTL 300 \\\r\n$BIN_DELETE \\\r\n$BASE_DIR/tmp/ftpputtest "*" 0.04\r\n\r\n# \u6587\u4ef6\u4f20\u8f93\u7684\u670d\u52a1\u7aef\u7a0b\u5e8f\r\n$BIN_PROCCTL 10 $BASE_DIR/tools/bin/fileserver 5005 $BASE_DIR/log/idc/fileserver.log\r\n\r\n# \u628a\u76ee\u5f55 /tmp/ftpputtest \u4e2d\u7684\u6587\u4ef6\u4e0a\u4f20\u5230 /tmp/tcpputtest \u76ee\u5f55\u4e2d\r\n$BIN_PROCCTL 20 \\\r\n$BASE_DIR/tools/bin/tcpputfiles \\\r\n$BASE_DIR/log/idc/tcpputfiles_surfdata.log \\\r\n"<ip>127.0.0.1</ip><port>5005</port>\\\r\n<ptype>1</ptype>\\\r\n<clientpath>$BASE_DIR/tmp/ftpputtest</clientpath>\\\r\n<srvpath>$BASE_DIR/tmp/tcpputtest</srvpath>\\\r\n<andchild>true</andchild>\\\r\n<matchname>*.XML,*.CSV,*.JSON</matchname>\\\r\n<timetvl>10</timetvl><timeout>50</timeout>\\\r\n<pname>tcpputfiles_surfdata</pname>"\r\n\r\n# \u628a\u76ee\u5f55 /tmp/tcpputtest \u4e2d\u7684\u6587\u4ef6\u4e0b\u8f7d\u5230 /tmp/tcpgettest \u76ee\u5f55\u4e2d\r\n$BIN_PROCCTL 20 \\\r\n$BASE_DIR/tools/bin/tcpgetfiles \\\r\n$BASE_DIR/log/idc/tcpgetfiles_surfdata.log \\\r\n"<ip>127.0.0.1</ip><port>5005</port>\\\r\n<ptype>1</ptype>\\\r\n<srvpath>$BASE_DIR/tmp/tcpputtest</srvpath>\\\r\n<clientpath>$BASE_DIR/tmp/tcpgettest</clientpath>\\\r\n<andchild>true</andchild>\\\r\n<matchname>*.XML,*.CSV,*.JSON</matchname>\\\r\n<timetvl>10</timetvl><timeout>50</timeout>\\\r\n<pname>tcpgetfiles_surfdata</pname>"\r\n\r\n# \u6e05\u7406 /tmp/tcpgettest \u76ee\u5f55\u4e2d\u7684\u5386\u53f2\u6570\u636e\u6587\u4ef6\r\n$BIN_PROCCTL 300 \\\r\n$BIN_DELETE \\\r\n$BASE_DIR/tmp/tcpgettest "*" 0.02\n'})}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-shell",children:"#!/bin/bash\r\n\r\n# \u6b64\u811a\u672c\u7528\u4e8e\u505c\u6b62\u6570\u636e\u5171\u4eab\u5e73\u53f0\u5168\u90e8\u7684\u670d\u52a1\u7a0b\u5e8f\r\n\r\n# \u505c\u6b62\u8c03\u5ea6\u7a0b\u5e8f\r\nkillall -9 procctl\r\n\r\n# \u505c\u6b62\u5176\u4ed6\u7684\u670d\u52a1\u7a0b\u5e8f\r\n# \u5c1d\u8bd5\u8ba9\u5176\u4ed6\u670d\u52a1\u7a0b\u5e8f\u6b63\u5e38\u7ec8\u6b62\r\nkillall crtsurfdata deletefiles gzipfiles ftpgetfiles ftpputfiles\r\nkillall fileserver tcpputfiles tcpgetfiles\r\n\r\n# \u8ba9\u5176\u4ed6\u670d\u52a1\u7a0b\u5e8f\u6709\u8db3\u591f\u7684\u65f6\u95f4\u9000\u51fa\r\nsleep 5 \r\n\r\n# \u4e0d\u7ba1\u670d\u52a1\u7a0b\u5e8f\u6709\u6ca1\u6709\u9650\u5236\uff0c\u90fd\u5f3a\u5236\u6740\u6b7b\r\nkillall -9 crtsurfdata deletefiles gzipfiles ftpgetfiles ftpputfiles\r\nkillall -9 fileserver tcpputfiles tcpgetfiles\r\n\n"})}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"\u7591\u95ee"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u59cb\u7ec8\u672a\u7406\u89e3\uff0c\u6700\u7ec8\u7248\u672c\u7684\u4ee3\u7801\u91cc\u9762\uff0c\u4e3a\u4ec0\u4e48\u4f7f\u7528\u4e86\u4e24\u4e2a ",(0,l.jsx)(r.code,{children:"delayed--"})," \uff1f"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u80fd\u4e0d\u80fd\u8bb2\u8bb2\u53cc\u5de5\u3001\u5168\u53cc\u5de5\u3001\u534a\u53cc\u5de5\u7b49\u6982\u5ff5\uff0c\u4ee5\u53ca\u9664\u6b64\u4ee5\u5916\u8fd8\u6709\u4ec0\u4e48\u672f\u8bed\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u5355\u5de5\uff08Simplex\uff09"}),": \u6570\u636e\u53ea\u80fd\u5355\u5411\u4f20\u8f93\u7684\u901a\u4fe1\u65b9\u5f0f\u3002\u4f8b\u5982\uff0c\u5e7f\u64ad\u7535\u89c6\u4fe1\u53f7\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u534a\u53cc\u5de5\uff08Half-Duplex\uff09"}),": \u6570\u636e\u53ef\u4ee5\u53cc\u5411\u4f20\u8f93\uff0c\u4f46",(0,l.jsx)(r.strong,{children:"\u4e0d\u80fd\u540c\u65f6"}),"\u8fdb\u884c\u3002\u4f8b\u5982\uff0c\u5bf9\u8bb2\u673a\uff0c\u4e00\u65b9\u8bb2\u8bdd\u65f6\u53e6\u4e00\u65b9\u53ea\u80fd\u63a5\u6536\u3002"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.strong,{children:"\u5168\u53cc\u5de5\uff08Full-Duplex\uff09"}),": \u6570\u636e\u53ef\u4ee5",(0,l.jsx)(r.strong,{children:"\u53cc\u5411\u540c\u65f6"}),"\u4f20\u8f93\u3002\u4f8b\u5982\uff0c\u7535\u8bdd\u901a\u4fe1\uff0c\u4e24\u65b9\u53ef\u4ee5\u540c\u65f6\u8bb2\u8bdd\u548c\u542c\u5230\u5bf9\u65b9\u8bb2\u8bdd\u3002"]}),"\n",(0,l.jsx)(r.li,{children:(0,l.jsx)(r.strong,{children:"\u533a\u522b\uff1a\u5355 / \u53cc\u5411 + \u540c\u65f6 / \u4e0d\u540c\u65f6"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u5b83\u4eec\u662f\u54ea\u4e2a\u9886\u57df\u7684\u672f\u8bed\uff1f\u901a\u4fe1\u9886\u57df\uff1f\u8fd8\u662f\u4ec0\u4e48\u5177\u4f53\u7684\u8bfe\u7a0b\u53ef\u4ee5\u5b66\u5230\uff1f\u5982\u679c\u8981\u8865\u5145\u8fd9\u65b9\u4fbf\u7684\u4fe1\u606f\u4e0e\u77e5\u8bc6\uff0c\u5e94\u8be5\u5b66\u4e60\u4ec0\u4e48\uff1f\u8ba1\u7b97\u673a\u7f51\u7edc\u91cc\u9762\u597d\u50cf\u6ca1\u6709\u76f4\u63a5\u8bb2\u5230\u8fd9\u4e9b\u6982\u5ff5\uff1f\u90a3\u4e48\u4fe1\u606f\u8bba\u91cc\u9762\u4f1a\u4e0d\u4f1a\u6709\u5462\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5c5e\u4e8e\u901a\u4fe1\u9886\u57df\u7684\u57fa\u7840\u6982\u5ff5\uff0c\u7528\u4e8e\u63cf\u8ff0\u901a\u4fe1\u65b9\u5f0f\u7684\u4e0d\u540c\u7c7b\u578b\u3002\u5b9e\u9645\u4e0a\uff0c\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u6570\u636e\u901a\u4fe1\u3001\u901a\u4fe1\u539f\u7406\u3001\u4fe1\u606f\u8bba\u7b49\u8bfe\u7a0b\u4e2d\uff0c\u90fd\u4f1a\u76f4\u63a5\u6216\u8005\u95f4\u63a5\u5730\u6d89\u53ca\u8fd9\u4e9b\u6982\u5ff5\u3002"}),"\n",(0,l.jsxs)(r.li,{children:["\u4f8b\u5982\uff0c\u8ba1\u7b97\u673a\u7f51\u7edc\uff08\u7f51\u7edc\u534f\u8bae\u3001\u4f20\u8f93\u63a7\u5236\uff09\u3001\u6570\u636e\u901a\u4fe1\uff08\u57fa\u7840\u901a\u4fe1\u6280\u672f\u548c\u534f\u8bae\uff09\u3001\u901a\u4fe1\u539f\u7406\uff08\u901a\u4fe1\u7cfb\u7edf\u7684\u5de5\u4f5c\u539f\u7406\uff09\u3001\u4fe1\u606f\u8bba\uff08\u4fe1\u606f\u4f20\u8f93\u7684\u57fa\u7840\u7406\u8bba\u548c\u65b9\u6cd5\uff0c\u5982\u4fe1\u9053\u5bb9\u91cf\u3001\u7f16\u7801\u7406\u8bba\uff0c\u867d\u7136",(0,l.jsx)(r.strong,{children:"\u6ca1\u6709\u76f4\u63a5\u8bb2\u5230"}),"\u8fd9\u4e9b\u6982\u5ff5\uff0c\u4f46\u63d0\u4f9b\u4e86",(0,l.jsx)(r.strong,{children:"\u7406\u89e3\u8fd9\u4e9b\u6982\u5ff5\u7684\u7406\u8bba\u80cc\u666f"}),"\uff09"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"\u6211\u524d\u9762\u7684\u4e00\u5806\u7591\u95ee\u6216\u8005\u63d0\u95ee\uff0c\u53ef\u4ee5\u600e\u4e48\u4f18\u5316\u63d0\u95ee\u7684\u601d\u8def\u548c\u65b9\u5f0f\uff1f\u5982\u4f55\u66f4\u597d\u5730\u7528\u5177\u4f53\u7684\u63d0\u95ee\uff0c\u6765\u83b7\u53d6\u6211\u6240\u9700\u7684\u8d44\u6e90\u3001\u4fe1\u606f\u3001\u6280\u672f\u3001\u8bfe\u7a0b\u3001\u77e5\u8bc6\uff1f"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u5177\u4f53\u5316\u95ee\u9898\uff08\u5177\u4f53\u660e\u786e\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u5206\u6b65\u9aa4\u63d0\u95ee\uff08\u590d\u6742\u95ee\u9898\u5206\u89e3\u591a\u4e2a\u5c0f\u95ee\u9898\uff0c\u9010\u6b65\u6c42\u89e3\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u63d0\u4f9b\u80cc\u666f\uff08\u7b80\u8ff0\u95ee\u9898\u80cc\u666f\uff0c\u4fbf\u4e8e\u7406\u89e3\uff09"}),"\n",(0,l.jsx)(r.li,{children:"\u660e\u786e\u76ee\u6807\uff08\u5e0c\u671b\u5f97\u5230\u7684\u4fe1\u606f\u3001\u5e0c\u671b\u89e3\u51b3\u7684\u95ee\u9898\uff09"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"BUG"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:[(0,l.jsx)(r.del,{children:"1\uff09\u8c03\u8bd5\u53d1\u73b0\uff0c\u6587\u4ef6\u53ef\u4ee5\u6b63\u5e38\u4e0b\u8f7d\uff0c\u4f46\u670d\u52a1\u7aef\u6587\u4ef6\u4e0d\u80fd\u6b63\u5e38\u5220\u9664\uff0c\u5bfc\u81f4\u4e00\u76f4\u91cd\u590d\u8fd0\u884c\u4e0b\u8f7d\u4ee3\u7801\uff0c\u9677\u5165\u6b7b\u5faa\u73af\u3002"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u6d4b\u8bd5\u53d1\u73b0\uff0c\u8f93\u51fa\u7684\u901f\u5ea6\u4e0e\u662f\u5426\u591a\u4f7f\u7528\u4e00\u4e2a ",(0,l.jsx)(r.code,{children:"delayed--"})," \u6709\u5173"]}),"\n",(0,l.jsx)(r.li,{children:"\u903b\u8f91\u4e0a\uff0c\u5e94\u5f53\u662f\u4ece\u670d\u52a1\u7aef\u4e0b\u8f7d\uff0c\u5e76\u4e14\u628a\u670d\u52a1\u7aef\u5df2\u4e0b\u8f7d\u7684\u6587\u4ef6\u5220\u9664"}),"\n",(0,l.jsxs)(r.li,{children:["\u5df2\u7ecf\u5b9a\u4f4d\u5230\u95ee\u9898\uff0c",(0,l.jsx)(r.code,{children:"filesever.cpp"})," \u7684 ",(0,l.jsx)(r.code,{children:"remove()"})," \u8bc6\u522b\u5230 ",(0,l.jsx)(r.code,{children:"filename"})," \u662f\u5ba2\u6237\u7aef\u7684\uff0c\u5bfc\u81f4\u5ba2\u6237\u7aef\u4e00\u904d\u4e0b\u8f7d\u6587\u4ef6\uff0c\u4e00\u904d\u5220\u9664\u6587\u4ef6\u3002"]}),"\n",(0,l.jsx)(r.li,{children:"\u90a3\u4e48\uff0c\u5c31\u9700\u8981\u627e\u5230\u662f\u54ea\u4e00\u4e2a\u4f4d\u7f6e\u5f00\u59cb\uff0c\u4f20\u5165\u7684\u6587\u4ef6\u540d\u53d1\u751f\u4e86\u9519\u8bef\uff0c\u4f8b\u5982\u67d0\u4e2a\u53d8\u91cf\u6ca1\u6709\u8d4b\u503c\uff0c\u6216\u8005\u5f04\u53cd\u4e86\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u7684\u6587\u4ef6\u540d"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\u89e3\u51b3\u95ee\u9898\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsxs)(r.li,{children:["\u662f ",(0,l.jsx)(r.code,{children:"tcpgetfiles.cpp"})," \u5728\u63a5\u53d7\u6587\u4ef6\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u4f20\u5165\u4e86\u5ba2\u6237\u7aef\u81ea\u5df1\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u539f\u672c\u5e94\u5f53\u4f20\u5165\u670d\u52a1\u7aef\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u4ece\u800c\u8fd4\u56de\u62a5\u6587\u7ed9\u670d\u52a1\u7aef\uff0c\u8ba9\u670d\u52a1\u7aef\u8fdb\u884c\u5220\u9664\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/23 19:12:21 30min+52min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/23 22:35:32 \u4ee3\u7801 + debug\uff0c2h9min"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/23 23:14:35 \u4ee3\u7801\u5b8c\u6210 + debug \u5b8c\u6210"}),"\n"]}),"\n",(0,l.jsxs)(r.li,{children:["\n",(0,l.jsx)(r.p,{children:"2024/06/24 20:31:12 \u811a\u672c\u5b8c\u5584 + \u4ee3\u7801\u6d41\u7a0b\u6574\u7406 26min + 1h18min"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(r.hr,{}),"\n",(0,l.jsx)(r.h2,{id:"\u672c\u7bc7\u5b8c",children:"\u672c\u7bc7\u5b8c"})]})}function o(n={}){const{wrapper:r}={...(0,s.R)(),...n.components};return r?(0,l.jsx)(r,{...n,children:(0,l.jsx)(f,{...n})}):f(n)}},68502:(n,r,e)=>{e.d(r,{A:()=>i});const i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAr0AAAA5CAYAAAA7mpM/AAAU9UlEQVR4nO3df2gbV4IH8G9iOfGeFWq3ic8kIdmqpk6O6mgqUyjHQBx5l90yQXSJOfXIH5c/RFi0+K/jxFFYW7Dh0LL3j6g5gv/ILQRWkNwuIsNd2bXqwHBk6XnaBS+NVXzKJU1zu067TsiEOrGd3h8zI43kmTcjWZId7fcDBktP8+b9nHl682a0a3Bw8BsQEREREXWw3dudACIiIiKiVuOgl4iIiIg6XssGvaMH38Dc6Kjx92qf84f6Xq18ZvQNZHp8RCylkVMUKIoCRcki4bnBSRw4/xt8+7X60u9k6uoqrl/chtUgtjzn0pL1JtI5BVnvAvBtY+ocVpMv1B1G9Utkrbpsfj02npbGSemc2ScVKG6ZSWQrn1FyqHeXzUinP0adKLk02rE3S3vyl0BWaX/evLSvbluhM9uLrz7tQ7vrVrS/7UxLs8rT7/7Md3z190bLZSeVtV+BgwcP4t69e02PeO7ex5i7Zwx+fxx0/szMiUNY+mQOiQc+I01kocSAvCxjxnqdS2MxPgm1SeneiRLjEUDLQJ4dQy41jgRULKaTiCznIc80aSfHw1gbuo2eqYdNirB+6++fwxPr+9FSAb1Td6o/cDyM1fdGsPFgHr0/WvCMT0rnkIpUN75SXsbEDGCcqFIoB5fykCeswnQPE8fpk5RGNFRCQVaB7R56VKWlcepkHCrM8ul3+kQC2Vio/rJqcjq3QyKrILqSQXxSkPbnOH9b5pZ3KY1cKoKgriFTPsYnkFViCJkf0TWPcn0ONdpefG1XB+8+7UO72/VO6kc1aWlKedaxv5bb9rIWncPdBY4cOYKuri58/vnnrU1frZ6DGMQX+MDvgBcS0tEBaJk4ytmauQItmsSYBKg7oI230vJdFcCY8UJKIxlZRr5pI17g2akh4MaHTYuvXhtT5/DkywJ6f3QHwBE8vRzFavKX6JmuDMLXkyPYvXQbG/v9x+t2UkxkU8aXhvgMrBNpLr2I+KQqDBPF6Zc0Ngxo02he7TWubWmRDmMAJRQa3FF7y0zFZLy9B5T25W8GE008bjSDc94lpJMRLJdKCA7Y3svFMKBlIE+qMPpmCtmE2tgXqabp5PayNe1O504ql52R99b19+0ua6/ztJvA+vo69u/fjy+//BJff/2186f6XsXciUPll3rxBk7fWwUAZN4YxZvWVe8vPsHoZz5HsT1BuEwAV8eJL3B17jNMJ8YRWS6g+kuFitliEqp6EgfOv4fe//oO/vf3Rsie7/4Kr7/4a3yUu2l+9of49j/+AMbxcwkf/fSHvpJ58foqRvZVXj/6yiXs1h5EzuwGptahvbYL8/vXMLJvN+avdWH49Br2PerGz0524RcArmqreLkcYeV9NzNXNORSCpQYoGt5HE7GsJyXm9jYjmD9LSBwoXqWt2rmFUDXfZcwa1ZWPoXHI/exd/8InvQ9wN7cEtbj9plZYzC7ZkVivX88jLWhB9h7wZrZvYPAjQf4+vgRAMaM7rPkO3iCeXxr/gDWvrfF7EppREM6tIxVgjO4okWRGh4DpDHXMKkp1xMSGI8AxUxtXPYZrBLy8oRZv9UzW7BmvRJZKOEVaAMRRII6tHwRwzH7rJifb8EuaUlkocTKe7QN8hv7Zg0AONbv0t9r4qzKu1s6JaRzSWC6gP7U5jKzZrymkSzPyldmmF3Kc1M67GEO6azNu0OZ2fcPpKAoKedtHevBbX/ivG/Kn5EaaJk4ZsdsVynqqTuX/MUnIUiLVzpFeQekdBIRaMgs9CMVtT46jkiwhHz5pGb2zXACEB4NO7u9VF99ctrOLQ+i/HlppN+65711bWlzPemaS5hVXp7HVj9l5nacd1NHHRkfgJaJozK+27y/qnaxqQ2JygWCc4Aof20sa9E53KP17tZ1Hd3d3QgGXYagfa9i7kQQH92Yw+ic8WcNeJOvjuJN/ZPy+x8FT+DaQfHC3PJa3xOHABzCmZp1v6MH36iKc3TuM0wDSIRDKC1YHdhcF5NLA3eXhfuzDLz9XTz+t+/go59+BzfvDOHNuPegd+rqKka+3INIpAeRSA+u3XIPm9//tLLe9+U1vHS9B9duPcPI6W9wPbIHt/Zt4OS7xkB5//zeynZYwz9cfSZOiDqJuCxDlmXE74YRWc43dWbjWTKCtSUNgZuV98ozr2cvoffsJfQsuYft3R+trPcdGsGzDy6hZ6kPT+IH0H22gO6+IawfB9bfj+LZjV9WtsMIHk8dAV45gI0HS5X9y6fw9Vt9QN8B4/XxMJ6+BeydXmjOIvRj/QjqRcxafSORNQ4OwX5h2LEm7FpKRxEqFVD7ZTQUi2IlI0OWM9D0EKLl9b7mzJZshiGClLUeLBRBf0FGvhREJNaPgpxHKTiMMcn2LdjabiC2aX2VY1oSWSixAWgZ2dxWLh/s/MS5Ob/mOrZYCEAIsZo1bZK1TEe29ld7InMrsyAiKavMZORLIcRs6+SCkRRS/QXIsoyMpiMUTXuUp4rJeCXPGU2vSoMw7y5lpk7GzbQZJ41yHms6r1P+xGVtz7u9vQCJbAyhkrldRoMOoJQ3To5Wemrz5knQJsT1IK4j17qV0khGAG3aYfClr2DR9lK9uwwMHPaxSKhz24t4O1EePI4vAg332za3pep6MMrIVx25HFtVn2Xmdpx3KU1hnKI+LdqfqL+LykVcRzukrEXncA+eY4hM6BD04qdIrW4Oe/3QF7hqm9lNlb5AcPBFjArim7v3sTGY/eQLGLO45uDWPkN8aADJqq0kHB7QsbJoNIABLQM5XwKW7/qee1v+j3dw3xwfP/r9EnDkr8UbvLuBky8HcO2McxG9VhN2/noA+4bNweujbvz7lPnvfBemzGI+P7yOkX0BXD+/q7LdxW48evkZpnzlIoFsbADaleZeUHh2vA/d87b1s+b63k1ragEAR7BRExb44DY2jh8xXjyYxx7F+LfrhoYu6zOvnMKTvttVyxUC0/PoGhqypSOM1cvn8DgO9JwtoBsvYP04sPG3I8CND6sG5X4FIyn3mwesGwRjQF7Oo4QBYdhhyUecQhLGhoPml7dqlYOYitmijmD/sfLMVqF8ZFExOa1BD4WNl7oGqyno2pXySWdSTSAcKiFfPlmqmCyUEBwesw0OnNIiIR0NQdemHQ7WfuLczDrwyvkSjNkZhxN5KCy4IdVPmQEzC6XqwY+uIWPuQ50tQg/2C8tTXIvueReXmR9O+RPtrzbvtvaCBMIhVOJSZ1HUgYHDW1k37p0/p3oQhYnboHUPg8P+ZhZQCkYwXq4sY524X53bXkRJERxDGs6fqe5+2+a2ZK45zTvOEHn0MZdjq78ya2Id+erTde5PWC5+2uf2l7V9v67ncBeBYDCItbU16Lrzt/8XXwD+UHIY8fYcxCAO4czoIZyxv/+w6LlTkbl7H+OvgqPleI2lFACwjLtqAuGUsXBaSiehrywCCIsjdLK8Ah1bWEn+7gb2Yx2ntXWctr//qNt720e70GgJWQP+hXEFxhWs2kscDZBP4Qnm0av4/PzxF/AMR/H48rnq9x/cd/6838/0jeDr926j9+wlcz9hrOEh9rxyCo/3z6O3gRvsrBsHDMblFSULyAsAghGkUqXKTZFSGjmY34pcwhZUQFVd4vQz9Z4YNy7Z1vOdpWZmyxfpMAbMWdVYVVy261eOaTmG/qC1fryBOBugTsZxLKuU4910Ga2eMrPNxuvF2Uo9qZOIqwAS2RaUp6DM/HDKX8NlvYgVPYaIdblfGsNwUEdxdisHiAbyJ5ptMetIBZzznsgiNqAhM+G0vxlM5MNQYsZJDighny8hFPY/+eGUFuA5by9eRHloJH9otN+2uS2JbOV45lVmTa0jH326kf258lFHO6WsRedwgUAgEMAf//hH1/W8f3oIvOi6ubne1nM39Zn+bA7Tnxn/z4yOAveG0B8E7kqHy+P4Y/1BLC+okA4n6z/gDfQj+HBli6kM4FoksHmGdmpdvNm+bzBsfz38Dfa5fdbOOhlcGUMyZaxnWkznkNziXXwbI0fRdbPegctt9J51uOlNPiXezFquYHnlADYA4H/uowsvIHDhw+qwB/exMTIC9B3F48sjtg2N1925S+VZZW/G+u9IP4DFFegxHcWM7ZLcsX4E9RVgEa5hmzufLU4fEuEQ9GKmvvZqP7BbafG1odOaN6+0GAdY9+yI42zUzIRsW4+aQi6NypKKesrMrCPhMpSml6fkUWZi7vlz3587FXeXU4iEYlCMUSF0LbO1L8WebcKBLji22vqRU94T4RAQBFKKgpTt/ZSiYDwvY2JmouqJNVI6h+hKI8M2dFh7ERDloeH8NdJv29uWvLnUUSIr3syjzJpZRwkffbqxvLvxrqMdUdaic7iH3Xfu3BE+ueGDPzzE0IlXa5YbAFi9h08fHsIZt2fwNsmfHgJGRdjfNab8jWn2yrt/cfCk8c9r/4rXX3fruidx4G+GoN/6tXjHv+jCl1jHa+ao9t2LT3H65UpY8dE6Tnutxa1xsRjALazjpO1ZvxdPrptLIETMZQ01a9yO9fs8PFnLBt4Pb3p/bah6yQEA4OZD7MZRPJWNl8+S72DVWoVwcwGBB0eNtbj1UJbQjaNVz/pd/95RdN3QzDj78CQZrg67eQddU5fKa4B7z15Cb+62cQPc2XoGvDDXCZqXZNRZFPUgIknr2YXmJZ3irDBsUye3x+lj/9GQ/VKNDzMLKKGyXrNy6emKeDt1FkV985o377QYl8pDMYfnX3vF2RQ1/dx3mRmXuR3ryE5QnsIaFOZdUGamxRXdeRmIW/4aLWvrEqPsvhavft75q6jUgyhMtaW1Nu8zE7Jtnai5LEbXkJE3P+pOSueQGi5iuu48dlh7EW0nOoY0mr/Ne/bZb9vblqDexTJCCCesZOVQXg3TaB/zKrMmH+dnvPp0I/sTlYtXHe2Qshaewz0EvJ7RO3fvYwBv4Mejo+VlDNbTG1IfzyHzxijmbIt4rbDqJzCcwNwh+Hq6Q/V2xjbGEoYBHMYVFPUUYsoANK2ESCwFlPIAruP+r76LA3//Ht58/T3g4X/j5u90HLdNUQ+8/RsMvG2m8XcX8Omvr3sUDXDmWgDa6VVopwHc2oOfza/jvBl2/mQPLl5fhWabJH00vxcn/88jzkgPrmq27W7tQcS2xteJtazBuOI3icK4cVnJ+PbU+Ent2akhbCw5zfLewZ7cbTyOn8NaHMBSAd+6EcFTMzTwo0vA++fw+HJli64bv0TPbfd9rR+/gz1nC3h6+Qd4/Jb55lIBveaAuxLnSCW+2sF4XWrvJNWhZeTyOsjJOJDOpcozSvbLc+5hojg9UjM2jGCpUOfJZAYTMpBVau7InlSBxLjrVmmpkj9rdgC2fIjSohobImW7FGVt5x4nasrFnJXwfEKAwx3wVv7gXWah8mVuv4+RE5SnkLg8RWUGAOrkNMZs7ckqF/f8icvaPZmVY4P9MuLW6kjUJoz/netBEoQ12h8c7gCP+4+hc9sLhNu550EVhNX2TXt7WWy437a3LdUshynlkdGi5gSeoI7uuhQwgLQkbhPuaRGVp7iO3Pu06FjusT/XchGfA3ZSWYvO4SK7BgcHt+EnxurX7Adv0xE8vRzB7gu/augGMapHAlklipWtrr/uuLSIiNJpHND7Cw3+0IUPxgPkC/U91qsuLagHKY1cqh8F+2VEKY1cahjFltS3qB5EYe1ug2wv7dNoOp+XtiTS3j4dlwttzvtOKuvGBbY7AX7NXNEQTSWNWSxj5TqyWWBie59K/hy7gz1nnZ7OQM23k34QYCelRWQ705nAeCQIXWtwragvLcifw3pMaWwYQSyj0fumWuN5aYN+PaftpSXanc6dVC7t7dOJP+uybtxzM+iFOon4sSyUlPXkAuMB4kREW2b95K312tdl7B1mZgL5cO2lUK+bD50efG9T749YbAtxHmQ50/xddkJ7oZ2voT5NIs/N8gai55Wi1HPHHXmR5cqX3d7oe8gm38Jf7tlanP8ky+Zv/1VEE/+Mv/t+eMtxt8uNKz/BhZ//dnPA8Peh/MumW5HL7OVZS9R2RfXQijoSEeXBju1lZ9pJbWknabRP/znzOhZw0EtEREREHa8pv+pKRERERLSTcdBLRERERB2vZTeySekcUtZD4p6LmyGIiIiIqFP5n+mV0sgpCpRcevMvxThQJ+OQZRkZTff+MBERERFRC/kc9EpIJyNYLpVamxoiIiIiohbwtbxBSicRgYbMQj9S0Wbstua5irqGTHzS/B10p2cu6tCe818BISIiIqLt4z3TK6WRjADatDUo3SoJ6VwMA1oGsixDljPQEEEqmwAAJLIxhEp5IyyjQQdQynPAS0RERESN8xz0JsYjgDbdvEFnYhyRYAmFcoQqJqc16KEwgATCIaC0YN70ps6iqAMDh/2sIiYiIiIiciYe9CayiA1omG72NKu+AudfKV/Eig6EwsasL6QxDAd1FGc5zUtEREREjROu6U2EQ0AQSCkKUrb3U4qC8byMhp9CFuzHMaCyXOJYP4IAElBxdzmFSCgGRTF+aVrXMlzaQERERERbIhz0zkzIqBrXJrJQoiu2m85gPMosFUGw6mY0UaQLKMViiKYlzEyqACSkoyHoWgYzUhq5UAl5eQJ8qi8RERERNUuLfpxCQjqXgvXbFIA5c2v+SMWEDGSVFBTFnD8u5SFPqgBUFMYVxBQFMVtsupZBnNO9RERERNSgXYODg99sdyLKpDRyqX4U7DO9Uhq51DCKfGQZERERETXI/y+ytYO5ttdOGhtGEMu4ywEvERERETVoZ830AkhkFcSqfpmCa3yJiIiIaGuEg15FUdqZFty48hNc+PlvNwcMfx8o/mdb00JEREREnaPhG9lkWW5mOsQ44CUiIiKiLfAc9DoNbts9A0xEREREtBU760Y2IiIiIqIW4KCXiIiIiDoeB71ERERE1PE46CUiIiKijsdBLxERERF1PA56iYiIiKjjcdBLRERERB2Pg14iIiIi6ngc9BIRERFRx+Ogl4iIiIg6Hge9RERERNTxOOglIiIioo7HQS8RERERdTwOeomIiIio4wW8PqAoSjvSQURERETUMrsGBwe/2e5EEBERERG1Epc3EBEREVHHC7z00kvbnQYiIiIiopYKfPXVV9udBiIiIiKiluLyBiIiIiLqeBz0EhEREVHH+3//NqlATi9tBAAAAABJRU5ErkJggg=="},70313:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604223827647-ec69c9cd050c418071ca093c978f4c61.png"},72209:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240608200131606-6dd11d9390d274b9481b92545cfaa0ef.png"},72912:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606181229135-30e8fa45d7aacf2b70a88be761afdd36.png"},76158:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240611155740411-c3c91695a19c1f7ee2525f15d12287f9.png"},76669:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240602003500010-6c51b8ef565e24a4cc2ba7a6c2cc250a.png"},77359:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240609172959090-833453698b0d1b0992c7f15a591af1df.png"},77877:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604231900952-a2856138b2b177b9d7107a8bb5f27141.png"},81180:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606182254165-5dcf2fe2b6c534883887d5ccec5b5326.png"},82534:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604225427004-866c7a5ce2676730027df94db2d4354e.png"},82606:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240607192230510-0237b81b5ccc0dc66749c089b9c31db3.png"},88364:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240604230849633-7de3e96c82e8293fe2be057847d28810.png"},89837:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240606182439282-36a345c33b2d6ad6d526a6905a4c3e9c.png"},97361:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240609171701197-d415370453ad73031d5a27f10da1fbc5.png"},99554:(n,r,e)=>{e.d(r,{A:()=>i});const i=e.p+"assets/images/image-20240616173002123-71168da309fa90675814f350ff912b80.png"}}]);